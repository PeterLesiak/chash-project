class nl{constructor(){this.subscribable=new Uu(this),this.subscribers=new Set}subscribe(t){return this.subscribers.add(t),()=>this.unsubscribe(t)}unsubscribe(t){this.subscribers.delete(t)}clear(){this.subscribers.clear()}notifySubscribers(t){return[...this.subscribers].map(e=>e(t))}}class Uu{constructor(t){this.dispatcher=t}subscribe(t){return this.dispatcher.subscribe(t)}unsubscribe(t){this.dispatcher.unsubscribe(t)}}class Ye extends nl{dispatch(t){this.notifySubscribers(t)}}class K0 extends nl{constructor(){super(...arguments),this.value=!1}raise(){this.value||(this.value=!0,this.notifySubscribers())}reset(){this.value=!1}isRaised(){return this.value}subscribe(t){const e=super.subscribe(t);return this.value&&t(),e}}class Te extends nl{get current(){return this.value}set current(t){this.value=t,this.notifySubscribers(t)}constructor(t){super(),this.value=t,this.subscribable=new G0(this)}subscribe(t,e=!0){const i=super.subscribe(t);return e&&t(this.value),i}}class G0 extends Uu{get current(){return this.dispatcher.current}subscribe(t,e=!0){return this.dispatcher.subscribe(t,e)}}class Pe{get onChanged(){return this.value.subscribable}get onDisabled(){return this.disabled.subscribable}constructor(t,e){this.name=t,this.initial=e,this.type=void 0,this.spacing=!1,this.description="",this.disabled=new Te(!1),this.value=new Te(e)}get(){return this.value.current}set(t){this.value.current=this.parse(t)}parse(t){return t}serialize(){return this.value.current}clone(){return new this.constructor(this.name,this.get())}disable(t=!0){return this.disabled.current=t,this}space(t=!0){return this.spacing=t,this}describe(t){return this.description=t,this}}class da extends Pe{constructor(){super(...arguments),this.type=Boolean}parse(t){return!!t}}class Wu extends Error{constructor(t,e){typeof t=="string"?(super(t),this.remarks=e):(super(t.message),this.remarks=t.remarks,this.object=t.object,this.durationMs=t.durationMs,this.inspect=t.inspect)}}class Y0{constructor(){this.resolveCurrent=null,this.current=null}async acquire(){for(;this.current;)await this.current;this.current=new Promise(t=>{this.resolveCurrent=t})}release(){this.current=null,this.resolveCurrent?.(),this.resolveCurrent=null}}const no=[];function Xe(){const r=no.at(-1);if(!r)throw new Error("The scene is not available in the current context.");return r}function X0(r){no.push(r)}function Q0(r){if(no.pop()!==r)throw new Error("startScene/endScene were called out of order.")}function qt(){return no.at(-1)?.logger??console}const rl=[];function sn(){const r=rl.at(-1);if(!r)throw new Wu("The thread is not available in the current context.",`<p><code>useThread()</code> can only be called from within generator functions.
      It&#39;s not available during rendering.</p>
`);return r}function gc(r){rl.push(r)}function mc(r){if(rl.pop()!==r)throw new Error("startThread/endThread was called out of order.")}function*de(r){const{slides:t}=Xe(),e=sn();for(t.register(r,e.fixed),yield;t.shouldWait(r);)yield}function ds(r){return r[0].toUpperCase()+r.slice(1)}function ae(){let r;return e=>{if(e!==void 0)r=e;else return r}}function Z0(r,t){return e=>{r[t]=e}}function ju(r){return{message:r.message,stack:r.stack,remarks:r.remarks}}function Hu(r,t){return{level:qe.Error,message:r,remarks:(t??"")+`<p>This feature requires enabling the <code>experimentalFeatures</code> flag in your project
configuration:</p>
<pre class=""><code class="language-ts"><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-title function_">makeProject</span>({
  <span class="hljs-attr">experimentalFeatures</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-comment">// ...</span>
});</code></pre><p><a href='https://motioncanvas.io/docs/experimental' target='_blank'>Learn more</a> about experimental
features.</p>
`}}const J0=180/Math.PI,pa=Math.PI/180;function vc(r,t,e){let i=0,s=r;t!==void 0&&(i=r,s=t),e=e===void 0?i<s?1:-1:e;const n=[];let o=Math.max(Math.ceil((s-i)/e),0),a=0;for(;o--;)n[a++]=i,i+=e;return n}function tv(r){const t=Xe(),e=sn();return t.timeEvents.register(r,e.time())}const ol=[];function Vu(){const r=ol.at(-1);if(!r)throw new Error("The playback is not available in the current context.");return r}function ev(r){ol.push(r)}function iv(r){if(ol.pop()!==r)throw new Error("startPlayback/endPlayback were called out of order.")}function ze(r,...t){const e={[r.name]:r},i=Object.getOwnPropertyDescriptor(e,r.name);if(i)for(let s=t.length-1;s>=0;s--)t[s](e,r.name,i)}const yc=Symbol.for("@motion-canvas/core/decorators/UNINITIALIZED");function ro(r){return(t,e)=>{let i=yc;Object.defineProperty(t,e,{get(){return i===yc&&(i=r.call(this)),i}})}}function Et(r){return function(t,e,i){i.value.prototype.name=r??e,i.value.prototype.threadable=!0}}ze(Lt,Et());function*Lt(...r){for(const t of r)yield t;yield*al(...r)}ze(qu,Et());function*qu(...r){for(const t of r)oo(t)?yield*t:t()}ze(sv,Et());function*sv(r,t){yield*It(tv(r)),t&&(yield*t)}ze(It,Et());function*It(r=0,t){const e=sn(),i=Vu().framesToSeconds(1),s=e.time()+r;for(;s-i>e.fixed;)yield;e.time(s),t&&(yield*t)}ze(Ku,Et());function*Ku(r,t){yield*It(r),oo(t)?yield*t:t()}ze(Gu,Et());function*Gu(r,t){if(typeof r!="number"&&(t=r,r=1/0),r===1/0&&sn().parent===null){qt().error({message:"Tried to execute an infinite loop in the main thread.",remarks:`<p>Make sure to use <code>yield</code> or <code>spawn()</code> to execute the loop concurrently in a
separate thread:</p>
<pre class="wrong"><code class="language-ts"><span class="hljs-keyword">yield</span>* <span class="hljs-title function_">loop</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">rect</span>().<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">opacity</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>));</code></pre><pre class="correct"><code class="language-ts"><span class="hljs-keyword">yield</span> <span class="hljs-title function_">loop</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">rect</span>().<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">opacity</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>));
<span class="hljs-comment">// or</span>
<span class="hljs-title function_">spawn</span>(<span class="hljs-title function_">loop</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">rect</span>().<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">opacity</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)));</code></pre><p>If you want to execute the loop a finite number of times, specify the iteration
count as the first argument:</p>
<pre class=""><code class="language-ts"><span class="hljs-keyword">yield</span>* <span class="hljs-title function_">loop</span>(<span class="hljs-number">10</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-title function_">rect</span>().<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0</span>).<span class="hljs-title function_">opacity</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>));
<span class="hljs-comment">//          ^ iteration count</span></code></pre>`,stack:new Error().stack});return}for(let e=0;e<r;e++){const i=t(e);i?yield*i:yield}}ze(Yu,Et());function*Yu(){}function bc(r,t){let e;return typeof r=="string"?(e=t(),Wr(e,r)):(e=r(),Wr(e,e)),e}ze(Xu,Et());function*Xu(r,...t){for(const e of t)yield e,yield*It(r);yield*al(...t)}function nv(r){return r&&(typeof r=="object"||typeof r=="function")&&"toPromise"in r}function oo(r){return r!==null&&typeof r=="object"&&Symbol.iterator in r&&"next"in r}function Wr(r,t){const e=Object.getPrototypeOf(r);e.threadable||(e.threadable=!0,e.name=typeof t=="string"?t:Qu(t))}function Qu(r){return Object.getPrototypeOf(r).name??null}class Ko{get onDeferred(){return this.deferred.subscribable}get fixed(){return this.fixedTime}get canceled(){return this.isCanceled||(this.parent?.canceled??!1)}get paused(){return this.isPaused||(this.parent?.paused??!1)}get root(){return this.parent?.root??this}constructor(t){this.runner=t,this.deferred=new Ye,this.children=[],this.time=ye(0),this.parent=null,this.isCanceled=!1,this.isPaused=!1,this.fixedTime=0,this.queue=[],this.runner.task&&(qt().error({message:`The generator "${Qu(this.runner)}" is already being executed by another thread.`,remarks:`<p>This usually happens when you mistakenly reuse a generator that is already
running.</p>
<p>For example, using <code>yield</code> here will run the opacity generator concurrently and
store it in the <code>task</code> variable (in case you want to cancel or await it later):</p>
<pre class=""><code class="language-ts"><span class="hljs-keyword">const</span> task = <span class="hljs-keyword">yield</span> <span class="hljs-title function_">rect</span>().<span class="hljs-title function_">opacity</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);</code></pre><p>Trying to <code>yield</code> this task again will cause the current error:</p>
<pre class=""><code class="language-ts"><span class="hljs-keyword">yield</span> task;</code></pre><p>Passing it to other flow functions will also cause the error:</p>
<pre class=""><code class="language-ts"><span class="hljs-keyword">yield</span>* <span class="hljs-title function_">all</span>(task);</code></pre><p>Try to investigate your code looking for <code>yield</code> statements whose return value
is reused in this way. Here&#39;s an example of a common mistake:</p>
<pre class="wrong"><code class="language-ts"><span class="hljs-keyword">yield</span>* <span class="hljs-title function_">all</span>(
  <span class="hljs-keyword">yield</span> <span class="hljs-title function_">rect</span>().<span class="hljs-title function_">opacity</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>), 
  <span class="hljs-keyword">yield</span> <span class="hljs-title function_">rect</span>().<span class="hljs-title function_">x</span>(<span class="hljs-number">200</span>, <span class="hljs-number">1</span>),
);</code></pre><pre class="correct"><code class="language-ts"><span class="hljs-keyword">yield</span>* <span class="hljs-title function_">all</span>(
  <span class="hljs-title function_">rect</span>().<span class="hljs-title function_">opacity</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>), 
  <span class="hljs-title function_">rect</span>().<span class="hljs-title function_">x</span>(<span class="hljs-number">200</span>, <span class="hljs-number">1</span>),
);</code></pre>`}),this.runner=Yu()),this.runner.task=this}next(){if(this.paused)return{value:null,done:!1};gc(this);const t=this.runner.next(this.value);return mc(this),this.value=null,t}update(t){this.paused||(this.time(this.time()+t),this.fixedTime+=t),this.children=this.children.filter(e=>!e.canceled)}spawn(t){return oo(t)||(t=t()),this.queue.push(t),t}add(t){t.parent=this,t.isCanceled=!1,t.time(this.time()),t.fixedTime=this.fixedTime,this.children.push(t),Wr(t.runner,`unknown ${this.children.length}`)}drain(t){this.queue.forEach(t),this.queue=[]}cancel(){this.deferred.clear(),this.runner.return(),this.isCanceled=!0,this.parent=null,this.drain(t=>t.return())}pause(t){this.isPaused=t}runDeferred(){gc(this),this.deferred.dispatch(),mc(this)}}ze(al,Et());function*al(r,...t){let e=!0;typeof r=="boolean"?e=r:t.push(r);const i=sn(),s=t.map(a=>i.children.find(l=>l.runner===a)).filter(a=>a),n=i.time();let o;if(e){for(;s.find(a=>!a.canceled);)yield;o=Math.max(...s.map(a=>a.time()))}else{for(;!s.find(l=>l.canceled);)yield;const a=s.filter(l=>l.canceled);o=Math.min(...a.map(l=>l.time()))}i.time(Math.max(n,o))}function rv(r){return typeof r?.then=="function"}ze(Zu,Et());function*Zu(r,t){const e=Vu(),i=r();Wr(i,"root");const s=new Ko(i);t?.(s);let n=[s];for(;n.length>0;){const o=[],a=[...n],l=e.deltaTime;for(;a.length>0;){const h=a.pop();if(!h||h.canceled)continue;const c=h.next();if(c.done){h.cancel();continue}if(oo(c.value)){const f=new Ko(c.value);h.value=c.value,h.add(f),a.push(h),a.push(f)}else c.value?(h.value=yield c.value,a.push(h)):(h.update(l),h.drain(f=>{const p=new Ko(f);h.add(p),o.unshift(p)}),o.unshift(h))}n=[];for(const h of o)h.canceled||(n.push(h),h.runDeferred());n.length>0&&(yield)}}var li;(function(r){r[r.BeforeRender=0]="BeforeRender",r[r.BeginRender=1]="BeginRender",r[r.FinishRender=2]="FinishRender",r[r.AfterRender=3]="AfterRender"})(li||(li={}));class ov{get onBeforeRender(){return this.beforeRender.subscribable}get onBeginRender(){return this.beginRender.subscribable}get onFinishRender(){return this.finishRender.subscribable}get onAfterRender(){return this.afterRender.subscribable}constructor(t){this.scene=t,this.beforeRender=new Ye,this.beginRender=new Ye,this.finishRender=new Ye,this.afterRender=new Ye,this.scene.onRenderLifecycle.subscribe(([e,i])=>{switch(e){case li.BeforeRender:return this.beforeRender.dispatch(i);case li.BeginRender:return this.beginRender.dispatch(i);case li.FinishRender:return this.finishRender.dispatch(i);case li.AfterRender:return this.afterRender.dispatch(i)}}),this.scene.onReset.subscribe(()=>{this.beforeRender.clear(),this.beginRender.clear(),this.finishRender.clear(),this.afterRender.clear()})}}class Vs{constructor(t){this.state=t,this.nextGauss=null}static createSeed(){return Math.floor(Math.random()*4294967296)}nextFloat(t=0,e=1){return ot(t,e,this.next())}nextInt(t=0,e=4294967296){let i=Math.floor(ot(t,e,this.next()));return i===e&&(i=t),i}gauss(t=0,e=1){let i=this.nextGauss;if(this.nextGauss=null,i===null){const s=this.next()*2*Math.PI,n=Math.sqrt(-2*Math.log(1-this.next()));i=Math.cos(s)*n,this.nextGauss=Math.sin(s)*n}return t+i*e}floatArray(t,e=0,i=1){return vc(t).map(()=>this.nextFloat(e,i))}intArray(t,e=0,i=4294967296){return vc(t).map(()=>this.nextInt(e,i))}spawn(){return new Vs(this.nextInt())}next(){this.state|=0,this.state=this.state+1831565813|0;let t=Math.imul(this.state^this.state>>>15,1|this.state);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}var ee;(function(r){r[r.Initial=0]="Initial",r[r.AfterTransitionIn=1]="AfterTransitionIn",r[r.CanTransitionOut=2]="CanTransitionOut",r[r.Finished=3]="Finished"})(ee||(ee={}));const av="resolution",lv="destinationTexture",hv="sourceTexture",wc="time",cv="deltaTime",uv="framerate",fv="sourceMatrix",dv="destinationMatrix",pv=`#version 300 es

in vec2 position;

out vec2 screenUV;
out vec2 sourceUV;
out vec2 destinationUV;

uniform mat4 sourceMatrix;
uniform mat4 destinationMatrix;

void main() {
    vec2 position_source = position * 0.5 + 0.5;
    vec4 position_screen = sourceMatrix * vec4(position_source, 0, 1);

    screenUV = position_screen.xy;
    sourceUV = position_source;
    destinationUV = (destinationMatrix * position_screen).xy;

    gl_Position = (position_screen - 0.5) * 2.0;
}
`;class gv{constructor(t,e){this.scene=t,this.sharedContext=e,this.gl=null,this.positionBuffer=null,this.sourceTexture=null,this.destinationTexture=null,this.positionLocation=0,this.quadPositions=new Float32Array([-1,1,-1,-1,1,1,1,-1]),this.handleReload=()=>{this.gl&&this.updateViewport()},t.onReloaded.subscribe(this.handleReload)}setup(t){this.gl=t,this.updateViewport(),this.positionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.positionBuffer),t.bufferData(t.ARRAY_BUFFER,this.quadPositions,t.STATIC_DRAW),t.vertexAttribPointer(this.positionLocation,2,t.FLOAT,!1,0,0),t.enableVertexAttribArray(this.positionLocation),this.sourceTexture=t.createTexture(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.sourceTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.destinationTexture=t.createTexture(),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,this.destinationTexture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}teardown(t){t.deleteBuffer(this.positionBuffer),t.disableVertexAttribArray(this.positionLocation),t.deleteTexture(this.sourceTexture),t.deleteTexture(this.destinationTexture),this.positionBuffer=null,this.sourceTexture=null,this.destinationTexture=null,this.gl=null}updateViewport(){if(this.gl){const t=this.scene.getRealSize();this.gl.canvas.width=t.width,this.gl.canvas.height=t.height,this.gl.viewport(0,0,t.width,t.height)}}getGL(){return this.gl??this.sharedContext.borrow(this)}getProgram(t){const e=this.sharedContext.getProgram(t,pv);if(!e)return null;const i=this.scene.getRealSize(),s=this.getGL();return s.useProgram(e),s.uniform1i(s.getUniformLocation(e,hv),0),s.uniform1i(s.getUniformLocation(e,lv),1),s.uniform2f(s.getUniformLocation(e,av),i.x,i.y),s.uniform1f(s.getUniformLocation(e,cv),this.scene.playback.deltaTime),s.uniform1f(s.getUniformLocation(e,uv),this.scene.playback.fps),e}copyTextures(t,e){this.copyTexture(e,this.sourceTexture),this.copyTexture(t,this.destinationTexture)}clear(){const t=this.getGL();t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)}render(){const t=this.getGL();t.drawArrays(t.TRIANGLE_STRIP,0,4)}copyTexture(t,e){const i=this.getGL();i.bindTexture(i.TEXTURE_2D,e),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),i.generateMipmap(i.TEXTURE_2D)}}var Pn;(function(r){r[r.Playing=0]="Playing",r[r.Rendering=1]="Rendering",r[r.Paused=2]="Paused",r[r.Presenting=3]="Presenting"})(Pn||(Pn={}));class mv{get onChanged(){return this.slides.subscribable}constructor(t){this.scene=t,this.slides=new Te([]),this.lookup=new Map,this.collisionLookup=new Set,this.current=null,this.canResume=!1,this.waitsForId=null,this.targetId=null,this.handleReload=()=>{this.lookup.clear(),this.collisionLookup.clear(),this.current=null,this.waitsForId=null,this.targetId=null},this.handleReset=()=>{this.collisionLookup.clear(),this.current=null,this.waitsForId=null},this.handleRecalculated=()=>{this.slides.current=[...this.lookup.values()]},this.scene.onReloaded.subscribe(this.handleReload),this.scene.onReset.subscribe(this.handleReset),this.scene.onRecalculated.subscribe(this.handleRecalculated)}setTarget(t){this.targetId=t}resume(){this.canResume=!0}isWaitingFor(t){return this.waitsForId===t}isWaiting(){return this.waitsForId!==null}didHappen(t){if(this.current===null)return!1;for(const e of this.lookup.keys()){if(e===t)return!0;if(e===this.current?.id)return!1}return!1}getCurrent(){return this.current}register(t,e){if(this.waitsForId!==null)throw new Error(`The animation already waits for a slide: ${this.waitsForId}.`);const i=this.toId(t);this.scene.playback.state!==Pn.Presenting&&(this.lookup.has(i)||this.lookup.set(i,{id:i,name:t,time:e,scene:this.scene,stack:new Error().stack}),this.collisionLookup.has(t)?this.scene.logger.warn({message:`A slide named "${t}" already exists.`,stack:new Error().stack}):this.collisionLookup.add(t)),this.waitsForId=i,this.current=this.lookup.get(i)??null,this.canResume=!1}shouldWait(t){const e=this.toId(t);if(this.waitsForId!==e)throw new Error(`The animation waits for a different slide: ${this.waitsForId}.`);if(!this.lookup.get(e))throw new Error(`Could not find the "${t}" slide.`);let s=this.canResume;return this.scene.playback.state!==Pn.Presenting&&(s=e!==this.targetId),s&&(this.waitsForId=null),!s}toId(t){return`${this.scene.name}:${t}`}}class vv{constructor(t){this.scene=t,this.signals={},this.variables={},this.handleReset=()=>{this.signals={}},t.onReset.subscribe(this.handleReset)}get(t,e){var i;return(i=this.signals)[t]??(i[t]=ye(this.variables[t]??e)),()=>this.signals[t]()}updateSignals(t){this.variables=t,Object.keys(t).map(e=>{e in this.signals&&this.signals[e](t[e])})}}class yv{get firstFrame(){return this.cache.current.firstFrame}get lastFrame(){return this.firstFrame+this.cache.current.duration}get onCacheChanged(){return this.cache.subscribable}get onReloaded(){return this.reloaded.subscribable}get onRecalculated(){return this.recalculated.subscribable}get onThreadChanged(){return this.thread.subscribable}get onRenderLifecycle(){return this.renderLifecycle.subscribable}get onReset(){return this.afterReset.subscribable}get LifecycleEvents(){return this.logger.warn("LifecycleEvents is deprecated. Use lifecycleEvents instead."),this.lifecycleEvents}get previous(){return this.previousScene}constructor(t){this.cache=new Te({firstFrame:0,transitionDuration:0,duration:0,lastFrame:0}),this.reloaded=new Ye,this.recalculated=new Ye,this.thread=new Te(null),this.renderLifecycle=new Ye,this.afterReset=new Ye,this.lifecycleEvents=new ov(this),this.previousScene=null,this.runner=null,this.state=ee.Initial,this.cached=!1,this.counters={},this.name=t.name,this.size=t.size,this.resolutionScale=t.resolutionScale,this.logger=t.logger,this.playback=t.playback,this.meta=t.meta,this.runnerFactory=t.config,this.creationStack=t.stack,this.experimentalFeatures=t.experimentalFeatures??!1,ze(this.runnerFactory,Et(this.name)),this.timeEvents=new t.timeEventsClass(this),this.variables=new vv(this),this.shaders=new gv(this,t.sharedWebGLContext),this.slides=new mv(this),this.random=new Vs(this.meta.seed.get()),this.previousOnTop=!1}update(){}async render(t){let e=0;do e++,await _t.consumePromises(),t.save(),t.clearRect(0,0,t.canvas.width,t.canvas.height),this.execute(()=>this.draw(t)),t.restore();while(_t.hasPromises()&&e<10);e>1&&this.logger.debug(`render iterations: ${e}`)}reload({config:t,size:e,stack:i,resolutionScale:s}={}){t&&(this.runnerFactory=t),e&&(this.size=e),s&&(this.resolutionScale=s),i&&(this.creationStack=i),this.cached=!1,this.reloaded.dispatch()}async recalculate(t){const e=this.cache.current;if(e.firstFrame=this.playback.frame,e.lastFrame=e.firstFrame+e.duration,this.isCached()){t(e.lastFrame),this.cache.current={...e};return}for(e.transitionDuration=-1,await this.reset();!this.canTransitionOut();)e.transitionDuration<0&&this.state===ee.AfterTransitionIn&&(e.transitionDuration=this.playback.frame-e.firstFrame),t(this.playback.frame+1),await this.next();e.transitionDuration===-1&&(e.transitionDuration=0),e.lastFrame=this.playback.frame,e.duration=e.lastFrame-e.firstFrame,await new Promise(i=>setTimeout(i,0)),this.cached=!0,this.cache.current={...e},this.recalculated.dispatch()}async next(){if(!this.runner)return;let t=this.execute(()=>this.runner.next());for(this.update();t.value;){if(nv(t.value)){const e=await t.value.toPromise();t=this.execute(()=>this.runner.next(e))}else if(rv(t.value)){const e=await t.value;t=this.execute(()=>this.runner.next(e))}else this.logger.warn({message:"Invalid value yielded by the scene.",object:t.value}),t=this.execute(()=>this.runner.next(t.value));this.update()}if(_t.hasPromises()){const e=await _t.consumePromises();this.logger.error({message:"Tried to access an asynchronous property before the node was ready. Make sure to yield the node before accessing the property.",stack:e[0].stack,inspect:e[0].owner?.key??void 0})}t.done&&(this.state=ee.Finished)}async reset(t=null){this.counters={},this.previousScene=t,this.previousOnTop=!1,this.random=new Vs(this.meta.seed.get()),this.runner=Zu(()=>this.runnerFactory(this.getView()),e=>{this.thread.current=e}),this.state=ee.AfterTransitionIn,this.afterReset.dispatch(),await this.next()}getSize(){return this.size}getRealSize(){return this.size.mul(this.resolutionScale)}isAfterTransitionIn(){return this.state===ee.AfterTransitionIn}canTransitionOut(){return this.state===ee.CanTransitionOut||this.state===ee.Finished}isFinished(){return this.state===ee.Finished}enterInitial(){this.state===ee.AfterTransitionIn?this.state=ee.Initial:this.logger.warn(`Scene ${this.name} entered initial in an unexpected state: ${this.state}`)}enterAfterTransitionIn(){this.state===ee.Initial?this.state=ee.AfterTransitionIn:this.logger.warn(`Scene ${this.name} transitioned in an unexpected state: ${this.state}`)}enterCanTransitionOut(){this.state===ee.AfterTransitionIn||this.state===ee.Initial?this.state=ee.CanTransitionOut:this.logger.warn(`Scene ${this.name} was marked as finished in an unexpected state: ${this.state}`)}isCached(){return this.cached}execute(t){let e;X0(this),ev(this.playback);try{e=t()}finally{iv(this.playback),Q0(this)}return e}}function bv(){return new Pi("scene",{version:new Pe("version",1),timeEvents:new Pe("time events",[]),seed:new Pe("seed",Vs.createSeed())})}function wv(r,t=!0){return typeof r=="number"?new Vs(t?r:r+Xe().meta.seed.get()):Xe().random}function Ju(r,t,e){const i=[...r],s=[...t];if(s.length>=i.length){const n=Math.floor(s.length*e),o=Math.floor(ot(i.length-1,s.length,e));let a="";for(let l=0;l<s.length;l++)l<n?a+=s[l]:(i[l]||l<=o)&&(a+=i[l]??s[l]);return a}else{const n=Math.round(i.length*(1-e)),o=Math.floor(ot(i.length+1,s.length,e)),a=[];for(let l=i.length-1;l>=0;l--)l<n?a.unshift(i[l]):(s[l]||l<o)&&a.unshift(s[l]??i[l]);return a.join("")}}function vs(r,t,e,i=!1){if(e===0)return r;if(e===1)return t;if(r==null||t==null){i||qt().warn(`Attempting to lerp ${r} -> ${t} may result in unexpected behavior.`);return}if(typeof r=="number"&&typeof t=="number")return ot(r,t,e);if(typeof r=="string"&&typeof t=="string")return Ju(r,t,e);if(typeof r=="boolean"&&typeof t=="boolean")return e<.5?r:t;if("lerp"in r)return r.lerp(t,e);if(r&&t&&typeof r=="object"&&typeof t=="object")if(Array.isArray(r)&&Array.isArray(t)){if(r.length===t.length)return r.map((s,n)=>vs(s,t[n],e))}else{let s=!1;if(!(r instanceof Map)&&!(t instanceof Map)&&(s=!0,r=new Map(Object.entries(r)),t=new Map(Object.entries(t))),r instanceof Map&&t instanceof Map){const n=new Map;for(const o of new Set([...r.keys(),...t.keys()])){const a=vs(r.get(o),t.get(o),e,!0);a!==void 0&&n.set(o,a)}return s?Object.fromEntries(n):n}}return t}function xv(r,t,e){return e<.5?r:t}function ot(r,t,e){return r+(t-r)*e}function tf(r,t,e,i,s){return e+(s-r)*(i-e)/(t-r)}function ne(r,t,e){return e<r?r:e>t?t:e}function Tn(r,t,e,i,s){const n=tf(r,t,e,i,s);return e>i&&([e,i]=[i,e]),ne(e,i,n)}function ef(r,t,e){let i=t;e>1?e=1/e:i=!i;const s=i?Math.acos(ne(-1,1,1-r)):Math.asin(r),n=ot(s,ot(0,Math.PI/2,r),e);let o=Math.sin(n),a=1-Math.cos(n);return t&&([o,a]=[a,o]),new k(o,a)}function Me(r,t=0,e=1){return r=Math.sin(r*Math.PI/2),ot(t,e,r)}function Ie(r,t=0,e=1){return r=r<.5?4*r*r*r:1-Math.pow(-2*r+2,3)/2,ot(t,e,r)}function yt(r,t=0,e=1){return r=1-Math.pow(1-r,5),ot(t,e,r)}function sf(r,t=0,e=1){return r=r===1?1:1-Math.pow(2,-10*r),ot(t,e,r)}function Sv(r=2.094395){return(t,e=0,i=1)=>(t=t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*r)+1,ot(e,i,t))}function kv(r=7.5625,t=2.75){return(e,i=0,s=1)=>(e<1/t?e=r*e*e:e<2/t?e=r*(e-=1.505/t)*e+.75:e<2.5/t?e=r*(e-=2.25/t)*e+.9375:e=r*(e-=2.625/t)*e+.984375,ot(i,s,e))}function ll(r,t=0,e=1){return ot(t,e,r)}const Cv=kv(),Ov=Sv();ze(Ge,Et());function*Ge(r,t,e){const i=sn(),s=i.time(),n=i.time()+r;for(t(0,0);n>i.fixed;){const o=i.fixed-s,a=o/r;o>0&&t(a,o),yield}i.time(n),t(1,r),e?.(1,r)}class _t{static collectPromise(t,e=null){const i={promise:t,value:e,stack:new Error().stack},s=this.collectionStack.at(-1);return s&&(i.owner=s.owner),t.then(n=>{i.value=n,s?.markDirty()}),this.promises.push(i),i}static hasPromises(){return this.promises.length>0}static async consumePromises(){const t=[...this.promises];return await Promise.all(t.map(e=>e.promise)),this.promises=this.promises.filter(e=>!t.includes(e)),t}constructor(t){this.owner=t,this.dependencies=new Set,this.event=new K0,this.markDirty=()=>this.event.raise(),this.invokable=this.invoke.bind(this),Object.defineProperty(this.invokable,"context",{value:this}),Object.defineProperty(this.invokable,"toPromise",{value:this.toPromise.bind(this)})}invoke(){}startCollecting(){if(_t.collectionSet.has(this))throw new Wu("A circular dependency occurred between signals.",`This can happen when signals reference each other in a loop.
        Try using the attached stack trace to locate said loop.`);_t.collectionSet.add(this),_t.collectionStack.push(this)}finishCollecting(){if(_t.collectionSet.delete(this),_t.collectionStack.pop()!==this)throw new Error("collectStart/collectEnd was called out of order.")}clearDependencies(){this.dependencies.forEach(t=>t.unsubscribe(this.markDirty)),this.dependencies.clear()}collect(){const t=_t.collectionStack.at(-1);t&&(t.dependencies.add(this.event.subscribable),this.event.subscribe(t.markDirty))}dispose(){this.clearDependencies(),this.event.clear(),this.owner=null}async toPromise(){do await _t.consumePromises(),this.invokable();while(_t.hasPromises());return this.invokable}}_t.collectionSet=new Set;_t.collectionStack=[];_t.promises=[];const Be=Symbol.for("@motion-canvas/core/signals/default");function Oi(r){return typeof r=="function"}function ps(r,t){return Oi(r)?()=>t(r()):t(r)}function Ht(r){return Oi(r)?r():r}class Gi extends _t{constructor(t,e,i=void 0,s=o=>o,n={}){super(i),this.initial=t,this.interpolation=e,this.parser=s,this.tweening=!1,Object.defineProperty(this.invokable,"reset",{value:this.reset.bind(this)}),Object.defineProperty(this.invokable,"save",{value:this.save.bind(this)}),Object.defineProperty(this.invokable,"isInitial",{value:this.isInitial.bind(this)}),this.initial!==void 0&&(this.current=this.initial,this.markDirty(),Oi(this.initial)||(this.last=this.parse(this.initial))),this.extensions={getter:this.getter.bind(this),setter:this.setter.bind(this),tweener:this.tweener.bind(this),...n}}toSignal(){return this.invokable}parse(t){return this.parser(t)}set(t){return this.extensions.setter(t),this.owner}setter(t){return t===Be&&(t=this.initial),this.current===t?this.owner:(this.current=t,this.clearDependencies(),Oi(t)||(this.last=this.parse(t)),this.markDirty(),this.owner)}get(){return this.extensions.getter()}getter(){if(this.event.isRaised()&&Oi(this.current)){this.clearDependencies(),this.startCollecting();try{this.last=this.parse(this.current())}catch(t){qt().error({...ju(t),inspect:this.owner?.key})}this.finishCollecting()}return this.event.reset(),this.collect(),this.last}invoke(t,e,i=Ie,s=this.interpolation){return t===void 0?this.get():e===void 0?this.set(t):this.createQueue(i,s).to(t,e)}createQueue(t,e){const i=this.get(),s=[],n=bc("animation chain",function*(){for(;s.length>0;)yield*s.shift()});return n.to=(o,a,l=t,h=e)=>(t=l,e=h,s.push(this.tween(o,a,l,h)),n),n.back=(o,a=t,l=e)=>(t=a,e=l,s.push(this.tween(i,o,t,e)),n),n.wait=o=>(s.push(It(o)),n),n.run=o=>(s.push(o),n),n.do=o=>(s.push(bc(function*(){o()})),n),n}*tween(t,e,i,s){t===Be&&(t=this.initial),this.tweening=!0,yield*this.extensions.tweener(t,e,i,s),this.set(t),this.tweening=!1}*tweener(t,e,i,s){const n=this.get();yield*Ge(e,o=>{this.set(s(n,this.parse(Ht(t)),i(o)))})}dispose(){super.dispose(),this.initial=void 0,this.current=void 0,this.last=void 0}reset(){return this.initial!==void 0&&this.set(this.initial),this.owner}save(){return this.set(this.get())}isInitial(){return this.collect(),this.current===this.initial}getInitial(){return this.initial}raw(){return this.current}isTweening(){return this.tweening}}class ao extends Gi{constructor(t,e,i,s,n=void 0,o={}){var a;super(void 0,s,n,e,o),this.entries=t,this.signals=[],this.parser=e;for(const l of t){let h,c;Array.isArray(l)?([h,c]=l,(a=c.context).owner??(a.owner=this)):(h=l,c=new Gi(ps(i,f=>e(f)[l]),ot,n??this.invokable).toSignal()),this.signals.push([h,c]),Object.defineProperty(this.invokable,h,{value:c})}}toSignal(){return this.invokable}parse(t){return this.parser(t)}getter(){return this.parse(Object.fromEntries(this.signals.map(([t,e])=>[t,e()])))}setter(t){if(Oi(t))for(const[e,i]of this.signals)i(()=>this.parser(t())[e]);else{const e=this.parse(t);for(const[i,s]of this.signals)s(e[i])}return this.owner}reset(){for(const[,t]of this.signals)t.reset();return this.owner}save(){for(const[,t]of this.signals)t.save();return this.owner}isInitial(){for(const[,t]of this.signals)if(!t.isInitial())return!1;return!0}raw(){return Object.fromEntries(this.signals.map(([t,e])=>[t,e.context.raw()]))}}class Pv extends _t{constructor(t,e){super(e),this.factory=t,this.markDirty()}toSignal(){return this.invokable}dispose(){super.dispose(),this.last=void 0}invoke(...t){if(this.event.isRaised()){this.clearDependencies(),this.startCollecting();try{this.last=this.factory(...t)}catch(e){qt().error({...ju(e),inspect:this.owner?.key})}this.finishCollecting()}return this.event.reset(),this.collect(),this.last}}class nf extends ao{constructor(t,e,i,s,n=void 0,o={}){super(t,e,i,s,n,o),Object.defineProperty(this.invokable,"edit",{value:this.edit.bind(this)}),Object.defineProperty(this.invokable,"mul",{value:this.mul.bind(this)}),Object.defineProperty(this.invokable,"div",{value:this.div.bind(this)}),Object.defineProperty(this.invokable,"add",{value:this.add.bind(this)}),Object.defineProperty(this.invokable,"sub",{value:this.sub.bind(this)}),Object.defineProperty(this.invokable,"dot",{value:this.dot.bind(this)}),Object.defineProperty(this.invokable,"cross",{value:this.cross.bind(this)}),Object.defineProperty(this.invokable,"mod",{value:this.mod.bind(this)})}toSignal(){return this.invokable}edit(t,e,i,s){const n=t(this.get());return this.invoke(n,e,i,s)}mul(t,e,i,s){const n=o=>o.mul(t);return e===void 0?this.edit(n):this.edit(n,e,i,s)}div(t,e,i,s){const n=o=>o.div(t);return e===void 0?this.edit(n):this.edit(n,e,i,s)}add(t,e,i,s){const n=o=>o.add(t);return e===void 0?this.edit(n):this.edit(n,e,i,s)}sub(t,e,i,s){const n=o=>o.sub(t);return e===void 0?this.edit(n):this.edit(n,e,i,s)}dot(t,e,i,s){const n=o=>o.dot(t);return e===void 0?this.edit(n):this.edit(n,e,i,s)}cross(t,e,i,s){const n=o=>o.cross(t);return e===void 0?this.edit(n):this.edit(n,e,i,s)}mod(t,e,i,s){const n=o=>o.mod(t);return e===void 0?this.edit(n):this.edit(n,e,i,s)}}function Tv(r,t){return new Pv(r,t).toSignal()}function ye(r,t=vs,e){return new Gi(r,t,e).toSignal()}class Ke{static createSignal(t,e=Ke.lerp){return new ao(["top","right","bottom","left"],i=>new Ke(i),t,e).toSignal()}static lerp(t,e,i){return new Ke(ot(t.top,e.top,i),ot(t.right,e.right,i),ot(t.bottom,e.bottom,i),ot(t.left,e.left,i))}get x(){return this.left+this.right}get y(){return this.top+this.bottom}constructor(t=0,e,i,s){if(this.top=0,this.right=0,this.bottom=0,this.left=0,t!=null){if(Array.isArray(t)&&(s=t[3],i=t[2],e=t[1],t=t[0]),typeof t=="number"){this.top=t,this.right=e!==void 0?e:t,this.bottom=i!==void 0?i:t,this.left=s!==void 0?s:e!==void 0?e:t;return}this.top=t.top,this.right=t.right,this.bottom=t.bottom,this.left=t.left}}lerp(t,e){return Ke.lerp(this,t,e)}scale(t){return new Ke(this.top*t,this.right*t,this.bottom*t,this.left*t)}addScalar(t){return new Ke(this.top+t,this.right+t,this.bottom+t,this.left+t)}toSymbol(){return Ke.symbol}toString(){return`Spacing(${this.top}, ${this.right}, ${this.bottom}, ${this.left})`}toUniform(t,e){t.uniform4f(e,this.top,this.right,this.bottom,this.left)}serialize(){return{top:this.top,right:this.right,bottom:this.bottom,left:this.left}}}Ke.symbol=Symbol.for("@motion-canvas/core/types/Spacing");const wn=1e-6;class Nt{static fromRotation(t){return Nt.identity.rotate(t)}static fromTranslation(t){return Nt.identity.translate(new k(t))}static fromScaling(t){return Nt.identity.scale(new k(t))}get x(){return new k(this.values[0],this.values[1])}get y(){return new k(this.values[2],this.values[3])}get scaleX(){return this.values[0]}set scaleX(t){this.values[0]=this.x.normalized.scale(t).x}get skewX(){return this.values[1]}set skewX(t){this.values[1]=t}get scaleY(){return this.values[3]}set scaleY(t){this.values[3]=this.y.normalized.scale(t).y}get skewY(){return this.values[2]}set skewY(t){this.values[2]=t}get translateX(){return this.values[4]}set translateX(t){this.values[4]=t}get translateY(){return this.values[5]}set translateY(t){this.values[5]=t}get rotation(){return k.degrees(this.values[0],this.values[1])}set rotation(t){const e=this.rotate(t-this.rotation);this.values[0]=e.values[0],this.values[1]=e.values[1],this.values[2]=e.values[2],this.values[3]=e.values[3]}get translation(){return new k(this.values[4],this.values[5])}set translation(t){const e=new k(t);this.values[4]=e.x,this.values[5]=e.y}get scaling(){return new k(this.values[0],this.values[3])}set scaling(t){const e=new k(t),i=new k(this.values[0],this.values[1]).normalized,s=new k(this.values[2],this.values[3]).normalized;this.values[0]=i.x*e.x,this.values[1]=i.y*e.y,this.values[2]=s.x*e.x,this.values[3]=s.y*e.y}get inverse(){const t=this.values[0],e=this.values[1],i=this.values[2],s=this.values[3],n=this.values[4],o=this.values[5];let a=t*s-e*i;return a?(a=1/a,new Nt(s*a,-e*a,-i*a,t*a,(i*o-s*n)*a,(e*n-t*o)*a)):null}get determinant(){return this.values[0]*this.values[3]-this.values[1]*this.values[2]}get domMatrix(){return new DOMMatrix([this.values[0],this.values[1],this.values[2],this.values[3],this.values[4],this.values[5]])}constructor(t,e,i,s,n,o){if(this.values=new Float32Array(6),arguments.length===0){this.values=new Float32Array([1,0,0,1,0,0]);return}if(arguments.length===6){this.values[0]=t,this.values[1]=e,this.values[2]=i,this.values[3]=s,this.values[4]=n,this.values[5]=o;return}if(t instanceof DOMMatrix){this.values[0]=t.m11,this.values[1]=t.m12,this.values[2]=t.m21,this.values[3]=t.m22,this.values[4]=t.m41,this.values[5]=t.m42;return}if(t instanceof Nt){this.values=t.values;return}if(Array.isArray(t)){if(t.length===2){this.values[0]=t[0],this.values[1]=t[1],this.values[2]=e[0],this.values[3]=e[1],this.values[4]=i[0],this.values[5]=i[1];return}if(t.length===3){const c=new k(t[0]),f=new k(t[1]),p=new k(t[2]);this.values[0]=c.x,this.values[1]=c.y,this.values[2]=f.x,this.values[3]=f.y,this.values[4]=p.x,this.values[5]=p.y;return}this.values[0]=t[0],this.values[1]=t[1],this.values[2]=t[2],this.values[3]=t[3],this.values[4]=t[4],this.values[5]=t[5];return}const a=new k(t),l=new k(e),h=new k(i);this.values[0]=a.x,this.values[1]=a.y,this.values[2]=l.x,this.values[3]=l.y,this.values[4]=h.x,this.values[5]=h.y}column(t){return new k(this.values[t*2],this.values[t*2+1])}row(t){return[this.values[t],this.values[t+2],this.values[t+4]]}mul(t){const e=this.values[0],i=this.values[1],s=this.values[2],n=this.values[3],o=this.values[4],a=this.values[5],l=t.values[0],h=t.values[1],c=t.values[2],f=t.values[3],p=t.values[4],m=t.values[5];return new Nt(e*l+s*h,i*l+n*h,e*c+s*f,i*c+n*f,e*p+s*m+o,i*p+n*m+a)}rotate(t,e=!0){e&&(t*=pa);const i=this.values[0],s=this.values[1],n=this.values[2],o=this.values[3],a=this.values[4],l=this.values[5],h=Math.sin(t),c=Math.cos(t);return new Nt(i*c+n*h,s*c+o*h,i*-h+n*c,s*-h+o*c,a,l)}scale(t){const e=new k(t);return new Nt(this.values[0]*e.x,this.values[1]*e.x,this.values[2]*e.y,this.values[3]*e.y,this.values[4],this.values[5])}mulScalar(t){return new Nt(this.values[0]*t,this.values[1]*t,this.values[2]*t,this.values[3]*t,this.values[4]*t,this.values[5]*t)}translate(t){const e=new k(t);return new Nt(this.values[0],this.values[1],this.values[2],this.values[3],this.values[0]*e.x+this.values[2]*e.y+this.values[4],this.values[1]*e.x+this.values[3]*e.y+this.values[5])}add(t){return new Nt(this.values[0]+t.values[0],this.values[1]+t.values[1],this.values[2]+t.values[2],this.values[3]+t.values[3],this.values[4]+t.values[4],this.values[5]+t.values[5])}sub(t){return new Nt(this.values[0]-t.values[0],this.values[1]-t.values[1],this.values[2]-t.values[2],this.values[3]-t.values[3],this.values[4]-t.values[4],this.values[5]-t.values[5])}toSymbol(){return Nt.symbol}toUniform(t,e){t.uniformMatrix3fv(e,!1,[this.values[0],this.values[1],0,this.values[2],this.values[3],0,this.values[4],this.values[5],1])}equals(t,e=wn){return Math.abs(this.values[0]-t.values[0])<=e+Number.EPSILON&&Math.abs(this.values[1]-t.values[1])<=e+Number.EPSILON&&Math.abs(this.values[2]-t.values[2])<=e+Number.EPSILON&&Math.abs(this.values[3]-t.values[3])<=e+Number.EPSILON&&Math.abs(this.values[4]-t.values[4])<=e+Number.EPSILON&&Math.abs(this.values[5]-t.values[5])<=e+Number.EPSILON}exactlyEquals(t){return this.values[0]===t.values[0]&&this.values[1]===t.values[1]&&this.values[2]===t.values[2]&&this.values[3]===t.values[3]&&this.values[4]===t.values[4]&&this.values[5]===t.values[5]}}Nt.symbol=Symbol.for("@motion-canvas/core/types/Matrix2D");Nt.identity=new Nt(1,0,0,1,0,0);Nt.zero=new Nt(0,0,0,0,0,0);var xc;(function(r){r[r.Vertical=1]="Vertical",r[r.Horizontal=2]="Horizontal"})(xc||(xc={}));var Qt;(function(r){r[r.Top=4]="Top",r[r.Bottom=8]="Bottom",r[r.Left=16]="Left",r[r.Right=32]="Right"})(Qt||(Qt={}));var Bt;(function(r){r[r.Middle=3]="Middle",r[r.Top=5]="Top",r[r.Bottom=9]="Bottom",r[r.Left=18]="Left",r[r.Right=34]="Right",r[r.TopLeft=20]="TopLeft",r[r.TopRight=36]="TopRight",r[r.BottomLeft=24]="BottomLeft",r[r.BottomRight=40]="BottomRight"})(Bt||(Bt={}));function Av(r){if(r===Bt.Middle)return k.zero;let t=0;r&Qt.Left?t=-1:r&Qt.Right&&(t=1);let e=0;return r&Qt.Top?e=-1:r&Qt.Bottom&&(e=1),new k(t,e)}class k{static createSignal(t,e=k.lerp,i){return new nf(["x","y"],s=>new k(s),t,e,i).toSignal()}static lerp(t,e,i){let s,n;return typeof i=="number"?s=n=i:(s=i.x,n=i.y),new k(ot(t.x,e.x,s),ot(t.y,e.y,n))}static arcLerp(t,e,i,s=!1,n){return n??(n=t.sub(e).ctg),k.lerp(t,e,ef(i,s,n))}static createArcLerp(t,e){return(i,s,n)=>k.arcLerp(i,s,n,t,e)}static polarLerp(t,e,i,s=!1,n=k.zero){t=t.sub(n),e=e.sub(n);const o=t.degrees;let a=e.degrees;o>a!==s&&(a=a+(s?-360:360));const h=ot(o,a,i)*pa,c=ot(t.magnitude,e.magnitude,i);return new k(c*Math.cos(h)+n.x,c*Math.sin(h)+n.y)}static createPolarLerp(t=!1,e=k.zero){return(i,s,n)=>k.polarLerp(i,s,n,t,new k(e))}static fromOrigin(t){const e=new k;return t===Bt.Middle||(t&Qt.Left?e.x=-1:t&Qt.Right&&(e.x=1),t&Qt.Top?e.y=-1:t&Qt.Bottom&&(e.y=1)),e}static fromScalar(t){return new k(t,t)}static fromRadians(t){return new k(Math.cos(t),Math.sin(t))}static fromDegrees(t){return k.fromRadians(t*pa)}static radians(t,e){return Math.atan2(e,t)}static degrees(t,e){return k.radians(t,e)*J0}static magnitude(t,e){return Math.sqrt(t*t+e*e)}static squaredMagnitude(t,e){return t*t+e*e}static angleBetween(t,e){return Math.acos(ne(-1,1,t.dot(e)/(t.magnitude*e.magnitude)))*(t.cross(e)>=0?1:-1)}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}get magnitude(){return k.magnitude(this.x,this.y)}get squaredMagnitude(){return k.squaredMagnitude(this.x,this.y)}get normalized(){return this.scale(1/k.magnitude(this.x,this.y))}get safe(){return new k(isNaN(this.x)?0:this.x,isNaN(this.y)?0:this.y)}get flipped(){return new k(-this.x,-this.y)}get floored(){return new k(Math.floor(this.x),Math.floor(this.y))}get rounded(){return new k(Math.round(this.x),Math.round(this.y))}get ceiled(){return new k(Math.ceil(this.x),Math.ceil(this.y))}get perpendicular(){return new k(this.y,-this.x)}get radians(){return k.radians(this.x,this.y)}get degrees(){return k.degrees(this.x,this.y)}get ctg(){return this.x/this.y}constructor(t,e){if(this.x=0,this.y=0,t!=null){if(typeof t!="object"){this.x=t,this.y=e??t;return}if(Array.isArray(t)){this.x=t[0],this.y=t[1];return}if("width"in t){this.x=t.width,this.y=t.height;return}this.x=t.x,this.y=t.y}}lerp(t,e){return k.lerp(this,t,e)}getOriginOffset(t){const e=k.fromOrigin(t);return e.x*=this.x/2,e.y*=this.y/2,e}scale(t){return new k(this.x*t,this.y*t)}transformAsPoint(t){const e=new Nt(t);return new k(this.x*e.scaleX+this.y*e.skewY+e.translateX,this.x*e.skewX+this.y*e.scaleY+e.translateY)}transform(t){const e=new Nt(t);return new k(this.x*e.scaleX+this.y*e.skewY,this.x*e.skewX+this.y*e.scaleY)}mul(t){const e=new k(t);return new k(this.x*e.x,this.y*e.y)}div(t){const e=new k(t);return new k(this.x/e.x,this.y/e.y)}add(t){const e=new k(t);return new k(this.x+e.x,this.y+e.y)}sub(t){const e=new k(t);return new k(this.x-e.x,this.y-e.y)}dot(t){const e=new k(t);return this.x*e.x+this.y*e.y}cross(t){const e=new k(t);return this.x*e.y-this.y*e.x}mod(t){const e=new k(t);return new k(this.x%e.x,this.y%e.y)}rotate(t,e=k.zero){const i=new k(e),s=Nt.fromTranslation(i).rotate(t).translate(i.flipped);return this.transformAsPoint(s)}addX(t){return new k(this.x+t,this.y)}addY(t){return new k(this.x,this.y+t)}map(t){return new k(t(this.x,0),t(this.y,1))}toSymbol(){return k.symbol}toString(){return`Vector2(${this.x}, ${this.y})`}toArray(){return[this.x,this.y]}toUniform(t,e){t.uniform2f(e,this.x,this.y)}serialize(){return{x:this.x,y:this.y}}exactlyEquals(t){return this.x===t.x&&this.y===t.y}equals(t,e=wn){return Math.abs(this.x-t.x)<=e+Number.EPSILON&&Math.abs(this.y-t.y)<=e+Number.EPSILON}*[Symbol.iterator](){yield this.x,yield this.y}}k.symbol=Symbol.for("@motion-canvas/core/types/Vector2");k.zero=new k;k.one=new k(1,1);k.right=new k(1,0);k.left=new k(-1,0);k.up=new k(0,1);k.down=new k(0,-1);k.top=new k(0,-1);k.bottom=new k(0,1);k.topLeft=new k(-1,-1);k.topRight=new k(1,-1);k.bottomLeft=new k(-1,1);k.bottomRight=new k(1,1);class ct{static createSignal(t,e=ct.lerp){return new ao(["x","y","width","height"],i=>new ct(i),t,e).toSignal()}static lerp(t,e,i){let s,n,o,a;return typeof i=="number"?s=n=o=a=i:i instanceof k?(s=o=i.x,n=a=i.y):(s=i.x,n=i.y,o=i.width,a=i.height),new ct(ot(t.x,e.x,s),ot(t.y,e.y,n),ot(t.width,e.width,o),ot(t.height,e.height,a))}static arcLerp(t,e,i,s=!1,n){return n??(n=(t.position.sub(e.position).ctg+t.size.sub(e.size).ctg)/2),ct.lerp(t,e,ef(i,s,n))}static fromSizeCentered(t){return new ct(-t.width/2,-t.height/2,t.width,t.height)}static fromPoints(...t){let e=1/0,i=1/0,s=-1/0,n=-1/0;for(const o of t)o.x>s&&(s=o.x),o.x<e&&(e=o.x),o.y>n&&(n=o.y),o.y<i&&(i=o.y);return new ct(e,i,s-e,n-i)}static fromBBoxes(...t){let e=1/0,i=1/0,s=-1/0,n=-1/0;for(const o of t){const a=o.x+o.width;a>s&&(s=a),o.x<e&&(e=o.x);const l=o.y+o.height;l>n&&(n=l),o.y<i&&(i=o.y)}return new ct(e,i,s-e,n-i)}lerp(t,e){return ct.lerp(this,t,e)}get position(){return new k(this.x,this.y)}set position(t){this.x=t.x,this.y=t.y}get size(){return new k(this.width,this.height)}get center(){return new k(this.x+this.width/2,this.y+this.height/2)}get left(){return this.x}set left(t){this.width+=this.x-t,this.x=t}get right(){return this.x+this.width}set right(t){this.width=t-this.x}get top(){return this.y}set top(t){this.height+=this.y-t,this.y=t}get bottom(){return this.y+this.height}set bottom(t){this.height=t-this.y}get topLeft(){return this.position}get topRight(){return new k(this.x+this.width,this.y)}get bottomLeft(){return new k(this.x,this.y+this.height)}get bottomRight(){return new k(this.x+this.width,this.y+this.height)}get corners(){return[this.topLeft,this.topRight,this.bottomRight,this.bottomLeft]}get pixelPerfect(){return new ct(Math.floor(this.x),Math.floor(this.y),Math.ceil(this.width+1),Math.ceil(this.height+1))}constructor(t,e=0,i=0,s=0){if(this.x=0,this.y=0,this.width=0,this.height=0,t!=null){if(typeof t=="number"){this.x=t,this.y=e,this.width=i,this.height=s;return}if(t instanceof k){this.x=t.x,this.y=t.y,e instanceof k&&(this.width=e.x,this.height=e.y);return}if(Array.isArray(t)){this.x=t[0],this.y=t[1],this.width=t[2],this.height=t[3];return}this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}}transform(t){return new ct(this.position.transformAsPoint(t),this.size.transform(t))}transformCorners(t){return this.corners.map(e=>e.transformAsPoint(t))}expand(t){const e=new Ke(t),i=new ct(this);return i.left-=e.left,i.top-=e.top,i.right+=e.right,i.bottom+=e.bottom,i}addSpacing(t){return this.expand(t)}includes(t){return t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height}intersects(t){return this.left<t.right&&this.right>t.left&&this.top<t.bottom&&this.bottom>t.top}intersection(t){const e=new ct;return this.intersects(t)&&(e.left=Math.max(this.left,t.left),e.top=Math.max(this.top,t.top),e.right=Math.min(this.right,t.right),e.bottom=Math.min(this.bottom,t.bottom)),e}union(t){const e=new ct;return e.left=Math.min(this.left,t.left),e.top=Math.min(this.top,t.top),e.right=Math.max(this.right,t.right),e.bottom=Math.max(this.bottom,t.bottom),e}toSymbol(){return ct.symbol}toString(){return`BBox(${this.x}, ${this.y}, ${this.width}, ${this.height})`}toUniform(t,e){t.uniform4f(e,this.x,this.y,this.width,this.height)}serialize(){return{x:this.x,y:this.y,width:this.width,height:this.height}}}ct.symbol=Symbol.for("@motion-canvas/core/types/Rect");var Rv=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},rf={exports:{}};/**
 * chroma.js - JavaScript library for color conversions
 *
 * Copyright (c) 2011-2019, Gregor Aisch
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 * list of conditions and the following disclaimer.
 *
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 * this list of conditions and the following disclaimer in the documentation
 * and/or other materials provided with the distribution.
 *
 * 3. The name Gregor Aisch may not be used to endorse or promote products
 * derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL GREGOR AISCH OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,
 * INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
 * BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
 * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
 * OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,
 * EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * -------------------------------------------------------
 *
 * chroma.js includes colors from colorbrewer2.org, which are released under
 * the following license:
 *
 * Copyright (c) 2002 Cynthia Brewer, Mark Harrower,
 * and The Pennsylvania State University.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
 * either express or implied. See the License for the specific
 * language governing permissions and limitations under the License.
 *
 * ------------------------------------------------------
 *
 * Named colors are taken from X11 Color Names.
 * http://www.w3.org/TR/css3-color/#svg-color
 *
 * @preserve
 */(function(r,t){(function(e,i){r.exports=i()})(Rv,function(){for(var e=function(u,d,g){return d===void 0&&(d=0),g===void 0&&(g=1),u<d?d:u>g?g:u},i=e,s=function(u){u._clipped=!1,u._unclipped=u.slice(0);for(var d=0;d<=3;d++)d<3?((u[d]<0||u[d]>255)&&(u._clipped=!0),u[d]=i(u[d],0,255)):d===3&&(u[d]=i(u[d],0,1));return u},n={},o=0,a=["Boolean","Number","String","Function","Array","Date","RegExp","Undefined","Null"];o<a.length;o+=1){var l=a[o];n["[object "+l+"]"]=l.toLowerCase()}var h=function(u){return n[Object.prototype.toString.call(u)]||"object"},c=h,f=function(u,d){return d===void 0&&(d=null),u.length>=3?Array.prototype.slice.call(u):c(u[0])=="object"&&d?d.split("").filter(function(g){return u[0][g]!==void 0}).map(function(g){return u[0][g]}):u[0]},p=h,m=function(u){if(u.length<2)return null;var d=u.length-1;return p(u[d])=="string"?u[d].toLowerCase():null},y=Math.PI,b={clip_rgb:s,limit:e,type:h,unpack:f,last:m,PI:y,TWOPI:y*2,PITHIRD:y/3,DEG2RAD:y/180,RAD2DEG:180/y},S={format:{},autodetect:[]},T=b.last,L=b.clip_rgb,B=b.type,N=S,F=function(){for(var d=[],g=arguments.length;g--;)d[g]=arguments[g];var v=this;if(B(d[0])==="object"&&d[0].constructor&&d[0].constructor===this.constructor)return d[0];var x=T(d),C=!1;if(!x){C=!0,N.sorted||(N.autodetect=N.autodetect.sort(function(M,z){return z.p-M.p}),N.sorted=!0);for(var w=0,O=N.autodetect;w<O.length;w+=1){var P=O[w];if(x=P.test.apply(P,d),x)break}}if(N.format[x]){var R=N.format[x].apply(null,C?d:d.slice(0,-1));v._rgb=L(R)}else throw new Error("unknown format: "+d);v._rgb.length===3&&v._rgb.push(1)};F.prototype.toString=function(){return B(this.hex)=="function"?this.hex():"["+this._rgb.join(",")+"]"};var I=F,U=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(U.Color,[null].concat(u)))};U.Color=I,U.version="2.4.2";var J=U,xt=b.unpack,Tt=Math.max,lt=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=xt(u,"rgb"),v=g[0],x=g[1],C=g[2];v=v/255,x=x/255,C=C/255;var w=1-Tt(v,Tt(x,C)),O=w<1?1/(1-w):0,P=(1-v-w)*O,R=(1-x-w)*O,M=(1-C-w)*O;return[P,R,M,w]},Z=lt,Ot=b.unpack,At=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];u=Ot(u,"cmyk");var g=u[0],v=u[1],x=u[2],C=u[3],w=u.length>4?u[4]:1;return C===1?[0,0,0,w]:[g>=1?0:255*(1-g)*(1-C),v>=1?0:255*(1-v)*(1-C),x>=1?0:255*(1-x)*(1-C),w]},jt=At,ei=J,Ei=I,ss=S,vi=b.unpack,Jn=b.type,Ue=Z;Ei.prototype.cmyk=function(){return Ue(this._rgb)},ei.cmyk=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(Ei,[null].concat(u,["cmyk"])))},ss.format.cmyk=jt,ss.autodetect.push({p:2,test:function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(u=vi(u,"cmyk"),Jn(u)==="array"&&u.length===4)return"cmyk"}});var ge=b.unpack,Re=b.last,We=function(u){return Math.round(u*100)/100},Di=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=ge(u,"hsla"),v=Re(u)||"lsa";return g[0]=We(g[0]||0),g[1]=We(g[1]*100)+"%",g[2]=We(g[2]*100)+"%",v==="hsla"||g.length>3&&g[3]<1?(g[3]=g.length>3?g[3]:1,v="hsla"):g.length=3,v+"("+g.join(",")+")"},Os=Di,tr=b.unpack,$d=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];u=tr(u,"rgba");var g=u[0],v=u[1],x=u[2];g/=255,v/=255,x/=255;var C=Math.min(g,v,x),w=Math.max(g,v,x),O=(w+C)/2,P,R;return w===C?(P=0,R=Number.NaN):P=O<.5?(w-C)/(w+C):(w-C)/(2-w-C),g==w?R=(v-x)/(w-C):v==w?R=2+(x-g)/(w-C):x==w&&(R=4+(g-v)/(w-C)),R*=60,R<0&&(R+=360),u.length>3&&u[3]!==void 0?[R,P,O,u[3]]:[R,P,O]},Ul=$d,Fd=b.unpack,zd=b.last,Ud=Os,Wd=Ul,yo=Math.round,jd=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=Fd(u,"rgba"),v=zd(u)||"rgb";return v.substr(0,3)=="hsl"?Ud(Wd(g),v):(g[0]=yo(g[0]),g[1]=yo(g[1]),g[2]=yo(g[2]),(v==="rgba"||g.length>3&&g[3]<1)&&(g[3]=g.length>3?g[3]:1,v="rgba"),v+"("+g.slice(0,v==="rgb"?3:4).join(",")+")")},Hd=jd,Vd=b.unpack,bo=Math.round,qd=function(){for(var u,d=[],g=arguments.length;g--;)d[g]=arguments[g];d=Vd(d,"hsl");var v=d[0],x=d[1],C=d[2],w,O,P;if(x===0)w=O=P=C*255;else{var R=[0,0,0],M=[0,0,0],z=C<.5?C*(1+x):C+x-C*x,E=2*C-z,H=v/360;R[0]=H+1/3,R[1]=H,R[2]=H-1/3;for(var j=0;j<3;j++)R[j]<0&&(R[j]+=1),R[j]>1&&(R[j]-=1),6*R[j]<1?M[j]=E+(z-E)*6*R[j]:2*R[j]<1?M[j]=z:3*R[j]<2?M[j]=E+(z-E)*(2/3-R[j])*6:M[j]=E;u=[bo(M[0]*255),bo(M[1]*255),bo(M[2]*255)],w=u[0],O=u[1],P=u[2]}return d.length>3?[w,O,P,d[3]]:[w,O,P,1]},Wl=qd,jl=Wl,Hl=S,Vl=/^rgb\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*\)$/,ql=/^rgba\(\s*(-?\d+),\s*(-?\d+)\s*,\s*(-?\d+)\s*,\s*([01]|[01]?\.\d+)\)$/,Kl=/^rgb\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Gl=/^rgba\(\s*(-?\d+(?:\.\d+)?)%,\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Yl=/^hsl\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*\)$/,Xl=/^hsla\(\s*(-?\d+(?:\.\d+)?),\s*(-?\d+(?:\.\d+)?)%\s*,\s*(-?\d+(?:\.\d+)?)%\s*,\s*([01]|[01]?\.\d+)\)$/,Ql=Math.round,Zl=function(u){u=u.toLowerCase().trim();var d;if(Hl.format.named)try{return Hl.format.named(u)}catch{}if(d=u.match(Vl)){for(var g=d.slice(1,4),v=0;v<3;v++)g[v]=+g[v];return g[3]=1,g}if(d=u.match(ql)){for(var x=d.slice(1,5),C=0;C<4;C++)x[C]=+x[C];return x}if(d=u.match(Kl)){for(var w=d.slice(1,4),O=0;O<3;O++)w[O]=Ql(w[O]*2.55);return w[3]=1,w}if(d=u.match(Gl)){for(var P=d.slice(1,5),R=0;R<3;R++)P[R]=Ql(P[R]*2.55);return P[3]=+P[3],P}if(d=u.match(Yl)){var M=d.slice(1,4);M[1]*=.01,M[2]*=.01;var z=jl(M);return z[3]=1,z}if(d=u.match(Xl)){var E=d.slice(1,4);E[1]*=.01,E[2]*=.01;var H=jl(E);return H[3]=+d[4],H}};Zl.test=function(u){return Vl.test(u)||ql.test(u)||Kl.test(u)||Gl.test(u)||Yl.test(u)||Xl.test(u)};var Kd=Zl,Gd=J,Jl=I,th=S,Yd=b.type,Xd=Hd,eh=Kd;Jl.prototype.css=function(u){return Xd(this._rgb,u)},Gd.css=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(Jl,[null].concat(u,["css"])))},th.format.css=eh,th.autodetect.push({p:5,test:function(u){for(var d=[],g=arguments.length-1;g-- >0;)d[g]=arguments[g+1];if(!d.length&&Yd(u)==="string"&&eh.test(u))return"css"}});var ih=I,Qd=J,Zd=S,Jd=b.unpack;Zd.format.gl=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=Jd(u,"rgba");return g[0]*=255,g[1]*=255,g[2]*=255,g},Qd.gl=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(ih,[null].concat(u,["gl"])))},ih.prototype.gl=function(){var u=this._rgb;return[u[0]/255,u[1]/255,u[2]/255,u[3]]};var tp=b.unpack,ep=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=tp(u,"rgb"),v=g[0],x=g[1],C=g[2],w=Math.min(v,x,C),O=Math.max(v,x,C),P=O-w,R=P*100/255,M=w/(255-P)*100,z;return P===0?z=Number.NaN:(v===O&&(z=(x-C)/P),x===O&&(z=2+(C-v)/P),C===O&&(z=4+(v-x)/P),z*=60,z<0&&(z+=360)),[z,R,M]},ip=ep,sp=b.unpack,np=Math.floor,rp=function(){for(var u,d,g,v,x,C,w=[],O=arguments.length;O--;)w[O]=arguments[O];w=sp(w,"hcg");var P=w[0],R=w[1],M=w[2],z,E,H;M=M*255;var j=R*255;if(R===0)z=E=H=M;else{P===360&&(P=0),P>360&&(P-=360),P<0&&(P+=360),P/=60;var et=np(P),at=P-et,ut=M*(1-R),dt=ut+j*(1-at),Jt=ut+j*at,Gt=ut+j;switch(et){case 0:u=[Gt,Jt,ut],z=u[0],E=u[1],H=u[2];break;case 1:d=[dt,Gt,ut],z=d[0],E=d[1],H=d[2];break;case 2:g=[ut,Gt,Jt],z=g[0],E=g[1],H=g[2];break;case 3:v=[ut,dt,Gt],z=v[0],E=v[1],H=v[2];break;case 4:x=[Jt,ut,Gt],z=x[0],E=x[1],H=x[2];break;case 5:C=[Gt,ut,dt],z=C[0],E=C[1],H=C[2];break}}return[z,E,H,w.length>3?w[3]:1]},op=rp,ap=b.unpack,lp=b.type,hp=J,sh=I,nh=S,cp=ip;sh.prototype.hcg=function(){return cp(this._rgb)},hp.hcg=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(sh,[null].concat(u,["hcg"])))},nh.format.hcg=op,nh.autodetect.push({p:1,test:function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(u=ap(u,"hcg"),lp(u)==="array"&&u.length===3)return"hcg"}});var up=b.unpack,fp=b.last,er=Math.round,dp=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=up(u,"rgba"),v=g[0],x=g[1],C=g[2],w=g[3],O=fp(u)||"auto";w===void 0&&(w=1),O==="auto"&&(O=w<1?"rgba":"rgb"),v=er(v),x=er(x),C=er(C);var P=v<<16|x<<8|C,R="000000"+P.toString(16);R=R.substr(R.length-6);var M="0"+er(w*255).toString(16);switch(M=M.substr(M.length-2),O.toLowerCase()){case"rgba":return"#"+R+M;case"argb":return"#"+M+R;default:return"#"+R}},rh=dp,pp=/^#?([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,gp=/^#?([A-Fa-f0-9]{8}|[A-Fa-f0-9]{4})$/,mp=function(u){if(u.match(pp)){(u.length===4||u.length===7)&&(u=u.substr(1)),u.length===3&&(u=u.split(""),u=u[0]+u[0]+u[1]+u[1]+u[2]+u[2]);var d=parseInt(u,16),g=d>>16,v=d>>8&255,x=d&255;return[g,v,x,1]}if(u.match(gp)){(u.length===5||u.length===9)&&(u=u.substr(1)),u.length===4&&(u=u.split(""),u=u[0]+u[0]+u[1]+u[1]+u[2]+u[2]+u[3]+u[3]);var C=parseInt(u,16),w=C>>24&255,O=C>>16&255,P=C>>8&255,R=Math.round((C&255)/255*100)/100;return[w,O,P,R]}throw new Error("unknown hex color: "+u)},oh=mp,vp=J,ah=I,yp=b.type,lh=S,bp=rh;ah.prototype.hex=function(u){return bp(this._rgb,u)},vp.hex=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(ah,[null].concat(u,["hex"])))},lh.format.hex=oh,lh.autodetect.push({p:4,test:function(u){for(var d=[],g=arguments.length-1;g-- >0;)d[g]=arguments[g+1];if(!d.length&&yp(u)==="string"&&[3,4,5,6,7,8,9].indexOf(u.length)>=0)return"hex"}});var wp=b.unpack,hh=b.TWOPI,xp=Math.min,Sp=Math.sqrt,kp=Math.acos,Cp=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=wp(u,"rgb"),v=g[0],x=g[1],C=g[2];v/=255,x/=255,C/=255;var w,O=xp(v,x,C),P=(v+x+C)/3,R=P>0?1-O/P:0;return R===0?w=NaN:(w=(v-x+(v-C))/2,w/=Sp((v-x)*(v-x)+(v-C)*(x-C)),w=kp(w),C>x&&(w=hh-w),w/=hh),[w*360,R,P]},Op=Cp,Pp=b.unpack,wo=b.limit,Ps=b.TWOPI,xo=b.PITHIRD,Ts=Math.cos,Tp=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];u=Pp(u,"hsi");var g=u[0],v=u[1],x=u[2],C,w,O;return isNaN(g)&&(g=0),isNaN(v)&&(v=0),g>360&&(g-=360),g<0&&(g+=360),g/=360,g<1/3?(O=(1-v)/3,C=(1+v*Ts(Ps*g)/Ts(xo-Ps*g))/3,w=1-(O+C)):g<2/3?(g-=1/3,C=(1-v)/3,w=(1+v*Ts(Ps*g)/Ts(xo-Ps*g))/3,O=1-(C+w)):(g-=2/3,w=(1-v)/3,O=(1+v*Ts(Ps*g)/Ts(xo-Ps*g))/3,C=1-(w+O)),C=wo(x*C*3),w=wo(x*w*3),O=wo(x*O*3),[C*255,w*255,O*255,u.length>3?u[3]:1]},Ap=Tp,Rp=b.unpack,Mp=b.type,Ip=J,ch=I,uh=S,Ep=Op;ch.prototype.hsi=function(){return Ep(this._rgb)},Ip.hsi=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(ch,[null].concat(u,["hsi"])))},uh.format.hsi=Ap,uh.autodetect.push({p:2,test:function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(u=Rp(u,"hsi"),Mp(u)==="array"&&u.length===3)return"hsi"}});var Dp=b.unpack,Lp=b.type,Np=J,fh=I,dh=S,Bp=Ul;fh.prototype.hsl=function(){return Bp(this._rgb)},Np.hsl=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(fh,[null].concat(u,["hsl"])))},dh.format.hsl=Wl,dh.autodetect.push({p:2,test:function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(u=Dp(u,"hsl"),Lp(u)==="array"&&u.length===3)return"hsl"}});var _p=b.unpack,$p=Math.min,Fp=Math.max,zp=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];u=_p(u,"rgb");var g=u[0],v=u[1],x=u[2],C=$p(g,v,x),w=Fp(g,v,x),O=w-C,P,R,M;return M=w/255,w===0?(P=Number.NaN,R=0):(R=O/w,g===w&&(P=(v-x)/O),v===w&&(P=2+(x-g)/O),x===w&&(P=4+(g-v)/O),P*=60,P<0&&(P+=360)),[P,R,M]},Up=zp,Wp=b.unpack,jp=Math.floor,Hp=function(){for(var u,d,g,v,x,C,w=[],O=arguments.length;O--;)w[O]=arguments[O];w=Wp(w,"hsv");var P=w[0],R=w[1],M=w[2],z,E,H;if(M*=255,R===0)z=E=H=M;else{P===360&&(P=0),P>360&&(P-=360),P<0&&(P+=360),P/=60;var j=jp(P),et=P-j,at=M*(1-R),ut=M*(1-R*et),dt=M*(1-R*(1-et));switch(j){case 0:u=[M,dt,at],z=u[0],E=u[1],H=u[2];break;case 1:d=[ut,M,at],z=d[0],E=d[1],H=d[2];break;case 2:g=[at,M,dt],z=g[0],E=g[1],H=g[2];break;case 3:v=[at,ut,M],z=v[0],E=v[1],H=v[2];break;case 4:x=[dt,at,M],z=x[0],E=x[1],H=x[2];break;case 5:C=[M,at,ut],z=C[0],E=C[1],H=C[2];break}}return[z,E,H,w.length>3?w[3]:1]},Vp=Hp,qp=b.unpack,Kp=b.type,Gp=J,ph=I,gh=S,Yp=Up;ph.prototype.hsv=function(){return Yp(this._rgb)},Gp.hsv=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(ph,[null].concat(u,["hsv"])))},gh.format.hsv=Vp,gh.autodetect.push({p:2,test:function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(u=qp(u,"hsv"),Kp(u)==="array"&&u.length===3)return"hsv"}});var ir={Kn:18,Xn:.95047,Yn:1,Zn:1.08883,t0:.137931034,t1:.206896552,t2:.12841855,t3:.008856452},As=ir,Xp=b.unpack,mh=Math.pow,Qp=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=Xp(u,"rgb"),v=g[0],x=g[1],C=g[2],w=Zp(v,x,C),O=w[0],P=w[1],R=w[2],M=116*P-16;return[M<0?0:M,500*(O-P),200*(P-R)]},So=function(u){return(u/=255)<=.04045?u/12.92:mh((u+.055)/1.055,2.4)},ko=function(u){return u>As.t3?mh(u,1/3):u/As.t2+As.t0},Zp=function(u,d,g){u=So(u),d=So(d),g=So(g);var v=ko((.4124564*u+.3575761*d+.1804375*g)/As.Xn),x=ko((.2126729*u+.7151522*d+.072175*g)/As.Yn),C=ko((.0193339*u+.119192*d+.9503041*g)/As.Zn);return[v,x,C]},vh=Qp,Rs=ir,Jp=b.unpack,tg=Math.pow,eg=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];u=Jp(u,"lab");var g=u[0],v=u[1],x=u[2],C,w,O,P,R,M;return w=(g+16)/116,C=isNaN(v)?w:w+v/500,O=isNaN(x)?w:w-x/200,w=Rs.Yn*Oo(w),C=Rs.Xn*Oo(C),O=Rs.Zn*Oo(O),P=Co(3.2404542*C-1.5371385*w-.4985314*O),R=Co(-.969266*C+1.8760108*w+.041556*O),M=Co(.0556434*C-.2040259*w+1.0572252*O),[P,R,M,u.length>3?u[3]:1]},Co=function(u){return 255*(u<=.00304?12.92*u:1.055*tg(u,1/2.4)-.055)},Oo=function(u){return u>Rs.t1?u*u*u:Rs.t2*(u-Rs.t0)},yh=eg,ig=b.unpack,sg=b.type,ng=J,bh=I,wh=S,rg=vh;bh.prototype.lab=function(){return rg(this._rgb)},ng.lab=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(bh,[null].concat(u,["lab"])))},wh.format.lab=yh,wh.autodetect.push({p:2,test:function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(u=ig(u,"lab"),sg(u)==="array"&&u.length===3)return"lab"}});var og=b.unpack,ag=b.RAD2DEG,lg=Math.sqrt,hg=Math.atan2,cg=Math.round,ug=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=og(u,"lab"),v=g[0],x=g[1],C=g[2],w=lg(x*x+C*C),O=(hg(C,x)*ag+360)%360;return cg(w*1e4)===0&&(O=Number.NaN),[v,w,O]},xh=ug,fg=b.unpack,dg=vh,pg=xh,gg=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=fg(u,"rgb"),v=g[0],x=g[1],C=g[2],w=dg(v,x,C),O=w[0],P=w[1],R=w[2];return pg(O,P,R)},mg=gg,vg=b.unpack,yg=b.DEG2RAD,bg=Math.sin,wg=Math.cos,xg=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=vg(u,"lch"),v=g[0],x=g[1],C=g[2];return isNaN(C)&&(C=0),C=C*yg,[v,wg(C)*x,bg(C)*x]},Sh=xg,Sg=b.unpack,kg=Sh,Cg=yh,Og=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];u=Sg(u,"lch");var g=u[0],v=u[1],x=u[2],C=kg(g,v,x),w=C[0],O=C[1],P=C[2],R=Cg(w,O,P),M=R[0],z=R[1],E=R[2];return[M,z,E,u.length>3?u[3]:1]},kh=Og,Pg=b.unpack,Tg=kh,Ag=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=Pg(u,"hcl").reverse();return Tg.apply(void 0,g)},Rg=Ag,Mg=b.unpack,Ig=b.type,Ch=J,sr=I,Po=S,Oh=mg;sr.prototype.lch=function(){return Oh(this._rgb)},sr.prototype.hcl=function(){return Oh(this._rgb).reverse()},Ch.lch=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(sr,[null].concat(u,["lch"])))},Ch.hcl=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(sr,[null].concat(u,["hcl"])))},Po.format.lch=kh,Po.format.hcl=Rg,["lch","hcl"].forEach(function(u){return Po.autodetect.push({p:2,test:function(){for(var d=[],g=arguments.length;g--;)d[g]=arguments[g];if(d=Mg(d,u),Ig(d)==="array"&&d.length===3)return u}})});var Eg={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflower:"#6495ed",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",laserlemon:"#ffff54",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrod:"#fafad2",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",maroon2:"#7f0000",maroon3:"#b03060",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",purple2:"#7f007f",purple3:"#a020f0",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"},Ph=Eg,Dg=I,Th=S,Lg=b.type,an=Ph,Ng=oh,Bg=rh;Dg.prototype.name=function(){for(var u=Bg(this._rgb,"rgb"),d=0,g=Object.keys(an);d<g.length;d+=1){var v=g[d];if(an[v]===u)return v.toLowerCase()}return u},Th.format.named=function(u){if(u=u.toLowerCase(),an[u])return Ng(an[u]);throw new Error("unknown color name: "+u)},Th.autodetect.push({p:5,test:function(u){for(var d=[],g=arguments.length-1;g-- >0;)d[g]=arguments[g+1];if(!d.length&&Lg(u)==="string"&&an[u.toLowerCase()])return"named"}});var _g=b.unpack,$g=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=_g(u,"rgb"),v=g[0],x=g[1],C=g[2];return(v<<16)+(x<<8)+C},Fg=$g,zg=b.type,Ug=function(u){if(zg(u)=="number"&&u>=0&&u<=16777215){var d=u>>16,g=u>>8&255,v=u&255;return[d,g,v,1]}throw new Error("unknown num color: "+u)},Wg=Ug,jg=J,Ah=I,Rh=S,Hg=b.type,Vg=Fg;Ah.prototype.num=function(){return Vg(this._rgb)},jg.num=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(Ah,[null].concat(u,["num"])))},Rh.format.num=Wg,Rh.autodetect.push({p:5,test:function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(u.length===1&&Hg(u[0])==="number"&&u[0]>=0&&u[0]<=16777215)return"num"}});var qg=J,To=I,Mh=S,Ih=b.unpack,Eh=b.type,Dh=Math.round;To.prototype.rgb=function(u){return u===void 0&&(u=!0),u===!1?this._rgb.slice(0,3):this._rgb.slice(0,3).map(Dh)},To.prototype.rgba=function(u){return u===void 0&&(u=!0),this._rgb.slice(0,4).map(function(d,g){return g<3?u===!1?d:Dh(d):d})},qg.rgb=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(To,[null].concat(u,["rgb"])))},Mh.format.rgb=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=Ih(u,"rgba");return g[3]===void 0&&(g[3]=1),g},Mh.autodetect.push({p:3,test:function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(u=Ih(u,"rgba"),Eh(u)==="array"&&(u.length===3||u.length===4&&Eh(u[3])=="number"&&u[3]>=0&&u[3]<=1))return"rgb"}});var nr=Math.log,Kg=function(u){var d=u/100,g,v,x;return d<66?(g=255,v=d<6?0:-155.25485562709179-.44596950469579133*(v=d-2)+104.49216199393888*nr(v),x=d<20?0:-254.76935184120902+.8274096064007395*(x=d-10)+115.67994401066147*nr(x)):(g=351.97690566805693+.114206453784165*(g=d-55)-40.25366309332127*nr(g),v=325.4494125711974+.07943456536662342*(v=d-50)-28.0852963507957*nr(v),x=255),[g,v,x,1]},Lh=Kg,Gg=Lh,Yg=b.unpack,Xg=Math.round,Qg=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];for(var g=Yg(u,"rgb"),v=g[0],x=g[2],C=1e3,w=4e4,O=.4,P;w-C>O;){P=(w+C)*.5;var R=Gg(P);R[2]/R[0]>=x/v?w=P:C=P}return Xg(P)},Zg=Qg,Ao=J,rr=I,Ro=S,Jg=Zg;rr.prototype.temp=rr.prototype.kelvin=rr.prototype.temperature=function(){return Jg(this._rgb)},Ao.temp=Ao.kelvin=Ao.temperature=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(rr,[null].concat(u,["temp"])))},Ro.format.temp=Ro.format.kelvin=Ro.format.temperature=Lh;var tm=b.unpack,Mo=Math.cbrt,em=Math.pow,im=Math.sign,sm=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=tm(u,"rgb"),v=g[0],x=g[1],C=g[2],w=[Io(v/255),Io(x/255),Io(C/255)],O=w[0],P=w[1],R=w[2],M=Mo(.4122214708*O+.5363325363*P+.0514459929*R),z=Mo(.2119034982*O+.6806995451*P+.1073969566*R),E=Mo(.0883024619*O+.2817188376*P+.6299787005*R);return[.2104542553*M+.793617785*z-.0040720468*E,1.9779984951*M-2.428592205*z+.4505937099*E,.0259040371*M+.7827717662*z-.808675766*E]},Nh=sm;function Io(u){var d=Math.abs(u);return d<.04045?u/12.92:(im(u)||1)*em((d+.055)/1.055,2.4)}var nm=b.unpack,or=Math.pow,rm=Math.sign,om=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];u=nm(u,"lab");var g=u[0],v=u[1],x=u[2],C=or(g+.3963377774*v+.2158037573*x,3),w=or(g-.1055613458*v-.0638541728*x,3),O=or(g-.0894841775*v-1.291485548*x,3);return[255*Eo(4.0767416621*C-3.3077115913*w+.2309699292*O),255*Eo(-1.2684380046*C+2.6097574011*w-.3413193965*O),255*Eo(-.0041960863*C-.7034186147*w+1.707614701*O),u.length>3?u[3]:1]},Bh=om;function Eo(u){var d=Math.abs(u);return d>.0031308?(rm(u)||1)*(1.055*or(d,1/2.4)-.055):u*12.92}var am=b.unpack,lm=b.type,hm=J,_h=I,$h=S,cm=Nh;_h.prototype.oklab=function(){return cm(this._rgb)},hm.oklab=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(_h,[null].concat(u,["oklab"])))},$h.format.oklab=Bh,$h.autodetect.push({p:3,test:function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(u=am(u,"oklab"),lm(u)==="array"&&u.length===3)return"oklab"}});var um=b.unpack,fm=Nh,dm=xh,pm=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];var g=um(u,"rgb"),v=g[0],x=g[1],C=g[2],w=fm(v,x,C),O=w[0],P=w[1],R=w[2];return dm(O,P,R)},gm=pm,mm=b.unpack,vm=Sh,ym=Bh,bm=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];u=mm(u,"lch");var g=u[0],v=u[1],x=u[2],C=vm(g,v,x),w=C[0],O=C[1],P=C[2],R=ym(w,O,P),M=R[0],z=R[1],E=R[2];return[M,z,E,u.length>3?u[3]:1]},wm=bm,xm=b.unpack,Sm=b.type,km=J,Fh=I,zh=S,Cm=gm;Fh.prototype.oklch=function(){return Cm(this._rgb)},km.oklch=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];return new(Function.prototype.bind.apply(Fh,[null].concat(u,["oklch"])))},zh.format.oklch=wm,zh.autodetect.push({p:3,test:function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];if(u=xm(u,"oklch"),Sm(u)==="array"&&u.length===3)return"oklch"}});var Uh=I,Om=b.type;Uh.prototype.alpha=function(u,d){return d===void 0&&(d=!1),u!==void 0&&Om(u)==="number"?d?(this._rgb[3]=u,this):new Uh([this._rgb[0],this._rgb[1],this._rgb[2],u],"rgb"):this._rgb[3]};var Pm=I;Pm.prototype.clipped=function(){return this._rgb._clipped||!1};var ns=I,Tm=ir;ns.prototype.darken=function(u){u===void 0&&(u=1);var d=this,g=d.lab();return g[0]-=Tm.Kn*u,new ns(g,"lab").alpha(d.alpha(),!0)},ns.prototype.brighten=function(u){return u===void 0&&(u=1),this.darken(-u)},ns.prototype.darker=ns.prototype.darken,ns.prototype.brighter=ns.prototype.brighten;var Am=I;Am.prototype.get=function(u){var d=u.split("."),g=d[0],v=d[1],x=this[g]();if(v){var C=g.indexOf(v)-(g.substr(0,2)==="ok"?2:0);if(C>-1)return x[C];throw new Error("unknown channel "+v+" in mode "+g)}else return x};var Ms=I,Rm=b.type,Mm=Math.pow,Im=1e-7,Em=20;Ms.prototype.luminance=function(u){if(u!==void 0&&Rm(u)==="number"){if(u===0)return new Ms([0,0,0,this._rgb[3]],"rgb");if(u===1)return new Ms([255,255,255,this._rgb[3]],"rgb");var d=this.luminance(),g="rgb",v=Em,x=function(w,O){var P=w.interpolate(O,.5,g),R=P.luminance();return Math.abs(u-R)<Im||!v--?P:R>u?x(w,P):x(P,O)},C=(d>u?x(new Ms([0,0,0]),this):x(this,new Ms([255,255,255]))).rgb();return new Ms(C.concat([this._rgb[3]]))}return Dm.apply(void 0,this._rgb.slice(0,3))};var Dm=function(u,d,g){return u=Do(u),d=Do(d),g=Do(g),.2126*u+.7152*d+.0722*g},Do=function(u){return u/=255,u<=.03928?u/12.92:Mm((u+.055)/1.055,2.4)},Se={},Wh=I,jh=b.type,ar=Se,Hh=function(u,d,g){g===void 0&&(g=.5);for(var v=[],x=arguments.length-3;x-- >0;)v[x]=arguments[x+3];var C=v[0]||"lrgb";if(!ar[C]&&!v.length&&(C=Object.keys(ar)[0]),!ar[C])throw new Error("interpolation mode "+C+" is not defined");return jh(u)!=="object"&&(u=new Wh(u)),jh(d)!=="object"&&(d=new Wh(d)),ar[C](u,d,g).alpha(u.alpha()+g*(d.alpha()-u.alpha()))},Vh=I,Lm=Hh;Vh.prototype.mix=Vh.prototype.interpolate=function(u,d){d===void 0&&(d=.5);for(var g=[],v=arguments.length-2;v-- >0;)g[v]=arguments[v+2];return Lm.apply(void 0,[this,u,d].concat(g))};var qh=I;qh.prototype.premultiply=function(u){u===void 0&&(u=!1);var d=this._rgb,g=d[3];return u?(this._rgb=[d[0]*g,d[1]*g,d[2]*g,g],this):new qh([d[0]*g,d[1]*g,d[2]*g,g],"rgb")};var Lo=I,Nm=ir;Lo.prototype.saturate=function(u){u===void 0&&(u=1);var d=this,g=d.lch();return g[1]+=Nm.Kn*u,g[1]<0&&(g[1]=0),new Lo(g,"lch").alpha(d.alpha(),!0)},Lo.prototype.desaturate=function(u){return u===void 0&&(u=1),this.saturate(-u)};var Kh=I,Gh=b.type;Kh.prototype.set=function(u,d,g){g===void 0&&(g=!1);var v=u.split("."),x=v[0],C=v[1],w=this[x]();if(C){var O=x.indexOf(C)-(x.substr(0,2)==="ok"?2:0);if(O>-1){if(Gh(d)=="string")switch(d.charAt(0)){case"+":w[O]+=+d;break;case"-":w[O]+=+d;break;case"*":w[O]*=+d.substr(1);break;case"/":w[O]/=+d.substr(1);break;default:w[O]=+d}else if(Gh(d)==="number")w[O]=d;else throw new Error("unsupported value for Color.set");var P=new Kh(w,x);return g?(this._rgb=P._rgb,this):P}throw new Error("unknown channel "+C+" in mode "+x)}else return w};var Bm=I,_m=function(u,d,g){var v=u._rgb,x=d._rgb;return new Bm(v[0]+g*(x[0]-v[0]),v[1]+g*(x[1]-v[1]),v[2]+g*(x[2]-v[2]),"rgb")};Se.rgb=_m;var $m=I,No=Math.sqrt,Is=Math.pow,Fm=function(u,d,g){var v=u._rgb,x=v[0],C=v[1],w=v[2],O=d._rgb,P=O[0],R=O[1],M=O[2];return new $m(No(Is(x,2)*(1-g)+Is(P,2)*g),No(Is(C,2)*(1-g)+Is(R,2)*g),No(Is(w,2)*(1-g)+Is(M,2)*g),"rgb")};Se.lrgb=Fm;var zm=I,Um=function(u,d,g){var v=u.lab(),x=d.lab();return new zm(v[0]+g*(x[0]-v[0]),v[1]+g*(x[1]-v[1]),v[2]+g*(x[2]-v[2]),"lab")};Se.lab=Um;var Yh=I,Es=function(u,d,g,v){var x,C,w,O;v==="hsl"?(w=u.hsl(),O=d.hsl()):v==="hsv"?(w=u.hsv(),O=d.hsv()):v==="hcg"?(w=u.hcg(),O=d.hcg()):v==="hsi"?(w=u.hsi(),O=d.hsi()):v==="lch"||v==="hcl"?(v="hcl",w=u.hcl(),O=d.hcl()):v==="oklch"&&(w=u.oklch().reverse(),O=d.oklch().reverse());var P,R,M,z,E,H;(v.substr(0,1)==="h"||v==="oklch")&&(x=w,P=x[0],M=x[1],E=x[2],C=O,R=C[0],z=C[1],H=C[2]);var j,et,at,ut;return!isNaN(P)&&!isNaN(R)?(R>P&&R-P>180?ut=R-(P+360):R<P&&P-R>180?ut=R+360-P:ut=R-P,et=P+g*ut):isNaN(P)?isNaN(R)?et=Number.NaN:(et=R,(E==1||E==0)&&v!="hsv"&&(j=z)):(et=P,(H==1||H==0)&&v!="hsv"&&(j=M)),j===void 0&&(j=M+g*(z-M)),at=E+g*(H-E),v==="oklch"?new Yh([at,j,et],v):new Yh([et,j,at],v)},Wm=Es,Xh=function(u,d,g){return Wm(u,d,g,"lch")};Se.lch=Xh,Se.hcl=Xh;var jm=I,Hm=function(u,d,g){var v=u.num(),x=d.num();return new jm(v+g*(x-v),"num")};Se.num=Hm;var Vm=Es,qm=function(u,d,g){return Vm(u,d,g,"hcg")};Se.hcg=qm;var Km=Es,Gm=function(u,d,g){return Km(u,d,g,"hsi")};Se.hsi=Gm;var Ym=Es,Xm=function(u,d,g){return Ym(u,d,g,"hsl")};Se.hsl=Xm;var Qm=Es,Zm=function(u,d,g){return Qm(u,d,g,"hsv")};Se.hsv=Zm;var Jm=I,t0=function(u,d,g){var v=u.oklab(),x=d.oklab();return new Jm(v[0]+g*(x[0]-v[0]),v[1]+g*(x[1]-v[1]),v[2]+g*(x[2]-v[2]),"oklab")};Se.oklab=t0;var e0=Es,i0=function(u,d,g){return e0(u,d,g,"oklch")};Se.oklch=i0;var Bo=I,s0=b.clip_rgb,_o=Math.pow,$o=Math.sqrt,Fo=Math.PI,Qh=Math.cos,Zh=Math.sin,n0=Math.atan2,r0=function(u,d,g){d===void 0&&(d="lrgb"),g===void 0&&(g=null);var v=u.length;g||(g=Array.from(new Array(v)).map(function(){return 1}));var x=v/g.reduce(function(et,at){return et+at});if(g.forEach(function(et,at){g[at]*=x}),u=u.map(function(et){return new Bo(et)}),d==="lrgb")return o0(u,g);for(var C=u.shift(),w=C.get(d),O=[],P=0,R=0,M=0;M<w.length;M++)if(w[M]=(w[M]||0)*g[0],O.push(isNaN(w[M])?0:g[0]),d.charAt(M)==="h"&&!isNaN(w[M])){var z=w[M]/180*Fo;P+=Qh(z)*g[0],R+=Zh(z)*g[0]}var E=C.alpha()*g[0];u.forEach(function(et,at){var ut=et.get(d);E+=et.alpha()*g[at+1];for(var dt=0;dt<w.length;dt++)if(!isNaN(ut[dt]))if(O[dt]+=g[at+1],d.charAt(dt)==="h"){var Jt=ut[dt]/180*Fo;P+=Qh(Jt)*g[at+1],R+=Zh(Jt)*g[at+1]}else w[dt]+=ut[dt]*g[at+1]});for(var H=0;H<w.length;H++)if(d.charAt(H)==="h"){for(var j=n0(R/O[H],P/O[H])/Fo*180;j<0;)j+=360;for(;j>=360;)j-=360;w[H]=j}else w[H]=w[H]/O[H];return E/=v,new Bo(w,d).alpha(E>.99999?1:E,!0)},o0=function(u,d){for(var g=u.length,v=[0,0,0,0],x=0;x<u.length;x++){var C=u[x],w=d[x]/g,O=C._rgb;v[0]+=_o(O[0],2)*w,v[1]+=_o(O[1],2)*w,v[2]+=_o(O[2],2)*w,v[3]+=O[3]*w}return v[0]=$o(v[0]),v[1]=$o(v[1]),v[2]=$o(v[2]),v[3]>.9999999&&(v[3]=1),new Bo(s0(v))},je=J,Ds=b.type,a0=Math.pow,zo=function(u){var d="rgb",g=je("#ccc"),v=0,x=[0,1],C=[],w=[0,0],O=!1,P=[],R=!1,M=0,z=1,E=!1,H={},j=!0,et=1,at=function(D){if(D=D||["#fff","#000"],D&&Ds(D)==="string"&&je.brewer&&je.brewer[D.toLowerCase()]&&(D=je.brewer[D.toLowerCase()]),Ds(D)==="array"){D.length===1&&(D=[D[0],D[0]]),D=D.slice(0);for(var X=0;X<D.length;X++)D[X]=je(D[X]);C.length=0;for(var nt=0;nt<D.length;nt++)C.push(nt/(D.length-1))}return me(),P=D},ut=function(D){if(O!=null){for(var X=O.length-1,nt=0;nt<X&&D>=O[nt];)nt++;return nt-1}return 0},dt=function(D){return D},Jt=function(D){return D},Gt=function(D,X){var nt,it;if(X==null&&(X=!1),isNaN(D)||D===null)return g;if(X)it=D;else if(O&&O.length>2){var te=ut(D);it=te/(O.length-2)}else z!==M?it=(D-M)/(z-M):it=1;it=Jt(it),X||(it=dt(it)),et!==1&&(it=a0(it,et)),it=w[0]+it*(1-w[0]-w[1]),it=Math.min(1,Math.max(0,it));var Pt=Math.floor(it*1e4);if(j&&H[Pt])nt=H[Pt];else{if(Ds(P)==="array")for(var ft=0;ft<C.length;ft++){var pt=C[ft];if(it<=pt){nt=P[ft];break}if(it>=pt&&ft===C.length-1){nt=P[ft];break}if(it>pt&&it<C[ft+1]){it=(it-pt)/(C[ft+1]-pt),nt=je.interpolate(P[ft],P[ft+1],it,d);break}}else Ds(P)==="function"&&(nt=P(it));j&&(H[Pt]=nt)}return nt},me=function(){return H={}};at(u);var ht=function(D){var X=je(Gt(D));return R&&X[R]?X[R]():X};return ht.classes=function(D){if(D!=null){if(Ds(D)==="array")O=D,x=[D[0],D[D.length-1]];else{var X=je.analyze(x);D===0?O=[X.min,X.max]:O=je.limits(X,"e",D)}return ht}return O},ht.domain=function(D){if(!arguments.length)return x;M=D[0],z=D[D.length-1],C=[];var X=P.length;if(D.length===X&&M!==z)for(var nt=0,it=Array.from(D);nt<it.length;nt+=1){var te=it[nt];C.push((te-M)/(z-M))}else{for(var Pt=0;Pt<X;Pt++)C.push(Pt/(X-1));if(D.length>2){var ft=D.map(function(gt,vt){return vt/(D.length-1)}),pt=D.map(function(gt){return(gt-M)/(z-M)});pt.every(function(gt,vt){return ft[vt]===gt})||(Jt=function(gt){if(gt<=0||gt>=1)return gt;for(var vt=0;gt>=pt[vt+1];)vt++;var Ve=(gt-pt[vt])/(pt[vt+1]-pt[vt]),Bi=ft[vt]+Ve*(ft[vt+1]-ft[vt]);return Bi})}}return x=[M,z],ht},ht.mode=function(D){return arguments.length?(d=D,me(),ht):d},ht.range=function(D,X){return at(D),ht},ht.out=function(D){return R=D,ht},ht.spread=function(D){return arguments.length?(v=D,ht):v},ht.correctLightness=function(D){return D==null&&(D=!0),E=D,me(),E?dt=function(X){for(var nt=Gt(0,!0).lab()[0],it=Gt(1,!0).lab()[0],te=nt>it,Pt=Gt(X,!0).lab()[0],ft=nt+(it-nt)*X,pt=Pt-ft,gt=0,vt=1,Ve=20;Math.abs(pt)>.01&&Ve-- >0;)(function(){return te&&(pt*=-1),pt<0?(gt=X,X+=(vt-X)*.5):(vt=X,X+=(gt-X)*.5),Pt=Gt(X,!0).lab()[0],pt=Pt-ft})();return X}:dt=function(X){return X},ht},ht.padding=function(D){return D!=null?(Ds(D)==="number"&&(D=[D,D]),w=D,ht):w},ht.colors=function(D,X){arguments.length<2&&(X="hex");var nt=[];if(arguments.length===0)nt=P.slice(0);else if(D===1)nt=[ht(.5)];else if(D>1){var it=x[0],te=x[1]-it;nt=l0(0,D,!1).map(function(vt){return ht(it+vt/(D-1)*te)})}else{u=[];var Pt=[];if(O&&O.length>2)for(var ft=1,pt=O.length,gt=1<=pt;gt?ft<pt:ft>pt;gt?ft++:ft--)Pt.push((O[ft-1]+O[ft])*.5);else Pt=x;nt=Pt.map(function(vt){return ht(vt)})}return je[X]&&(nt=nt.map(function(vt){return vt[X]()})),nt},ht.cache=function(D){return D!=null?(j=D,ht):j},ht.gamma=function(D){return D!=null?(et=D,ht):et},ht.nodata=function(D){return D!=null?(g=je(D),ht):g},ht};function l0(u,d,g){for(var v=[],x=u<d,C=g?x?d+1:d-1:d,w=u;x?w<C:w>C;x?w++:w--)v.push(w);return v}var ln=I,h0=zo,c0=function(u){for(var d=[1,1],g=1;g<u;g++){for(var v=[1],x=1;x<=d.length;x++)v[x]=(d[x]||0)+d[x-1];d=v}return d},u0=function(u){var d,g,v,x,C,w,O;if(u=u.map(function(E){return new ln(E)}),u.length===2)d=u.map(function(E){return E.lab()}),C=d[0],w=d[1],x=function(E){var H=[0,1,2].map(function(j){return C[j]+E*(w[j]-C[j])});return new ln(H,"lab")};else if(u.length===3)g=u.map(function(E){return E.lab()}),C=g[0],w=g[1],O=g[2],x=function(E){var H=[0,1,2].map(function(j){return(1-E)*(1-E)*C[j]+2*(1-E)*E*w[j]+E*E*O[j]});return new ln(H,"lab")};else if(u.length===4){var P;v=u.map(function(E){return E.lab()}),C=v[0],w=v[1],O=v[2],P=v[3],x=function(E){var H=[0,1,2].map(function(j){return(1-E)*(1-E)*(1-E)*C[j]+3*(1-E)*(1-E)*E*w[j]+3*(1-E)*E*E*O[j]+E*E*E*P[j]});return new ln(H,"lab")}}else if(u.length>=5){var R,M,z;R=u.map(function(E){return E.lab()}),z=u.length-1,M=c0(z),x=function(E){var H=1-E,j=[0,1,2].map(function(et){return R.reduce(function(at,ut,dt){return at+M[dt]*Math.pow(H,z-dt)*Math.pow(E,dt)*ut[et]},0)});return new ln(j,"lab")}}else throw new RangeError("No point in running bezier with only one color.");return x},f0=function(u){var d=u0(u);return d.scale=function(){return h0(d)},d},Uo=J,He=function(u,d,g){if(!He[g])throw new Error("unknown blend mode "+g);return He[g](u,d)},Li=function(u){return function(d,g){var v=Uo(g).rgb(),x=Uo(d).rgb();return Uo.rgb(u(v,x))}},Ni=function(u){return function(d,g){var v=[];return v[0]=u(d[0],g[0]),v[1]=u(d[1],g[1]),v[2]=u(d[2],g[2]),v}},d0=function(u){return u},p0=function(u,d){return u*d/255},g0=function(u,d){return u>d?d:u},m0=function(u,d){return u>d?u:d},v0=function(u,d){return 255*(1-(1-u/255)*(1-d/255))},y0=function(u,d){return d<128?2*u*d/255:255*(1-2*(1-u/255)*(1-d/255))},b0=function(u,d){return 255*(1-(1-d/255)/(u/255))},w0=function(u,d){return u===255?255:(u=255*(d/255)/(1-u/255),u>255?255:u)};He.normal=Li(Ni(d0)),He.multiply=Li(Ni(p0)),He.screen=Li(Ni(v0)),He.overlay=Li(Ni(y0)),He.darken=Li(Ni(g0)),He.lighten=Li(Ni(m0)),He.dodge=Li(Ni(w0)),He.burn=Li(Ni(b0));for(var x0=He,Wo=b.type,S0=b.clip_rgb,k0=b.TWOPI,C0=Math.pow,O0=Math.sin,P0=Math.cos,Jh=J,T0=function(u,d,g,v,x){u===void 0&&(u=300),d===void 0&&(d=-1.5),g===void 0&&(g=1),v===void 0&&(v=1),x===void 0&&(x=[0,1]);var C=0,w;Wo(x)==="array"?w=x[1]-x[0]:(w=0,x=[x,x]);var O=function(P){var R=k0*((u+120)/360+d*P),M=C0(x[0]+w*P,v),z=C!==0?g[0]+P*C:g,E=z*M*(1-M)/2,H=P0(R),j=O0(R),et=M+E*(-.14861*H+1.78277*j),at=M+E*(-.29227*H-.90649*j),ut=M+E*(1.97294*H);return Jh(S0([et*255,at*255,ut*255,1]))};return O.start=function(P){return P==null?u:(u=P,O)},O.rotations=function(P){return P==null?d:(d=P,O)},O.gamma=function(P){return P==null?v:(v=P,O)},O.hue=function(P){return P==null?g:(g=P,Wo(g)==="array"?(C=g[1]-g[0],C===0&&(g=g[1])):C=0,O)},O.lightness=function(P){return P==null?x:(Wo(P)==="array"?(x=P,w=P[1]-P[0]):(x=[P,P],w=0),O)},O.scale=function(){return Jh.scale(O)},O.hue(g),O},A0=I,R0="0123456789abcdef",M0=Math.floor,I0=Math.random,E0=function(){for(var u="#",d=0;d<6;d++)u+=R0.charAt(M0(I0()*16));return new A0(u,"hex")},jo=h,tc=Math.log,D0=Math.pow,L0=Math.floor,N0=Math.abs,ec=function(u,d){d===void 0&&(d=null);var g={min:Number.MAX_VALUE,max:Number.MAX_VALUE*-1,sum:0,values:[],count:0};return jo(u)==="object"&&(u=Object.values(u)),u.forEach(function(v){d&&jo(v)==="object"&&(v=v[d]),v!=null&&!isNaN(v)&&(g.values.push(v),g.sum+=v,v<g.min&&(g.min=v),v>g.max&&(g.max=v),g.count+=1)}),g.domain=[g.min,g.max],g.limits=function(v,x){return ic(g,v,x)},g},ic=function(u,d,g){d===void 0&&(d="equal"),g===void 0&&(g=7),jo(u)=="array"&&(u=ec(u));var v=u.min,x=u.max,C=u.values.sort(function(Vo,qo){return Vo-qo});if(g===1)return[v,x];var w=[];if(d.substr(0,1)==="c"&&(w.push(v),w.push(x)),d.substr(0,1)==="e"){w.push(v);for(var O=1;O<g;O++)w.push(v+O/g*(x-v));w.push(x)}else if(d.substr(0,1)==="l"){if(v<=0)throw new Error("Logarithmic scales are only possible for values > 0");var P=Math.LOG10E*tc(v),R=Math.LOG10E*tc(x);w.push(v);for(var M=1;M<g;M++)w.push(D0(10,P+M/g*(R-P)));w.push(x)}else if(d.substr(0,1)==="q"){w.push(v);for(var z=1;z<g;z++){var E=(C.length-1)*z/g,H=L0(E);if(H===E)w.push(C[H]);else{var j=E-H;w.push(C[H]*(1-j)+C[H+1]*j)}}w.push(x)}else if(d.substr(0,1)==="k"){var et,at=C.length,ut=new Array(at),dt=new Array(g),Jt=!0,Gt=0,me=null;me=[],me.push(v);for(var ht=1;ht<g;ht++)me.push(v+ht/g*(x-v));for(me.push(x);Jt;){for(var D=0;D<g;D++)dt[D]=0;for(var X=0;X<at;X++)for(var nt=C[X],it=Number.MAX_VALUE,te=void 0,Pt=0;Pt<g;Pt++){var ft=N0(me[Pt]-nt);ft<it&&(it=ft,te=Pt),dt[te]++,ut[X]=te}for(var pt=new Array(g),gt=0;gt<g;gt++)pt[gt]=null;for(var vt=0;vt<at;vt++)et=ut[vt],pt[et]===null?pt[et]=C[vt]:pt[et]+=C[vt];for(var Ve=0;Ve<g;Ve++)pt[Ve]*=1/dt[Ve];Jt=!1;for(var Bi=0;Bi<g;Bi++)if(pt[Bi]!==me[Bi]){Jt=!0;break}me=pt,Gt++,Gt>200&&(Jt=!1)}for(var _i={},Ls=0;Ls<g;Ls++)_i[Ls]=[];for(var Ns=0;Ns<at;Ns++)et=ut[Ns],_i[et].push(C[Ns]);for(var bi=[],rs=0;rs<g;rs++)bi.push(_i[rs][0]),bi.push(_i[rs][_i[rs].length-1]);bi=bi.sort(function(Vo,qo){return Vo-qo}),w.push(bi[0]);for(var hn=1;hn<bi.length;hn+=2){var os=bi[hn];!isNaN(os)&&w.indexOf(os)===-1&&w.push(os)}}return w},sc={analyze:ec,limits:ic},nc=I,B0=function(u,d){u=new nc(u),d=new nc(d);var g=u.luminance(),v=d.luminance();return g>v?(g+.05)/(v+.05):(v+.05)/(g+.05)},rc=I,yi=Math.sqrt,Ft=Math.pow,_0=Math.min,$0=Math.max,oc=Math.atan2,ac=Math.abs,lr=Math.cos,lc=Math.sin,F0=Math.exp,hc=Math.PI,z0=function(u,d,g,v,x){g===void 0&&(g=1),v===void 0&&(v=1),x===void 0&&(x=1);var C=function(os){return 360*os/(2*hc)},w=function(os){return 2*hc*os/360};u=new rc(u),d=new rc(d);var O=Array.from(u.lab()),P=O[0],R=O[1],M=O[2],z=Array.from(d.lab()),E=z[0],H=z[1],j=z[2],et=(P+E)/2,at=yi(Ft(R,2)+Ft(M,2)),ut=yi(Ft(H,2)+Ft(j,2)),dt=(at+ut)/2,Jt=.5*(1-yi(Ft(dt,7)/(Ft(dt,7)+Ft(25,7)))),Gt=R*(1+Jt),me=H*(1+Jt),ht=yi(Ft(Gt,2)+Ft(M,2)),D=yi(Ft(me,2)+Ft(j,2)),X=(ht+D)/2,nt=C(oc(M,Gt)),it=C(oc(j,me)),te=nt>=0?nt:nt+360,Pt=it>=0?it:it+360,ft=ac(te-Pt)>180?(te+Pt+360)/2:(te+Pt)/2,pt=1-.17*lr(w(ft-30))+.24*lr(w(2*ft))+.32*lr(w(3*ft+6))-.2*lr(w(4*ft-63)),gt=Pt-te;gt=ac(gt)<=180?gt:Pt<=te?gt+360:gt-360,gt=2*yi(ht*D)*lc(w(gt)/2);var vt=E-P,Ve=D-ht,Bi=1+.015*Ft(et-50,2)/yi(20+Ft(et-50,2)),_i=1+.045*X,Ls=1+.015*X*pt,Ns=30*F0(-Ft((ft-275)/25,2)),bi=2*yi(Ft(X,7)/(Ft(X,7)+Ft(25,7))),rs=-bi*lc(2*w(Ns)),hn=yi(Ft(vt/(g*Bi),2)+Ft(Ve/(v*_i),2)+Ft(gt/(x*Ls),2)+rs*(Ve/(v*_i))*(gt/(x*Ls)));return $0(0,_0(100,hn))},cc=I,U0=function(u,d,g){g===void 0&&(g="lab"),u=new cc(u),d=new cc(d);var v=u.get(g),x=d.get(g),C=0;for(var w in v){var O=(v[w]||0)-(x[w]||0);C+=O*O}return Math.sqrt(C)},W0=I,j0=function(){for(var u=[],d=arguments.length;d--;)u[d]=arguments[d];try{return new(Function.prototype.bind.apply(W0,[null].concat(u))),!0}catch{return!1}},uc=J,fc=zo,H0={cool:function(){return fc([uc.hsl(180,1,.9),uc.hsl(250,.7,.4)])},hot:function(){return fc(["#000","#f00","#ff0","#fff"]).mode("rgb")}},hr={OrRd:["#fff7ec","#fee8c8","#fdd49e","#fdbb84","#fc8d59","#ef6548","#d7301f","#b30000","#7f0000"],PuBu:["#fff7fb","#ece7f2","#d0d1e6","#a6bddb","#74a9cf","#3690c0","#0570b0","#045a8d","#023858"],BuPu:["#f7fcfd","#e0ecf4","#bfd3e6","#9ebcda","#8c96c6","#8c6bb1","#88419d","#810f7c","#4d004b"],Oranges:["#fff5eb","#fee6ce","#fdd0a2","#fdae6b","#fd8d3c","#f16913","#d94801","#a63603","#7f2704"],BuGn:["#f7fcfd","#e5f5f9","#ccece6","#99d8c9","#66c2a4","#41ae76","#238b45","#006d2c","#00441b"],YlOrBr:["#ffffe5","#fff7bc","#fee391","#fec44f","#fe9929","#ec7014","#cc4c02","#993404","#662506"],YlGn:["#ffffe5","#f7fcb9","#d9f0a3","#addd8e","#78c679","#41ab5d","#238443","#006837","#004529"],Reds:["#fff5f0","#fee0d2","#fcbba1","#fc9272","#fb6a4a","#ef3b2c","#cb181d","#a50f15","#67000d"],RdPu:["#fff7f3","#fde0dd","#fcc5c0","#fa9fb5","#f768a1","#dd3497","#ae017e","#7a0177","#49006a"],Greens:["#f7fcf5","#e5f5e0","#c7e9c0","#a1d99b","#74c476","#41ab5d","#238b45","#006d2c","#00441b"],YlGnBu:["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"],Purples:["#fcfbfd","#efedf5","#dadaeb","#bcbddc","#9e9ac8","#807dba","#6a51a3","#54278f","#3f007d"],GnBu:["#f7fcf0","#e0f3db","#ccebc5","#a8ddb5","#7bccc4","#4eb3d3","#2b8cbe","#0868ac","#084081"],Greys:["#ffffff","#f0f0f0","#d9d9d9","#bdbdbd","#969696","#737373","#525252","#252525","#000000"],YlOrRd:["#ffffcc","#ffeda0","#fed976","#feb24c","#fd8d3c","#fc4e2a","#e31a1c","#bd0026","#800026"],PuRd:["#f7f4f9","#e7e1ef","#d4b9da","#c994c7","#df65b0","#e7298a","#ce1256","#980043","#67001f"],Blues:["#f7fbff","#deebf7","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#08519c","#08306b"],PuBuGn:["#fff7fb","#ece2f0","#d0d1e6","#a6bddb","#67a9cf","#3690c0","#02818a","#016c59","#014636"],Viridis:["#440154","#482777","#3f4a8a","#31678e","#26838f","#1f9d8a","#6cce5a","#b6de2b","#fee825"],Spectral:["#9e0142","#d53e4f","#f46d43","#fdae61","#fee08b","#ffffbf","#e6f598","#abdda4","#66c2a5","#3288bd","#5e4fa2"],RdYlGn:["#a50026","#d73027","#f46d43","#fdae61","#fee08b","#ffffbf","#d9ef8b","#a6d96a","#66bd63","#1a9850","#006837"],RdBu:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#f7f7f7","#d1e5f0","#92c5de","#4393c3","#2166ac","#053061"],PiYG:["#8e0152","#c51b7d","#de77ae","#f1b6da","#fde0ef","#f7f7f7","#e6f5d0","#b8e186","#7fbc41","#4d9221","#276419"],PRGn:["#40004b","#762a83","#9970ab","#c2a5cf","#e7d4e8","#f7f7f7","#d9f0d3","#a6dba0","#5aae61","#1b7837","#00441b"],RdYlBu:["#a50026","#d73027","#f46d43","#fdae61","#fee090","#ffffbf","#e0f3f8","#abd9e9","#74add1","#4575b4","#313695"],BrBG:["#543005","#8c510a","#bf812d","#dfc27d","#f6e8c3","#f5f5f5","#c7eae5","#80cdc1","#35978f","#01665e","#003c30"],RdGy:["#67001f","#b2182b","#d6604d","#f4a582","#fddbc7","#ffffff","#e0e0e0","#bababa","#878787","#4d4d4d","#1a1a1a"],PuOr:["#7f3b08","#b35806","#e08214","#fdb863","#fee0b6","#f7f7f7","#d8daeb","#b2abd2","#8073ac","#542788","#2d004b"],Set2:["#66c2a5","#fc8d62","#8da0cb","#e78ac3","#a6d854","#ffd92f","#e5c494","#b3b3b3"],Accent:["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"],Set1:["#e41a1c","#377eb8","#4daf4a","#984ea3","#ff7f00","#ffff33","#a65628","#f781bf","#999999"],Set3:["#8dd3c7","#ffffb3","#bebada","#fb8072","#80b1d3","#fdb462","#b3de69","#fccde5","#d9d9d9","#bc80bd","#ccebc5","#ffed6f"],Dark2:["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Paired:["#a6cee3","#1f78b4","#b2df8a","#33a02c","#fb9a99","#e31a1c","#fdbf6f","#ff7f00","#cab2d6","#6a3d9a","#ffff99","#b15928"],Pastel2:["#b3e2cd","#fdcdac","#cbd5e8","#f4cae4","#e6f5c9","#fff2ae","#f1e2cc","#cccccc"],Pastel1:["#fbb4ae","#b3cde3","#ccebc5","#decbe4","#fed9a6","#ffffcc","#e5d8bd","#fddaec","#f2f2f2"]},Ho=0,dc=Object.keys(hr);Ho<dc.length;Ho+=1){var pc=dc[Ho];hr[pc.toLowerCase()]=hr[pc]}var V0=hr,Kt=J;Kt.average=r0,Kt.bezier=f0,Kt.blend=x0,Kt.cubehelix=T0,Kt.mix=Kt.interpolate=Hh,Kt.random=E0,Kt.scale=zo,Kt.analyze=sc.analyze,Kt.contrast=B0,Kt.deltaE=z0,Kt.distance=U0,Kt.limits=sc.limits,Kt.valid=j0,Kt.scales=H0,Kt.colors=Ph,Kt.brewer=V0;var q0=Kt;return q0})})(rf);var Dt=rf.exports;const Le=(()=>(Dt.Color.symbol=Dt.Color.prototype.symbol=Symbol.for("@motion-canvas/core/types/Color"),Dt.Color.lerp=Dt.Color.prototype.lerp=(r,t,e,i="lch")=>{typeof r=="string"&&(r=new Dt.Color(r)),typeof t=="string"&&(t=new Dt.Color(t));const s=r instanceof Dt.Color,n=t instanceof Dt.Color;return s||(r=n?t.alpha(0):new Dt.Color("rgba(0, 0, 0, 0)")),n||(t=s?r.alpha(0):new Dt.Color("rgba(0, 0, 0, 0)")),Dt.mix(r,t,e,i)},Dt.Color.createLerp=Dt.Color.prototype.createLerp=r=>(t,e,i)=>Dt.Color.lerp(t,e,i,r),Dt.Color.createSignal=(r,t=Dt.Color.lerp)=>new Gi(r,t,void 0,e=>new Dt.Color(e)).toSignal(),Dt.Color.prototype.toSymbol=()=>Dt.Color.symbol,Dt.Color.prototype.toUniform=function(r,t){r.uniform4fv(t,this.gl())},Dt.Color.prototype.serialize=function(){return this.css()},Dt.Color.prototype.lerp=function(r,t,e){return Dt.Color.lerp(this,r,t,e)},Dt.Color))();function Mv(r,t){return k.fromDegrees(r).transform(t).degrees}function ga(r,t){return k.magnitude(t.m11,t.m12)*r}class ma extends Pe{constructor(){super(...arguments),this.type=Le.symbol}parse(t){return t===null?null:new Le(t)}serialize(){return this.value.current?.serialize()??null}}class Ki extends Pe{constructor(t,e,i=e[0]?.value){super(t,i),this.options=e,this.type=Ki.symbol}set(t){super.set(this.getOption(t)?.value)}parse(t){return this.getOption(t)?.value}getOption(t){return this.options.find(e=>e.value===t)??this.options[0]}}Ki.symbol=Symbol.for("@motion-canvas/core/meta/EnumMetaField");class Iv extends Pe{get onFieldsChanged(){return this.fields.subscribable}get options(){return this.optionFields[this.current]}constructor(t,e,i=0){const s=e.plugins.flatMap(a=>a.exporters?.(e)??[]),n=s.map(a=>a.meta(e)),o=new Ki("exporter",s.map(a=>({value:a.id,text:a.displayName})),s[i]?.id);super(t,{name:o.get(),options:n[i]?.get()}),this.current=i,this.type=Object,this.handleChange=()=>{const a=this.exporterField.get(),l=Math.max(this.exporters.findIndex(h=>h.id===a),0);this.current!==l&&(this.options?.onChanged.unsubscribe(this.handleChange),this.current=l,this.options?.onChanged.subscribe(this.handleChange,!1),this.fields.current=this.options?[this.exporterField,this.options]:[this.exporterField]),this.value.current={name:this.exporterField.get(),options:this.options?.get()??null}},this.exporters=s,this.exporterField=o,this.exporterField.onChanged.subscribe(this.handleChange,!1),this.exporterField.disable(n.length<2).space(),this.optionFields=n,this.fields=new Te([this.exporterField]),this.options&&(this.options.onChanged.subscribe(this.handleChange,!1),this.fields.current=[this.exporterField,this.options])}set(t){this.exporterField.set(t.name),this.options?.set(t.options??{})}serialize(){return{name:this.exporterField.serialize(),options:this.options?.serialize()??null}}clone(){return new this.constructor(this.name,this.exporters,this.current)}}var pn;class pi{constructor(t,e=!1){this.name=t,this.source=e,this.lock=new Y0,this.ignoreChange=!1,this.cache=null,this.metaField=null,this.handleChanged=async()=>{}}attach(t){this.metaField||(this.metaField=t,this.cache&&this.metaField.set(this.cache),this.metaField?.onChanged.subscribe(this.handleChanged))}async saveData(t){if(this.source===!1)return;if(!this.source)throw new Error(`The meta file for ${this.name} is missing.`);if(pn.sourceLookup[this.source])throw new Error(`Metadata for ${this.name} is already being updated`);const e=this.source;await new Promise((i,s)=>{setTimeout(()=>{delete pn.sourceLookup[e],s(`Connection timeout when updating metadata for ${this.name}`)},1e3),pn.sourceLookup[e]=()=>{delete pn.sourceLookup[e],i()},(void 0).send("motion-canvas:meta",{source:e,data:t})})}loadData(t){this.ignoreChange=!0,this.cache=t,this.metaField?.set(t),this.ignoreChange=!1}}pn=pi;pi.sourceLookup={};class Tr extends Pe{constructor(){super(...arguments),this.type=Number,this.presets=[]}parse(t){let e=parseFloat(t);return this.min!==void 0&&e<this.min&&(e=this.min),this.max!==void 0&&e>this.max&&(e=this.max),e}getPresets(){return this.presets}setPresets(t){return this.presets=t,this}setRange(t,e){return this.min=t,this.max=e,this}getMin(){return this.min??-1/0}getMax(){return this.max??1/0}}class Ev extends Pe{get onFieldsChanged(){return this.event.subscribable}constructor(t,e){const i=new Map(Object.entries(e));super(t,Object.fromEntries(Array.from(i,([s,n])=>[s,n.get()]))),this.type=Object,this.ignoreChange=!1,this.customFields={},this.handleChange=()=>{this.ignoreChange||(this.value.current={...this.transform("get"),...this.customFields})},this.event=new Te([...i.values()]),this.fields=i;for(const[s,n]of this.fields)Object.defineProperty(this,s,{value:n}),n.onChanged.subscribe(this.handleChange)}set(t){this.ignoreChange=!0;for(const[e,i]of Object.entries(t)){const s=this.fields.get(e);s?s.set(i):this.customFields[e]=i}this.ignoreChange=!1,this.handleChange()}serialize(){return{...this.transform("serialize"),...this.customFields}}clone(){const t=new this.constructor(this.name,this.transform("clone"));return t.set(structuredClone(this.customFields)),t}transform(t){return Object.fromEntries(Array.from(this.fields,([i,s])=>[i,s[t]()]))}}const Pi=Ev;class lo extends Pe{constructor(){super(...arguments),this.type=lo.symbol}parse(t){return this.parseRange(1/0,t[0],t[1]??1/0)}update(t,e,i,s){this.value.current=this.parseRange(i/s-wn,t/s-wn,e/s-wn)}parseRange(t,e=this.value.current[0],i=this.value.current[1]){return e=ne(0,t,e),i=ne(0,t,i??1/0),e>i&&([e,i]=[i,e]),i>=t&&(i=1/0),[e,i]}}lo.symbol=Symbol.for("@motion-canvas/core/meta/RangeMetaField");class of extends Pe{constructor(){super(...arguments),this.type=k.symbol}parse(t){return new k(t)}serialize(){return this.value.current.serialize()}}const Sc=[{value:.25,text:"0.25x (Quarter)"},{value:.5,text:"0.5x (Half)"},{value:1,text:"1.0x (Full)"},{value:2,text:"2.0x (Double)"}],Dv=[{value:"srgb",text:"sRGB"},{value:"display-p3",text:"DCI-P3"}],Lv=[{value:"image/png",text:"png"},{value:"image/jpeg",text:"jpeg"},{value:"image/webp",text:"webp"}],kc=[{value:30,text:"30 FPS"},{value:60,text:"60 FPS"}];var Ar;const Nv=1e3;class Un{static meta(){const t=new Pi(this.name,{fileType:new Ki("file type",Lv),quality:new Tr("quality",100).setRange(0,100).describe("A number between 0 and 100 indicating the image quality."),groupByScene:new da("group by scene",!1).describe("Group exported images by scene. When checked, separates the sequence into subdirectories for each scene in the project.")});return t.fileType.onChanged.subscribe(e=>{t.quality.disable(e==="image/png")}),t}static async create(t,e){return new Ar(t.logger,e)}constructor(t,e){this.logger=t,this.settings=e,this.frameLookup=new Set,this.handleResponse=({frame:s})=>{this.frameLookup.delete(s)};const i=e.exporter.options;this.projectName=e.name,this.quality=ne(0,1,i.quality/100),this.fileType=i.fileType,this.groupByScene=i.groupByScene}async start(){Ar.response.subscribe(this.handleResponse)}async handleFrame(t,e,i,s,n){if(this.frameLookup.has(e)){this.logger.warn(`Frame no. ${e} is already being exported.`);return}}async stop(){for(;this.frameLookup.size>0;)await new Promise(t=>setTimeout(t,Nv));Ar.response.unsubscribe(this.handleResponse)}}Ar=Un;Un.id="@motion-canvas/core/image-sequence";Un.displayName="Image sequence";Un.response=new Ye;var qe;(function(r){r.Error="error",r.Warn="warn",r.Info="info",r.Http="http",r.Verbose="verbose",r.Debug="debug",r.Silly="silly"})(qe||(qe={}));class af{constructor(){this.logged=new Ye,this.history=[],this.profilers={}}get onLogged(){return this.logged.subscribable}log(t){this.logged.dispatch(t),this.history.push(t)}error(t){this.logLevel(qe.Error,t)}warn(t){this.logLevel(qe.Warn,t)}info(t){this.logLevel(qe.Info,t)}http(t){this.logLevel(qe.Http,t)}verbose(t){this.logLevel(qe.Verbose,t)}debug(t){this.logLevel(qe.Debug,t)}silly(t){this.logLevel(qe.Silly,t)}logLevel(t,e){const i=typeof e=="string"?{message:e}:e;i.level=t,this.log(i)}profile(t,e){const i=performance.now();if(this.profilers[t]){const s=this.profilers[t];delete this.profilers[t];const n=e??{message:t};n.level??(n.level=qe.Debug),n.durationMs=i-s,this.log(n);return}this.profilers[t]=i}}function Bv(r){const t={version:new Pe("version",1),shared:new Pi("General",{background:new ma("background",null),range:new lo("range",[0,1/0]),size:new of("resolution",new k(1920,1080)),audioOffset:new Tr("audio offset",0)}),preview:new Pi("Preview",{fps:new Tr("frame rate",30).setPresets(kc).setRange(1),resolutionScale:new Ki("scale",Sc,1)}),rendering:new Pi("Rendering",{fps:new Tr("frame rate",60).setPresets(kc).setRange(1),resolutionScale:new Ki("scale",Sc,1),colorSpace:new Ki("color space",Dv),exporter:new Iv("exporter",r)})};return t.shared.audioOffset.disable(!r.audio),t}class _v extends Pi{constructor(t){super("project",Bv(t))}getFullPreviewSettings(){return{...this.shared.get(),...this.preview.get()}}getFullRenderingSettings(){return{...this.shared.get(),...this.rendering.get()}}}function $v(){return new Pi("Application Settings",{version:new Pe("version",1),appearance:new Pi("Appearance",{color:new ma("accent color",new Le("#33a6ff")).describe("The accent color for the user interface. (Leave empty to use the default color)"),font:new da("legacy font",!1).describe("Use the 'JetBrains Mono' font for the user interface."),coordinates:new da("coordinates",!0).describe("Display mouse coordinates within the preview window.")}),defaults:new Pi("Defaults",{background:new ma("background",null).describe("The default background color used in new projects."),size:new of("resolution",new k(1920,1080)).describe("The default resolution used in new projects.")})})}const Fv="modulepreload",zv=function(r){return"/"+r},Cc={},Uv=function(t,e,i){if(!e||e.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(e.map(n=>{if(n=zv(n),n in Cc)return;Cc[n]=!0;const o=n.endsWith(".css"),a=o?'[rel="stylesheet"]':"";if(!!i)for(let c=s.length-1;c>=0;c--){const f=s[c];if(f.href===n&&(!o||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${n}"]${a}`))return;const h=document.createElement("link");if(h.rel=o?"stylesheet":Fv,o||(h.as="script",h.crossOrigin=""),h.href=n,document.head.appendChild(h),o)return new Promise((c,f)=>{h.addEventListener("load",c),h.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${n}`)))})})).then(()=>t()).catch(n=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=n,window.dispatchEvent(o),!o.defaultPrevented)throw n})};function Wv(r){return typeof r=="function"?r:()=>r}const jv=Wv({name:"@motion-canvas/core/default",exporters(){return[Un]}});function Hv(r,t,e,i,s,n,o=i.logger??new af){const a=$v();n.attach(a);const l={name:r,...i,plugins:e,versions:t,settings:a,logger:o};return l.meta=new _v(l),l.meta.shared.set(a.defaults.get()),l.experimentalFeatures??(l.experimentalFeatures=!1),s.attach(l.meta),l}async function Vv(r,t,e,i,s,n){const o=i.logger??new af,a=[Promise.resolve(jv())];if(i.plugins)for(const m of i.plugins)a.push(Go(m,o));for(const m of i.scenes)if(m.plugins)for(const y of m.plugins)a.push(Go(y,o));for(const m of e)a.push(Go(m,o));const l=new Set,h=await Promise.all(a),c=[];let f=i;for(const m of h)!m||l.has(m.name)||(l.add(m.name),c.push(m),f={...f,...m.settings?.(f)??{}});const p=Hv(r,t,c,f,s,n);return c.forEach(m=>m.project?.(p)),p}async function Go(r,t){if(typeof r=="string")try{let e=`/@id/${r}`;const i=new URL(import.meta.url).searchParams.get("v");i&&(e+=`?v=${i}`),r=(await Uv(()=>import(e),[])).default()}catch(e){return console.error(e),t.error({message:`Failed to load plugin "${r}": ${e.message}.`,stack:e.stack,remarks:e.remarks}),null}return r}function hl(r,t,e){t==null&&(t=()=>{});const i=Xe(),s=i.previous;i.previousOnTop=e??!1;const n=s?.lifecycleEvents.onBeforeRender.subscribe(t),o=i.lifecycleEvents.onBeforeRender.subscribe(r);return i.enterInitial(),()=>{i.enterAfterTransitionIn(),n?.(),o()}}function*cl(r=Qt.Top,t=.6){const i=Xe().getRealSize().getOriginOffset(r).scale(2),s=k.createSignal(),n=k.createSignal(i),o=hl(a=>a.translate(n.x(),n.y()),a=>a.translate(s.x(),s.y()));yield*Lt(s(i.scale(-1),t),n(k.zero,t)),o()}function*qv(r,t=.6){const e=Xe().getRealSize().div(r.size),i=k.createSignal(r.position),s=k.createSignal(k.one.div(e)),n=k.createSignal(0),o=k.createSignal(1),a=ye(0),l=hl(c=>{c.globalAlpha=Tn(.1,.5,0,1,a()),c.translate(i.x(),i.y()),c.scale(s.x(),s.y())},c=>{c.globalAlpha=Tn(.5,.9,1,0,a()),c.translate(n.x(),n.y()),c.scale(o.x(),o.y())}),h=c=>Ie(c*c);yield*Lt(i(k.zero,t,h),n(r.position.flipped.mul(e),t,h),s(1,t,h),o(e,t,h),a(1,t,ll)),l()}function*Kv(r,t=.6){const e=Xe().getRealSize().div(r.size),i=k.createSignal(r.position.flipped.mul(e)),s=k.createSignal(e),n=k.createSignal(0),o=k.createSignal(1),a=ye(0),l=hl(c=>{c.globalAlpha=Tn(.1,.5,0,1,a()),c.translate(i.x(),i.y()),c.scale(s.x(),s.y())},c=>{c.globalAlpha=Tn(.5,.9,1,0,a()),c.translate(n.x(),n.y()),c.scale(o.x(),o.y())}),h=c=>Ie(Math.sqrt(c));yield*Lt(i(k.zero,t,h),n(r.position,t,h),s(1,t,h),o(k.one.div(e),t,h),a(1,t,ll)),l()}let ul;ul??=new pi("project",!1);ul.loadData({version:0,shared:{background:"rgb(18,18,18)",range:[0,null],size:{x:1920,y:1080},audioOffset:0},preview:{fps:30,resolutionScale:1},rendering:{fps:30,resolutionScale:1,colorSpace:"srgb",exporter:{name:"@motion-canvas/core/image-sequence",options:{fileType:"image/png",quality:100,groupByScene:!1,fastStart:!1,includeAudio:!0}}}});const Gv=ul;function Yo(r,t,e){const i=e.split(`
`),s=i[i.length-1],n=Math.round(r.measureText(i[0]).width/t);let o=n,a=n;for(let l=1;l<i.length;l++){const h=i[l],c=Math.round(r.measureText(h).width/t);c>a&&(a=c)}return i.length>0&&(o=Math.round(r.measureText(s).width/t)),{content:e,newRows:i.length-1,endColumn:s.length,firstWidth:n,maxWidth:a,lastWidth:o}}function lf(r){return r?.content!==void 0}function Oc(r){return{before:r,after:r}}function Pc(r,t,e){let i;return typeof r=="string"?i=Oc(Yo(t,e,r)):lf(r)?i=Oc(r):i={before:typeof r.before=="string"?Yo(t,e,r.before):r.before,after:typeof r.after=="string"?Yo(t,e,r.after):r.after},i}function Tc(r){return{before:"",after:r}}function Yv(r,t){return{before:r,after:t}}function cr(r,...t){const e=[];for(let i=0;i<r.length;i++){e.push(r[i]);const s=t[i];s!==void 0&&(Array.isArray(s)?e.push(...s):e.push(s))}return e}function va(r){return r?.fragments!==void 0}function Xv(r){return typeof r=="string"?{progress:0,fragments:[r]}:Array.isArray(r)?{progress:0,fragments:r}:r}function gs(r,t){let e="";const i=typeof t=="boolean"?t:t(r);for(const s of r.fragments)e+=_s(s,i,t);return e}function _s(r,t,e=t){const i=Ht(r);return typeof i=="string"?i:va(i)?gs(i,e):lf(i)?i.content:Array.isArray(i)?gs({progress:0,fragments:i},e):t?typeof i.after=="string"?i.after:i.after.content:typeof i.before=="string"?i.before:i.before.content}function Ac(r){return Array.isArray(r)&&r.length===2&&typeof r[0]=="number"&&typeof r[1]=="number"}function Qv(r){return Array.isArray(r)&&r.length===2&&Ac(r[0])&&Ac(r[1])}function Rr(r,t){return[[r,0],[t??r,1/0]]}function as(r,t,e){return[[r,t],[r,t+(e??1/0)]]}function Zv(r,t){const[e,i]=r,[[s,n],[o,a]]=t;return(e===s&&i>=n||e>s)&&(e===o&&i<a||e<o)}function Xo(r,t,e=1/0){typeof t=="string"&&(t=new RegExp(t,"g"));const i=r.matchAll(t),s=[];let n=0,o=0,a=0;for(const l of i){if(l.index===void 0||s.length>=e)continue;let h=[o,a];for(;n<=r.length;){if(n===l.index&&(h=[o,a]),n===l.index+l[0].length){s.push([h,[o,a]]);break}r[n]===`
`?(o++,a=0):a++,n++}}return s}function hf(r){return Qv(r)?[r]:r}function ya(r,t){for(const e of t)if(Zv(r,e))return!0;return!1}class Jv{constructor(t){this.node=t,this.cursor=new k,this.beforeCursor=new k,this.afterCursor=new k,this.beforeIndex=0,this.afterIndex=0,this.context={},this.monoWidth=0,this.maxWidth=0,this.lineHeight=0,this.fallbackFill=new Le("white"),this.caches=null,this.highlighter=null,this.selection=[],this.selectionProgress=null,this.globalProgress=[],this.fragmentDrawingInfo=[],this.fontHeight=0,this.verticalOffset=0}setupMeasure(t){const e=t.measureText("X");this.monoWidth=e.width,this.fontHeight=e.fontBoundingBoxDescent+e.fontBoundingBoxAscent,this.verticalOffset=e.fontBoundingBoxAscent,this.context=t,this.lineHeight=parseFloat(this.node.styles.lineHeight),this.cursor=new k,this.beforeCursor=new k,this.afterCursor=new k,this.beforeIndex=0,this.afterIndex=0,this.maxWidth=0}setupDraw(t){this.setupMeasure(t);const e=this.node.fill();this.fallbackFill=e instanceof Le?e:new Le("white"),this.caches=this.node.highlighterCache(),this.highlighter=this.node.highlighter(),this.selection=this.node.selection(),this.selectionProgress=this.node.selectionProgress(),this.fragmentDrawingInfo=[],this.globalProgress=[]}measureSize(t){const e=Ht(t.progress);for(const i of t.fragments){const s=Ht(i);if(va(s)){this.measureSize(s);continue}if(Array.isArray(s)){this.measureSize({progress:t.progress,fragments:s});continue}const n=Pc(s,this.context,this.monoWidth),o=this.calculateMaxWidth(n.before),a=this.calculateMaxWidth(n.after),l=ot(o,a,e);l>this.maxWidth&&(this.maxWidth=l);const h=this.calculateWidth(n.before),c=this.calculateWidth(n.after);this.cursor.x=ot(h,c,e),this.cursor.y===0&&(this.cursor.y=1),this.cursor.y+=ot(n.before.newRows,n.after.newRows,e)}}getSize(){return{x:this.maxWidth*this.monoWidth,y:this.cursor.y*this.lineHeight+this.verticalOffset}}getDrawingInfo(){return{fragments:this.fragmentDrawingInfo,verticalOffset:this.verticalOffset,fontHeight:this.fontHeight}}drawScope(t){const e=Ht(t.progress);for(const i of t.fragments){const s=Ht(i);if(va(s)){this.drawScope(s);continue}if(Array.isArray(s)){this.drawScope({progress:t.progress,fragments:s});continue}const n=Pc(s,this.context,this.monoWidth),o=.8;let a=1,l=0;if(n.before.content!==n.after.content){const f=Math.abs(e-.5)*2;a=Tn(1,1-o,1,0,f);const p=n.after.newRows>n.before.newRows?1:-1,m=e<.5?1:-1,y=p*m*4;l=ot(Math.abs(n.after.newRows-n.before.newRows)/y,0,f)}this.drawToken(n,t,this.cursor.addY(l),a),this.beforeCursor.x=this.calculateWidth(n.before,this.beforeCursor.x),this.afterCursor.x=this.calculateWidth(n.after,this.afterCursor.x),this.beforeCursor.y+=n.before.newRows,this.afterCursor.y+=n.after.newRows,this.beforeIndex+=n.before.content.length,this.afterIndex+=n.after.content.length,this.cursor.y+=ot(n.before.newRows,n.after.newRows,e);const h=this.calculateWidth(n.before),c=this.calculateWidth(n.after);this.cursor.x=ot(h,c,e)}}drawToken(t,e,i,s){const n=Ht(e.progress),o=this.currentProgress();n>0&&this.globalProgress.push(n);const a=n<.5?t.before:t.after;let l=!0,h=0,c=0,f=0;for(let p=0;p<a.content.length;p++){let m=this.fallbackFill.serialize(),y=a.content.charAt(p);const b={before:null,after:null};if(y===`
`){f++,l=!1,h=0,c=0,b.before=null,b.after=null;continue}const S=this.caches&&this.highlighter?.highlight(this.beforeIndex+p,this.caches.before),T=this.caches&&this.highlighter?.highlight(this.afterIndex+p,this.caches.after),L=n<.5?S:T;if(L){t.before.content===t.after.content&&S?.color!==T?.color&&(L.color=Le.lerp(S?.color??this.fallbackFill,T?.color??this.fallbackFill,n).serialize()),L.color&&(m=L.color);let U=0;do{if(this.processSelection(b,U,l,c,f))break;U++}while(U<L.skipAhead&&a.content.charAt(p+U)!==`
`);U>1&&(y=a.content.slice(p,p+U)),p+=y.length-1}else{this.processSelection(b,0,l,c,f);let U=1;for(;p<a.content.length-1&&a.content.charAt(p+1)!==`
`&&!this.processSelection(b,U,l,c,f);)U++,y+=a.content.charAt(++p)}let B;const N=b.after??0,F=b.before??0;t.before.content===""?B=N:t.after.content===""?B=F:B=ot(F,N,this.selectionProgress??o);const I=this.context.measureText(y);this.fragmentDrawingInfo.push({text:y,position:new k((l?i.x+h:h)*this.monoWidth,(i.y+f)*this.lineHeight),cursor:new k(l?this.beforeCursor.x+c:c,this.beforeCursor.y+f),alpha:s,characterSize:new k(I.width/y.length,this.fontHeight),fill:m,time:B}),c+=y.length,h+=Math.round(I.width/this.monoWidth)}}calculateWidth(t,e=this.cursor.x){return t.newRows===0?e+t.lastWidth:t.lastWidth}calculateMaxWidth(t,e=this.cursor.x){return Math.max(this.maxWidth,t.maxWidth,e+t.firstWidth)}currentProgress(){if(this.globalProgress.length===0)return 0;let t=0;for(const e of this.globalProgress)t+=e;return t/this.globalProgress.length}processSelection(t,e,i,s,n){let o=!1,a=this.isSelected((i?this.beforeCursor.x+s:s)+e,this.beforeCursor.y+n);return t.before!==null&&t.before!==a?o=!0:t.before=a,a=this.isSelected((i?this.afterCursor.x+s:s)+e,this.afterCursor.y+n,!0),t.after!==null&&t.after!==a?o=!0:t.after=a,o}isSelected(t,e,i){const s=[e,t],n=ya(s,this.selection)?1:0;return this.node.oldSelection===null||this.selectionProgress===null||i?n:ya(s,this.node.oldSelection)?1:0}}function ty(r,t){function e(f,p,m){const y=new Map;for(let S=p;S<=m;S++){const T=f[S],L=y.get(T);L?(L.count++,L.index=S):y.set(T,{count:1,index:S})}const b=new Map;for(const[S,T]of y)T.count===1&&b.set(S,T.index);return b}function i(f,p,m,y,b,S){const T=e(f,p,m),L=e(y,b,S);return[...T.entries()].reduce((B,[N,F])=>{const I=L.get(N);return I!==void 0&&B.set(N,{aIndex:F,bIndex:I}),B},new Map)}function s(f){const p=[];f.forEach(y=>{let b=0;for(;p[b]&&p[b].at(-1).bIndex<y.bIndex;)b++;b>0&&(y.prev=p[b-1].at(-1)),p[b]?p[b].push(y):p[b]=[y]});let m=[];if(p.length>0){m=[p.at(-1).at(-1)];let y=m.at(-1);for(;y?.prev;)y=y.prev,m.push(y)}return m.reverse()}const n=[];let o=0,a=0;function l(f,p){p<0?o++:f<0&&a++,n.push({line:0<=f?r[f]:t[p],aIndex:f,bIndex:p,moved:!1})}function h(f,p,m,y){for(;f<=p&&m<=y&&r[f]===t[m];)l(f++,m++);const b=p;for(;f<=p&&m<=y&&r[p]===t[y];)p--,y--;const S=i(r,f,p,t,m,y);if(S.size===0){for(;f<=p;)l(f++,-1);for(;m<=y;)l(-1,m++)}else c(f,p,m,y,S);for(;p<b;)l(++p,++y)}function c(f,p,m,y,b=i(r,f,p,t,m,y)){const S=s(b);if(S.length===0)h(f,p,m,y);else{(f<S[0].aIndex||m<S[0].bIndex)&&h(f,S[0].aIndex-1,m,S[0].bIndex-1);let T;for(T=0;T<S.length-1;T++)h(S[T].aIndex,S[T+1].aIndex-1,S[T].bIndex,S[T+1].bIndex-1);(S[T].aIndex<=p||S[T].bIndex<=y)&&h(S[T].aIndex,p,S[T].bIndex,y)}}return c(0,r.length-1,0,t.length-1),{lines:n,lineCountDeleted:o,lineCountInserted:a}}function ey(r,t,e){const i=gs(r,!1),s=gs(t,!0),n=ty(e(i),e(s)),o=[];let a="",l="",h=!1;const c=()=>{(a!==""||l!=="")&&(o.push({before:a,after:l}),a="",l="")};for(const f of n.lines)f.aIndex===-1?(l!==""&&!h&&c(),h=!0,l+=f.line):f.bIndex===-1?(a!==""&&h&&c(),h=!1,a+=f.line):(c(),o.push(f.line));return c(),o}const Rc={invert:{name:"invert"},sepia:{name:"sepia"},grayscale:{name:"grayscale"},brightness:{name:"brightness",default:1},contrast:{name:"contrast",default:1},saturate:{name:"saturate",default:1},hue:{name:"hue-rotate",unit:"deg",scale:1},blur:{name:"blur",transform:!0,unit:"px",scale:1}};class iy{get name(){return this.props.name}get default(){return this.props.default}constructor(t){this.props={name:"invert",default:0,unit:"%",scale:100,transform:!1,...t,value:t.value??t.default??0},this.value=ye(this.props.value,ot,this)}isActive(){return this.value()!==this.props.default}serialize(t){let e=this.value();return this.props.transform&&(e=ga(e,t)),`${this.props.name}(${e*this.props.scale}${this.props.unit})`}}const wi=Symbol.for("@motion-canvas/2d/decorators/initializers");function nn(r,t){if(!r[wi])r[wi]=[];else if(r[wi]&&!Object.prototype.hasOwnProperty.call(r,wi)){const e=Object.getPrototypeOf(r);r[wi]=[...e[wi]]}r[wi].push(t)}function sy(r,t){if(r[wi])try{r[wi].forEach(e=>e(r,t))}catch(e){throw e.inspect??(e.inspect=r.key),e}}function Q(){return(r,t)=>{nn(r,e=>{const i=Object.getPrototypeOf(e)[t];e[t]=Tv(i.bind(e),e)})}}function ba(r={},t,e){const i={};if(e&&t){const s=r.setter??t?.[`set${ds(e)}`];s&&(i.setter=s.bind(t));const n=r.getter??t?.[`get${ds(e)}`];n&&(i.getter=n.bind(t));const o=r.tweener??t?.[`tween${ds(e)}`];o&&(i.tweener=o.bind(t))}return i}const xi=Symbol.for("@motion-canvas/2d/decorators/properties");function xs(r,t){return r[xi]?.[t]??null}function ho(r,t){let e;return r[xi]?r[xi]&&!Object.prototype.hasOwnProperty.call(r,xi)?r[xi]=e=Object.fromEntries(Object.entries(r[xi]).map(([i,s])=>[i,{...s}])):e=r[xi]:r[xi]=e={},e[t]??(e[t]={cloneable:!0,inspectable:!0,compoundEntries:[]}),e[t]}function cf(r){return r&&typeof r=="object"?r[xi]??{}:{}}function fl(r,t){sy(r);for(const[e,i]of Object.entries(cf(r))){const s=r[e];if(s.reset(),t[e]!==void 0&&s(t[e]),i.compoundEntries!==void 0)for(const[n,o]of i.compoundEntries)o in t&&s[n](t[o])}}function _(){return(r,t)=>{const e=ho(r,t);nn(r,i=>{let s=e.default;const n=i[`getDefault${ds(t)}`];n&&(s=()=>n.call(i,e.default));const o=new Gi(s,e.interpolationFunction??vs,i,e.parser?.bind(i),ba(e,i,t));i[t]=o.toSignal()})}}function V(r){return(t,e)=>{const i=xs(t,e);if(!i){qt().error(`Missing property decorator for "${e.toString()}"`);return}i.default=r}}function dl(r){return(t,e)=>{const i=xs(t,e);if(!i){qt().error(`Missing property decorator for "${e.toString()}"`);return}i.interpolationFunction=r}}function co(r){return(t,e)=>{const i=xs(t,e);if(!i){qt().error(`Missing property decorator for "${e.toString()}"`);return}i.parser=r}}function Wn(r){return(t,e)=>{const i=xs(t,e);if(!i){qt().error(`Missing property decorator for "${e.toString()}"`);return}i.parser=s=>new r(s),"lerp"in r&&(i.interpolationFunction??(i.interpolationFunction=r.lerp))}}function Ss(r=!0){return(t,e)=>{const i=xs(t,e);if(!i){qt().error(`Missing property decorator for "${e.toString()}"`);return}i.cloneable=r}}function uf(r=!0){return(t,e)=>{const i=xs(t,e);if(!i){qt().error(`Missing property decorator for "${e.toString()}"`);return}i.inspectable=r}}function ff(r,t=ao){return(e,i)=>{const s=ho(e,i);s.compound=!0,s.compoundEntries=Object.entries(r),nn(e,n=>{if(!s.parser){qt().error(`Missing parser decorator for "${i.toString()}"`);return}const o=s.default,a=s.parser.bind(n),l=new t(s.compoundEntries.map(([h,c])=>{const f=new Gi(ps(o,p=>a(p)[h]),ot,n,void 0,ba(void 0,n,c)).toSignal();return[h,f]}),a,o,s.interpolationFunction??vs,n,ba(s,n,i));n[i]=l.toSignal()})}}function Mi(r){return(t,e)=>{ff(typeof r=="object"?r:{x:r?`${r}X`:"x",y:r?`${r}Y`:"y"},nf)(t,e),Wn(k)(t,e)}}var Ji=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};class gi{constructor(t){fl(this,t)}canvasGradient(t){let e;switch(this.type()){case"linear":e=t.createLinearGradient(this.from.x(),this.from.y(),this.to.x(),this.to.y());break;case"conic":e=t.createConicGradient(this.angle(),this.from.x(),this.from.y());break;case"radial":e=t.createRadialGradient(this.from.x(),this.from.y(),this.fromRadius(),this.to.x(),this.to.y(),this.toRadius());break}for(const{offset:i,color:s}of this.stops())e.addColorStop(Ht(i),new Le(Ht(s)).serialize());return e}}Ji([V("linear"),_()],gi.prototype,"type",void 0);Ji([Mi("from")],gi.prototype,"from",void 0);Ji([Mi("to")],gi.prototype,"to",void 0);Ji([V(0),_()],gi.prototype,"angle",void 0);Ji([V(0),_()],gi.prototype,"fromRadius",void 0);Ji([V(0),_()],gi.prototype,"toRadius",void 0);Ji([V([]),_()],gi.prototype,"stops",void 0);Ji([Q()],gi.prototype,"canvasGradient",null);var pl=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};class jn{constructor(t){fl(this,t)}canvasPattern(t){return t.createPattern(this.image(),this.repetition())}}pl([_()],jn.prototype,"image",void 0);pl([V(null),_()],jn.prototype,"repetition",void 0);pl([Q()],jn.prototype,"canvasPattern",null);function ny(r){return r===null?null:r instanceof gi||r instanceof jn?r:new Le(r)}function wa(r,t){return r===null?"":r instanceof Le?r.serialize():r instanceof gi?r.canvasGradient(t):r instanceof jn?r.canvasPattern(t)??"":""}function Mc(r,t,e,i,s){if(e.top===0&&e.right===0&&e.bottom===0&&e.left===0){ry(r,t);return}const n=ji(e.top,e.right,e.left,t),o=ji(e.right,e.top,e.bottom,t),a=ji(e.bottom,e.left,e.right,t),l=ji(e.left,e.bottom,e.top,t);if(i){const h=c=>{const f=c*s;return c-f};r.moveTo(t.left+n,t.top),r.lineTo(t.right-o,t.top),r.bezierCurveTo(t.right-h(o),t.top,t.right,t.top+h(o),t.right,t.top+o),r.lineTo(t.right,t.bottom-a),r.bezierCurveTo(t.right,t.bottom-h(a),t.right-h(a),t.bottom,t.right-a,t.bottom),r.lineTo(t.left+l,t.bottom),r.bezierCurveTo(t.left+h(l),t.bottom,t.left,t.bottom-h(l),t.left,t.bottom-l),r.lineTo(t.left,t.top+n),r.bezierCurveTo(t.left,t.top+h(n),t.left+h(n),t.top,t.left+n,t.top);return}r.moveTo(t.left+n,t.top),r.arcTo(t.right,t.top,t.right,t.bottom,o),r.arcTo(t.right,t.bottom,t.left,t.bottom,a),r.arcTo(t.left,t.bottom,t.left,t.top,l),r.arcTo(t.left,t.top,t.right,t.top,n)}function ji(r,t,e,i){const s=r+t>i.width?i.width*(r/(r+t)):r,n=r+e>i.height?i.height*(r/(r+e)):r;return Math.min(s,n)}function ry(r,t){r.rect(t.x,t.y,t.width,t.height)}function Hn(r,t){r.moveTo(t.x,t.y)}function hi(r,t){r.lineTo(t.x,t.y)}function zi(r,t){if(!(t.length<2)){Hn(r,t[0]);for(const e of t.slice(1))hi(r,e)}}function df(r,t,e=8){hi(r,t.addY(-e)),hi(r,t.addY(e)),hi(r,t),hi(r,t.addX(-e)),pf(r,t,e)}function pf(r,t,e,i=0,s=Math.PI*2,n=!1){r.arc(t.x,t.y,e,i,s,n)}function oy(r,t,e,i){r.bezierCurveTo(t.x,t.y,e.x,e.y,i.x,i.y)}function gl(r){return t=>t instanceof r}function gf(){return(r,t)=>{_()(r,t),co(ny)(r,t),dl(Le.lerp)(r,t),V(null)(r,t)}}function ay(){return(r,t)=>{_()(r,t),Wn(Le)(r,t)}}function ts(r,t=e=>e){return(e,i)=>{e[`getDefault${ds(i)}`]=function(){this.requestLayoutUpdate();const s=this.element.style[r];this.element.style[r]="";const n=t.call(this,this.styles.getPropertyValue(r));return this.element.style[r]=s,n}}}class ly extends Gi{constructor(t,e){super(t,vs,e);for(const i in Rc){const s=Rc[i];Object.defineProperty(this.invokable,i,{value:(n,o,a=Ie)=>{if(n===void 0)return this.get()?.find(h=>h.name===s.name)?.value()??s.default??0;let l=this.get()?.find(h=>h.name===s.name);return l||(l=new iy(s),this.set([...this.get(),l])),o===void 0?(l.value(n),this.owner):l.value(n,o,a)}})}}*tweener(t,e,i){const s=this.get(),n=Ht(t);if(cy(s,n)){yield*Lt(...s.map((l,h)=>l.value(n[h].value(),e,i))),this.set(n);return}for(const l of n)l.value(l.default);const o=n.map(l=>l.value.context.raw()),a=s.length>0&&n.length>0?e/2:e;s.length>0&&(yield*Lt(...s.map(l=>l.value(l.default,a,i)))),this.set(n),n.length>0&&(yield*Lt(...n.map((l,h)=>l.value(o[h],a,i))))}}function hy(){return(r,t)=>{const e=ho(r,t);nn(r,i=>{i[t]=new ly(e.default??[],i).toSignal()})}}function cy(r,t){if(r.length!==t.length)return!1;for(let e=0;e<r.length;e++)if(r[e].name!==t[e].name)return!1;return!0}const uy=Symbol.for("@motion-canvas/2d/nodeName");function mi(r){return function(t){t.prototype[uy]=r}}function Ic(r,t){const e=ne(0,r.arcLength,t);let i=0;for(const s of r.segments){const n=i;if(i+=s.arcLength,i>=e){const o=(e-n)/s.arcLength;return s.getPoint(ne(0,1,o))}}return{position:k.zero,tangent:k.up,normal:k.up}}function uo(r){return(t,e)=>{ff({top:r?`${r}Top`:"top",right:r?`${r}Right`:"right",bottom:r?`${r}Bottom`:"bottom",left:r?`${r}Left`:"left"})(t,e),Wn(Ke)(t,e)}}function fy(r){let t;return r?typeof r=="string"?t=[{fragment:r}]:Array.isArray(r)?t=r.map(e=>typeof e=="string"?{fragment:e}:e):t=[r]:t=[],!Xe().experimentalFeatures&&t.length>0&&(t=[],qt().log({...Hu("Node uses experimental shaders."),inspect:this.key})),t}function Mr(){return Xe()}var tt=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n},Ir;let Y=Ir=class{get x(){return this.position.x}get y(){return this.position.y}getAbsolutePosition(){return new k(this.parentToWorld().transformPoint(this.position()))}setAbsolutePosition(t){this.position(ps(t,e=>new k(e).transformAsPoint(this.worldToParent())))}getAbsoluteRotation(){const t=this.localToWorld();return k.degrees(t.m11,t.m12)}setAbsoluteRotation(t){this.rotation(ps(t,e=>Mv(e,this.worldToParent())))}getAbsoluteScale(){const t=this.localToWorld();return new k(k.magnitude(t.m11,t.m12),k.magnitude(t.m21,t.m22))}setAbsoluteScale(t){this.scale(ps(t,e=>this.getRelativeScale(new k(e))))}getRelativeScale(t){const e=this.parent()?.absoluteScale()??k.one;return t.div(e)}*tweenCompositeOperation(t,e,i){const s=Ht(t);s==="source-over"?(yield*this.compositeOverride(1,e,i),this.compositeOverride(0),this.compositeOperation(s)):(this.compositeOperation(s),this.compositeOverride(1),yield*this.compositeOverride(0,e,i))}absoluteOpacity(){return(this.parent()?.absoluteOpacity()??1)*this.opacity()}hasFilters(){return!!this.filters().find(t=>t.isActive())}hasShadow(){return!!this.shadowColor()&&(this.shadowBlur()>0||this.shadowOffset.x()!==0||this.shadowOffset.y()!==0)}filterString(){let t="";const e=this.compositeToWorld();for(const i of this.filters())i.isActive()&&(t+=" "+i.serialize(e));return t}getSpawner(){return this.children()}setSpawner(t){this.children(t)}setChildren(t){if(this.children.context.raw()!==t){if(this.children.context.setter(t),!Oi(t))this.spawnChildren(!1,t);else if(!this.hasSpawnedChildren)for(const e of this.realChildren)e.parent(null)}}getChildren(){return this.children.context.getter(),this.spawnedChildren()}spawnedChildren(){const t=this.children.context.getter();return Oi(this.children.context.raw())&&this.spawnChildren(!0,t),this.realChildren}sortedChildren(){return[...this.children()].sort((t,e)=>Math.sign(t.zIndex()-e.zIndex()))}constructor({children:t,spawner:e,key:i,...s}){this.compositeOverride=ye(0),this.stateStack=[],this.realChildren=[],this.hasSpawnedChildren=!1,this.parent=ye(null),this.properties=cf(this);const n=Mr();[this.key,this.unregister]=n.registerNode(this,i),this.view2D=n.getView(),this.creationStack=new Error().stack,fl(this,s),e&&qt().warn({message:"Node.spawner() has been deprecated.",remarks:"Use <code>Node.children()</code> instead.",inspect:this.key,stack:new Error().stack}),this.children(e??t)}localToWorld(){const t=this.parent();return t?t.localToWorld().multiply(this.localToParent()):this.localToParent()}worldToLocal(){return this.localToWorld().inverse()}worldToParent(){return this.parent()?.worldToLocal()??new DOMMatrix}parentToWorld(){return this.parent()?.localToWorld()??new DOMMatrix}localToParent(){const t=new DOMMatrix;return t.translateSelf(this.x(),this.y()),t.rotateSelf(0,0,this.rotation()),t.scaleSelf(this.scale.x(),this.scale.y()),t.skewXSelf(this.skew.x()),t.skewYSelf(this.skew.y()),t}compositeToWorld(){return this.compositeRoot()?.localToWorld()??new DOMMatrix}compositeRoot(){return this.composite()?this:this.parent()?.compositeRoot()??null}compositeToLocal(){const t=this.compositeRoot();if(t){const e=this.worldToLocal();return e.m44=1,t.localToWorld().multiply(e)}return new DOMMatrix}view(){return this.view2D}add(t){return this.insert(t,1/0)}insert(t,e=0){const i=Array.isArray(t)?t:[t];if(i.length===0)return this;const s=this.children(),n=s.slice(0,e);for(const o of i)o instanceof Ir&&(n.push(o),o.remove(),o.parent(this));return n.push(...s.slice(e)),this.setParsedChildren(n),this}remove(){const t=this.parent();return t===null?this:(t.removeChild(this),this.parent(null),this)}move(t=1){const e=this.parent();if(t===0||!e)return this;const i=e.children(),s=[];if(t>0)for(let n=0;n<i.length;n++){const o=i[n];if(o===this){const a=n+t;for(;n<a&&n+1<i.length;n++)s[n]=i[n+1]}s[n]=o}else for(let n=i.length-1;n>=0;n--){const o=i[n];if(o===this){const a=n+t;for(;n>a&&n>0;n--)s[n]=i[n-1]}s[n]=o}return e.setParsedChildren(s),this}moveUp(){return this.move(1)}moveDown(){return this.move(-1)}moveToTop(){return this.move(1/0)}moveToBottom(){return this.move(-1/0)}moveTo(t){const e=this.parent();if(!e)return this;const i=e.children().indexOf(this),s=t-i;return this.move(s)}moveBelow(t,e=!1){const i=this.parent();if(!i)return this;if(t.parent()!==i)return qt().error("Cannot position nodes relative to each other if they don't belong to the same parent."),this;const s=i.children(),n=s.indexOf(this),o=s.indexOf(t);if(!e&&n<o)return this;const a=o-n-1;return this.move(a)}moveAbove(t,e=!1){const i=this.parent();if(!i)return this;if(t.parent()!==i)return qt().error("Cannot position nodes relative to each other if they don't belong to the same parent."),this;const s=i.children(),n=s.indexOf(this),o=s.indexOf(t);if(!e&&n>o)return this;const a=o-n+1;return this.move(a)}reparent(t){const e=this.absolutePosition(),i=this.absoluteRotation(),s=this.absoluteScale();return t.add(this),this.absolutePosition(e),this.absoluteRotation(i),this.absoluteScale(s),this}removeChildren(){for(const t of this.realChildren)t.parent(null);return this.setParsedChildren([]),this}peekChildren(){return this.realChildren}findAll(t){const e=[],i=this.reversedChildren();for(;i.length>0;){const s=i.pop();t(s)&&e.push(s);const n=s.children();for(let o=n.length-1;o>=0;o--)i.push(n[o])}return e}findFirst(t){const e=this.reversedChildren();for(;e.length>0;){const i=e.pop();if(t(i))return i;const s=i.children();for(let n=s.length-1;n>=0;n--)e.push(s[n])}return null}findLast(t){const e=[],i=this.reversedChildren();for(;i.length>0;){const s=i.pop();e.push(s);const n=s.children();for(let o=n.length-1;o>=0;o--)i.push(n[o])}for(;e.length>0;){const s=e.pop();if(t(s))return s}return null}findAncestor(t){let e=this.parent();for(;e;){if(t(e))return e;e=e.parent()}return null}childAs(t){return this.children()[t]??null}childrenAs(){return this.children()}parentAs(){return this.parent()??null}dispose(){if(this.unregister){this.stateStack=[],this.unregister(),this.unregister=null;for(const{signal:t}of this)t?.context.dispose();for(const t of this.realChildren)t.dispose()}}clone(t={}){const e={...t};Oi(this.children.context.raw())?e.children??(e.children=this.children.context.raw()):this.children().length>0&&(e.children??(e.children=this.children().map(i=>i.clone())));for(const{key:i,meta:s,signal:n}of this)if(!(!s.cloneable||i in e))if(s.compound)for(const[o,a]of s.compoundEntries){if(a in e)continue;const l=n[o];l.context.isInitial()||(e[a]=l.context.raw())}else n.context.isInitial()||(e[i]=n.context.raw());return this.instantiate(e)}snapshotClone(t={}){const e={...this.getState(),...t};return this.children().length>0&&(e.children??(e.children=this.children().map(i=>i.snapshotClone()))),this.instantiate(e)}reactiveClone(t={}){const e={...t};this.children().length>0&&(e.children??(e.children=this.children().map(i=>i.reactiveClone())));for(const{key:i,meta:s,signal:n}of this)!s.cloneable||i in e||(e[i]=()=>n());return this.instantiate(e)}instantiate(t={}){return new this.constructor(t)}setParsedChildren(t){this.children.context.setter(t),this.realChildren=t}spawnChildren(t,e){const i=this.parseChildren(e),s=new Set;for(const n of i){const o=n.parent.context.raw();o&&o!==this&&o.removeChild(n),s.add(n.key),n.parent(this)}for(const n of this.realChildren)s.has(n.key)||n.parent(null);this.hasSpawnedChildren=t,this.realChildren=i}parseChildren(t){const e=[],i=Array.isArray(t)?t:[t];for(const s of i)s instanceof Ir&&e.push(s);return e}removeChild(t){this.setParsedChildren(this.children().filter(e=>e!==t))}requiresCache(){return this.cache()||this.opacity()<1||this.compositeOperation()!=="source-over"||this.hasFilters()||this.hasShadow()||this.shaders().length>0}cacheCanvas(){const t=document.createElement("canvas").getContext("2d");if(!t)throw new Error("Could not create a cache canvas");return t}cachedCanvas(){const t=this.cacheCanvas(),e=this.worldSpaceCacheBBox(),i=this.localToWorld();return t.canvas.width=e.width,t.canvas.height=e.height,t.setTransform(i.a,i.b,i.c,i.d,i.e-e.x,i.f-e.y),this.draw(t),t}getCacheBBox(){return new ct}cacheBBox(){const t=this.getCacheBBox(),e=this.children(),i=this.cachePadding();if(e.length===0)return t.addSpacing(i);const s=t.corners;for(const o of e){const a=o.fullCacheBBox(),l=o.localToParent();s.push(...a.corners.map(h=>h.transformAsPoint(l)))}return ct.fromPoints(...s).addSpacing(i)}fullCacheBBox(){const t=this.compositeToLocal(),e=this.shadowOffset().transform(t),i=ga(this.shadowBlur(),t),s=this.cacheBBox().expand(this.filters.blur()*2+i);return e.x<0?(s.x+=e.x,s.width-=e.x):s.width+=e.x,e.y<0?(s.y+=e.y,s.height-=e.y):s.height+=e.y,s}worldSpaceCacheBBox(){const t=ct.fromSizeCentered(this.view().size()).expand(this.view().cachePadding()),e=ct.fromPoints(...t.transformCorners(this.view().localToWorld())),i=ct.fromPoints(...this.cacheBBox().transformCorners(this.localToWorld()));return e.intersection(i).pixelPerfect.expand(2)}parentWorldSpaceCacheBBox(){return this.findAncestor(t=>t.requiresCache())?.worldSpaceCacheBBox()??new ct(k.zero,Mr().getRealSize())}setupDrawFromCache(t){if(t.globalCompositeOperation=this.compositeOperation(),t.globalAlpha*=this.opacity(),this.hasFilters()&&(t.filter=this.filterString()),this.hasShadow()){const i=this.compositeToWorld(),s=this.shadowOffset().transform(i),n=ga(this.shadowBlur(),i);t.shadowColor=this.shadowColor().serialize(),t.shadowBlur=n,t.shadowOffsetX=s.x,t.shadowOffsetY=s.y}const e=this.worldToLocal();t.transform(e.a,e.b,e.c,e.d,e.e,e.f)}renderFromSource(t,e,i,s){this.setupDrawFromCache(t);const n=this.compositeOverride();t.drawImage(e,i,s),n>0&&(t.save(),t.globalAlpha*=n,t.globalCompositeOperation="source-over",t.drawImage(e,i,s),t.restore())}shaderCanvas(t,e){const i=this.shaders();if(i.length===0)return null;const s=Mr(),n=s.getRealSize(),o=this.parentWorldSpaceCacheBBox(),a=new DOMMatrix().scaleSelf(n.width/o.width,n.height/-o.height).translateSelf(o.x/-n.width,o.y/n.height-1),l=this.worldSpaceCacheBBox(),h=new DOMMatrix().scaleSelf(n.width/l.width,n.height/-l.height).translateSelf(l.x/-n.width,l.y/n.height-1).invertSelf(),c=s.shaders.getGL();s.shaders.copyTextures(t,e),s.shaders.clear();for(const f of i){const p=s.shaders.getProgram(f.fragment);if(p){if(f.uniforms)for(const[m,y]of Object.entries(f.uniforms)){const b=c.getUniformLocation(p,m);if(b===null)continue;const S=Ht(y);typeof S=="number"?c.uniform1f(b,S):"toUniform"in S?S.toUniform(c,b):S.length===1?c.uniform1f(b,S[0]):S.length===2?c.uniform2f(b,S[0],S[1]):S.length===3?c.uniform3f(b,S[0],S[1],S[2]):S.length===4&&c.uniform4f(b,S[0],S[1],S[2],S[3])}c.uniform1f(c.getUniformLocation(p,wc),this.view2D.globalTime()),c.uniform1i(c.getUniformLocation(p,wc),s.playback.frame),c.uniformMatrix4fv(c.getUniformLocation(p,fv),!1,h.toFloat32Array()),c.uniformMatrix4fv(c.getUniformLocation(p,dv),!1,a.toFloat32Array()),f.setup?.(c,p),s.shaders.render(),f.teardown?.(c,p)}}return c.canvas}render(t){if(!(this.absoluteOpacity()<=0)){if(t.save(),this.transformContext(t),this.requiresCache()){const e=this.worldSpaceCacheBBox();if(e.width!==0&&e.height!==0){const i=this.cachedCanvas().canvas,s=this.shaderCanvas(t.canvas,i);s?this.renderFromSource(t,s,0,0):this.renderFromSource(t,i,e.position.x,e.position.y)}}else this.draw(t);t.restore()}}draw(t){this.drawChildren(t)}drawChildren(t){for(const e of this.sortedChildren())e.render(t)}drawOverlay(t,e){const i=this.cacheBBox().transformCorners(e),s=this.getCacheBBox().transformCorners(e);t.strokeStyle="white",t.lineWidth=1,t.beginPath(),zi(t,i),t.closePath(),t.stroke(),t.strokeStyle="blue",t.beginPath(),zi(t,s),t.closePath(),t.stroke()}transformContext(t){const e=this.localToParent();t.transform(e.a,e.b,e.c,e.d,e.e,e.f)}hit(t){let e=null;const i=t.transformAsPoint(this.localToParent().inverse()),s=this.children();for(let n=s.length-1;n>=0&&(e=s[n].hit(i),!e);n--);return e}collectAsyncResources(){for(const t of this.children())t.collectAsyncResources()}async toPromise(){do await _t.consumePromises(),this.collectAsyncResources();while(_t.hasPromises());return this}getState(){const t={};for(const{key:e,meta:i,signal:s}of this)!i.cloneable||e in t||(t[e]=s());return t}applyState(t,e,i=Ie){if(e===void 0)for(const n in t){const o=this.signalByKey(n);o&&o(t[n])}const s=[];for(const n in t){const o=this.signalByKey(n);t[n]!==o.context.raw()&&s.push(o(t[n],e,i))}return Lt(...s)}save(){this.stateStack.push(this.getState())}restore(t,e=Ie){const i=this.stateStack.pop();if(i!==void 0)return this.applyState(i,t,e)}*[Symbol.iterator](){for(const t in this.properties){const e=this.properties[t],i=this.signalByKey(t);yield{meta:e,signal:i,key:t}}}signalByKey(t){return this[t]}reversedChildren(){const t=this.children(),e=[];for(let i=t.length-1;i>=0;i--)e.push(t[i]);return e}};tt([Mi()],Y.prototype,"position",void 0);tt([Wn(k),Ss(!1),_()],Y.prototype,"absolutePosition",void 0);tt([V(0),_()],Y.prototype,"rotation",void 0);tt([Ss(!1),_()],Y.prototype,"absoluteRotation",void 0);tt([V(k.one),Mi("scale")],Y.prototype,"scale",void 0);tt([V(k.zero),Mi("skew")],Y.prototype,"skew",void 0);tt([Wn(k),Ss(!1),_()],Y.prototype,"absoluteScale",void 0);tt([V(0),_()],Y.prototype,"zIndex",void 0);tt([V(!1),_()],Y.prototype,"cache",void 0);tt([uo("cachePadding")],Y.prototype,"cachePadding",void 0);tt([V(!1),_()],Y.prototype,"composite",void 0);tt([V("source-over"),_()],Y.prototype,"compositeOperation",void 0);tt([Et()],Y.prototype,"tweenCompositeOperation",null);tt([V(1),co(r=>ne(0,1,r)),_()],Y.prototype,"opacity",void 0);tt([Q()],Y.prototype,"absoluteOpacity",null);tt([hy()],Y.prototype,"filters",void 0);tt([V("#0000"),ay()],Y.prototype,"shadowColor",void 0);tt([V(0),_()],Y.prototype,"shadowBlur",void 0);tt([Mi("shadowOffset")],Y.prototype,"shadowOffset",void 0);tt([V([]),co(fy),_()],Y.prototype,"shaders",void 0);tt([Q()],Y.prototype,"hasFilters",null);tt([Q()],Y.prototype,"hasShadow",null);tt([Q()],Y.prototype,"filterString",null);tt([uf(!1),Ss(!1),_()],Y.prototype,"spawner",void 0);tt([uf(!1),Ss(!1),_()],Y.prototype,"children",void 0);tt([Q()],Y.prototype,"spawnedChildren",null);tt([Q()],Y.prototype,"sortedChildren",null);tt([Q()],Y.prototype,"localToWorld",null);tt([Q()],Y.prototype,"worldToLocal",null);tt([Q()],Y.prototype,"worldToParent",null);tt([Q()],Y.prototype,"parentToWorld",null);tt([Q()],Y.prototype,"localToParent",null);tt([Q()],Y.prototype,"compositeToWorld",null);tt([Q()],Y.prototype,"compositeRoot",null);tt([Q()],Y.prototype,"compositeToLocal",null);tt([Q()],Y.prototype,"cacheCanvas",null);tt([Q()],Y.prototype,"cachedCanvas",null);tt([Q()],Y.prototype,"cacheBBox",null);tt([Q()],Y.prototype,"fullCacheBBox",null);tt([Q()],Y.prototype,"worldSpaceCacheBBox",null);tt([Q()],Y.prototype,"parentWorldSpaceCacheBBox",null);Y=Ir=tt([mi("Node")],Y);Y.prototype.isClass=!0;var K=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n},Er;let W=Er=class extends Y{get columnGap(){return this.gap.x}get rowGap(){return this.gap.y}getX(){return this.isLayoutRoot()?this.x.context.getter():this.computedPosition().x}setX(t){this.x.context.setter(t)}getY(){return this.isLayoutRoot()?this.y.context.getter():this.computedPosition().y}setY(t){this.y.context.setter(t)}get width(){return this.size.x}get height(){return this.size.y}getWidth(){return this.computedSize().width}setWidth(t){this.width.context.setter(t)}*tweenWidth(t,e,i,s){const n=this.desiredSize().x,o=typeof n!="number"||typeof t!="number";let a;o?a=this.size.x():a=n;let l;o?(this.size.x(t),l=this.size.x()):l=t,this.size.x(a),o&&this.lockSize(),yield*Ge(e,h=>this.size.x(s(a,l,i(h)))),this.size.x(t),o&&this.releaseSize()}getHeight(){return this.computedSize().height}setHeight(t){this.height.context.setter(t)}*tweenHeight(t,e,i,s){const n=this.desiredSize().y,o=typeof n!="number"||typeof t!="number";let a;o?a=this.size.y():a=n;let l;o?(this.size.y(t),l=this.size.y()):l=t,this.size.y(a),o&&this.lockSize(),yield*Ge(e,h=>this.size.y(s(a,l,i(h)))),this.size.y(t),o&&this.releaseSize()}desiredSize(){return{x:this.width.context.getter(),y:this.height.context.getter()}}*tweenSize(t,e,i,s){const n=this.desiredSize();let o;typeof n.x!="number"||typeof n.y!="number"?o=this.size():o=new k(n);let a;typeof t=="object"&&typeof t.x=="number"&&typeof t.y=="number"?a=new k(t):(this.size(t),a=this.size()),this.size(o),this.lockSize(),yield*Ge(e,l=>this.size(s(o,a,i(l)))),this.releaseSize(),this.size(t)}cardinalPoint(t){switch(t){case Bt.TopLeft:return this.topLeft;case Bt.TopRight:return this.topRight;case Bt.BottomLeft:return this.bottomLeft;case Bt.BottomRight:return this.bottomRight;case Bt.Top:case Qt.Top:return this.top;case Bt.Bottom:case Qt.Bottom:return this.bottom;case Bt.Left:case Qt.Left:return this.left;case Bt.Right:case Qt.Right:return this.right;default:return this.middle}}constructor(t){super(t),this.element.dataset.motionCanvasKey=this.key}lockSize(){this.sizeLockCounter(this.sizeLockCounter()+1)}releaseSize(){this.sizeLockCounter(this.sizeLockCounter()-1)}parentTransform(){return this.findAncestor(gl(Er))}anchorPosition(){const t=this.computedSize(),e=this.offset();return t.scale(.5).mul(e)}layoutEnabled(){return this.layout()??this.parentTransform()?.layoutEnabled()??!1}isLayoutRoot(){return!this.layoutEnabled()||!this.parentTransform()?.layoutEnabled()}localToParent(){const t=super.localToParent(),e=this.offset();if(!e.exactlyEquals(k.zero)){const i=this.size().mul(e).scale(-.5);t.translateSelf(i.x,i.y)}return t}scalingRotationMatrix(){const t=new DOMMatrix;t.rotateSelf(0,0,this.rotation()),t.scaleSelf(this.scale.x(),this.scale.y());const e=this.offset();if(!e.exactlyEquals(k.zero)){const i=this.size().mul(e).scale(-.5);t.translateSelf(i.x,i.y)}return t}getComputedLayout(){return new ct(this.element.getBoundingClientRect())}computedPosition(){this.requestLayoutUpdate();const t=this.getComputedLayout(),e=new k(t.x+t.width/2*this.offset.x(),t.y+t.height/2*this.offset.y()),i=this.parentTransform();if(i){const s=i.getComputedLayout();e.x-=s.x+(s.width-t.width)/2,e.y-=s.y+(s.height-t.height)/2}return e}computedSize(){return this.requestLayoutUpdate(),this.getComputedLayout().size}requestLayoutUpdate(){const t=this.parentTransform();this.appendedToView()?(t?.requestFontUpdate(),this.updateLayout()):t.requestLayoutUpdate()}appendedToView(){const t=this.isLayoutRoot();return t&&this.view().element.append(this.element),t}updateLayout(){if(this.applyFont(),this.applyFlex(),this.layoutEnabled()){const t=this.layoutChildren();for(const e of t)e.updateLayout()}}layoutChildren(){const t=[...this.children()],e=[],i=[];for(;t.length;){const s=t.shift();s instanceof Er?s.layoutEnabled()&&(e.push(s),i.push(s.element)):s&&t.unshift(...s.children())}return this.element.replaceChildren(...i),e}requestFontUpdate(){this.appendedToView(),this.parentTransform()?.requestFontUpdate(),this.applyFont()}getCacheBBox(){return ct.fromSizeCentered(this.computedSize())}draw(t){if(this.clip()){const e=this.computedSize();if(e.width===0||e.height===0)return;t.beginPath(),t.rect(e.width/-2,e.height/-2,e.width,e.height),t.closePath(),t.clip()}this.drawChildren(t)}drawOverlay(t,e){const i=this.computedSize(),s=i.mul(this.offset()).scale(.5).transformAsPoint(e),n=ct.fromSizeCentered(i),o=n.transformCorners(e),a=n.addSpacing(this.padding().scale(-1)).transformCorners(e),l=n.addSpacing(this.margin()).transformCorners(e);t.beginPath(),zi(t,l),zi(t,o),t.closePath(),t.fillStyle="rgba(255,193,125,0.6)",t.fill("evenodd"),t.beginPath(),zi(t,o),zi(t,a),t.closePath(),t.fillStyle="rgba(180,255,147,0.6)",t.fill("evenodd"),t.beginPath(),zi(t,o),t.closePath(),t.lineWidth=1,t.strokeStyle="white",t.stroke(),t.beginPath(),df(t,s),t.stroke()}getOriginDelta(t){const e=this.computedSize().scale(.5),i=this.offset().mul(e);return t===Bt.Middle?i.flipped:Av(t).mul(e).sub(i)}moveOffset(t){const e=this.computedSize().scale(.5),i=this.offset().mul(e),s=t.mul(e);this.offset(t),this.position(this.position().add(s).sub(i))}parsePixels(t){return t===null?"":`${t}px`}parseLength(t){return t===null?"":typeof t=="string"?t:`${t}px`}applyFlex(){this.element.style.position=this.isLayoutRoot()?"absolute":"relative";const t=this.desiredSize();this.element.style.width=this.parseLength(t.x),this.element.style.height=this.parseLength(t.y),this.element.style.maxWidth=this.parseLength(this.maxWidth()),this.element.style.minWidth=this.parseLength(this.minWidth()),this.element.style.maxHeight=this.parseLength(this.maxHeight()),this.element.style.minHeight=this.parseLength(this.minHeight()),this.element.style.aspectRatio=this.ratio()===null?"":this.ratio().toString(),this.element.style.marginTop=this.parsePixels(this.margin.top()),this.element.style.marginBottom=this.parsePixels(this.margin.bottom()),this.element.style.marginLeft=this.parsePixels(this.margin.left()),this.element.style.marginRight=this.parsePixels(this.margin.right()),this.element.style.paddingTop=this.parsePixels(this.padding.top()),this.element.style.paddingBottom=this.parsePixels(this.padding.bottom()),this.element.style.paddingLeft=this.parsePixels(this.padding.left()),this.element.style.paddingRight=this.parsePixels(this.padding.right()),this.element.style.flexDirection=this.direction(),this.element.style.flexBasis=this.parseLength(this.basis()),this.element.style.flexWrap=this.wrap(),this.element.style.justifyContent=this.justifyContent(),this.element.style.alignContent=this.alignContent(),this.element.style.alignItems=this.alignItems(),this.element.style.alignSelf=this.alignSelf(),this.element.style.columnGap=this.parseLength(this.gap.x()),this.element.style.rowGap=this.parseLength(this.gap.y()),this.sizeLockCounter()>0?(this.element.style.flexGrow="0",this.element.style.flexShrink="0"):(this.element.style.flexGrow=this.grow().toString(),this.element.style.flexShrink=this.shrink().toString())}applyFont(){if(this.element.style.fontFamily=this.fontFamily.isInitial()?"":this.fontFamily(),this.element.style.fontSize=this.fontSize.isInitial()?"":`${this.fontSize()}px`,this.element.style.fontStyle=this.fontStyle.isInitial()?"":this.fontStyle(),this.lineHeight.isInitial())this.element.style.lineHeight="";else{const t=this.lineHeight();this.element.style.lineHeight=typeof t=="string"?(parseFloat(t)/100).toString():`${t}px`}if(this.element.style.fontWeight=this.fontWeight.isInitial()?"":this.fontWeight().toString(),this.element.style.letterSpacing=this.letterSpacing.isInitial()?"":`${this.letterSpacing()}px`,this.element.style.textAlign=this.textAlign.isInitial()?"":this.textAlign(),this.textWrap.isInitial())this.element.style.whiteSpace="";else{const t=this.textWrap();typeof t=="boolean"?this.element.style.whiteSpace=t?"normal":"nowrap":this.element.style.whiteSpace=t}}dispose(){super.dispose(),this.sizeLockCounter?.context.dispose(),this.element&&(this.element.remove(),this.element.innerHTML=""),this.element=null,this.styles=null}hit(t){const e=t.transformAsPoint(this.localToParent().inverse());return this.cacheBBox().includes(e)?super.hit(t)??this:null}};K([V(null),dl(xv),_()],W.prototype,"layout",void 0);K([V(null),_()],W.prototype,"maxWidth",void 0);K([V(null),_()],W.prototype,"maxHeight",void 0);K([V(null),_()],W.prototype,"minWidth",void 0);K([V(null),_()],W.prototype,"minHeight",void 0);K([V(null),_()],W.prototype,"ratio",void 0);K([uo("margin")],W.prototype,"margin",void 0);K([uo("padding")],W.prototype,"padding",void 0);K([V("row"),_()],W.prototype,"direction",void 0);K([V(null),_()],W.prototype,"basis",void 0);K([V(0),_()],W.prototype,"grow",void 0);K([V(1),_()],W.prototype,"shrink",void 0);K([V("nowrap"),_()],W.prototype,"wrap",void 0);K([V("start"),_()],W.prototype,"justifyContent",void 0);K([V("normal"),_()],W.prototype,"alignContent",void 0);K([V("stretch"),_()],W.prototype,"alignItems",void 0);K([V("auto"),_()],W.prototype,"alignSelf",void 0);K([V(0),Mi({x:"columnGap",y:"rowGap"})],W.prototype,"gap",void 0);K([ts("font-family"),_()],W.prototype,"fontFamily",void 0);K([ts("font-size",parseFloat),_()],W.prototype,"fontSize",void 0);K([ts("font-style"),_()],W.prototype,"fontStyle",void 0);K([ts("font-weight",parseInt),_()],W.prototype,"fontWeight",void 0);K([ts("line-height",parseFloat),_()],W.prototype,"lineHeight",void 0);K([ts("letter-spacing",r=>r==="normal"?0:parseFloat(r)),_()],W.prototype,"letterSpacing",void 0);K([ts("white-space",r=>r==="pre"?"pre":r==="normal"),_()],W.prototype,"textWrap",void 0);K([V("inherit"),_()],W.prototype,"textDirection",void 0);K([ts("text-align"),_()],W.prototype,"textAlign",void 0);K([V({x:null,y:null}),Mi({x:"width",y:"height"})],W.prototype,"size",void 0);K([Et()],W.prototype,"tweenWidth",null);K([Et()],W.prototype,"tweenHeight",null);K([Q()],W.prototype,"desiredSize",null);K([Et()],W.prototype,"tweenSize",null);K([Mi("offset")],W.prototype,"offset",void 0);K([Ii(Bt.Middle)],W.prototype,"middle",void 0);K([Ii(Bt.Top)],W.prototype,"top",void 0);K([Ii(Bt.Bottom)],W.prototype,"bottom",void 0);K([Ii(Bt.Left)],W.prototype,"left",void 0);K([Ii(Bt.Right)],W.prototype,"right",void 0);K([Ii(Bt.TopLeft)],W.prototype,"topLeft",void 0);K([Ii(Bt.TopRight)],W.prototype,"topRight",void 0);K([Ii(Bt.BottomLeft)],W.prototype,"bottomLeft",void 0);K([Ii(Bt.BottomRight)],W.prototype,"bottomRight",void 0);K([V(!1),_()],W.prototype,"clip",void 0);K([V(0),_()],W.prototype,"sizeLockCounter",void 0);K([Q()],W.prototype,"parentTransform",null);K([Q()],W.prototype,"anchorPosition",null);K([Q()],W.prototype,"layoutEnabled",null);K([Q()],W.prototype,"isLayoutRoot",null);K([Q()],W.prototype,"scalingRotationMatrix",null);K([Q()],W.prototype,"computedPosition",null);K([Q()],W.prototype,"computedSize",null);K([Q()],W.prototype,"requestLayoutUpdate",null);K([Q()],W.prototype,"appendedToView",null);K([Q()],W.prototype,"updateLayout",null);K([Q()],W.prototype,"layoutChildren",null);K([Q()],W.prototype,"requestFontUpdate",null);K([Q()],W.prototype,"applyFlex",null);K([Q()],W.prototype,"applyFont",null);W=Er=K([mi("Layout")],W);function Ii(r){return(t,e)=>{_()(t,e),Ss(!1)(t,e);const i=xs(t,e);i.parser=s=>new k(s),i.getter=function(){return this.computedSize().getOriginOffset(r).transformAsPoint(this.localToParent())},i.setter=function(s){return this.position(ps(s,n=>this.getOriginDelta(r).transform(this.scalingRotationMatrix()).flipped.add(n))),this}}}nn(W.prototype,r=>{r.element=document.createElement("div"),r.element.style.display="flex",r.element.style.boxSizing="border-box",r.styles=getComputedStyle(r.element)});var Ae=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};let Zt=class extends W{rippleSize(){return sf(this.rippleStrength(),0,50)}constructor(t){super(t),this.rippleStrength=ye(0)}applyText(t){t.direction=this.textDirection(),this.element.dir=this.textDirection()}applyStyle(t){t.fillStyle=wa(this.fill(),t),t.strokeStyle=wa(this.stroke(),t),t.lineWidth=this.lineWidth(),t.lineJoin=this.lineJoin(),t.lineCap=this.lineCap(),t.setLineDash(this.lineDash()),t.lineDashOffset=this.lineDashOffset(),this.antialiased()||(t.filter="url(data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxmaWx0ZXIgaWQ9ImZpbHRlciIgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCUiIGhlaWdodD0iMTAwJSIgY29sb3ItaW50ZXJwb2xhdGlvbi1maWx0ZXJzPSJzUkdCIj48ZmVDb21wb25lbnRUcmFuc2Zlcj48ZmVGdW5jUiB0eXBlPSJpZGVudGl0eSIvPjxmZUZ1bmNHIHR5cGU9ImlkZW50aXR5Ii8+PGZlRnVuY0IgdHlwZT0iaWRlbnRpdHkiLz48ZmVGdW5jQSB0eXBlPSJkaXNjcmV0ZSIgdGFibGVWYWx1ZXM9IjAgMSIvPjwvZmVDb21wb25lbnRUcmFuc2Zlcj48L2ZpbHRlcj48L3N2Zz4=#filter)")}draw(t){this.drawShape(t),this.clip()&&t.clip(this.getPath()),this.drawChildren(t)}drawShape(t){const e=this.getPath(),i=this.lineWidth()>0&&this.stroke()!==null,s=this.fill()!==null;t.save(),this.applyStyle(t),this.drawRipple(t),this.strokeFirst()?(i&&t.stroke(e),s&&t.fill(e)):(s&&t.fill(e),i&&t.stroke(e)),t.restore()}getCacheBBox(){return super.getCacheBBox().expand(this.lineWidth()/2)}getPath(){return new Path2D}getRipplePath(){return new Path2D}drawRipple(t){const e=this.rippleStrength();if(e>0){const i=this.getRipplePath();t.save(),t.globalAlpha*=ot(.54,0,e),t.fill(i),t.restore()}}*ripple(t=1){this.rippleStrength(0),yield*this.rippleStrength(1,t,ll),this.rippleStrength(0)}};Ae([gf()],Zt.prototype,"fill",void 0);Ae([gf()],Zt.prototype,"stroke",void 0);Ae([V(!1),_()],Zt.prototype,"strokeFirst",void 0);Ae([V(0),_()],Zt.prototype,"lineWidth",void 0);Ae([V("miter"),_()],Zt.prototype,"lineJoin",void 0);Ae([V("butt"),_()],Zt.prototype,"lineCap",void 0);Ae([V([]),_()],Zt.prototype,"lineDash",void 0);Ae([V(0),_()],Zt.prototype,"lineDashOffset",void 0);Ae([V(!0),_()],Zt.prototype,"antialiased",void 0);Ae([Q()],Zt.prototype,"rippleSize",null);Ae([Q()],Zt.prototype,"getPath",null);Ae([Et()],Zt.prototype,"ripple",null);Zt=Ae([mi("Shape")],Zt);var Je=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};let we=class extends Zt{desiredSize(){return this.childrenBBox().size}constructor(t){super(t),this.canHaveSubpath=!1}percentageToDistance(t){return ne(0,this.baseArcLength(),this.startOffset()+this.offsetArcLength()*t)}distanceToPercentage(t){return(t-this.startOffset())/this.offsetArcLength()}baseArcLength(){return this.profile().arcLength}offsetArcLength(){const t=this.startOffset(),e=this.endOffset(),i=this.baseArcLength();return ne(0,i,i-t-e)}arcLength(){return this.offsetArcLength()*Math.abs(this.start()-this.end())}completion(){return Math.abs(this.start()-this.end())}processSubpath(t,e,i){}curveDrawingInfo(){const t=new Path2D;let e=new Path2D;const i=this.profile();let s=this.percentageToDistance(this.start()),n=this.percentageToDistance(this.end());s>n&&([s,n]=[n,s]);const o=n-s,a=Math.min(o/2,this.arrowSize());this.startArrow()&&(s+=a/2),this.endArrow()&&(n-=a/2);let l=0,h=null,c=null,f=null,p=null;for(const m of i.segments){const y=l;if(l+=m.arcLength,l<s)continue;const b=(s-y)/m.arcLength,S=(n-y)/m.arcLength,T=ne(0,1,b),L=ne(0,1,S);this.canHaveSubpath&&f&&!m.getPoint(0).position.equals(f)&&(t.addPath(e),this.processSubpath(e,h,f),e=new Path2D,h=null);const[B,N]=m.draw(e,T,L,h===null);if(h===null&&(h=B.position,c=B.normal.flipped.perpendicular),f=N.position,p=N.normal.flipped.perpendicular,l>n)break}return this.closed()&&this.start.isInitial()&&this.end.isInitial()&&this.startOffset.isInitial()&&this.endOffset.isInitial()&&e.closePath(),this.processSubpath(e,h,f),t.addPath(e),{startPoint:h??k.zero,startTangent:c??k.right,endPoint:f??k.zero,endTangent:p??k.right,arrowSize:a,path:t,startOffset:s}}getPointAtDistance(t){return Ic(this.profile(),t+this.startOffset())}getPointAtPercentage(t){return Ic(this.profile(),this.percentageToDistance(t))}getComputedLayout(){return this.offsetComputedLayout(super.getComputedLayout())}offsetComputedLayout(t){return t.position=t.position.sub(this.childrenBBox().center),t}getPath(){return this.curveDrawingInfo().path}getCacheBBox(){const t=this.childrenBBox(),e=this.startArrow()||this.endArrow()?this.arrowSize():0,i=this.lineWidth(),s=this.lineWidthCoefficient();return t.expand(Math.max(0,e,i*s))}lineWidthCoefficient(){return this.lineCap()==="square"?.5*1.4143:.5}requiresProfile(){return!this.start.isInitial()||!this.startOffset.isInitial()||!this.startArrow.isInitial()||!this.end.isInitial()||!this.endOffset.isInitial()||!this.endArrow.isInitial()}drawShape(t){super.drawShape(t),(this.startArrow()||this.endArrow())&&this.drawArrows(t)}drawArrows(t){const{startPoint:e,startTangent:i,endPoint:s,endTangent:n,arrowSize:o}=this.curveDrawingInfo();o<.001||(t.save(),t.beginPath(),this.endArrow()&&this.drawArrow(t,s,n.flipped,o),this.startArrow()&&this.drawArrow(t,e,i,o),t.fillStyle=wa(this.stroke(),t),t.closePath(),t.fill(),t.restore())}drawArrow(t,e,i,s){const n=i.perpendicular,o=e.add(i.scale(-s/2));Hn(t,o),hi(t,o.add(i.add(n).scale(s))),hi(t,o.add(i.sub(n).scale(s))),hi(t,o),t.closePath()}};Je([V(!1),_()],we.prototype,"closed",void 0);Je([V(0),_()],we.prototype,"start",void 0);Je([V(0),_()],we.prototype,"startOffset",void 0);Je([V(!1),_()],we.prototype,"startArrow",void 0);Je([V(1),_()],we.prototype,"end",void 0);Je([V(0),_()],we.prototype,"endOffset",void 0);Je([V(!1),_()],we.prototype,"endArrow",void 0);Je([V(24),_()],we.prototype,"arrowSize",void 0);Je([Q()],we.prototype,"arcLength",null);Je([Q()],we.prototype,"curveDrawingInfo",null);we=Je([mi("Curve")],we);class ml{}class mf extends ml{constructor(t,e,i,s,n){super(),this.center=t,this.radius=e,this.from=i,this.to=s,this.counter=n,this.angle=Math.acos(ne(-1,1,i.dot(s))),this.length=Math.abs(this.angle*e);const o=new k(1,1).scale(e);this.points=[t.sub(o),t.add(o)]}get arcLength(){return this.length}draw(t,e,i){const s=this.counter?-1:1,n=this.from.radians+e*this.angle*s,o=this.to.radians-(1-i)*this.angle*s;Math.abs(this.angle)>1e-4&&t.arc(this.center.x,this.center.y,this.radius,n,o,this.counter);const a=k.fromRadians(n),l=k.fromRadians(o);return[{position:this.center.add(a.scale(this.radius)),tangent:this.counter?a:a.flipped,normal:this.counter?a.flipped:a},{position:this.center.add(l.scale(this.radius)),tangent:this.counter?l.flipped:l,normal:this.counter?l.flipped:l}]}getPoint(t){const e=this.counter?-1:1,i=this.from.radians+t*this.angle*e,s=k.fromRadians(i);return{position:this.center.add(s.scale(this.radius)),tangent:this.counter?s:s.flipped,normal:this.counter?s:s.flipped}}}class fe{static constant(t){return new fe(t)}static linear(t,e){return new fe(t,e)}static quadratic(t,e,i){return new fe(t,e,i)}static cubic(t,e,i,s){return new fe(t,e,i,s)}get degree(){return this.c3!==0?3:this.c2!==0?2:this.c1!==0?1:0}constructor(t,e,i,s){this.c0=t,this.c1=e??0,this.c2=i??0,this.c3=s??0}differentiate(t=1){switch(t){case 0:return this;case 1:return new fe(this.c1,2*this.c2,3*this.c3,0);case 2:return new fe(2*this.c2,6*this.c3,0,0);case 3:return new fe(6*this.c3,0,0,0);default:throw new Error("Unsupported derivative")}}eval(t,e=0){return e!==0?this.differentiate(e).eval(t):this.c3*(t*t*t)+this.c2*(t*t)+this.c1*t+this.c0}split(t){const e=1-t,i=new fe(this.c0,this.c1*t,this.c2*t*t,this.c3*t*t*t),s=new fe(this.eval(0),e*this.differentiate(1).eval(t),e*e/2*this.differentiate(2).eval(t),e*e*e/6*this.differentiate(3).eval(t));return[i,s]}roots(){switch(this.degree){case 3:return this.solveCubicRoots();case 2:return this.solveQuadraticRoots();case 1:return this.solveLinearRoot();case 0:return[];default:throw new Error(`Unsupported polynomial degree: ${this.degree}`)}}localExtrema(){return this.differentiate().roots()}localExtrema01(){const t=this.localExtrema(),e=[];for(let i=0;i<t.length;i++){const s=t[i];s>=0&&s<=1&&e.push(t[i])}return e}outputRange01(){let t=[this.eval(0),this.eval(1)];const e=i=>{t[1]>t[0]?t=[Math.min(t[0],i),Math.max(t[1],i)]:t=[Math.min(t[1],i),Math.max(t[0],i)]};return this.localExtrema01().forEach(i=>e(this.eval(i))),t}solveCubicRoots(){const t=this.c0,e=this.c1,i=this.c2,s=this.c3,n=t*t,o=t*i,a=e*e,l=(3*o-a)/(3*n),h=(2*a*e-9*o*e+27*n*s)/(27*n*t),c=this.solveDepressedCubicRoots(l,h),f=p=>p-e/(3*t);switch(c.length){case 1:return[f(c[0])];case 2:return[f(c[0]),f(c[1])];case 3:return[f(c[0]),f(c[1]),f(c[2])];default:return[]}}solveDepressedCubicRoots(t,e){if(this.almostZero(t))return[Math.cbrt(-e)];const i=Math.PI*2,s=4*t*t*t+27*e*e;if(s<1e-5){const n=2*Math.sqrt(-t/3),o=3*e/(2*t)*Math.sqrt(-3/t),a=l=>n*Math.cos(1/3*Math.acos(ne(-1,1,o))-i/3*l);return o>=.9999?[a(0),a(2)]:o<=-.9999?[a(1),a(2)]:[a(0),a(1),a(2)]}if(s>0&&t<0){const n=.3333333333333333*Math.acosh(-3*Math.abs(e)/(2*t)*Math.sqrt(-3/t));return[-2*Math.sign(e)*Math.sqrt(-t/3)*Math.cosh(n)]}if(t>0){const n=.3333333333333333*Math.asinh(3*e/(2*t)*Math.sqrt(3/t));return[-2*Math.sqrt(t/3)*Math.sinh(n)]}return[]}solveQuadraticRoots(){const t=this.c2,e=this.c1,i=this.c0,s=e*e-4*t*i;if(this.almostZero(s))return[-e/(2*t)];if(s>=0){const n=Math.sqrt(s),o=(-e-n)/(2*t),a=(-e+n)/(2*t);return[Math.min(o,a),Math.max(o,a)]}return[]}solveLinearRoot(){return[-this.c0/this.c1]}almostZero(t){return Math.abs(0-t)<=Number.EPSILON}}class xn{constructor(t,e,i,s){this.c0=t,this.c1=e,this.c2=i,this.c3=s,t instanceof fe?(this.x=t,this.y=e):s!==void 0?(this.x=new fe(t.x,e.x,i.x,s.x),this.y=new fe(t.y,e.y,i.y,s.y)):(this.x=new fe(t.x,e.x,i.x),this.y=new fe(t.y,e.y,i.y))}eval(t,e=0){return new k(this.x.differentiate(e).eval(t),this.y.differentiate(e).eval(t))}split(t){const[e,i]=this.x.split(t),[s,n]=this.y.split(t);return[new xn(e,s),new xn(i,n)]}differentiate(t=1){return new xn(this.x.differentiate(t),this.y.differentiate(t))}evalDerivative(t){return this.differentiate().eval(t)}getBounds(){const t=this.x.outputRange01(),e=this.y.outputRange01();return ct.fromPoints(new k(Math.min(...t),Math.max(...e)),new k(Math.max(...t),Math.min(...e)))}}class dy{constructor(t,e=20){this.curve=t,this.sampledDistances=[],this.resample(e)}resample(t){this.sampledDistances=[0];let e=0,i=this.curve.eval(0).position;for(let s=1;s<t;s++){const n=s/(t-1),o=this.curve.eval(n),a=i.sub(o.position).magnitude;e+=a,this.sampledDistances.push(e),i=o.position}this.sampledDistances[this.sampledDistances.length-1]=this.curve.arcLength}pointAtDistance(t){return this.curve.eval(this.distanceToT(t))}distanceToT(t){const e=this.sampledDistances.length;t=ne(0,this.curve.arcLength,t);for(let i=0;i<e;i++){const s=this.sampledDistances[i],n=this.sampledDistances[i+1];if(t>=s&&t<=n)return tf(s,n,i/(e-1),(i+1)/(e-1),t)}return 1}}class py extends ml{get arcLength(){return this.length}constructor(t,e){super(),this.curve=t,this.length=e,this.pointSampler=new dy(this)}getBBox(){return this.curve.getBounds()}eval(t){const e=this.tangent(t);return{position:this.curve.eval(t),tangent:e,normal:e.perpendicular}}getPoint(t){const e=this.pointSampler.pointAtDistance(this.arcLength*t);return{position:e.position,tangent:e.tangent,normal:e.tangent.perpendicular}}transformPoints(t){return this.points.map(e=>e.transformAsPoint(t))}tangent(t){return this.curve.evalDerivative(t).normalized}draw(t,e=0,i=1,s=!0){let n=null,o=e,a=i,l=this.points;if(e!==0||i!==1){const f=this.length*e,p=this.length*i;o=this.pointSampler.distanceToT(f),a=this.pointSampler.distanceToT(p);const m=(a-o)/(1-o),[,y]=this.split(o);[n]=y.split(m),l=n.points}s&&Hn(t,l[0]),(n??this).doDraw(t);const h=this.tangent(o),c=this.tangent(a);return[{position:l[0],tangent:h,normal:h.perpendicular},{position:l.at(-1),tangent:c,normal:c.perpendicular}]}}var gy=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};class Ui extends py{get points(){return[this.p0,this.p1,this.p2,this.p3]}constructor(t,e,i,s){super(new xn(t,t.flipped.add(e).scale(3),t.scale(3).sub(e.scale(6)).add(i.scale(3)),t.flipped.add(e.scale(3)).sub(i.scale(3)).add(s)),Ui.getLength(t,e,i,s)),this.p0=t,this.p1=e,this.p2=i,this.p3=s}split(t){const e=new k(this.p0.x+(this.p1.x-this.p0.x)*t,this.p0.y+(this.p1.y-this.p0.y)*t),i=new k(this.p1.x+(this.p2.x-this.p1.x)*t,this.p1.y+(this.p2.y-this.p1.y)*t),s=new k(this.p2.x+(this.p3.x-this.p2.x)*t,this.p2.y+(this.p3.y-this.p2.y)*t),n=new k(e.x+(i.x-e.x)*t,e.y+(i.y-e.y)*t),o=new k(i.x+(s.x-i.x)*t,i.y+(s.y-i.y)*t),a=new k(n.x+(o.x-n.x)*t,n.y+(o.y-n.y)*t),l=new Ui(this.p0,e,n,a),h=new Ui(a,o,s,this.p3);return[l,h]}doDraw(t){oy(t,this.p1,this.p2,this.p3)}static getLength(t,e,i,s){return Ui.el.setAttribute("d",`M ${t.x} ${t.y} C ${e.x} ${e.y} ${i.x} ${i.y} ${s.x} ${s.y}`),Ui.el.getTotalLength()}}gy([ro(()=>document.createElementNS("http://www.w3.org/2000/svg","path"))],Ui,"el",void 0);class $s extends ml{constructor(t,e){super(),this.from=t,this.to=e,this.vector=e.sub(t),this.length=this.vector.magnitude,this.normal=this.vector.perpendicular.normalized.safe,this.points=[t,e]}get arcLength(){return this.length}draw(t,e=0,i=1,s=!1){const n=this.from.add(this.vector.scale(e)),o=this.from.add(this.vector.scale(i));return s&&Hn(t,n),hi(t,o),[{position:n,tangent:this.normal.flipped,normal:this.normal},{position:o,tangent:this.normal,normal:this.normal}]}getPoint(t){return{position:this.from.add(this.vector.scale(t)),tangent:this.normal.flipped,normal:this.normal}}}function my(r,t,e,i){const s={arcLength:0,segments:[],minSin:1},n=ji(t.top,t.right,t.left,r),o=ji(t.right,t.top,t.bottom,r),a=ji(t.bottom,t.left,t.right,r),l=ji(t.left,t.bottom,t.top,r);let h=new k(r.left+n,r.top),c=new k(r.right-o,r.top);return Fs(s,new $s(h,c)),h=new k(r.right,r.top+o),c=new k(r.right,r.bottom-a),o>0&&ur(s,h.addX(-o),o,k.down,k.right,e,i),Fs(s,new $s(h,c)),h=new k(r.right-a,r.bottom),c=new k(r.left+l,r.bottom),a>0&&ur(s,h.addY(-a),a,k.right,k.up,e,i),Fs(s,new $s(h,c)),h=new k(r.left,r.bottom-l),c=new k(r.left,r.top+n),l>0&&ur(s,h.addX(l),l,k.up,k.left,e,i),Fs(s,new $s(h,c)),h=new k(r.left+n,r.top),n>0&&ur(s,h.addY(n),n,k.left,k.down,e,i),s}function Fs(r,t){r.segments.push(t),r.arcLength+=t.arcLength}function ur(r,t,e,i,s,n,o){const a=t.add(i.scale(e)),l=t.add(s.scale(e));n?Fs(r,new Ui(a,a.add(s.scale(o*e)),l.add(i.scale(o*e)),l)):Fs(r,new mf(t,e,i,s,!1))}var Vn=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};let be=class extends we{constructor(t){super(t)}profile(){return my(this.childrenBBox(),this.radius(),this.smoothCorners(),this.cornerSharpness())}desiredSize(){return{x:this.width.context.getter(),y:this.height.context.getter()}}offsetComputedLayout(t){return t}childrenBBox(){return ct.fromSizeCentered(this.computedSize())}getPath(){if(this.requiresProfile())return this.curveDrawingInfo().path;const t=new Path2D,e=this.radius(),i=this.smoothCorners(),s=this.cornerSharpness(),n=ct.fromSizeCentered(this.size());return Mc(t,n,e,i,s),t}getCacheBBox(){return super.getCacheBBox().expand(this.rippleSize())}getRipplePath(){const t=new Path2D,e=this.rippleSize(),i=this.radius().addScalar(e),s=this.smoothCorners(),n=this.cornerSharpness(),o=ct.fromSizeCentered(this.size()).expand(e);return Mc(t,o,i,s,n),t}};Vn([uo("radius")],be.prototype,"radius",void 0);Vn([V(!1),_()],be.prototype,"smoothCorners",void 0);Vn([V(.6),_()],be.prototype,"cornerSharpness",void 0);Vn([Q()],be.prototype,"profile",null);be=Vn([mi("Rect")],be);var es=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n};class ti extends Y{constructor({children:t,...e}){super(e),this.scene()||this.scene(new Y({})),t&&this.scene().add(t)}getZoom(){return 1/this.scale.x()}setZoom(t){this.scale(ps(t,e=>1/e))}getDefaultZoom(){return this.scale.x.context.getInitial()}*tweenZoom(t,e,i,s){const n=this.scale.x();yield*Ge(e,o=>{this.zoom(1/s(n,1/Ht(t),i(o)))})}*reset(t,e=Ie){yield*Lt(this.position(Be,t,e),this.zoom(Be,t,e),this.rotation(Be,t,e))}*centerOn(t,e,i=Ie,s=k.lerp){const n=t instanceof Y?t.absolutePosition().transformAsPoint(this.scene().worldToLocal()):t;yield*this.position(n,e,i,s)}*followCurve(t,e,i=Ie){yield*Ge(e,s=>{const n=i(s),o=t.getPointAtPercentage(n).position.transformAsPoint(t.localToWorld());this.position(o)})}*followCurveReverse(t,e,i=Ie){yield*Ge(e,s=>{const n=1-i(s),o=t.getPointAtPercentage(n).position.transformAsPoint(t.localToWorld());this.position(o)})}*followCurveWithRotation(t,e,i=Ie){yield*Ge(e,s=>{const n=i(s),{position:o,normal:a}=t.getPointAtPercentage(n),l=o.transformAsPoint(t.localToWorld()),h=a.flipped.perpendicular.degrees;this.position(l),this.rotation(h)})}*followCurveWithRotationReverse(t,e,i=Ie){yield*Ge(e,s=>{const n=1-i(s),{position:o,normal:a}=t.getPointAtPercentage(n),l=o.transformAsPoint(t.localToWorld()),h=a.flipped.perpendicular.degrees;this.position(l),this.rotation(h)})}transformContext(t){const e=this.localToParent().inverse();t.transform(e.a,e.b,e.c,e.d,e.e,e.f)}hit(t){const e=t.transformAsPoint(this.localToParent());return this.scene().hit(e)}drawChildren(t){this.scene().drawChildren(t)}static Stage({children:t,cameraRef:e,scene:i,...s}){const n=new ti({scene:i,children:t});return e?.(n),new be({clip:!0,...s,children:[n]})}}es([_()],ti.prototype,"scene",void 0);es([Ss(!1),_()],ti.prototype,"zoom",void 0);es([Et()],ti.prototype,"reset",null);es([Et()],ti.prototype,"centerOn",null);es([Et()],ti.prototype,"followCurve",null);es([Et()],ti.prototype,"followCurveReverse",null);es([Et()],ti.prototype,"followCurveWithRotation",null);es([Et()],ti.prototype,"followCurveWithRotationReverse",null);var qn=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n},xa;let Yi=xa=class extends be{constructor(t){super({composite:!0,fontFamily:"Roboto",fontSize:48,lineHeight:"120%",textWrap:!1,fontStyle:"normal",...t}),this.view2D=this,xa.shadowRoot.append(this.element),this.applyFlex()}dispose(){this.removeChildren(),super.dispose()}render(t){this.computedSize(),this.computedPosition(),super.render(t)}findKey(t){return Mr().getNode(t)??null}requestLayoutUpdate(){this.updateLayout()}requestFontUpdate(){this.applyFont()}view(){return this}};qn([V(Pn.Paused),_()],Yi.prototype,"playbackState",void 0);qn([V(0),_()],Yi.prototype,"globalTime",void 0);qn([_()],Yi.prototype,"assetHash",void 0);qn([ro(()=>{const r="motion-canvas-2d-frame";let t=document.querySelector(`#${r}`);return t||(t=document.createElement("div"),t.id=r,t.style.position="absolute",t.style.pointerEvents="none",t.style.top="0",t.style.left="0",t.style.opacity="0",t.style.overflow="hidden",document.body.prepend(t)),t.shadowRoot??t.attachShadow({mode:"open"})})],Yi,"shadowRoot",void 0);Yi=xa=qn([mi("View2D")],Yi);function vy(r,t,e){const i={arcLength:0,segments:[],minSin:1};if(r.length===0)return i;if(e){const o=r[0].add(r[r.length-1]).scale(.5);r=[o,...r,o]}let s=r[0];for(let o=2;o<r.length;o++){const a=r[o-2],l=r[o-1],h=r[o],c=a.sub(l),f=h.sub(l),p=c.normalized.safe,m=f.normalized.safe,y=Math.acos(ne(-1,1,p.dot(m))),b=Math.tan(y/2),S=Math.sin(y/2),T=Math.min(t,b*c.magnitude*(o===2?1:.5),b*f.magnitude*(o===r.length-1?1:.5)),L=S===0?0:T/S,B=b===0?0:T/b,N=p.add(m).scale(1/2).normalized.safe.scale(L).add(l),F=p.perpendicular.dot(m)<0,I=new $s(s,l.add(p.scale(B))),U=new mf(N,T,p.perpendicular.scale(F?1:-1),m.perpendicular.scale(F?-1:1),F);I.arcLength>0&&(i.segments.push(I),i.arcLength+=I.arcLength),U.arcLength>0&&(i.segments.push(U),i.arcLength+=U.arcLength),i.minSin=Math.min(i.minSin,Math.abs(S)),s=l.add(m.scale(B))}const n=new $s(s,r[r.length-1]);return n.arcLength>0&&(i.segments.push(n),i.arcLength+=n.arcLength),i}var is=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n},Sa;let oe=Sa=class extends Zt{static createSignal(t,e){return new ka(t,void 0,e).toSignal()}setDrawHooks(t){!Xe().experimentalFeatures&&t!==this.drawHooks.context.getInitial()?qt().log({...Hu("Code uses experimental draw hooks."),inspect:this.key}):this.drawHooks.context.setter(t)}*tweenSelection(t,e,i){this.oldSelection=this.selection(),this.selection(t),this.selectionProgress(0),yield*this.selectionProgress(1,e,i),this.selectionProgress(null),this.oldSelection=null}parsed(){return gs(this.code(),t=>Ht(t.progress)>.5)}highlighterCache(){const t=this.highlighter();if(!t||!t.initialize())return null;const e=this.code(),i=gs(e,!1),s=gs(e,!0);return{before:t.prepare(i),after:t.prepare(s)}}get cursor(){return this.cursorCache??(this.cursorCache=new Jv(this)),this.cursorCache}constructor(t){super({fontFamily:"monospace",highlighter:Sa.defaultHighlighter,...t}),this.oldSelection=null,this.selectionProgress=ye(null)}createSignal(t){return new ka(t,this,this.highlighter).toSignal()}findAllRanges(t){return Xo(this.parsed(),t)}findFirstRange(t){return Xo(this.parsed(),t,1)[0]??[[0,0],[0,0]]}findLastRange(t){return Xo(this.parsed(),t).at(-1)??[[0,0],[0,0]]}getPointBBox(t){const[e,i]=t,s=this.drawingInfo();let n;for(const a of s.fragments){if(a.cursor.y<e){n=a;continue}if(a.cursor.y===e&&a.cursor.x<i){n=a;continue}break}if(!n)return new ct;const o=this.computedSize();return new ct(n.position.sub(o.scale(.5)).addX(n.characterSize.x*(i-n.cursor.x)),n.characterSize)}getSelectionBBox(t){const e=this.computedSize(),i=hf(t),s=this.drawingInfo(),n=[];let o=null,a=0,l=0;for(const h of s.fragments){h.cursor.y!==a&&(a=h.cursor.y,o&&(n.push(o),o=null)),l=h.cursor.x;for(let c=0;c<h.text.length;c++){if(ya([a,l],i)){const f=new ct(h.position.sub(e.scale(.5)).addX(h.characterSize.x*(l-h.cursor.x)),h.characterSize);o?o=o.union(f):o=f}else o&&(n.push(o),o=null);l++}}return o&&n.push(o),n}drawingInfo(){this.requestFontUpdate();const t=this.cacheCanvas(),e=this.code();t.save(),this.applyStyle(t),this.applyText(t),this.cursor.setupDraw(t),this.cursor.drawScope(e);const i=this.cursor.getDrawingInfo();return t.restore(),i}desiredSize(){this.requestFontUpdate();const t=this.cacheCanvas(),e=this.code();t.save(),this.applyStyle(t),this.applyText(t),this.cursor.setupMeasure(t),this.cursor.measureSize(e);const i=this.cursor.getSize();return t.restore(),i}draw(t){this.requestFontUpdate(),this.applyStyle(t),this.applyText(t);const e=this.computedSize(),i=this.drawingInfo();t.save(),t.translate(-e.width/2,-e.height/2+i.verticalOffset);const s=this.drawHooks();for(const n of i.fragments)t.save(),t.globalAlpha*=n.alpha,s.token(t,n.text,n.position,n.fill,n.time),t.restore();t.restore(),this.drawChildren(t)}applyText(t){super.applyText(t),t.font=this.styles.font,t.textBaseline="top","letterSpacing"in t&&(t.letterSpacing=this.styles.letterSpacing)}collectAsyncResources(){super.collectAsyncResources(),this.highlighter()?.initialize()}};oe.defaultHighlighter=null;is([V(()=>oe.defaultHighlighter),_()],oe.prototype,"highlighter",void 0);is([xy()],oe.prototype,"code",void 0);is([V({token(r,t,e,i,s){r.fillStyle=i,r.globalAlpha*=ot(.2,1,s),r.fillText(t,e.x,e.y)}}),_()],oe.prototype,"drawHooks",void 0);is([V(Rr(0,1/0)),co(hf),_()],oe.prototype,"selection",void 0);is([Q()],oe.prototype,"parsed",null);is([Q()],oe.prototype,"highlighterCache",null);is([Q()],oe.prototype,"drawingInfo",null);oe=Sa=is([mi("CodeBlock")],oe);function yy(r){return r.reduce((t,e,i)=>i?t+r[i-1].sub(e).magnitude:0,0)}function Qo(r,t,e){const i=r.length;let s=0;for(let n=0;n<t.length;n+=1){const o=r[(e+n)%i],a=t[n];s+=o.sub(a).squaredMagnitude}return s}function by(r,t,e){const i=[];if(e===0)return[...r];if(e===1)return[...t];for(let s=0;s<r.length;s++){const n=r[s],o=t[s];i.push(k.lerp(n,o,e))}return i}var ks=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n},Dr;let Ne=Dr=class extends we{static rotatePoints(t,e,i){if(i){let s=1/0,n=0;for(let o=0;o<t.length;o+=1){const a=Qo(t,e,o);a<s&&(s=a,n=o)}if(n){const o=t.splice(0,n);t.splice(t.length,0,...o)}}else{const s=Qo(t,e,0),n=[...t].reverse();Qo(n,e,0)<s&&t.reverse()}}static distributePoints(t,e){if(t.length===0){for(let a=0;a<e;a++)t.push(k.zero);return}if(t.length===1){const a=t[0];for(let l=0;l<e;l++)t.push(a);return}const i=t.length+e,s=yy(t);let n=s===0?0:e/s,o=0;for(;t.length<i;){const a=i-t.length;if(o+1>=t.length){n=s===0?0:a/s,o=0;continue}const l=t[o],h=t[o+1],c=l.sub(h).magnitude;let f=Math.min(Math.round(c*n),a)+1;s===0&&(f=2);for(let p=1;p<f;p++)t.splice(++o,0,k.lerp(l,h,p/f));o++}}*tweenPoints(t,e,i){const s=[...this.parsedPoints()],n=this.parsePoints(Ht(t)),o=this.closed(),a=s.length-n.length;Dr.distributePoints(a<0?s:n,Math.abs(a)),Dr.rotatePoints(n,s,o),this.tweenedPoints(s),yield*Ge(e,l=>{const h=i(l);this.tweenedPoints(by(s,n,h))},()=>{this.tweenedPoints(null),this.points(t)})}constructor(t){super(t),this.tweenedPoints=ye(null),t.children===void 0&&t.points===void 0&&qt().warn({message:"No points specified for the line",remarks:`<p>The line won&#39;t be visible unless you specify at least two points:</p>
<pre class=""><code class="language-tsx">&lt;<span class="hljs-title class_">Line</span>
  stroke=<span class="hljs-string">&quot;#fff&quot;</span>
  lineWidth={<span class="hljs-number">8</span>}
  points={[
    [<span class="hljs-number">100</span>, <span class="hljs-number">0</span>],
    [<span class="hljs-number">0</span>, <span class="hljs-number">0</span>],
    [<span class="hljs-number">0</span>, <span class="hljs-number">100</span>],
  ]}
/&gt;</code></pre><p>Alternatively, you can define the points using the children:</p>
<pre class=""><code class="language-tsx">&lt;<span class="hljs-title class_">Line</span> stroke=<span class="hljs-string">&quot;#fff&quot;</span> lineWidth={<span class="hljs-number">8</span>}&gt;
  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Node</span> <span class="hljs-attr">x</span>=<span class="hljs-string">{100}</span> /&gt;</span></span>
  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Node</span> /&gt;</span></span>
  <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Node</span> <span class="hljs-attr">y</span>=<span class="hljs-string">{100}</span> /&gt;</span></span>
&lt;/<span class="hljs-title class_">Line</span>&gt;</code></pre><p>If you did this intentionally, and want to disable this message, set the
<code>points</code> property to <code>null</code>:</p>
<pre class=""><code class="language-tsx">&lt;<span class="hljs-title class_">Line</span> stroke=<span class="hljs-string">&quot;#fff&quot;</span> lineWidth={<span class="hljs-number">8</span>} points={<span class="hljs-literal">null</span>} /&gt;</code></pre>`,inspect:this.key})}childrenBBox(){let t=this.tweenedPoints();if(!t){const e=this.points();t=e?e.map(i=>new k(Ht(i))):this.children().filter(i=>!(i instanceof W)||i.isLayoutRoot()).map(i=>i.position())}return ct.fromPoints(...t)}parsedPoints(){return this.parsePoints(this.points())}profile(){return vy(this.tweenedPoints()??this.parsedPoints(),this.radius(),this.closed())}lineWidthCoefficient(){const t=this.radius(),e=this.lineJoin();let i=super.lineWidthCoefficient();if(t===0&&e==="miter"){const{minSin:s}=this.profile();s>0&&(i=Math.max(i,.5/s))}return i}drawOverlay(t,e){const i=this.childrenBBox().transformCorners(e),n=this.computedSize().mul(this.offset()).scale(.5).transformAsPoint(e);t.fillStyle="white",t.strokeStyle="black",t.lineWidth=1;const o=new Path2D,a=(this.tweenedPoints()??this.parsedPoints()).map(l=>l.transformAsPoint(e));if(a.length>0){Hn(o,a[0]);for(const l of a)hi(o,l),t.beginPath(),pf(t,l,4),t.closePath(),t.fill(),t.stroke()}t.strokeStyle="white",t.stroke(o),t.beginPath(),df(t,n),t.stroke(),t.beginPath(),zi(t,i),t.closePath(),t.stroke()}parsePoints(t){return t?t.map(e=>new k(Ht(e))):this.children().map(e=>e.position())}};ks([V(0),_()],Ne.prototype,"radius",void 0);ks([V(null),_()],Ne.prototype,"points",void 0);ks([Et()],Ne.prototype,"tweenPoints",null);ks([Q()],Ne.prototype,"childrenBBox",null);ks([Q()],Ne.prototype,"parsedPoints",null);ks([Q()],Ne.prototype,"profile",null);Ne=Dr=ks([mi("Line")],Ne);var Kn=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n},Lr;let De=Lr=class extends Zt{constructor({children:t,...e}){super(e),t&&this.text(t)}parentTxt(){const t=this.parent();return t instanceof Ut?t:null}draw(t){this.requestFontUpdate(),this.applyStyle(t),this.applyText(t),t.font=this.styles.font,t.textBaseline="bottom","letterSpacing"in t&&(t.letterSpacing=`${this.letterSpacing()}px`);const e=t.measureText("").fontBoundingBoxAscent,i=this.element.getBoundingClientRect(),{width:s,height:n}=this.size(),o=document.createRange();let a="";const l=new ct;for(const h of this.element.childNodes){if(!h.textContent)continue;o.selectNodeContents(h);const c=o.getBoundingClientRect(),f=s/-2+c.left-i.left,p=n/-2+c.top-i.top+e;l.y===p?(l.width+=c.width,a+=h.textContent):(this.drawText(t,a,l),l.x=f,l.y=p,l.width=c.width,l.height=c.height,a=h.textContent)}this.drawText(t,a,l)}drawText(t,e,i){const s=i.y;e=e.replace(/\s+/g," "),this.lineWidth()<=0?t.fillText(e,i.x,s):this.strokeFirst()?(t.strokeText(e,i.x,s),t.fillText(e,i.x,s)):(t.fillText(e,i.x,s),t.strokeText(e,i.x,s))}getCacheBBox(){const t=this.computedSize(),e=document.createRange();e.selectNodeContents(this.element);const i=e.getBoundingClientRect(),s=this.lineWidth(),n=this.lineJoin()==="miter"?.5*10:.5;return new ct(-t.width/2,-t.height/2,i.width,i.height).expand([0,this.fontSize()*.5]).expand(s*n)}applyFlex(){super.applyFlex(),this.element.style.display="inline"}updateLayout(){if(this.applyFont(),this.applyFlex(),this.justifyContent.isInitial()&&(this.element.style.justifyContent=this.styles.getPropertyValue("text-align")),this.styles.whiteSpace!=="nowrap"&&this.styles.whiteSpace!=="pre")if(this.element.innerText="",Lr.segmenter)for(const e of Lr.segmenter.segment(this.text()))this.element.appendChild(document.createTextNode(e.segment));else for(const e of this.text().split(""))this.element.appendChild(document.createTextNode(e));else if(this.styles.whiteSpace==="pre"){this.element.innerText="";for(const e of this.text().split(`
`))this.element.appendChild(document.createTextNode(e+`
`))}else this.element.innerText=this.text()}};Kn([V(""),dl(Ju),_()],De.prototype,"text",void 0);Kn([Q()],De.prototype,"parentTxt",null);Kn([ro(()=>{const r=document.createElement("span");return Yi.shadowRoot.append(r),r})],De,"formatter",void 0);Kn([ro(()=>{try{return new Intl.Segmenter(void 0,{granularity:"grapheme"})}catch{return null}})],De,"segmenter",void 0);De=Lr=Kn([mi("TxtLeaf")],De);["fill","stroke","lineWidth","strokeFirst","lineCap","lineJoin","lineDash","lineDashOffset"].forEach(r=>{De.prototype[`get${ds(r)}`]=function(){return this.parentTxt()?.[r]()??this[r].context.getInitial()}});var Gn=globalThis&&globalThis.__decorate||function(r,t,e,i){var s=arguments.length,n=s<3?t:i===null?i=Object.getOwnPropertyDescriptor(t,e):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")n=Reflect.decorate(r,t,e,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(n=(s<3?o(n):s>3?o(t,e,n):o(t,e))||n);return s>3&&n&&Object.defineProperty(t,e,n),n},hs;let Ut=hs=class extends Zt{static b(t){return new hs({...t,fontWeight:700})}static i(t){return new hs({...t,fontStyle:"italic"})}getText(){return this.innerText()}setText(t){const e=this.children();let i=null;for(let s=0;s<e.length;s++){const n=e[s];i===null&&n instanceof De?i=n:n.parent(null)}i===null?(i=new De({text:t}),i.parent(this)):i.text(t),this.setParsedChildren([i])}setChildren(t){this.children.context.raw()!==t&&(typeof t=="string"?this.text(t):super.setChildren(t))}*tweenText(t,e,i,s){const n=this.children();(n.length!==1||!(n[0]instanceof De))&&this.text.save();const o=this.childAs(0),a=o.text.context.raw(),l=this.size.context.raw();o.text(t);const h=this.size();o.text(a??Be),this.height()===0&&this.height(h.height),yield*Lt(this.size(h,e,i),o.text(t,e,i,s)),this.children.context.setter(t),this.size(l)}getLayout(){return!0}constructor({children:t,text:e,...i}){super(i),this.children(e??t)}innerText(){const t=this.childrenAs();let e="";for(const i of t)e+=i.text();return e}parentTxt(){const t=this.parent();return t instanceof hs?t:null}parseChildren(t){const e=[],i=Array.isArray(t)?t:[t];for(const s of i)s instanceof hs||s instanceof De?e.push(s):typeof s=="string"&&e.push(new De({text:s}));return e}applyFlex(){super.applyFlex(),this.element.style.display=this.findAncestor(gl(hs))?"inline":"block"}draw(t){this.drawChildren(t)}};Gn([V(""),_()],Ut.prototype,"text",void 0);Gn([Et()],Ut.prototype,"tweenText",null);Gn([Q()],Ut.prototype,"innerText",null);Gn([Q()],Ut.prototype,"parentTxt",null);Ut=hs=Gn([mi("Txt")],Ut);["fill","stroke","lineWidth","strokeFirst","lineCap","lineJoin","lineDash","lineDashOffset"].forEach(r=>{Ut.prototype[`getDefault${ds(r)}`]=function(t){return this.parentTxt()?.[r]()??t}});function wy(r){const t=[];let e="",i=!1;for(const s of r)switch(s){case" ":case"	":case`
`:!i&&e!==""&&(t.push(e),e=""),i=!0,e+=s;break;case"(":case")":case"{":case"}":case"[":case"]":e!==""&&(t.push(e),e=""),i=!1,t.push(s);break;default:i&&e!==""&&(t.push(e),e=""),i=!1,e+=s;break}return e!==""&&t.push(e),t}function Ec(r,t){const[e,i]=r;let[s,n]=e,[o,a]=i;(s>o||s===o&&n>a)&&([s,n]=i,[o,a]=e);let l=0,h=0;const c=[];let f=-1,p=!1,m="";for(const y of t){if(p){c.push(y);continue}const b=_s(y,!1),S=b.split(`
`),T=S.length-1,L=S[T].length,B=T>0?L:h+L;if(s>l+T||s===l+T&&n>B){l+=T,h=B,c.push(y);continue}for(let N=0;N<b.length;N++){const F=b.charAt(N);if(s===l&&n>=h&&(n===h?(f=c.length+1,c.push(b.slice(0,N),"")):F===`
`&&(f=c.length+1,c.push(b.slice(0,N)+" ".repeat(n-h),""))),f!==-1&&o===l&&a>=h){if(a===h){c.push(b.slice(N)),p=!0;break}if(F===`
`){h<a?(m+=`
`,N+1<b.length&&c.push(b.slice(N+1))):c.push(b.slice(N)),p=!0;break}}f!==-1&&(m+=F),F===`
`?(l++,h=0):h++}f===-1&&c.push(y)}if(f===-1){f=c.length+1;const y=s-l,b=y>0?n:n-h;c.push(`
`.repeat(y)+" ".repeat(b),"")}return c[f]=m,[c,f]}class ka extends Gi{constructor(t,e,i){super(t,vs,e),this.highlighter=i,this.progress=ye(0),e instanceof oe&&(this.highlighter??(this.highlighter=e.highlighter)),Object.defineProperty(this.invokable,"edit",{value:this.edit.bind(this)}),Object.defineProperty(this.invokable,"append",{value:this.append.bind(this)}),Object.defineProperty(this.invokable,"prepend",{value:this.prepend.bind(this)}),Object.defineProperty(this.invokable,"insert",{value:this.insert.bind(this)}),Object.defineProperty(this.invokable,"remove",{value:this.remove.bind(this)}),Object.defineProperty(this.invokable,"replace",{value:this.replace.bind(this)})}*tweener(t,e,i){let s=wy;const n=Ht(this.highlighter);n&&(yield(async()=>{do await _t.consumePromises(),n.initialize();while(_t.hasPromises())})(),s=o=>n.tokenize(o)),this.progress(0),this.set({progress:this.progress,fragments:ey(this.get(),this.parse(Ht(t)),s)}),yield*this.progress(1,e,i),this.set(t)}edit(t=.6){return(e,...i)=>this.editTween(cr(e,...i),t)}append(t=.6,e){if(typeof t<"u"&&typeof t!="number")if(e===void 0){const s=this.get();return this.set({progress:0,fragments:[...s.fragments,t]})}else return this.appendTween(t,e);const i=t;return(s,...n)=>this.append(cr(s,...n),i)}prepend(t=.6,e){if(typeof t<"u"&&typeof t!="number")if(e===void 0){const s=this.get();return this.set({progress:0,fragments:[t,...s.fragments]})}else return this.prependTween(t,e);const i=t;return(s,...n)=>this.prepend(cr(s,...n),i)}insert(t,e=.6,i){return this.replace([t,t],e,i)}remove(t,e){return this.replace(t,"",e)}replace(t,e=.6,i){if(typeof e<"u"&&typeof e!="number")if(i===void 0){const n=this.get(),[o,a]=Ec(t,n.fragments);return o[a]=e,this.set({progress:n.progress,fragments:o})}else return this.replaceTween(t,e,i);const s=e;return(n,...o)=>this.replaceTween(t,cr(n,...o),s)}*replaceTween(t,e,i){let s=this.get();const[n,o]=Ec(t,s.fragments),a=ye(0),l=_s(e,!0),h={progress:a,fragments:[Yv(n[o],l)]};n[o]=h,this.set({progress:s.progress,fragments:n}),yield*a(1,i),s=this.get(),this.set({progress:s.progress,fragments:s.fragments.map(c=>c===h?e:c)}),a.context.dispose()}*editTween(t,e){this.progress(0),this.set({progress:this.progress,fragments:t}),yield*this.progress(1,e);const i=this.get();this.set({progress:0,fragments:i.fragments.map(s=>t.includes(s)?_s(s,!0):s)})}*appendTween(t,e){let i=this.get();const s=ye(0),n=_s(t,!0),o={progress:s,fragments:[Tc(n)]};this.set({progress:i.progress,fragments:[...i.fragments,o]}),yield*s(1,e),i=this.get(),this.set({progress:i.progress,fragments:i.fragments.map(a=>a===o?t:a)}),s.context.dispose()}*prependTween(t,e){let i=this.get();const s=ye(0),n=_s(t,!0),o={progress:s,fragments:[Tc(n)]};this.set({progress:i.progress,fragments:[o,...i.fragments]}),yield*s(1,e),i=this.get(),this.set({progress:i.progress,fragments:i.fragments.map(a=>a===o?t:a)}),s.context.dispose()}parse(t){return Xv(t)}toSignal(){return this.invokable}}function xy(){return(r,t)=>{const e=ho(r,t);nn(r,i=>{i[t]=new ka(e.default??[],i).toSignal()})}}const vf=1024;let Sy=0,Zo=class{constructor(t,e){this.from=t,this.to=e}};class bt{constructor(t={}){this.id=Sy++,this.perNode=!!t.perNode,this.deserialize=t.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(t){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof t!="function"&&(t=xe.match(t)),e=>{let i=t(e);return i===void 0?null:[this,i]}}}bt.closedBy=new bt({deserialize:r=>r.split(" ")});bt.openedBy=new bt({deserialize:r=>r.split(" ")});bt.group=new bt({deserialize:r=>r.split(" ")});bt.isolate=new bt({deserialize:r=>{if(r&&r!="rtl"&&r!="ltr"&&r!="auto")throw new RangeError("Invalid value for isolate: "+r);return r||"auto"}});bt.contextHash=new bt({perNode:!0});bt.lookAhead=new bt({perNode:!0});bt.mounted=new bt({perNode:!0});class jr{constructor(t,e,i){this.tree=t,this.overlay=e,this.parser=i}static get(t){return t&&t.props&&t.props[bt.mounted.id]}}const ky=Object.create(null);class xe{constructor(t,e,i,s=0){this.name=t,this.props=e,this.id=i,this.flags=s}static define(t){let e=t.props&&t.props.length?Object.create(null):ky,i=(t.top?1:0)|(t.skipped?2:0)|(t.error?4:0)|(t.name==null?8:0),s=new xe(t.name||"",e,t.id,i);if(t.props){for(let n of t.props)if(Array.isArray(n)||(n=n(s)),n){if(n[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");e[n[0].id]=n[1]}}return s}prop(t){return this.props[t.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(t){if(typeof t=="string"){if(this.name==t)return!0;let e=this.prop(bt.group);return e?e.indexOf(t)>-1:!1}return this.id==t}static match(t){let e=Object.create(null);for(let i in t)for(let s of i.split(" "))e[s]=t[i];return i=>{for(let s=i.prop(bt.group),n=-1;n<(s?s.length:0);n++){let o=e[n<0?i.name:s[n]];if(o)return o}}}}xe.none=new xe("",Object.create(null),0,8);class vl{constructor(t){this.types=t;for(let e=0;e<t.length;e++)if(t[e].id!=e)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...t){let e=[];for(let i of this.types){let s=null;for(let n of t){let o=n(i);o&&(s||(s=Object.assign({},i.props)),s[o[0].id]=o[1])}e.push(s?new xe(i.name,s,i.id,i.flags):i)}return new vl(e)}}const fr=new WeakMap,Dc=new WeakMap;var Xt;(function(r){r[r.ExcludeBuffers=1]="ExcludeBuffers",r[r.IncludeAnonymous=2]="IncludeAnonymous",r[r.IgnoreMounts=4]="IgnoreMounts",r[r.IgnoreOverlays=8]="IgnoreOverlays"})(Xt||(Xt={}));class Wt{constructor(t,e,i,s,n){if(this.type=t,this.children=e,this.positions=i,this.length=s,this.props=null,n&&n.length){this.props=Object.create(null);for(let[o,a]of n)this.props[typeof o=="number"?o:o.id]=a}}toString(){let t=jr.get(this);if(t&&!t.overlay)return t.tree.toString();let e="";for(let i of this.children){let s=i.toString();s&&(e&&(e+=","),e+=s)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(e.length?"("+e+")":""):e}cursor(t=0){return new Oa(this.topNode,t)}cursorAt(t,e=0,i=0){let s=fr.get(this)||this.topNode,n=new Oa(s);return n.moveTo(t,e),fr.set(this,n._tree),n}get topNode(){return new _e(this,0,0,null)}resolve(t,e=0){let i=An(fr.get(this)||this.topNode,t,e,!1);return fr.set(this,i),i}resolveInner(t,e=0){let i=An(Dc.get(this)||this.topNode,t,e,!0);return Dc.set(this,i),i}resolveStack(t,e=0){return Py(this,t,e)}iterate(t){let{enter:e,leave:i,from:s=0,to:n=this.length}=t,o=t.mode||0,a=(o&Xt.IncludeAnonymous)>0;for(let l=this.cursor(o|Xt.IncludeAnonymous);;){let h=!1;if(l.from<=n&&l.to>=s&&(!a&&l.type.isAnonymous||e(l)!==!1)){if(l.firstChild())continue;h=!0}for(;h&&i&&(a||!l.type.isAnonymous)&&i(l),!l.nextSibling();){if(!l.parent())return;h=!0}}}prop(t){return t.perNode?this.props?this.props[t.id]:void 0:this.type.prop(t)}get propValues(){let t=[];if(this.props)for(let e in this.props)t.push([+e,this.props[e]]);return t}balance(t={}){return this.children.length<=8?this:wl(xe.none,this.children,this.positions,0,this.children.length,0,this.length,(e,i,s)=>new Wt(this.type,e,i,s,this.propValues),t.makeTree||((e,i,s)=>new Wt(xe.none,e,i,s)))}static build(t){return Ty(t)}}Wt.empty=new Wt(xe.none,[],[],0);class yl{constructor(t,e){this.buffer=t,this.index=e}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new yl(this.buffer,this.index)}}class Xi{constructor(t,e,i){this.buffer=t,this.length=e,this.set=i}get type(){return xe.none}toString(){let t=[];for(let e=0;e<this.buffer.length;)t.push(this.childString(e)),e=this.buffer[e+3];return t.join(",")}childString(t){let e=this.buffer[t],i=this.buffer[t+3],s=this.set.types[e],n=s.name;if(/\W/.test(n)&&!s.isError&&(n=JSON.stringify(n)),t+=4,i==t)return n;let o=[];for(;t<i;)o.push(this.childString(t)),t=this.buffer[t+3];return n+"("+o.join(",")+")"}findChild(t,e,i,s,n){let{buffer:o}=this,a=-1;for(let l=t;l!=e&&!(yf(n,s,o[l+1],o[l+2])&&(a=l,i>0));l=o[l+3]);return a}slice(t,e,i){let s=this.buffer,n=new Uint16Array(e-t),o=0;for(let a=t,l=0;a<e;){n[l++]=s[a++],n[l++]=s[a++]-i;let h=n[l++]=s[a++]-i;n[l++]=s[a++]-t,o=Math.max(o,h)}return new Xi(n,o,this.set)}}function yf(r,t,e,i){switch(r){case-2:return e<t;case-1:return i>=t&&e<t;case 0:return e<t&&i>t;case 1:return e<=t&&i>t;case 2:return i>t;case 4:return!0}}function An(r,t,e,i){for(var s;r.from==r.to||(e<1?r.from>=t:r.from>t)||(e>-1?r.to<=t:r.to<t);){let o=!i&&r instanceof _e&&r.index<0?null:r.parent;if(!o)return r;r=o}let n=i?0:Xt.IgnoreOverlays;if(i)for(let o=r,a=o.parent;a;o=a,a=o.parent)o instanceof _e&&o.index<0&&((s=a.enter(t,e,n))===null||s===void 0?void 0:s.from)!=o.from&&(r=a);for(;;){let o=r.enter(t,e,n);if(!o)return r;r=o}}class bf{cursor(t=0){return new Oa(this,t)}getChild(t,e=null,i=null){let s=Lc(this,t,e,i);return s.length?s[0]:null}getChildren(t,e=null,i=null){return Lc(this,t,e,i)}resolve(t,e=0){return An(this,t,e,!1)}resolveInner(t,e=0){return An(this,t,e,!0)}matchContext(t){return Ca(this.parent,t)}enterUnfinishedNodesBefore(t){let e=this.childBefore(t),i=this;for(;e;){let s=e.lastChild;if(!s||s.to!=e.to)break;s.type.isError&&s.from==s.to?(i=e,e=s.prevSibling):e=s}return i}get node(){return this}get next(){return this.parent}}class _e extends bf{constructor(t,e,i,s){super(),this._tree=t,this.from=e,this.index=i,this._parent=s}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(t,e,i,s,n=0){for(let o=this;;){for(let{children:a,positions:l}=o._tree,h=e>0?a.length:-1;t!=h;t+=e){let c=a[t],f=l[t]+o.from;if(yf(s,i,f,f+c.length)){if(c instanceof Xi){if(n&Xt.ExcludeBuffers)continue;let p=c.findChild(0,c.buffer.length,e,i-f,s);if(p>-1)return new Hi(new Cy(o,c,t,f),null,p)}else if(n&Xt.IncludeAnonymous||!c.type.isAnonymous||bl(c)){let p;if(!(n&Xt.IgnoreMounts)&&(p=jr.get(c))&&!p.overlay)return new _e(p.tree,f,t,o);let m=new _e(c,f,t,o);return n&Xt.IncludeAnonymous||!m.type.isAnonymous?m:m.nextChild(e<0?c.children.length-1:0,e,i,s)}}}if(n&Xt.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?t=o.index+e:t=e<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(t){return this.nextChild(0,1,t,2)}childBefore(t){return this.nextChild(this._tree.children.length-1,-1,t,-2)}enter(t,e,i=0){let s;if(!(i&Xt.IgnoreOverlays)&&(s=jr.get(this._tree))&&s.overlay){let n=t-this.from;for(let{from:o,to:a}of s.overlay)if((e>0?o<=n:o<n)&&(e<0?a>=n:a>n))return new _e(s.tree,s.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,t,e,i)}nextSignificantParent(){let t=this;for(;t.type.isAnonymous&&t._parent;)t=t._parent;return t}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function Lc(r,t,e,i){let s=r.cursor(),n=[];if(!s.firstChild())return n;if(e!=null){for(let o=!1;!o;)if(o=s.type.is(e),!s.nextSibling())return n}for(;;){if(i!=null&&s.type.is(i))return n;if(s.type.is(t)&&n.push(s.node),!s.nextSibling())return i==null?n:[]}}function Ca(r,t,e=t.length-1){for(let i=r;e>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(t[e]&&t[e]!=i.name)return!1;e--}}return!0}class Cy{constructor(t,e,i,s){this.parent=t,this.buffer=e,this.index=i,this.start=s}}class Hi extends bf{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(t,e,i){super(),this.context=t,this._parent=e,this.index=i,this.type=t.buffer.set.types[t.buffer.buffer[i]]}child(t,e,i){let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.context.start,i);return n<0?null:new Hi(this.context,this,n)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(t){return this.child(1,t,2)}childBefore(t){return this.child(-1,t,-2)}enter(t,e,i=0){if(i&Xt.ExcludeBuffers)return null;let{buffer:s}=this.context,n=s.findChild(this.index+4,s.buffer[this.index+3],e>0?1:-1,t-this.context.start,e);return n<0?null:new Hi(this.context,this,n)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(t){return this._parent?null:this.context.parent.nextChild(this.context.index+t,t,0,4)}get nextSibling(){let{buffer:t}=this.context,e=t.buffer[this.index+3];return e<(this._parent?t.buffer[this._parent.index+3]:t.buffer.length)?new Hi(this.context,this._parent,e):this.externalSibling(1)}get prevSibling(){let{buffer:t}=this.context,e=this._parent?this._parent.index+4:0;return this.index==e?this.externalSibling(-1):new Hi(this.context,this._parent,t.findChild(e,this.index,-1,0,4))}get tree(){return null}toTree(){let t=[],e=[],{buffer:i}=this.context,s=this.index+4,n=i.buffer[this.index+3];if(n>s){let o=i.buffer[this.index+1];t.push(i.slice(s,n,o)),e.push(0)}return new Wt(this.type,t,e,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function wf(r){if(!r.length)return null;let t=0,e=r[0];for(let n=1;n<r.length;n++){let o=r[n];(o.from>e.from||o.to<e.to)&&(e=o,t=n)}let i=e instanceof _e&&e.index<0?null:e.parent,s=r.slice();return i?s[t]=i:s.splice(t,1),new Oy(s,e)}class Oy{constructor(t,e){this.heads=t,this.node=e}get next(){return wf(this.heads)}}function Py(r,t,e){let i=r.resolveInner(t,e),s=null;for(let n=i instanceof _e?i:i.context.parent;n;n=n.parent)if(n.index<0){let o=n.parent;(s||(s=[i])).push(o.resolve(t,e)),n=o}else{let o=jr.get(n.tree);if(o&&o.overlay&&o.overlay[0].from<=t&&o.overlay[o.overlay.length-1].to>=t){let a=new _e(o.tree,o.overlay[0].from+n.from,-1,n);(s||(s=[i])).push(An(a,t,e,!1))}}return s?wf(s):i}class Oa{get name(){return this.type.name}constructor(t,e=0){if(this.mode=e,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,t instanceof _e)this.yieldNode(t);else{this._tree=t.context.parent,this.buffer=t.context;for(let i=t._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=t,this.yieldBuf(t.index)}}yieldNode(t){return t?(this._tree=t,this.type=t.type,this.from=t.from,this.to=t.to,!0):!1}yieldBuf(t,e){this.index=t;let{start:i,buffer:s}=this.buffer;return this.type=e||s.set.types[s.buffer[t]],this.from=i+s.buffer[t+1],this.to=i+s.buffer[t+2],!0}yield(t){return t?t instanceof _e?(this.buffer=null,this.yieldNode(t)):(this.buffer=t.context,this.yieldBuf(t.index,t.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(t,e,i){if(!this.buffer)return this.yield(this._tree.nextChild(t<0?this._tree._tree.children.length-1:0,t,e,i,this.mode));let{buffer:s}=this.buffer,n=s.findChild(this.index+4,s.buffer[this.index+3],t,e-this.buffer.start,i);return n<0?!1:(this.stack.push(this.index),this.yieldBuf(n))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(t){return this.enterChild(1,t,2)}childBefore(t){return this.enterChild(-1,t,-2)}enter(t,e,i=this.mode){return this.buffer?i&Xt.ExcludeBuffers?!1:this.enterChild(1,t,e):this.yield(this._tree.enter(t,e,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&Xt.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let t=this.mode&Xt.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(t)}sibling(t){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+t,t,0,4,this.mode)):!1;let{buffer:e}=this.buffer,i=this.stack.length-1;if(t<0){let s=i<0?0:this.stack[i]+4;if(this.index!=s)return this.yieldBuf(e.findChild(s,this.index,-1,0,4))}else{let s=e.buffer[this.index+3];if(s<(i<0?e.buffer.length:e.buffer[this.stack[i]+3]))return this.yieldBuf(s)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+t,t,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(t){let e,i,{buffer:s}=this;if(s){if(t>0){if(this.index<s.buffer.buffer.length)return!1}else for(let n=0;n<this.index;n++)if(s.buffer.buffer[n+3]<this.index)return!1;({index:e,parent:i}=s)}else({index:e,_parent:i}=this._tree);for(;i;{index:e,_parent:i}=i)if(e>-1)for(let n=e+t,o=t<0?-1:i._tree.children.length;n!=o;n+=t){let a=i._tree.children[n];if(this.mode&Xt.IncludeAnonymous||a instanceof Xi||!a.type.isAnonymous||bl(a))return!1}return!0}move(t,e){if(e&&this.enterChild(t,0,4))return!0;for(;;){if(this.sibling(t))return!0;if(this.atLastNode(t)||!this.parent())return!1}}next(t=!0){return this.move(1,t)}prev(t=!0){return this.move(-1,t)}moveTo(t,e=0){for(;(this.from==this.to||(e<1?this.from>=t:this.from>t)||(e>-1?this.to<=t:this.to<t))&&this.parent(););for(;this.enterChild(1,t,e););return this}get node(){if(!this.buffer)return this._tree;let t=this.bufferNode,e=null,i=0;if(t&&t.context==this.buffer)t:for(let s=this.index,n=this.stack.length;n>=0;){for(let o=t;o;o=o._parent)if(o.index==s){if(s==this.index)return o;e=o,i=n+1;break t}s=this.stack[--n]}for(let s=i;s<this.stack.length;s++)e=new Hi(this.buffer,e,this.stack[s]);return this.bufferNode=new Hi(this.buffer,e,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(t,e){for(let i=0;;){let s=!1;if(this.type.isAnonymous||t(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(s=!0)}for(;s&&e&&e(this),s=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,s=!0}}}matchContext(t){if(!this.buffer)return Ca(this.node.parent,t);let{buffer:e}=this.buffer,{types:i}=e.set;for(let s=t.length-1,n=this.stack.length-1;s>=0;n--){if(n<0)return Ca(this._tree,t,s);let o=i[e.buffer[this.stack[n]]];if(!o.isAnonymous){if(t[s]&&t[s]!=o.name)return!1;s--}}return!0}}function bl(r){return r.children.some(t=>t instanceof Xi||!t.type.isAnonymous||bl(t))}function Ty(r){var t;let{buffer:e,nodeSet:i,maxBufferLength:s=vf,reused:n=[],minRepeatType:o=i.types.length}=r,a=Array.isArray(e)?new yl(e,e.length):e,l=i.types,h=0,c=0;function f(F,I,U,J,xt,Tt){let{id:lt,start:Z,end:Ot,size:At}=a,jt=c,ei=h;for(;At<0;)if(a.next(),At==-1){let Ue=n[lt];U.push(Ue),J.push(Z-F);return}else if(At==-3){h=lt;return}else if(At==-4){c=lt;return}else throw new RangeError(`Unrecognized record size: ${At}`);let Ei=l[lt],ss,vi,Jn=Z-F;if(Ot-Z<=s&&(vi=S(a.pos-I,xt))){let Ue=new Uint16Array(vi.size-vi.skip),ge=a.pos-vi.size,Re=Ue.length;for(;a.pos>ge;)Re=T(vi.start,Ue,Re);ss=new Xi(Ue,Ot-vi.start,i),Jn=vi.start-F}else{let Ue=a.pos-At;a.next();let ge=[],Re=[],We=lt>=o?lt:-1,Di=0,Os=Ot;for(;a.pos>Ue;)We>=0&&a.id==We&&a.size>=0?(a.end<=Os-s&&(y(ge,Re,Z,Di,a.end,Os,We,jt,ei),Di=ge.length,Os=a.end),a.next()):Tt>2500?p(Z,Ue,ge,Re):f(Z,Ue,ge,Re,We,Tt+1);if(We>=0&&Di>0&&Di<ge.length&&y(ge,Re,Z,Di,Z,Os,We,jt,ei),ge.reverse(),Re.reverse(),We>-1&&Di>0){let tr=m(Ei,ei);ss=wl(Ei,ge,Re,0,ge.length,0,Ot-Z,tr,tr)}else ss=b(Ei,ge,Re,Ot-Z,jt-Ot,ei)}U.push(ss),J.push(Jn)}function p(F,I,U,J){let xt=[],Tt=0,lt=-1;for(;a.pos>I;){let{id:Z,start:Ot,end:At,size:jt}=a;if(jt>4)a.next();else{if(lt>-1&&Ot<lt)break;lt<0&&(lt=At-s),xt.push(Z,Ot,At),Tt++,a.next()}}if(Tt){let Z=new Uint16Array(Tt*4),Ot=xt[xt.length-2];for(let At=xt.length-3,jt=0;At>=0;At-=3)Z[jt++]=xt[At],Z[jt++]=xt[At+1]-Ot,Z[jt++]=xt[At+2]-Ot,Z[jt++]=jt;U.push(new Xi(Z,xt[2]-Ot,i)),J.push(Ot-F)}}function m(F,I){return(U,J,xt)=>{let Tt=0,lt=U.length-1,Z,Ot;if(lt>=0&&(Z=U[lt])instanceof Wt){if(!lt&&Z.type==F&&Z.length==xt)return Z;(Ot=Z.prop(bt.lookAhead))&&(Tt=J[lt]+Z.length+Ot)}return b(F,U,J,xt,Tt,I)}}function y(F,I,U,J,xt,Tt,lt,Z,Ot){let At=[],jt=[];for(;F.length>J;)At.push(F.pop()),jt.push(I.pop()+U-xt);F.push(b(i.types[lt],At,jt,Tt-xt,Z-Tt,Ot)),I.push(xt-U)}function b(F,I,U,J,xt,Tt,lt){if(Tt){let Z=[bt.contextHash,Tt];lt=lt?[Z].concat(lt):[Z]}if(xt>25){let Z=[bt.lookAhead,xt];lt=lt?[Z].concat(lt):[Z]}return new Wt(F,I,U,J,lt)}function S(F,I){let U=a.fork(),J=0,xt=0,Tt=0,lt=U.end-s,Z={size:0,start:0,skip:0};t:for(let Ot=U.pos-F;U.pos>Ot;){let At=U.size;if(U.id==I&&At>=0){Z.size=J,Z.start=xt,Z.skip=Tt,Tt+=4,J+=4,U.next();continue}let jt=U.pos-At;if(At<0||jt<Ot||U.start<lt)break;let ei=U.id>=o?4:0,Ei=U.start;for(U.next();U.pos>jt;){if(U.size<0)if(U.size==-3)ei+=4;else break t;else U.id>=o&&(ei+=4);U.next()}xt=Ei,J+=At,Tt+=ei}return(I<0||J==F)&&(Z.size=J,Z.start=xt,Z.skip=Tt),Z.size>4?Z:void 0}function T(F,I,U){let{id:J,start:xt,end:Tt,size:lt}=a;if(a.next(),lt>=0&&J<o){let Z=U;if(lt>4){let Ot=a.pos-(lt-4);for(;a.pos>Ot;)U=T(F,I,U)}I[--U]=Z,I[--U]=Tt-F,I[--U]=xt-F,I[--U]=J}else lt==-3?h=J:lt==-4&&(c=J);return U}let L=[],B=[];for(;a.pos>0;)f(r.start||0,r.bufferStart||0,L,B,-1,0);let N=(t=r.length)!==null&&t!==void 0?t:L.length?B[0]+L[0].length:0;return new Wt(l[r.topID],L.reverse(),B.reverse(),N)}const Nc=new WeakMap;function Nr(r,t){if(!r.isAnonymous||t instanceof Xi||t.type!=r)return 1;let e=Nc.get(t);if(e==null){e=1;for(let i of t.children){if(i.type!=r||!(i instanceof Wt)){e=1;break}e+=Nr(r,i)}Nc.set(t,e)}return e}function wl(r,t,e,i,s,n,o,a,l){let h=0;for(let y=i;y<s;y++)h+=Nr(r,t[y]);let c=Math.ceil(h*1.5/8),f=[],p=[];function m(y,b,S,T,L){for(let B=S;B<T;){let N=B,F=b[B],I=Nr(r,y[B]);for(B++;B<T;B++){let U=Nr(r,y[B]);if(I+U>=c)break;I+=U}if(B==N+1){if(I>c){let U=y[N];m(U.children,U.positions,0,U.children.length,b[N]+L);continue}f.push(y[N])}else{let U=b[B-1]+y[B-1].length-F;f.push(wl(r,y,b,N,B,F,U,null,l))}p.push(F+L-n)}}return m(t,e,i,s,0),(a||l)(f,p,o)}class ms{constructor(t,e,i,s,n=!1,o=!1){this.from=t,this.to=e,this.tree=i,this.offset=s,this.open=(n?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(t,e=[],i=!1){let s=[new ms(0,t.length,t,0,!1,i)];for(let n of e)n.to>t.length&&s.push(n);return s}static applyChanges(t,e,i=128){if(!e.length)return t;let s=[],n=1,o=t.length?t[0]:null;for(let a=0,l=0,h=0;;a++){let c=a<e.length?e[a]:null,f=c?c.fromA:1e9;if(f-l>=i)for(;o&&o.from<f;){let p=o;if(l>=p.from||f<=p.to||h){let m=Math.max(p.from,l)-h,y=Math.min(p.to,f)-h;p=m>=y?null:new ms(m,y,p.tree,p.offset+h,a>0,!!c)}if(p&&s.push(p),o.to>f)break;o=n<t.length?t[n++]:null}if(!c)break;l=c.toA,h=c.toA-c.toB}return s}}class xf{startParse(t,e,i){return typeof t=="string"&&(t=new Ay(t)),i=i?i.length?i.map(s=>new Zo(s.from,s.to)):[new Zo(0,0)]:[new Zo(0,t.length)],this.createParse(t,e||[],i)}parse(t,e,i){let s=this.startParse(t,e,i);for(;;){let n=s.advance();if(n)return n}}}class Ay{constructor(t){this.string=t}get length(){return this.string.length}chunk(t){return this.string.slice(t)}get lineChunks(){return!1}read(t,e){return this.string.slice(t,e)}}new bt({perNode:!0});class mt{lineAt(t){if(t<0||t>this.length)throw new RangeError(`Invalid position ${t} in document of length ${this.length}`);return this.lineInner(t,!1,1,0)}line(t){if(t<1||t>this.lines)throw new RangeError(`Invalid line number ${t} in ${this.lines}-line document`);return this.lineInner(t,!0,1,0)}replace(t,e,i){[t,e]=qs(this,t,e);let s=[];return this.decompose(0,t,s,2),i.length&&i.decompose(0,i.length,s,3),this.decompose(e,this.length,s,1),oi.from(s,this.length-(e-t)+i.length)}append(t){return this.replace(this.length,this.length,t)}slice(t,e=this.length){[t,e]=qs(this,t,e);let i=[];return this.decompose(t,e,i,0),oi.from(i,e-t)}eq(t){if(t==this)return!0;if(t.length!=this.length||t.lines!=this.lines)return!1;let e=this.scanIdentical(t,1),i=this.length-this.scanIdentical(t,-1),s=new Sn(this),n=new Sn(t);for(let o=e,a=e;;){if(s.next(o),n.next(o),o=0,s.lineBreak!=n.lineBreak||s.done!=n.done||s.value!=n.value)return!1;if(a+=s.value.length,s.done||a>=i)return!0}}iter(t=1){return new Sn(this,t)}iterRange(t,e=this.length){return new Sf(this,t,e)}iterLines(t,e){let i;if(t==null)i=this.iter();else{e==null&&(e=this.lines+1);let s=this.line(t).from;i=this.iterRange(s,Math.max(s,e==this.lines+1?this.length:e<=1?0:this.line(e-1).to))}return new kf(i)}toString(){return this.sliceString(0)}toJSON(){let t=[];return this.flatten(t),t}constructor(){}static of(t){if(t.length==0)throw new RangeError("A document must have at least one line");return t.length==1&&!t[0]?mt.empty:t.length<=32?new $t(t):oi.from($t.split(t,[]))}}class $t extends mt{constructor(t,e=Ry(t)){super(),this.text=t,this.length=e}get lines(){return this.text.length}get children(){return null}lineInner(t,e,i,s){for(let n=0;;n++){let o=this.text[n],a=s+o.length;if((e?i:a)>=t)return new My(s,a,i,o);s=a+1,i++}}decompose(t,e,i,s){let n=t<=0&&e>=this.length?this:new $t(Bc(this.text,t,e),Math.min(e,this.length)-Math.max(0,t));if(s&1){let o=i.pop(),a=Br(n.text,o.text.slice(),0,n.length);if(a.length<=32)i.push(new $t(a,o.length+n.length));else{let l=a.length>>1;i.push(new $t(a.slice(0,l)),new $t(a.slice(l)))}}else i.push(n)}replace(t,e,i){if(!(i instanceof $t))return super.replace(t,e,i);[t,e]=qs(this,t,e);let s=Br(this.text,Br(i.text,Bc(this.text,0,t)),e),n=this.length+i.length-(e-t);return s.length<=32?new $t(s,n):oi.from($t.split(s,[]),n)}sliceString(t,e=this.length,i=`
`){[t,e]=qs(this,t,e);let s="";for(let n=0,o=0;n<=e&&o<this.text.length;o++){let a=this.text[o],l=n+a.length;n>t&&o&&(s+=i),t<l&&e>n&&(s+=a.slice(Math.max(0,t-n),e-n)),n=l+1}return s}flatten(t){for(let e of this.text)t.push(e)}scanIdentical(){return 0}static split(t,e){let i=[],s=-1;for(let n of t)i.push(n),s+=n.length+1,i.length==32&&(e.push(new $t(i,s)),i=[],s=-1);return s>-1&&e.push(new $t(i,s)),e}}class oi extends mt{constructor(t,e){super(),this.children=t,this.length=e,this.lines=0;for(let i of t)this.lines+=i.lines}lineInner(t,e,i,s){for(let n=0;;n++){let o=this.children[n],a=s+o.length,l=i+o.lines-1;if((e?l:a)>=t)return o.lineInner(t,e,i,s);s=a+1,i=l+1}}decompose(t,e,i,s){for(let n=0,o=0;o<=e&&n<this.children.length;n++){let a=this.children[n],l=o+a.length;if(t<=l&&e>=o){let h=s&((o<=t?1:0)|(l>=e?2:0));o>=t&&l<=e&&!h?i.push(a):a.decompose(t-o,e-o,i,h)}o=l+1}}replace(t,e,i){if([t,e]=qs(this,t,e),i.lines<this.lines)for(let s=0,n=0;s<this.children.length;s++){let o=this.children[s],a=n+o.length;if(t>=n&&e<=a){let l=o.replace(t-n,e-n,i),h=this.lines-o.lines+l.lines;if(l.lines<h>>5-1&&l.lines>h>>5+1){let c=this.children.slice();return c[s]=l,new oi(c,this.length-(e-t)+i.length)}return super.replace(n,a,l)}n=a+1}return super.replace(t,e,i)}sliceString(t,e=this.length,i=`
`){[t,e]=qs(this,t,e);let s="";for(let n=0,o=0;n<this.children.length&&o<=e;n++){let a=this.children[n],l=o+a.length;o>t&&n&&(s+=i),t<l&&e>o&&(s+=a.sliceString(t-o,e-o,i)),o=l+1}return s}flatten(t){for(let e of this.children)e.flatten(t)}scanIdentical(t,e){if(!(t instanceof oi))return 0;let i=0,[s,n,o,a]=e>0?[0,0,this.children.length,t.children.length]:[this.children.length-1,t.children.length-1,-1,-1];for(;;s+=e,n+=e){if(s==o||n==a)return i;let l=this.children[s],h=t.children[n];if(l!=h)return i+l.scanIdentical(h,e);i+=l.length+1}}static from(t,e=t.reduce((i,s)=>i+s.length+1,-1)){let i=0;for(let m of t)i+=m.lines;if(i<32){let m=[];for(let y of t)y.flatten(m);return new $t(m,e)}let s=Math.max(32,i>>5),n=s<<1,o=s>>1,a=[],l=0,h=-1,c=[];function f(m){let y;if(m.lines>n&&m instanceof oi)for(let b of m.children)f(b);else m.lines>o&&(l>o||!l)?(p(),a.push(m)):m instanceof $t&&l&&(y=c[c.length-1])instanceof $t&&m.lines+y.lines<=32?(l+=m.lines,h+=m.length+1,c[c.length-1]=new $t(y.text.concat(m.text),y.length+1+m.length)):(l+m.lines>s&&p(),l+=m.lines,h+=m.length+1,c.push(m))}function p(){l!=0&&(a.push(c.length==1?c[0]:oi.from(c,h)),h=-1,l=c.length=0)}for(let m of t)f(m);return p(),a.length==1?a[0]:new oi(a,e)}}mt.empty=new $t([""],0);function Ry(r){let t=-1;for(let e of r)t+=e.length+1;return t}function Br(r,t,e=0,i=1e9){for(let s=0,n=0,o=!0;n<r.length&&s<=i;n++){let a=r[n],l=s+a.length;l>=e&&(l>i&&(a=a.slice(0,i-s)),s<e&&(a=a.slice(e-s)),o?(t[t.length-1]+=a,o=!1):t.push(a)),s=l+1}return t}function Bc(r,t,e){return Br(r,[""],t,e)}class Sn{constructor(t,e=1){this.dir=e,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[t],this.offsets=[e>0?1:(t instanceof $t?t.text.length:t.children.length)<<1]}nextInner(t,e){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,s=this.nodes[i],n=this.offsets[i],o=n>>1,a=s instanceof $t?s.text.length:s.children.length;if(o==(e>0?a:0)){if(i==0)return this.done=!0,this.value="",this;e>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((n&1)==(e>0?0:1)){if(this.offsets[i]+=e,t==0)return this.lineBreak=!0,this.value=`
`,this;t--}else if(s instanceof $t){let l=s.text[o+(e<0?-1:0)];if(this.offsets[i]+=e,l.length>Math.max(0,t))return this.value=t==0?l:e>0?l.slice(t):l.slice(0,l.length-t),this;t-=l.length}else{let l=s.children[o+(e<0?-1:0)];t>l.length?(t-=l.length,this.offsets[i]+=e):(e<0&&this.offsets[i]--,this.nodes.push(l),this.offsets.push(e>0?1:(l instanceof $t?l.text.length:l.children.length)<<1))}}}next(t=0){return t<0&&(this.nextInner(-t,-this.dir),t=this.value.length),this.nextInner(t,this.dir)}}class Sf{constructor(t,e,i){this.value="",this.done=!1,this.cursor=new Sn(t,e>i?-1:1),this.pos=e>i?t.length:0,this.from=Math.min(e,i),this.to=Math.max(e,i)}nextInner(t,e){if(e<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;t+=Math.max(0,e<0?this.pos-this.to:this.from-this.pos);let i=e<0?this.pos-this.from:this.to-this.pos;t>i&&(t=i),i-=t;let{value:s}=this.cursor.next(t);return this.pos+=(s.length+t)*e,this.value=s.length<=i?s:e<0?s.slice(s.length-i):s.slice(0,i),this.done=!this.value,this}next(t=0){return t<0?t=Math.max(t,this.from-this.pos):t>0&&(t=Math.min(t,this.to-this.pos)),this.nextInner(t,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class kf{constructor(t){this.inner=t,this.afterBreak=!0,this.value="",this.done=!1}next(t=0){let{done:e,lineBreak:i,value:s}=this.inner.next(t);return e&&this.afterBreak?(this.value="",this.afterBreak=!1):e?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(mt.prototype[Symbol.iterator]=function(){return this.iter()},Sn.prototype[Symbol.iterator]=Sf.prototype[Symbol.iterator]=kf.prototype[Symbol.iterator]=function(){return this});class My{constructor(t,e,i,s){this.from=t,this.to=e,this.number=i,this.text=s}get length(){return this.to-this.from}}function qs(r,t,e){return t=Math.max(0,Math.min(r.length,t)),[t,Math.max(t,Math.min(r.length,e))]}let zs="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(r=>r?parseInt(r,36):1);for(let r=1;r<zs.length;r++)zs[r]+=zs[r-1];function Iy(r){for(let t=1;t<zs.length;t+=2)if(zs[t]>r)return zs[t-1]<=r;return!1}function _c(r){return r>=127462&&r<=127487}const $c=8205;function ki(r,t,e=!0,i=!0){return(e?Cf:Ey)(r,t,i)}function Cf(r,t,e){if(t==r.length)return t;t&&Of(r.charCodeAt(t))&&Pf(r.charCodeAt(t-1))&&t--;let i=Jo(r,t);for(t+=Fc(i);t<r.length;){let s=Jo(r,t);if(i==$c||s==$c||e&&Iy(s))t+=Fc(s),i=s;else if(_c(s)){let n=0,o=t-2;for(;o>=0&&_c(Jo(r,o));)n++,o-=2;if(n%2==0)break;t+=2}else break}return t}function Ey(r,t,e){for(;t>0;){let i=Cf(r,t-2,e);if(i<t)return i;t--}return 0}function Of(r){return r>=56320&&r<57344}function Pf(r){return r>=55296&&r<56320}function Jo(r,t){let e=r.charCodeAt(t);if(!Pf(e)||t+1==r.length)return e;let i=r.charCodeAt(t+1);return Of(i)?(e-55296<<10)+(i-56320)+65536:e}function Fc(r){return r<65536?1:2}const Pa=/\r\n?|\n/;var Oe=function(r){return r[r.Simple=0]="Simple",r[r.TrackDel=1]="TrackDel",r[r.TrackBefore=2]="TrackBefore",r[r.TrackAfter=3]="TrackAfter",r}(Oe||(Oe={}));class Ti{constructor(t){this.sections=t}get length(){let t=0;for(let e=0;e<this.sections.length;e+=2)t+=this.sections[e];return t}get newLength(){let t=0;for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e+1];t+=i<0?this.sections[e]:i}return t}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(t){for(let e=0,i=0,s=0;e<this.sections.length;){let n=this.sections[e++],o=this.sections[e++];o<0?(t(i,s,n),s+=n):s+=o,i+=n}}iterChangedRanges(t,e=!1){Ta(this,t,e)}get invertedDesc(){let t=[];for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];s<0?t.push(i,s):t.push(s,i)}return new Ti(t)}composeDesc(t){return this.empty?t:t.empty?this:Tf(this,t)}mapDesc(t,e=!1){return t.empty?this:Aa(this,t,e)}mapPos(t,e=-1,i=Oe.Simple){let s=0,n=0;for(let o=0;o<this.sections.length;){let a=this.sections[o++],l=this.sections[o++],h=s+a;if(l<0){if(h>t)return n+(t-s);n+=a}else{if(i!=Oe.Simple&&h>=t&&(i==Oe.TrackDel&&s<t&&h>t||i==Oe.TrackBefore&&s<t||i==Oe.TrackAfter&&h>t))return null;if(h>t||h==t&&e<0&&!a)return t==s||e<0?n:n+l;n+=l}s=h}if(t>s)throw new RangeError(`Position ${t} is out of range for changeset of length ${s}`);return n}touchesRange(t,e=t){for(let i=0,s=0;i<this.sections.length&&s<=e;){let n=this.sections[i++],o=this.sections[i++],a=s+n;if(o>=0&&s<=e&&a>=t)return s<t&&a>e?"cover":!0;s=a}return!1}toString(){let t="";for(let e=0;e<this.sections.length;){let i=this.sections[e++],s=this.sections[e++];t+=(t?" ":"")+i+(s>=0?":"+s:"")}return t}toJSON(){return this.sections}static fromJSON(t){if(!Array.isArray(t)||t.length%2||t.some(e=>typeof e!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Ti(t)}static create(t){return new Ti(t)}}class Yt extends Ti{constructor(t,e){super(t),this.inserted=e}apply(t){if(this.length!=t.length)throw new RangeError("Applying change set to a document with the wrong length");return Ta(this,(e,i,s,n,o)=>t=t.replace(s,s+(i-e),o),!1),t}mapDesc(t,e=!1){return Aa(this,t,e,!0)}invert(t){let e=this.sections.slice(),i=[];for(let s=0,n=0;s<e.length;s+=2){let o=e[s],a=e[s+1];if(a>=0){e[s]=a,e[s+1]=o;let l=s>>1;for(;i.length<l;)i.push(mt.empty);i.push(o?t.slice(n,n+o):mt.empty)}n+=o}return new Yt(e,i)}compose(t){return this.empty?t:t.empty?this:Tf(this,t,!0)}map(t,e=!1){return t.empty?this:Aa(this,t,e,!0)}iterChanges(t,e=!1){Ta(this,t,e)}get desc(){return Ti.create(this.sections)}filter(t){let e=[],i=[],s=[],n=new Rn(this);t:for(let o=0,a=0;;){let l=o==t.length?1e9:t[o++];for(;a<l||a==l&&n.len==0;){if(n.done)break t;let c=Math.min(n.len,l-a);le(s,c,-1);let f=n.ins==-1?-1:n.off==0?n.ins:0;le(e,c,f),f>0&&Vi(i,e,n.text),n.forward(c),a+=c}let h=t[o++];for(;a<h;){if(n.done)break t;let c=Math.min(n.len,h-a);le(e,c,-1),le(s,c,n.ins==-1?-1:n.off==0?n.ins:0),n.forward(c),a+=c}}return{changes:new Yt(e,i),filtered:Ti.create(s)}}toJSON(){let t=[];for(let e=0;e<this.sections.length;e+=2){let i=this.sections[e],s=this.sections[e+1];s<0?t.push(i):s==0?t.push([i]):t.push([i].concat(this.inserted[e>>1].toJSON()))}return t}static of(t,e,i){let s=[],n=[],o=0,a=null;function l(c=!1){if(!c&&!s.length)return;o<e&&le(s,e-o,-1);let f=new Yt(s,n);a=a?a.compose(f.map(a)):f,s=[],n=[],o=0}function h(c){if(Array.isArray(c))for(let f of c)h(f);else if(c instanceof Yt){if(c.length!=e)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${e})`);l(),a=a?a.compose(c.map(a)):c}else{let{from:f,to:p=f,insert:m}=c;if(f>p||f<0||p>e)throw new RangeError(`Invalid change range ${f} to ${p} (in doc of length ${e})`);let y=m?typeof m=="string"?mt.of(m.split(i||Pa)):m:mt.empty,b=y.length;if(f==p&&b==0)return;f<o&&l(),f>o&&le(s,f-o,-1),le(s,p-f,b),Vi(n,s,y),o=p}}return h(t),l(!a),a}static empty(t){return new Yt(t?[t,-1]:[],[])}static fromJSON(t){if(!Array.isArray(t))throw new RangeError("Invalid JSON representation of ChangeSet");let e=[],i=[];for(let s=0;s<t.length;s++){let n=t[s];if(typeof n=="number")e.push(n,-1);else{if(!Array.isArray(n)||typeof n[0]!="number"||n.some((o,a)=>a&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(n.length==1)e.push(n[0],0);else{for(;i.length<s;)i.push(mt.empty);i[s]=mt.of(n.slice(1)),e.push(n[0],i[s].length)}}}return new Yt(e,i)}static createSet(t,e){return new Yt(t,e)}}function le(r,t,e,i=!1){if(t==0&&e<=0)return;let s=r.length-2;s>=0&&e<=0&&e==r[s+1]?r[s]+=t:t==0&&r[s]==0?r[s+1]+=e:i?(r[s]+=t,r[s+1]+=e):r.push(t,e)}function Vi(r,t,e){if(e.length==0)return;let i=t.length-2>>1;if(i<r.length)r[r.length-1]=r[r.length-1].append(e);else{for(;r.length<i;)r.push(mt.empty);r.push(e)}}function Ta(r,t,e){let i=r.inserted;for(let s=0,n=0,o=0;o<r.sections.length;){let a=r.sections[o++],l=r.sections[o++];if(l<0)s+=a,n+=a;else{let h=s,c=n,f=mt.empty;for(;h+=a,c+=l,l&&i&&(f=f.append(i[o-2>>1])),!(e||o==r.sections.length||r.sections[o+1]<0);)a=r.sections[o++],l=r.sections[o++];t(s,h,n,c,f),s=h,n=c}}}function Aa(r,t,e,i=!1){let s=[],n=i?[]:null,o=new Rn(r),a=new Rn(t);for(let l=-1;;)if(o.ins==-1&&a.ins==-1){let h=Math.min(o.len,a.len);le(s,h,-1),o.forward(h),a.forward(h)}else if(a.ins>=0&&(o.ins<0||l==o.i||o.off==0&&(a.len<o.len||a.len==o.len&&!e))){let h=a.len;for(le(s,a.ins,-1);h;){let c=Math.min(o.len,h);o.ins>=0&&l<o.i&&o.len<=c&&(le(s,0,o.ins),n&&Vi(n,s,o.text),l=o.i),o.forward(c),h-=c}a.next()}else if(o.ins>=0){let h=0,c=o.len;for(;c;)if(a.ins==-1){let f=Math.min(c,a.len);h+=f,c-=f,a.forward(f)}else if(a.ins==0&&a.len<c)c-=a.len,a.next();else break;le(s,h,l<o.i?o.ins:0),n&&l<o.i&&Vi(n,s,o.text),l=o.i,o.forward(o.len-c)}else{if(o.done&&a.done)return n?Yt.createSet(s,n):Ti.create(s);throw new Error("Mismatched change set lengths")}}function Tf(r,t,e=!1){let i=[],s=e?[]:null,n=new Rn(r),o=new Rn(t);for(let a=!1;;){if(n.done&&o.done)return s?Yt.createSet(i,s):Ti.create(i);if(n.ins==0)le(i,n.len,0,a),n.next();else if(o.len==0&&!o.done)le(i,0,o.ins,a),s&&Vi(s,i,o.text),o.next();else{if(n.done||o.done)throw new Error("Mismatched change set lengths");{let l=Math.min(n.len2,o.len),h=i.length;if(n.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;le(i,l,c,a),s&&c&&Vi(s,i,o.text)}else o.ins==-1?(le(i,n.off?0:n.len,l,a),s&&Vi(s,i,n.textBit(l))):(le(i,n.off?0:n.len,o.off?0:o.ins,a),s&&!o.off&&Vi(s,i,o.text));a=(n.ins>l||o.ins>=0&&o.len>l)&&(a||i.length>h),n.forward2(l),o.forward(l)}}}}class Rn{constructor(t){this.set=t,this.i=0,this.next()}next(){let{sections:t}=this.set;this.i<t.length?(this.len=t[this.i++],this.ins=t[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:t}=this.set,e=this.i-2>>1;return e>=t.length?mt.empty:t[e]}textBit(t){let{inserted:e}=this.set,i=this.i-2>>1;return i>=e.length&&!t?mt.empty:e[i].slice(this.off,t==null?void 0:this.off+t)}forward(t){t==this.len?this.next():(this.len-=t,this.off+=t)}forward2(t){this.ins==-1?this.forward(t):t==this.ins?this.next():(this.ins-=t,this.off+=t)}}class us{constructor(t,e,i){this.from=t,this.to=e,this.flags=i}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let t=this.flags&7;return t==7?null:t}get goalColumn(){let t=this.flags>>6;return t==16777215?void 0:t}map(t,e=-1){let i,s;return this.empty?i=s=t.mapPos(this.from,e):(i=t.mapPos(this.from,1),s=t.mapPos(this.to,-1)),i==this.from&&s==this.to?this:new us(i,s,this.flags)}extend(t,e=t){if(t<=this.anchor&&e>=this.anchor)return G.range(t,e);let i=Math.abs(t-this.anchor)>Math.abs(e-this.anchor)?t:e;return G.range(this.anchor,i)}eq(t,e=!1){return this.anchor==t.anchor&&this.head==t.head&&(!e||!this.empty||this.assoc==t.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(t){if(!t||typeof t.anchor!="number"||typeof t.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return G.range(t.anchor,t.head)}static create(t,e,i){return new us(t,e,i)}}class G{constructor(t,e){this.ranges=t,this.mainIndex=e}map(t,e=-1){return t.empty?this:G.create(this.ranges.map(i=>i.map(t,e)),this.mainIndex)}eq(t,e=!1){if(this.ranges.length!=t.ranges.length||this.mainIndex!=t.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(t.ranges[i],e))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new G([this.main],0)}addRange(t,e=!0){return G.create([t].concat(this.ranges),e?0:this.mainIndex+1)}replaceRange(t,e=this.mainIndex){let i=this.ranges.slice();return i[e]=t,G.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(t=>t.toJSON()),main:this.mainIndex}}static fromJSON(t){if(!t||!Array.isArray(t.ranges)||typeof t.main!="number"||t.main>=t.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new G(t.ranges.map(e=>us.fromJSON(e)),t.main)}static single(t,e=t){return new G([G.range(t,e)],0)}static create(t,e=0){if(t.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,s=0;s<t.length;s++){let n=t[s];if(n.empty?n.from<=i:n.from<i)return G.normalized(t.slice(),e);i=n.to}return new G(t,e)}static cursor(t,e=0,i,s){return us.create(t,t,(e==0?0:e<0?8:16)|(i==null?7:Math.min(6,i))|(s??16777215)<<6)}static range(t,e,i,s){let n=(i??16777215)<<6|(s==null?7:Math.min(6,s));return e<t?us.create(e,t,48|n):us.create(t,e,(e>t?8:0)|n)}static normalized(t,e=0){let i=t[e];t.sort((s,n)=>s.from-n.from),e=t.indexOf(i);for(let s=1;s<t.length;s++){let n=t[s],o=t[s-1];if(n.empty?n.from<=o.to:n.from<o.to){let a=o.from,l=Math.max(n.to,o.to);s<=e&&e--,t.splice(--s,2,n.anchor>n.head?G.range(l,a):G.range(a,l))}}return new G(t,e)}}function Af(r,t){for(let e of r.ranges)if(e.to>t)throw new RangeError("Selection points outside of document")}let xl=0;class st{constructor(t,e,i,s,n){this.combine=t,this.compareInput=e,this.compare=i,this.isStatic=s,this.id=xl++,this.default=t([]),this.extensions=typeof n=="function"?n(this):n}get reader(){return this}static define(t={}){return new st(t.combine||(e=>e),t.compareInput||((e,i)=>e===i),t.compare||(t.combine?(e,i)=>e===i:Sl),!!t.static,t.enables)}of(t){return new _r([],this,0,t)}compute(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new _r(t,this,1,e)}computeN(t,e){if(this.isStatic)throw new Error("Can't compute a static facet");return new _r(t,this,2,e)}from(t,e){return e||(e=i=>i),this.compute([t],i=>e(i.field(t)))}}function Sl(r,t){return r==t||r.length==t.length&&r.every((e,i)=>e===t[i])}class _r{constructor(t,e,i,s){this.dependencies=t,this.facet=e,this.type=i,this.value=s,this.id=xl++}dynamicSlot(t){var e;let i=this.value,s=this.facet.compareInput,n=this.id,o=t[n]>>1,a=this.type==2,l=!1,h=!1,c=[];for(let f of this.dependencies)f=="doc"?l=!0:f=="selection"?h=!0:((e=t[f.id])!==null&&e!==void 0?e:1)&1||c.push(t[f.id]);return{create(f){return f.values[o]=i(f),1},update(f,p){if(l&&p.docChanged||h&&(p.docChanged||p.selection)||Ra(f,c)){let m=i(f);if(a?!zc(m,f.values[o],s):!s(m,f.values[o]))return f.values[o]=m,1}return 0},reconfigure:(f,p)=>{let m,y=p.config.address[n];if(y!=null){let b=Vr(p,y);if(this.dependencies.every(S=>S instanceof st?p.facet(S)===f.facet(S):S instanceof Cs?p.field(S,!1)==f.field(S,!1):!0)||(a?zc(m=i(f),b,s):s(m=i(f),b)))return f.values[o]=b,0}else m=i(f);return f.values[o]=m,1}}}}function zc(r,t,e){if(r.length!=t.length)return!1;for(let i=0;i<r.length;i++)if(!e(r[i],t[i]))return!1;return!0}function Ra(r,t){let e=!1;for(let i of t)kn(r,i)&1&&(e=!0);return e}function Dy(r,t,e){let i=e.map(l=>r[l.id]),s=e.map(l=>l.type),n=i.filter(l=>!(l&1)),o=r[t.id]>>1;function a(l){let h=[];for(let c=0;c<i.length;c++){let f=Vr(l,i[c]);if(s[c]==2)for(let p of f)h.push(p);else h.push(f)}return t.combine(h)}return{create(l){for(let h of i)kn(l,h);return l.values[o]=a(l),1},update(l,h){if(!Ra(l,n))return 0;let c=a(l);return t.compare(c,l.values[o])?0:(l.values[o]=c,1)},reconfigure(l,h){let c=Ra(l,i),f=h.config.facets[t.id],p=h.facet(t);if(f&&!c&&Sl(e,f))return l.values[o]=p,0;let m=a(l);return t.compare(m,p)?(l.values[o]=p,0):(l.values[o]=m,1)}}}const Uc=st.define({static:!0});class Cs{constructor(t,e,i,s,n){this.id=t,this.createF=e,this.updateF=i,this.compareF=s,this.spec=n,this.provides=void 0}static define(t){let e=new Cs(xl++,t.create,t.update,t.compare||((i,s)=>i===s),t);return t.provide&&(e.provides=t.provide(e)),e}create(t){let e=t.facet(Uc).find(i=>i.field==this);return(e?.create||this.createF)(t)}slot(t){let e=t[this.id]>>1;return{create:i=>(i.values[e]=this.create(i),1),update:(i,s)=>{let n=i.values[e],o=this.updateF(n,s);return this.compareF(n,o)?0:(i.values[e]=o,1)},reconfigure:(i,s)=>s.config.address[this.id]!=null?(i.values[e]=s.field(this),0):(i.values[e]=this.create(i),1)}}init(t){return[this,Uc.of({field:this,create:t})]}get extension(){return this}}const cs={lowest:4,low:3,default:2,high:1,highest:0};function cn(r){return t=>new Rf(t,r)}const Ly={highest:cn(cs.highest),high:cn(cs.high),default:cn(cs.default),low:cn(cs.low),lowest:cn(cs.lowest)};class Rf{constructor(t,e){this.inner=t,this.prec=e}}class fo{of(t){return new Ma(this,t)}reconfigure(t){return fo.reconfigure.of({compartment:this,extension:t})}get(t){return t.config.compartments.get(this)}}class Ma{constructor(t,e){this.compartment=t,this.inner=e}}class Hr{constructor(t,e,i,s,n,o){for(this.base=t,this.compartments=e,this.dynamicSlots=i,this.address=s,this.staticValues=n,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(t){let e=this.address[t.id];return e==null?t.default:this.staticValues[e>>1]}static resolve(t,e,i){let s=[],n=Object.create(null),o=new Map;for(let p of Ny(t,e,o))p instanceof Cs?s.push(p):(n[p.facet.id]||(n[p.facet.id]=[])).push(p);let a=Object.create(null),l=[],h=[];for(let p of s)a[p.id]=h.length<<1,h.push(m=>p.slot(m));let c=i?.config.facets;for(let p in n){let m=n[p],y=m[0].facet,b=c&&c[p]||[];if(m.every(S=>S.type==0))if(a[y.id]=l.length<<1|1,Sl(b,m))l.push(i.facet(y));else{let S=y.combine(m.map(T=>T.value));l.push(i&&y.compare(S,i.facet(y))?i.facet(y):S)}else{for(let S of m)S.type==0?(a[S.id]=l.length<<1|1,l.push(S.value)):(a[S.id]=h.length<<1,h.push(T=>S.dynamicSlot(T)));a[y.id]=h.length<<1,h.push(S=>Dy(S,y,m))}}let f=h.map(p=>p(a));return new Hr(t,o,f,a,l,n)}}function Ny(r,t,e){let i=[[],[],[],[],[]],s=new Map;function n(o,a){let l=s.get(o);if(l!=null){if(l<=a)return;let h=i[l].indexOf(o);h>-1&&i[l].splice(h,1),o instanceof Ma&&e.delete(o.compartment)}if(s.set(o,a),Array.isArray(o))for(let h of o)n(h,a);else if(o instanceof Ma){if(e.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let h=t.get(o.compartment)||o.inner;e.set(o.compartment,h),n(h,a)}else if(o instanceof Rf)n(o.inner,o.prec);else if(o instanceof Cs)i[a].push(o),o.provides&&n(o.provides,a);else if(o instanceof _r)i[a].push(o),o.facet.extensions&&n(o.facet.extensions,cs.default);else{let h=o.extension;if(!h)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);n(h,a)}}return n(r,cs.default),i.reduce((o,a)=>o.concat(a))}function kn(r,t){if(t&1)return 2;let e=t>>1,i=r.status[e];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;r.status[e]=4;let s=r.computeSlot(r,r.config.dynamicSlots[e]);return r.status[e]=2|s}function Vr(r,t){return t&1?r.config.staticValues[t>>1]:r.values[t>>1]}const Mf=st.define(),Ia=st.define({combine:r=>r.some(t=>t),static:!0}),If=st.define({combine:r=>r.length?r[0]:void 0,static:!0}),Ef=st.define(),Df=st.define(),Lf=st.define(),Nf=st.define({combine:r=>r.length?r[0]:!1});class rn{constructor(t,e){this.type=t,this.value=e}static define(){return new By}}class By{of(t){return new rn(this,t)}}class _y{constructor(t){this.map=t}of(t){return new Vt(this,t)}}class Vt{constructor(t,e){this.type=t,this.value=e}map(t){let e=this.type.map(this.value,t);return e===void 0?void 0:e==this.value?this:new Vt(this.type,e)}is(t){return this.type==t}static define(t={}){return new _y(t.map||(e=>e))}static mapEffects(t,e){if(!t.length)return t;let i=[];for(let s of t){let n=s.map(e);n&&i.push(n)}return i}}Vt.reconfigure=Vt.define();Vt.appendConfig=Vt.define();class ce{constructor(t,e,i,s,n,o){this.startState=t,this.changes=e,this.selection=i,this.effects=s,this.annotations=n,this.scrollIntoView=o,this._doc=null,this._state=null,i&&Af(i,e.newLength),n.some(a=>a.type==ce.time)||(this.annotations=n.concat(ce.time.of(Date.now())))}static create(t,e,i,s,n,o){return new ce(t,e,i,s,n,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(t){for(let e of this.annotations)if(e.type==t)return e.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(t){let e=this.annotation(ce.userEvent);return!!(e&&(e==t||e.length>t.length&&e.slice(0,t.length)==t&&e[t.length]=="."))}}ce.time=rn.define();ce.userEvent=rn.define();ce.addToHistory=rn.define();ce.remote=rn.define();function $y(r,t){let e=[];for(let i=0,s=0;;){let n,o;if(i<r.length&&(s==t.length||t[s]>=r[i]))n=r[i++],o=r[i++];else if(s<t.length)n=t[s++],o=t[s++];else return e;!e.length||e[e.length-1]<n?e.push(n,o):e[e.length-1]<o&&(e[e.length-1]=o)}}function Bf(r,t,e){var i;let s,n,o;return e?(s=t.changes,n=Yt.empty(t.changes.length),o=r.changes.compose(t.changes)):(s=t.changes.map(r.changes),n=r.changes.mapDesc(t.changes,!0),o=r.changes.compose(s)),{changes:o,selection:t.selection?t.selection.map(n):(i=r.selection)===null||i===void 0?void 0:i.map(s),effects:Vt.mapEffects(r.effects,s).concat(Vt.mapEffects(t.effects,n)),annotations:r.annotations.length?r.annotations.concat(t.annotations):t.annotations,scrollIntoView:r.scrollIntoView||t.scrollIntoView}}function Ea(r,t,e){let i=t.selection,s=Us(t.annotations);return t.userEvent&&(s=s.concat(ce.userEvent.of(t.userEvent))),{changes:t.changes instanceof Yt?t.changes:Yt.of(t.changes||[],e,r.facet(If)),selection:i&&(i instanceof G?i:G.single(i.anchor,i.head)),effects:Us(t.effects),annotations:s,scrollIntoView:!!t.scrollIntoView}}function _f(r,t,e){let i=Ea(r,t.length?t[0]:{},r.doc.length);t.length&&t[0].filter===!1&&(e=!1);for(let n=1;n<t.length;n++){t[n].filter===!1&&(e=!1);let o=!!t[n].sequential;i=Bf(i,Ea(r,t[n],o?i.changes.newLength:r.doc.length),o)}let s=ce.create(r,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return zy(e?Fy(s):s)}function Fy(r){let t=r.startState,e=!0;for(let s of t.facet(Ef)){let n=s(r);if(n===!1){e=!1;break}Array.isArray(n)&&(e=e===!0?n:$y(e,n))}if(e!==!0){let s,n;if(e===!1)n=r.changes.invertedDesc,s=Yt.empty(t.doc.length);else{let o=r.changes.filter(e);s=o.changes,n=o.filtered.mapDesc(o.changes).invertedDesc}r=ce.create(t,s,r.selection&&r.selection.map(n),Vt.mapEffects(r.effects,n),r.annotations,r.scrollIntoView)}let i=t.facet(Df);for(let s=i.length-1;s>=0;s--){let n=i[s](r);n instanceof ce?r=n:Array.isArray(n)&&n.length==1&&n[0]instanceof ce?r=n[0]:r=_f(t,Us(n),!1)}return r}function zy(r){let t=r.startState,e=t.facet(Lf),i=r;for(let s=e.length-1;s>=0;s--){let n=e[s](r);n&&Object.keys(n).length&&(i=Bf(i,Ea(t,n,r.changes.newLength),!0))}return i==r?r:ce.create(t,r.changes,r.selection,i.effects,i.annotations,i.scrollIntoView)}const Uy=[];function Us(r){return r==null?Uy:Array.isArray(r)?r:[r]}var Ci=function(r){return r[r.Word=0]="Word",r[r.Space=1]="Space",r[r.Other=2]="Other",r}(Ci||(Ci={}));const Wy=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Da;try{Da=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function jy(r){if(Da)return Da.test(r);for(let t=0;t<r.length;t++){let e=r[t];if(/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||Wy.test(e)))return!0}return!1}function Hy(r){return t=>{if(!/\S/.test(t))return Ci.Space;if(jy(t))return Ci.Word;for(let e=0;e<r.length;e++)if(t.indexOf(r[e])>-1)return Ci.Word;return Ci.Other}}class St{constructor(t,e,i,s,n,o){this.config=t,this.doc=e,this.selection=i,this.values=s,this.status=t.statusTemplate.slice(),this.computeSlot=n,o&&(o._state=this);for(let a=0;a<this.config.dynamicSlots.length;a++)kn(this,a<<1);this.computeSlot=null}field(t,e=!0){let i=this.config.address[t.id];if(i==null){if(e)throw new RangeError("Field is not present in this state");return}return kn(this,i),Vr(this,i)}update(...t){return _f(this,t,!0)}applyTransaction(t){let e=this.config,{base:i,compartments:s}=e;for(let a of t.effects)a.is(fo.reconfigure)?(e&&(s=new Map,e.compartments.forEach((l,h)=>s.set(h,l)),e=null),s.set(a.value.compartment,a.value.extension)):a.is(Vt.reconfigure)?(e=null,i=a.value):a.is(Vt.appendConfig)&&(e=null,i=Us(i).concat(a.value));let n;e?n=t.startState.values.slice():(e=Hr.resolve(i,s,this),n=new St(e,this.doc,this.selection,e.dynamicSlots.map(()=>null),(l,h)=>h.reconfigure(l,this),null).values);let o=t.startState.facet(Ia)?t.newSelection:t.newSelection.asSingle();new St(e,t.newDoc,o,n,(a,l)=>l.update(a,t),t)}replaceSelection(t){return typeof t=="string"&&(t=this.toText(t)),this.changeByRange(e=>({changes:{from:e.from,to:e.to,insert:t},range:G.cursor(e.from+t.length)}))}changeByRange(t){let e=this.selection,i=t(e.ranges[0]),s=this.changes(i.changes),n=[i.range],o=Us(i.effects);for(let a=1;a<e.ranges.length;a++){let l=t(e.ranges[a]),h=this.changes(l.changes),c=h.map(s);for(let p=0;p<a;p++)n[p]=n[p].map(c);let f=s.mapDesc(h,!0);n.push(l.range.map(f)),s=s.compose(c),o=Vt.mapEffects(o,c).concat(Vt.mapEffects(Us(l.effects),f))}return{changes:s,selection:G.create(n,e.mainIndex),effects:o}}changes(t=[]){return t instanceof Yt?t:Yt.of(t,this.doc.length,this.facet(St.lineSeparator))}toText(t){return mt.of(t.split(this.facet(St.lineSeparator)||Pa))}sliceDoc(t=0,e=this.doc.length){return this.doc.sliceString(t,e,this.lineBreak)}facet(t){let e=this.config.address[t.id];return e==null?t.default:(kn(this,e),Vr(this,e))}toJSON(t){let e={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(t)for(let i in t){let s=t[i];s instanceof Cs&&this.config.address[s.id]!=null&&(e[i]=s.spec.toJSON(this.field(t[i]),this))}return e}static fromJSON(t,e={},i){if(!t||typeof t.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let s=[];if(i){for(let n in i)if(Object.prototype.hasOwnProperty.call(t,n)){let o=i[n],a=t[n];s.push(o.init(l=>o.spec.fromJSON(a,l)))}}return St.create({doc:t.doc,selection:G.fromJSON(t.selection),extensions:e.extensions?s.concat([e.extensions]):s})}static create(t={}){let e=Hr.resolve(t.extensions||[],new Map),i=t.doc instanceof mt?t.doc:mt.of((t.doc||"").split(e.staticFacet(St.lineSeparator)||Pa)),s=t.selection?t.selection instanceof G?t.selection:G.single(t.selection.anchor,t.selection.head):G.single(0);return Af(s,i.length),e.staticFacet(Ia)||(s=s.asSingle()),new St(e,i,s,e.dynamicSlots.map(()=>null),(n,o)=>o.create(n),null)}get tabSize(){return this.facet(St.tabSize)}get lineBreak(){return this.facet(St.lineSeparator)||`
`}get readOnly(){return this.facet(Nf)}phrase(t,...e){for(let i of this.facet(St.phrases))if(Object.prototype.hasOwnProperty.call(i,t)){t=i[t];break}return e.length&&(t=t.replace(/\$(\$|\d*)/g,(i,s)=>{if(s=="$")return"$";let n=+(s||1);return!n||n>e.length?i:e[n-1]})),t}languageDataAt(t,e,i=-1){let s=[];for(let n of this.facet(Mf))for(let o of n(this,e,i))Object.prototype.hasOwnProperty.call(o,t)&&s.push(o[t]);return s}charCategorizer(t){return Hy(this.languageDataAt("wordChars",t).join(""))}wordAt(t){let{text:e,from:i,length:s}=this.doc.lineAt(t),n=this.charCategorizer(t),o=t-i,a=t-i;for(;o>0;){let l=ki(e,o,!1);if(n(e.slice(l,o))!=Ci.Word)break;o=l}for(;a<s;){let l=ki(e,a);if(n(e.slice(a,l))!=Ci.Word)break;a=l}return o==a?null:G.range(o+i,a+i)}}St.allowMultipleSelections=Ia;St.tabSize=st.define({combine:r=>r.length?r[0]:4});St.lineSeparator=If;St.readOnly=Nf;St.phrases=st.define({compare(r,t){let e=Object.keys(r),i=Object.keys(t);return e.length==i.length&&e.every(s=>r[s]==t[s])}});St.languageData=Mf;St.changeFilter=Ef;St.transactionFilter=Df;St.transactionExtender=Lf;fo.reconfigure=Vt.define();class Ks{eq(t){return this==t}range(t,e=t){return Mn.create(t,e,this)}}Ks.prototype.startSide=Ks.prototype.endSide=0;Ks.prototype.point=!1;Ks.prototype.mapMode=Oe.TrackDel;class Mn{constructor(t,e,i){this.from=t,this.to=e,this.value=i}static create(t,e,i){return new Mn(t,e,i)}}function La(r,t){return r.from-t.from||r.value.startSide-t.value.startSide}class kl{constructor(t,e,i,s){this.from=t,this.to=e,this.value=i,this.maxPoint=s}get length(){return this.to[this.to.length-1]}findIndex(t,e,i,s=0){let n=i?this.to:this.from;for(let o=s,a=n.length;;){if(o==a)return o;let l=o+a>>1,h=n[l]-t||(i?this.value[l].endSide:this.value[l].startSide)-e;if(l==o)return h>=0?o:a;h>=0?a=l:o=l+1}}between(t,e,i,s){for(let n=this.findIndex(e,-1e9,!0),o=this.findIndex(i,1e9,!1,n);n<o;n++)if(s(this.from[n]+t,this.to[n]+t,this.value[n])===!1)return!1}map(t,e){let i=[],s=[],n=[],o=-1,a=-1;for(let l=0;l<this.value.length;l++){let h=this.value[l],c=this.from[l]+t,f=this.to[l]+t,p,m;if(c==f){let y=e.mapPos(c,h.startSide,h.mapMode);if(y==null||(p=m=y,h.startSide!=h.endSide&&(m=e.mapPos(c,h.endSide),m<p)))continue}else if(p=e.mapPos(c,h.startSide),m=e.mapPos(f,h.endSide),p>m||p==m&&h.startSide>0&&h.endSide<=0)continue;(m-p||h.endSide-h.startSide)<0||(o<0&&(o=p),h.point&&(a=Math.max(a,m-p)),i.push(h),s.push(p-o),n.push(m-o))}return{mapped:i.length?new kl(s,n,i,a):null,pos:o}}}class Mt{constructor(t,e,i,s){this.chunkPos=t,this.chunk=e,this.nextLayer=i,this.maxPoint=s}static create(t,e,i,s){return new Mt(t,e,i,s)}get length(){let t=this.chunk.length-1;return t<0?0:Math.max(this.chunkEnd(t),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let t=this.nextLayer.size;for(let e of this.chunk)t+=e.value.length;return t}chunkEnd(t){return this.chunkPos[t]+this.chunk[t].length}update(t){let{add:e=[],sort:i=!1,filterFrom:s=0,filterTo:n=this.length}=t,o=t.filter;if(e.length==0&&!o)return this;if(i&&(e=e.slice().sort(La)),this.isEmpty)return e.length?Mt.of(e):this;let a=new $f(this,null,-1).goto(0),l=0,h=[],c=new qr;for(;a.value||l<e.length;)if(l<e.length&&(a.from-e[l].from||a.startSide-e[l].value.startSide)>=0){let f=e[l++];c.addInner(f.from,f.to,f.value)||h.push(f)}else a.rangeIndex==1&&a.chunkIndex<this.chunk.length&&(l==e.length||this.chunkEnd(a.chunkIndex)<e[l].from)&&(!o||s>this.chunkEnd(a.chunkIndex)||n<this.chunkPos[a.chunkIndex])&&c.addChunk(this.chunkPos[a.chunkIndex],this.chunk[a.chunkIndex])?a.nextChunk():((!o||s>a.to||n<a.from||o(a.from,a.to,a.value))&&(c.addInner(a.from,a.to,a.value)||h.push(Mn.create(a.from,a.to,a.value))),a.next());return c.finishInner(this.nextLayer.isEmpty&&!h.length?Mt.empty:this.nextLayer.update({add:h,filter:o,filterFrom:s,filterTo:n}))}map(t){if(t.empty||this.isEmpty)return this;let e=[],i=[],s=-1;for(let o=0;o<this.chunk.length;o++){let a=this.chunkPos[o],l=this.chunk[o],h=t.touchesRange(a,a+l.length);if(h===!1)s=Math.max(s,l.maxPoint),e.push(l),i.push(t.mapPos(a));else if(h===!0){let{mapped:c,pos:f}=l.map(a,t);c&&(s=Math.max(s,c.maxPoint),e.push(c),i.push(f))}}let n=this.nextLayer.map(t);return e.length==0?n:new Mt(i,e,n||Mt.empty,s)}between(t,e,i){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let n=this.chunkPos[s],o=this.chunk[s];if(e>=n&&t<=n+o.length&&o.between(n,t-n,e-n,i)===!1)return}this.nextLayer.between(t,e,i)}}iter(t=0){return In.from([this]).goto(t)}get isEmpty(){return this.nextLayer==this}static iter(t,e=0){return In.from(t).goto(e)}static compare(t,e,i,s,n=-1){let o=t.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=n),a=e.filter(f=>f.maxPoint>0||!f.isEmpty&&f.maxPoint>=n),l=Wc(o,a,i),h=new un(o,l,n),c=new un(a,l,n);i.iterGaps((f,p,m)=>jc(h,f,c,p,m,s)),i.empty&&i.length==0&&jc(h,0,c,0,0,s)}static eq(t,e,i=0,s){s==null&&(s=1e9-1);let n=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0),o=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0);if(n.length!=o.length)return!1;if(!n.length)return!0;let a=Wc(n,o),l=new un(n,a,0).goto(i),h=new un(o,a,0).goto(i);for(;;){if(l.to!=h.to||!Na(l.active,h.active)||l.point&&(!h.point||!l.point.eq(h.point)))return!1;if(l.to>s)return!0;l.next(),h.next()}}static spans(t,e,i,s,n=-1){let o=new un(t,null,n).goto(e),a=e,l=o.openStart;for(;;){let h=Math.min(o.to,i);if(o.point){let c=o.activeForPoint(o.to),f=o.pointFrom<e?c.length+1:o.point.startSide<0?c.length:Math.min(c.length,l);s.point(a,h,o.point,c,f,o.pointRank),l=Math.min(o.openEnd(h),c.length)}else h>a&&(s.span(a,h,o.active,l),l=o.openEnd(h));if(o.to>i)return l+(o.point&&o.to>i?1:0);a=o.to,o.next()}}static of(t,e=!1){let i=new qr;for(let s of t instanceof Mn?[t]:e?Vy(t):t)i.add(s.from,s.to,s.value);return i.finish()}static join(t){if(!t.length)return Mt.empty;let e=t[t.length-1];for(let i=t.length-2;i>=0;i--)for(let s=t[i];s!=Mt.empty;s=s.nextLayer)e=new Mt(s.chunkPos,s.chunk,e,Math.max(s.maxPoint,e.maxPoint));return e}}Mt.empty=new Mt([],[],null,-1);function Vy(r){if(r.length>1)for(let t=r[0],e=1;e<r.length;e++){let i=r[e];if(La(t,i)>0)return r.slice().sort(La);t=i}return r}Mt.empty.nextLayer=Mt.empty;class qr{finishChunk(t){this.chunks.push(new kl(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,t&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(t,e,i){this.addInner(t,e,i)||(this.nextLayer||(this.nextLayer=new qr)).add(t,e,i)}addInner(t,e,i){let s=t-this.lastTo||i.startSide-this.last.endSide;if(s<=0&&(t-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return s<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=t),this.from.push(t-this.chunkStart),this.to.push(e-this.chunkStart),this.last=i,this.lastFrom=t,this.lastTo=e,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,e-t)),!0)}addChunk(t,e){if((t-this.lastTo||e.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,e.maxPoint),this.chunks.push(e),this.chunkPos.push(t);let i=e.value.length-1;return this.last=e.value[i],this.lastFrom=e.from[i]+t,this.lastTo=e.to[i]+t,!0}finish(){return this.finishInner(Mt.empty)}finishInner(t){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return t;let e=Mt.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(t):t,this.setMaxPoint);return this.from=null,e}}function Wc(r,t,e){let i=new Map;for(let n of r)for(let o=0;o<n.chunk.length;o++)n.chunk[o].maxPoint<=0&&i.set(n.chunk[o],n.chunkPos[o]);let s=new Set;for(let n of t)for(let o=0;o<n.chunk.length;o++){let a=i.get(n.chunk[o]);a!=null&&(e?e.mapPos(a):a)==n.chunkPos[o]&&!e?.touchesRange(a,a+n.chunk[o].length)&&s.add(n.chunk[o])}return s}class $f{constructor(t,e,i,s=0){this.layer=t,this.skip=e,this.minPoint=i,this.rank=s}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(t,e=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(t,e,!1),this}gotoInner(t,e,i){for(;this.chunkIndex<this.layer.chunk.length;){let s=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(s)||this.layer.chunkEnd(this.chunkIndex)<t||s.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(t-this.layer.chunkPos[this.chunkIndex],e,!0);(!i||this.rangeIndex<s)&&this.setRangeIndex(s)}this.next()}forward(t,e){(this.to-t||this.endSide-e)<0&&this.gotoInner(t,e,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let t=this.layer.chunkPos[this.chunkIndex],e=this.layer.chunk[this.chunkIndex],i=t+e.from[this.rangeIndex];if(this.from=i,this.to=t+e.to[this.rangeIndex],this.value=e.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(t){if(t==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=t}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(t){return this.from-t.from||this.startSide-t.startSide||this.rank-t.rank||this.to-t.to||this.endSide-t.endSide}}class In{constructor(t){this.heap=t}static from(t,e=null,i=-1){let s=[];for(let n=0;n<t.length;n++)for(let o=t[n];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&s.push(new $f(o,e,i,n));return s.length==1?s[0]:new In(s)}get startSide(){return this.value?this.value.startSide:0}goto(t,e=-1e9){for(let i of this.heap)i.goto(t,e);for(let i=this.heap.length>>1;i>=0;i--)ta(this.heap,i);return this.next(),this}forward(t,e){for(let i of this.heap)i.forward(t,e);for(let i=this.heap.length>>1;i>=0;i--)ta(this.heap,i);(this.to-t||this.value.endSide-e)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let t=this.heap[0];this.from=t.from,this.to=t.to,this.value=t.value,this.rank=t.rank,t.value&&t.next(),ta(this.heap,0)}}}function ta(r,t){for(let e=r[t];;){let i=(t<<1)+1;if(i>=r.length)break;let s=r[i];if(i+1<r.length&&s.compare(r[i+1])>=0&&(s=r[i+1],i++),e.compare(s)<0)break;r[i]=e,r[t]=s,t=i}}class un{constructor(t,e,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=In.from(t,e,i)}goto(t,e=-1e9){return this.cursor.goto(t,e),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=t,this.endSide=e,this.openStart=-1,this.next(),this}forward(t,e){for(;this.minActive>-1&&(this.activeTo[this.minActive]-t||this.active[this.minActive].endSide-e)<0;)this.removeActive(this.minActive);this.cursor.forward(t,e)}removeActive(t){dr(this.active,t),dr(this.activeTo,t),dr(this.activeRank,t),this.minActive=Hc(this.active,this.activeTo)}addActive(t){let e=0,{value:i,to:s,rank:n}=this.cursor;for(;e<this.activeRank.length&&(n-this.activeRank[e]||s-this.activeTo[e])>0;)e++;pr(this.active,e,i),pr(this.activeTo,e,s),pr(this.activeRank,e,n),t&&pr(t,e,this.cursor.from),this.minActive=Hc(this.active,this.activeTo)}next(){let t=this.to,e=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>t){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),i&&dr(i,s)}else if(this.cursor.value)if(this.cursor.from>t){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let n=this.cursor.value;if(!n.point)this.addActive(i),this.cursor.next();else if(e&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=n,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=n.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){this.openStart=0;for(let s=i.length-1;s>=0&&i[s]<t;s--)this.openStart++}}activeForPoint(t){if(!this.active.length)return this.active;let e=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>t||this.activeTo[i]==t&&this.active[i].endSide>=this.point.endSide)&&e.push(this.active[i]);return e.reverse()}openEnd(t){let e=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>t;i--)e++;return e}}function jc(r,t,e,i,s,n){r.goto(t),e.goto(i);let o=i+s,a=i,l=i-t;for(;;){let h=r.to+l-e.to||r.endSide-e.endSide,c=h<0?r.to+l:e.to,f=Math.min(c,o);if(r.point||e.point?r.point&&e.point&&(r.point==e.point||r.point.eq(e.point))&&Na(r.activeForPoint(r.to),e.activeForPoint(e.to))||n.comparePoint(a,f,r.point,e.point):f>a&&!Na(r.active,e.active)&&n.compareRange(a,f,r.active,e.active),c>o)break;a=c,h<=0&&r.next(),h>=0&&e.next()}}function Na(r,t){if(r.length!=t.length)return!1;for(let e=0;e<r.length;e++)if(r[e]!=t[e]&&!r[e].eq(t[e]))return!1;return!0}function dr(r,t){for(let e=t,i=r.length-1;e<i;e++)r[e]=r[e+1];r.pop()}function pr(r,t,e){for(let i=r.length-1;i>=t;i--)r[i+1]=r[i];r[t]=e}function Hc(r,t){let e=-1,i=1e9;for(let s=0;s<t.length;s++)(t[s]-i||r[s].endSide-r[e].endSide)<0&&(e=s,i=t[s]);return e}function qy(r,t,e,i){for(let s=0,n=0;;){if(n>=t)return s;if(s==r.length)break;n+=r.charCodeAt(s)==9?e-n%e:1,s=ki(r,s)}return i===!0?-1:r.length}const Ba="",Vc=typeof Symbol>"u"?"__"+Ba:Symbol.for(Ba),_a=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),qc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class Qi{constructor(t,e){this.rules=[];let{finish:i}=e||{};function s(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function n(o,a,l,h){let c=[],f=/^@(\w+)\b/.exec(o[0]),p=f&&f[1]=="keyframes";if(f&&a==null)return l.push(o[0]+";");for(let m in a){let y=a[m];if(/&/.test(m))n(m.split(/,\s*/).map(b=>o.map(S=>b.replace(/&/,S))).reduce((b,S)=>b.concat(S)),y,l);else if(y&&typeof y=="object"){if(!f)throw new RangeError("The value of a property ("+m+") should be a primitive value.");n(s(m),y,c,p)}else y!=null&&c.push(m.replace(/_.*/,"").replace(/[A-Z]/g,b=>"-"+b.toLowerCase())+": "+y+";")}(c.length||p)&&l.push((i&&!f&&!h?o.map(i):o).join(", ")+" {"+c.join(" ")+"}")}for(let o in t)n(s(o),t[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let t=qc[Vc]||1;return qc[Vc]=t+1,Ba+t.toString(36)}static mount(t,e,i){let s=t[_a],n=i&&i.nonce;s?n&&s.setNonce(n):s=new Ky(t,n),s.mount(Array.isArray(e)?e:[e],t)}}let Kc=new Map;class Ky{constructor(t,e){let i=t.ownerDocument||t,s=i.defaultView;if(!t.head&&t.adoptedStyleSheets&&s.CSSStyleSheet){let n=Kc.get(i);if(n)return t[_a]=n;this.sheet=new s.CSSStyleSheet,Kc.set(i,this)}else this.styleTag=i.createElement("style"),e&&this.styleTag.setAttribute("nonce",e);this.modules=[],t[_a]=this}mount(t,e){let i=this.sheet,s=0,n=0;for(let o=0;o<t.length;o++){let a=t[o],l=this.modules.indexOf(a);if(l<n&&l>-1&&(this.modules.splice(l,1),n--,l=-1),l==-1){if(this.modules.splice(n++,0,a),i)for(let h=0;h<a.rules.length;h++)i.insertRule(a.rules[h],s++)}else{for(;n<l;)s+=this.modules[n++].rules.length;s+=a.rules.length,n++}}if(i)e.adoptedStyleSheets.indexOf(this.sheet)<0&&(e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets]);else{let o="";for(let l=0;l<this.modules.length;l++)o+=this.modules[l].getRules()+`
`;this.styleTag.textContent=o;let a=e.head||e;this.styleTag.parentNode!=a&&a.insertBefore(this.styleTag,a.firstChild)}}setNonce(t){this.styleTag&&this.styleTag.getAttribute("nonce")!=t&&this.styleTag.setAttribute("nonce",t)}}var Gs={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},$a={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'};for(var se=0;se<10;se++)Gs[48+se]=Gs[96+se]=String(se);for(var se=1;se<=24;se++)Gs[se+111]="F"+se;for(var se=65;se<=90;se++)Gs[se]=String.fromCharCode(se+32),$a[se]=String.fromCharCode(se);for(var ea in Gs)$a.hasOwnProperty(ea)||($a[ea]=Gs[ea]);function En(r){let t;return r.nodeType==11?t=r.getSelection?r:r.ownerDocument:t=r,t.getSelection()}function Fa(r,t){return t?r==t||r.contains(t.nodeType!=1?t.parentNode:t):!1}function $r(r,t){if(!t.anchorNode)return!1;try{return Fa(r,t.anchorNode)}catch{return!1}}function Dn(r){return r.nodeType==3?bs(r,0,r.nodeValue.length).getClientRects():r.nodeType==1?r.getClientRects():[]}function Cn(r,t,e,i){return e?Gc(r,t,e,i,-1)||Gc(r,t,e,i,1):!1}function ys(r){for(var t=0;;t++)if(r=r.previousSibling,!r)return t}function Kr(r){return r.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(r.nodeName)}function Gc(r,t,e,i,s){for(;;){if(r==e&&t==i)return!0;if(t==(s<0?0:di(r))){if(r.nodeName=="DIV")return!1;let n=r.parentNode;if(!n||n.nodeType!=1)return!1;t=ys(r)+(s<0?0:1),r=n}else if(r.nodeType==1){if(r=r.childNodes[t+(s<0?-1:0)],r.nodeType==1&&r.contentEditable=="false")return!1;t=s<0?di(r):0}else return!1}}function di(r){return r.nodeType==3?r.nodeValue.length:r.childNodes.length}function po(r,t){let e=t?r.left:r.right;return{left:e,right:e,top:r.top,bottom:r.bottom}}function Gy(r){let t=r.visualViewport;return t?{left:0,right:t.width,top:0,bottom:t.height}:{left:0,right:r.innerWidth,top:0,bottom:r.innerHeight}}function Ff(r,t){let e=t.width/r.offsetWidth,i=t.height/r.offsetHeight;return(e>.995&&e<1.005||!isFinite(e)||Math.abs(t.width-r.offsetWidth)<1)&&(e=1),(i>.995&&i<1.005||!isFinite(i)||Math.abs(t.height-r.offsetHeight)<1)&&(i=1),{scaleX:e,scaleY:i}}function Yy(r,t,e,i,s,n,o,a){let l=r.ownerDocument,h=l.defaultView||window;for(let c=r,f=!1;c&&!f;)if(c.nodeType==1){let p,m=c==l.body,y=1,b=1;if(m)p=Gy(h);else{if(/^(fixed|sticky)$/.test(getComputedStyle(c).position)&&(f=!0),c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.assignedSlot||c.parentNode;continue}let L=c.getBoundingClientRect();({scaleX:y,scaleY:b}=Ff(c,L)),p={left:L.left,right:L.left+c.clientWidth*y,top:L.top,bottom:L.top+c.clientHeight*b}}let S=0,T=0;if(s=="nearest")t.top<p.top?(T=-(p.top-t.top+o),e>0&&t.bottom>p.bottom+T&&(T=t.bottom-p.bottom+T+o)):t.bottom>p.bottom&&(T=t.bottom-p.bottom+o,e<0&&t.top-T<p.top&&(T=-(p.top+T-t.top+o)));else{let L=t.bottom-t.top,B=p.bottom-p.top;T=(s=="center"&&L<=B?t.top+L/2-B/2:s=="start"||s=="center"&&e<0?t.top-o:t.bottom-B+o)-p.top}if(i=="nearest"?t.left<p.left?(S=-(p.left-t.left+n),e>0&&t.right>p.right+S&&(S=t.right-p.right+S+n)):t.right>p.right&&(S=t.right-p.right+n,e<0&&t.left<p.left+S&&(S=-(p.left+S-t.left+n))):S=(i=="center"?t.left+(t.right-t.left)/2-(p.right-p.left)/2:i=="start"==a?t.left-n:t.right-(p.right-p.left)+n)-p.left,S||T)if(m)h.scrollBy(S,T);else{let L=0,B=0;if(T){let N=c.scrollTop;c.scrollTop+=T/b,B=(c.scrollTop-N)*b}if(S){let N=c.scrollLeft;c.scrollLeft+=S/y,L=(c.scrollLeft-N)*y}t={left:t.left-L,top:t.top-B,right:t.right-L,bottom:t.bottom-B},L&&Math.abs(L-S)<1&&(i="nearest"),B&&Math.abs(B-T)<1&&(s="nearest")}if(m)break;c=c.assignedSlot||c.parentNode}else if(c.nodeType==11)c=c.host;else break}function Xy(r){let t=r.ownerDocument,e,i;for(let s=r.parentNode;s&&!(s==t.body||e&&i);)if(s.nodeType==1)!i&&s.scrollHeight>s.clientHeight&&(i=s),!e&&s.scrollWidth>s.clientWidth&&(e=s),s=s.assignedSlot||s.parentNode;else if(s.nodeType==11)s=s.host;else break;return{x:e,y:i}}class Qy{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(t){return this.anchorNode==t.anchorNode&&this.anchorOffset==t.anchorOffset&&this.focusNode==t.focusNode&&this.focusOffset==t.focusOffset}setRange(t){let{anchorNode:e,focusNode:i}=t;this.set(e,Math.min(t.anchorOffset,e?di(e):0),i,Math.min(t.focusOffset,i?di(i):0))}set(t,e,i,s){this.anchorNode=t,this.anchorOffset=e,this.focusNode=i,this.focusOffset=s}}let Bs=null;function zf(r){if(r.setActive)return r.setActive();if(Bs)return r.focus(Bs);let t=[];for(let e=r;e&&(t.push(e,e.scrollTop,e.scrollLeft),e!=e.ownerDocument);e=e.parentNode);if(r.focus(Bs==null?{get preventScroll(){return Bs={preventScroll:!0},!0}}:void 0),!Bs){Bs=!1;for(let e=0;e<t.length;){let i=t[e++],s=t[e++],n=t[e++];i.scrollTop!=s&&(i.scrollTop=s),i.scrollLeft!=n&&(i.scrollLeft=n)}}}let Yc;function bs(r,t,e=t){let i=Yc||(Yc=document.createRange());return i.setEnd(r,e),i.setStart(r,t),i}function Ws(r,t,e,i){let s={key:t,code:t,keyCode:e,which:e,cancelable:!0};i&&({altKey:s.altKey,ctrlKey:s.ctrlKey,shiftKey:s.shiftKey,metaKey:s.metaKey}=i);let n=new KeyboardEvent("keydown",s);n.synthetic=!0,r.dispatchEvent(n);let o=new KeyboardEvent("keyup",s);return o.synthetic=!0,r.dispatchEvent(o),n.defaultPrevented||o.defaultPrevented}function Zy(r){for(;r;){if(r&&(r.nodeType==9||r.nodeType==11&&r.host))return r;r=r.assignedSlot||r.parentNode}return null}function Uf(r){for(;r.attributes.length;)r.removeAttributeNode(r.attributes[0])}function Jy(r,t){let e=t.focusNode,i=t.focusOffset;if(!e||t.anchorNode!=e||t.anchorOffset!=i)return!1;for(i=Math.min(i,di(e));;)if(i){if(e.nodeType!=1)return!1;let s=e.childNodes[i-1];s.contentEditable=="false"?i--:(e=s,i=di(e))}else{if(e==r)return!0;i=ys(e),e=e.parentNode}}function Wf(r){return r.scrollTop>Math.max(1,r.scrollHeight-r.clientHeight-4)}function jf(r,t){for(let e=r,i=t;;){if(e.nodeType==3&&i>0)return{node:e,offset:i};if(e.nodeType==1&&i>0){if(e.contentEditable=="false")return null;e=e.childNodes[i-1],i=di(e)}else if(e.parentNode&&!Kr(e))i=ys(e),e=e.parentNode;else return null}}function Hf(r,t){for(let e=r,i=t;;){if(e.nodeType==3&&i<e.nodeValue.length)return{node:e,offset:i};if(e.nodeType==1&&i<e.childNodes.length){if(e.contentEditable=="false")return null;e=e.childNodes[i],i=0}else if(e.parentNode&&!Kr(e))i=ys(e)+1,e=e.parentNode;else return null}}class he{constructor(t,e,i=!0){this.node=t,this.offset=e,this.precise=i}static before(t,e){return new he(t.parentNode,ys(t),e)}static after(t,e){return new he(t.parentNode,ys(t)+1,e)}}const Cl=[];class Ct{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(t){let e=this.posAtStart;for(let i of this.children){if(i==t)return e;e+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(t){return this.posBefore(t)+t.length}sync(t,e){if(this.flags&2){let i=this.dom,s=null,n;for(let o of this.children){if(o.flags&7){if(!o.dom&&(n=s?s.nextSibling:i.firstChild)){let a=Ct.get(n);(!a||!a.parent&&a.canReuseDOM(o))&&o.reuseDOM(n)}o.sync(t,e),o.flags&=-8}if(n=s?s.nextSibling:i.firstChild,e&&!e.written&&e.node==i&&n!=o.dom&&(e.written=!0),o.dom.parentNode==i)for(;n&&n!=o.dom;)n=Xc(n);else i.insertBefore(o.dom,n);s=o.dom}for(n=s?s.nextSibling:i.firstChild,n&&e&&e.node==i&&(e.written=!0);n;)n=Xc(n)}else if(this.flags&1)for(let i of this.children)i.flags&7&&(i.sync(t,e),i.flags&=-8)}reuseDOM(t){}localPosFromDOM(t,e){let i;if(t==this.dom)i=this.dom.childNodes[e];else{let s=di(t)==0?0:e==0?-1:1;for(;;){let n=t.parentNode;if(n==this.dom)break;s==0&&n.firstChild!=n.lastChild&&(t==n.firstChild?s=-1:s=1),t=n}s<0?i=t:i=t.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Ct.get(i);)i=i.nextSibling;if(!i)return this.length;for(let s=0,n=0;;s++){let o=this.children[s];if(o.dom==i)return n;n+=o.length+o.breakAfter}}domBoundsAround(t,e,i=0){let s=-1,n=-1,o=-1,a=-1;for(let l=0,h=i,c=i;l<this.children.length;l++){let f=this.children[l],p=h+f.length;if(h<t&&p>e)return f.domBoundsAround(t,e,h);if(p>=t&&s==-1&&(s=l,n=h),h>e&&f.dom.parentNode==this.dom){o=l,a=c;break}c=p,h=p+f.breakAfter}return{from:n,to:a<0?i+this.length:a,startDOM:(s?this.children[s-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(t=!1){this.flags|=2,this.markParentsDirty(t)}markParentsDirty(t){for(let e=this.parent;e;e=e.parent){if(t&&(e.flags|=2),e.flags&1)return;e.flags|=1,t=!1}}setParent(t){this.parent!=t&&(this.parent=t,this.flags&7&&this.markParentsDirty(!0))}setDOM(t){this.dom!=t&&(this.dom&&(this.dom.cmView=null),this.dom=t,t.cmView=this)}get rootView(){for(let t=this;;){let e=t.parent;if(!e)return t;t=e}}replaceChildren(t,e,i=Cl){this.markDirty();for(let s=t;s<e;s++){let n=this.children[s];n.parent==this&&i.indexOf(n)<0&&n.destroy()}i.length<250?this.children.splice(t,e-t,...i):this.children=[].concat(this.children.slice(0,t),i,this.children.slice(e));for(let s=0;s<i.length;s++)i[s].setParent(this)}ignoreMutation(t){return!1}ignoreEvent(t){return!1}childCursor(t=this.length){return new Vf(this.children,t,this.children.length)}childPos(t,e=1){return this.childCursor().findPos(t,e)}toString(){let t=this.constructor.name.replace("View","");return t+(this.children.length?"("+this.children.join()+")":this.length?"["+(t=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(t){return t.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(t,e,i,s,n,o){return!1}become(t){return!1}canReuseDOM(t){return t.constructor==this.constructor&&!((this.flags|t.flags)&8)}getSide(){return 0}destroy(){for(let t of this.children)t.parent==this&&t.destroy();this.parent=null}}Ct.prototype.breakAfter=0;function Xc(r){let t=r.nextSibling;return r.parentNode.removeChild(r),t}class Vf{constructor(t,e,i){this.children=t,this.pos=e,this.i=i,this.off=0}findPos(t,e=1){for(;;){if(t>this.pos||t==this.pos&&(e>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=t-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function qf(r,t,e,i,s,n,o,a,l){let{children:h}=r,c=h.length?h[t]:null,f=n.length?n[n.length-1]:null,p=f?f.breakAfter:o;if(!(t==i&&c&&!o&&!p&&n.length<2&&c.merge(e,s,n.length?f:null,e==0,a,l))){if(i<h.length){let m=h[i];m&&(s<m.length||m.breakAfter&&f?.breakAfter)?(t==i&&(m=m.split(s),s=0),!p&&f&&m.merge(0,s,f,!0,0,l)?n[n.length-1]=m:((s||m.children.length&&!m.children[0].length)&&m.merge(0,s,null,!1,0,l),n.push(m))):m?.breakAfter&&(f?f.breakAfter=1:o=1),i++}for(c&&(c.breakAfter=o,e>0&&(!o&&n.length&&c.merge(e,c.length,n[0],!1,a,0)?c.breakAfter=n.shift().breakAfter:(e<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(e,c.length,null,!1,a,0),t++));t<i&&n.length;)if(h[i-1].become(n[n.length-1]))i--,n.pop(),l=n.length?0:a;else if(h[t].become(n[0]))t++,n.shift(),a=n.length?0:l;else break;!n.length&&t&&i<h.length&&!h[t-1].breakAfter&&h[i].merge(0,0,h[t-1],!1,a,l)&&t--,(t<i||n.length)&&r.replaceChildren(t,i,n)}}function Kf(r,t,e,i,s,n){let o=r.childCursor(),{i:a,off:l}=o.findPos(e,1),{i:h,off:c}=o.findPos(t,-1),f=t-e;for(let p of i)f+=p.length;r.length+=f,qf(r,h,c,a,l,i,0,s,n)}let ve=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},za=typeof document<"u"?document:{documentElement:{style:{}}};const Ua=/Edge\/(\d+)/.exec(ve.userAgent),Gf=/MSIE \d/.test(ve.userAgent),Wa=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(ve.userAgent),go=!!(Gf||Wa||Ua),Qc=!go&&/gecko\/(\d+)/i.test(ve.userAgent),ia=!go&&/Chrome\/(\d+)/.exec(ve.userAgent),Zc="webkitFontSmoothing"in za.documentElement.style,Yf=!go&&/Apple Computer/.test(ve.vendor),Jc=Yf&&(/Mobile\/\w+/.test(ve.userAgent)||ve.maxTouchPoints>2);var q={mac:Jc||/Mac/.test(ve.platform),windows:/Win/.test(ve.platform),linux:/Linux|X11/.test(ve.platform),ie:go,ie_version:Gf?za.documentMode||6:Wa?+Wa[1]:Ua?+Ua[1]:0,gecko:Qc,gecko_version:Qc?+(/Firefox\/(\d+)/.exec(ve.userAgent)||[0,0])[1]:0,chrome:!!ia,chrome_version:ia?+ia[1]:0,ios:Jc,android:/Android\b/.test(ve.userAgent),webkit:Zc,safari:Yf,webkit_version:Zc?+(/\bAppleWebKit\/(\d+)/.exec(ve.userAgent)||[0,0])[1]:0,tabSize:za.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const t1=256;class Qe extends Ct{constructor(t){super(),this.text=t}get length(){return this.text.length}createDOM(t){this.setDOM(t||document.createTextNode(this.text))}sync(t,e){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(e&&e.node==this.dom&&(e.written=!0),this.dom.nodeValue=this.text)}reuseDOM(t){t.nodeType==3&&this.createDOM(t)}merge(t,e,i){return this.flags&8||i&&(!(i instanceof Qe)||this.length-(e-t)+i.length>t1||i.flags&8)?!1:(this.text=this.text.slice(0,t)+(i?i.text:"")+this.text.slice(e),this.markDirty(),!0)}split(t){let e=new Qe(this.text.slice(t));return this.text=this.text.slice(0,t),this.markDirty(),e.flags|=this.flags&8,e}localPosFromDOM(t,e){return t==this.dom?e:e?this.text.length:0}domAtPos(t){return new he(this.dom,t)}domBoundsAround(t,e,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(t,e){return e1(this.dom,t,e)}}class Ri extends Ct{constructor(t,e=[],i=0){super(),this.mark=t,this.children=e,this.length=i;for(let s of e)s.setParent(this)}setAttrs(t){if(Uf(t),this.mark.class&&(t.className=this.mark.class),this.mark.attrs)for(let e in this.mark.attrs)t.setAttribute(e,this.mark.attrs[e]);return t}canReuseDOM(t){return super.canReuseDOM(t)&&!((this.flags|t.flags)&8)}reuseDOM(t){t.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(t),this.flags|=6)}sync(t,e){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(t,e)}merge(t,e,i,s,n,o){return i&&(!(i instanceof Ri&&i.mark.eq(this.mark))||t&&n<=0||e<this.length&&o<=0)?!1:(Kf(this,t,e,i?i.children.slice():[],n-1,o-1),this.markDirty(),!0)}split(t){let e=[],i=0,s=-1,n=0;for(let a of this.children){let l=i+a.length;l>t&&e.push(i<t?a.split(t-i):a),s<0&&i>=t&&(s=n),i=l,n++}let o=this.length-t;return this.length=t,s>-1&&(this.children.length=s,this.markDirty()),new Ri(this.mark,e,o)}domAtPos(t){return Xf(this,t)}coordsAt(t,e){return Zf(this,t,e)}}function e1(r,t,e){let i=r.nodeValue.length;t>i&&(t=i);let s=t,n=t,o=0;t==0&&e<0||t==i&&e>=0?q.chrome||q.gecko||(t?(s--,o=1):n<i&&(n++,o=-1)):e<0?s--:n<i&&n++;let a=bs(r,s,n).getClientRects();if(!a.length)return null;let l=a[(o?o<0:e>=0)?0:a.length-1];return q.safari&&!o&&l.width==0&&(l=Array.prototype.find.call(a,h=>h.width)||l),o?po(l,o<0):l||null}class fs extends Ct{static create(t,e,i){return new fs(t,e,i)}constructor(t,e,i){super(),this.widget=t,this.length=e,this.side=i,this.prevWidget=null}split(t){let e=fs.create(this.widget,this.length-t,this.side);return this.length-=t,e}sync(t){(!this.dom||!this.widget.updateDOM(this.dom,t))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(t)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(t,e,i,s,n,o){return i&&(!(i instanceof fs)||!this.widget.compare(i.widget)||t>0&&n<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}become(t){return t instanceof fs&&t.side==this.side&&this.widget.constructor==t.widget.constructor?(this.widget.compare(t.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get overrideDOMText(){if(this.length==0)return mt.empty;let t=this;for(;t.parent;)t=t.parent;let{view:e}=t,i=e&&e.state.doc,s=this.posAtStart;return i?i.slice(s,s+this.length):mt.empty}domAtPos(t){return(this.length?t==0:this.side>0)?he.before(this.dom):he.after(this.dom,t==this.length)}domBoundsAround(){return null}coordsAt(t,e){let i=this.widget.coordsAt(this.dom,t,e);if(i)return i;let s=this.dom.getClientRects(),n=null;if(!s.length)return null;let o=this.side?this.side<0:t>0;for(let a=o?s.length-1:0;n=s[a],!(t>0?a==0:a==s.length-1||n.top<n.bottom);a+=o?-1:1);return po(n,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Ys extends Ct{constructor(t){super(),this.side=t}get length(){return 0}merge(){return!1}become(t){return t instanceof Ys&&t.side==this.side}split(){return new Ys(this.side)}sync(){if(!this.dom){let t=document.createElement("img");t.className="cm-widgetBuffer",t.setAttribute("aria-hidden","true"),this.setDOM(t)}}getSide(){return this.side}domAtPos(t){return this.side>0?he.before(this.dom):he.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(t){return this.dom.getBoundingClientRect()}get overrideDOMText(){return mt.empty}get isHidden(){return!0}}Qe.prototype.children=fs.prototype.children=Ys.prototype.children=Cl;function Xf(r,t){let e=r.dom,{children:i}=r,s=0;for(let n=0;s<i.length;s++){let o=i[s],a=n+o.length;if(!(a==n&&o.getSide()<=0)){if(t>n&&t<a&&o.dom.parentNode==e)return o.domAtPos(t-n);if(t<=n)break;n=a}}for(let n=s;n>0;n--){let o=i[n-1];if(o.dom.parentNode==e)return o.domAtPos(o.length)}for(let n=s;n<i.length;n++){let o=i[n];if(o.dom.parentNode==e)return o.domAtPos(0)}return new he(e,0)}function Qf(r,t,e){let i,{children:s}=r;e>0&&t instanceof Ri&&s.length&&(i=s[s.length-1])instanceof Ri&&i.mark.eq(t.mark)?Qf(i,t.children[0],e-1):(s.push(t),t.setParent(r)),r.length+=t.length}function Zf(r,t,e){let i=null,s=-1,n=null,o=-1;function a(h,c){for(let f=0,p=0;f<h.children.length&&p<=c;f++){let m=h.children[f],y=p+m.length;y>=c&&(m.children.length?a(m,c-p):(!n||n.isHidden&&e>0)&&(y>c||p==y&&m.getSide()>0)?(n=m,o=c-p):(p<c||p==y&&m.getSide()<0&&!m.isHidden)&&(i=m,s=c-p)),p=y}}a(r,t);let l=(e<0?i:n)||i||n;return l?l.coordsAt(Math.max(0,l==i?s:o),e):i1(r)}function i1(r){let t=r.dom.lastChild;if(!t)return r.dom.getBoundingClientRect();let e=Dn(t);return e[e.length-1]||null}function ja(r,t){for(let e in r)e=="class"&&t.class?t.class+=" "+r.class:e=="style"&&t.style?t.style+=";"+r.style:t[e]=r[e];return t}const tu=Object.create(null);function Gr(r,t,e){if(r==t)return!0;r||(r=tu),t||(t=tu);let i=Object.keys(r),s=Object.keys(t);if(i.length-(e&&i.indexOf(e)>-1?1:0)!=s.length-(e&&s.indexOf(e)>-1?1:0))return!1;for(let n of i)if(n!=e&&(s.indexOf(n)==-1||r[n]!==t[n]))return!1;return!0}function Ha(r,t,e){let i=!1;if(t)for(let s in t)e&&s in e||(i=!0,s=="style"?r.style.cssText="":r.removeAttribute(s));if(e)for(let s in e)t&&t[s]==e[s]||(i=!0,s=="style"?r.style.cssText=e[s]:r.setAttribute(s,e[s]));return i}function s1(r){let t=Object.create(null);for(let e=0;e<r.attributes.length;e++){let i=r.attributes[e];t[i.name]=i.value}return t}class Ol{eq(t){return!1}updateDOM(t,e){return!1}compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(t){return!0}coordsAt(t,e,i){return null}get isHidden(){return!1}get editable(){return!1}destroy(t){}}var fi=function(r){return r[r.Text=0]="Text",r[r.WidgetBefore=1]="WidgetBefore",r[r.WidgetAfter=2]="WidgetAfter",r[r.WidgetRange=3]="WidgetRange",r}(fi||(fi={}));class ue extends Ks{constructor(t,e,i,s){super(),this.startSide=t,this.endSide=e,this.widget=i,this.spec=s}get heightRelevant(){return!1}static mark(t){return new Yn(t)}static widget(t){let e=Math.max(-1e4,Math.min(1e4,t.side||0)),i=!!t.block;return e+=i&&!t.inlineOrder?e>0?3e8:-4e8:e>0?1e8:-1e8,new Zi(t,e,e,i,t.widget||null,!1)}static replace(t){let e=!!t.block,i,s;if(t.isBlockGap)i=-5e8,s=4e8;else{let{start:n,end:o}=Jf(t,e);i=(n?e?-3e8:-1:5e8)-1,s=(o?e?2e8:1:-6e8)+1}return new Zi(t,i,s,e,t.widget||null,!0)}static line(t){return new Xn(t)}static set(t,e=!1){return Mt.of(t,e)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}ue.none=Mt.empty;class Yn extends ue{constructor(t){let{start:e,end:i}=Jf(t);super(e?-1:5e8,i?1:-6e8,null,t),this.tagName=t.tagName||"span",this.class=t.class||"",this.attrs=t.attributes||null}eq(t){var e,i;return this==t||t instanceof Yn&&this.tagName==t.tagName&&(this.class||((e=this.attrs)===null||e===void 0?void 0:e.class))==(t.class||((i=t.attrs)===null||i===void 0?void 0:i.class))&&Gr(this.attrs,t.attrs,"class")}range(t,e=t){if(t>=e)throw new RangeError("Mark decorations may not be empty");return super.range(t,e)}}Yn.prototype.point=!1;class Xn extends ue{constructor(t){super(-2e8,-2e8,null,t)}eq(t){return t instanceof Xn&&this.spec.class==t.spec.class&&Gr(this.spec.attributes,t.spec.attributes)}range(t,e=t){if(e!=t)throw new RangeError("Line decoration ranges must be zero-length");return super.range(t,e)}}Xn.prototype.mapMode=Oe.TrackBefore;Xn.prototype.point=!0;class Zi extends ue{constructor(t,e,i,s,n,o){super(e,i,n,t),this.block=s,this.isReplace=o,this.mapMode=s?e<=0?Oe.TrackBefore:Oe.TrackAfter:Oe.TrackDel}get type(){return this.startSide!=this.endSide?fi.WidgetRange:this.startSide<=0?fi.WidgetBefore:fi.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(t){return t instanceof Zi&&n1(this.widget,t.widget)&&this.block==t.block&&this.startSide==t.startSide&&this.endSide==t.endSide}range(t,e=t){if(this.isReplace&&(t>e||t==e&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&e!=t)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(t,e)}}Zi.prototype.point=!0;function Jf(r,t=!1){let{inclusiveStart:e,inclusiveEnd:i}=r;return e==null&&(e=r.inclusive),i==null&&(i=r.inclusive),{start:e??t,end:i??t}}function n1(r,t){return r==t||!!(r&&t&&r.compare(t))}function Va(r,t,e,i=0){let s=e.length-1;s>=0&&e[s]+i>=r?e[s]=Math.max(e[s],t):e.push(r,t)}class zt extends Ct{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(t,e,i,s,n,o){if(i){if(!(i instanceof zt))return!1;this.dom||i.transferDOM(this)}return s&&this.setDeco(i?i.attrs:null),Kf(this,t,e,i?i.children.slice():[],n,o),!0}split(t){let e=new zt;if(e.breakAfter=this.breakAfter,this.length==0)return e;let{i,off:s}=this.childPos(t);s&&(e.append(this.children[i].split(s),0),this.children[i].merge(s,this.children[i].length,null,!1,0,0),i++);for(let n=i;n<this.children.length;n++)e.append(this.children[n],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=t,e}transferDOM(t){this.dom&&(this.markDirty(),t.setDOM(this.dom),t.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(t){Gr(this.attrs,t)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=t)}append(t,e){Qf(this,t,e)}addLineDeco(t){let e=t.spec.attributes,i=t.spec.class;e&&(this.attrs=ja(e,this.attrs||{})),i&&(this.attrs=ja({class:i},this.attrs||{}))}domAtPos(t){return Xf(this,t)}reuseDOM(t){t.nodeName=="DIV"&&(this.setDOM(t),this.flags|=6)}sync(t,e){var i;this.dom?this.flags&4&&(Uf(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(Ha(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(t,e);let s=this.dom.lastChild;for(;s&&Ct.get(s)instanceof Ri;)s=s.lastChild;if(!s||!this.length||s.nodeName!="BR"&&((i=Ct.get(s))===null||i===void 0?void 0:i.isEditable)==!1&&(!q.ios||!this.children.some(n=>n instanceof Qe))){let n=document.createElement("BR");n.cmIgnore=!0,this.dom.appendChild(n)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let t=0,e;for(let i of this.children){if(!(i instanceof Qe)||/[^ -~]/.test(i.text))return null;let s=Dn(i.dom);if(s.length!=1)return null;t+=s[0].width,e=s[0].height}return t?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:t/this.length,textHeight:e}:null}coordsAt(t,e){let i=Zf(this,t,e);if(!this.children.length&&i&&this.parent){let{heightOracle:s}=this.parent.view.viewState,n=i.bottom-i.top;if(Math.abs(n-s.lineHeight)<2&&s.textHeight<n){let o=(n-s.textHeight)/2;return{top:i.top+o,bottom:i.bottom-o,left:i.left,right:i.left}}}return i}become(t){return t instanceof zt&&this.children.length==0&&t.children.length==0&&Gr(this.attrs,t.attrs)&&this.breakAfter==t.breakAfter}covers(){return!0}static find(t,e){for(let i=0,s=0;i<t.children.length;i++){let n=t.children[i],o=s+n.length;if(o>=e){if(n instanceof zt)return n;if(o>e)break}s=o+n.breakAfter}return null}}class Ai extends Ct{constructor(t,e,i){super(),this.widget=t,this.length=e,this.deco=i,this.breakAfter=0,this.prevWidget=null}merge(t,e,i,s,n,o){return i&&(!(i instanceof Ai)||!this.widget.compare(i.widget)||t>0&&n<=0||e<this.length&&o<=0)?!1:(this.length=t+(i?i.length:0)+(this.length-e),!0)}domAtPos(t){return t==0?he.before(this.dom):he.after(this.dom,t==this.length)}split(t){let e=this.length-t;this.length=t;let i=new Ai(this.widget,e,this.deco);return i.breakAfter=this.breakAfter,i}get children(){return Cl}sync(t){(!this.dom||!this.widget.updateDOM(this.dom,t))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(t)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):mt.empty}domBoundsAround(){return null}become(t){return t instanceof Ai&&t.widget.constructor==this.widget.constructor?(t.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=t.widget,this.length=t.length,this.deco=t.deco,this.breakAfter=t.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(t){return this.widget.ignoreEvent(t)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(t,e){let i=this.widget.coordsAt(this.dom,t,e);return i||(this.widget instanceof qa?null:po(this.dom.getBoundingClientRect(),this.length?t==0:e<=0))}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(t){let{startSide:e,endSide:i}=this.deco;return e==i?!1:t<0?e<0:i>0}}class qa extends Ol{constructor(t){super(),this.height=t}toDOM(){let t=document.createElement("div");return t.className="cm-gap",this.updateDOM(t),t}eq(t){return t.height==this.height}updateDOM(t){return t.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}class On{constructor(t,e,i,s){this.doc=t,this.pos=e,this.end=i,this.disallowBlockEffectsFor=s,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=t.iter(),this.skip=e}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let t=this.content[this.content.length-1];return!(t.breakAfter||t instanceof Ai&&t.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new zt),this.atCursorPos=!0),this.curLine}flushBuffer(t=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(gr(new Ys(-1),t),t.length),this.pendingBuffer=0)}addBlockWidget(t){this.flushBuffer(),this.curLine=null,this.content.push(t)}finish(t){this.pendingBuffer&&t<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(t&&this.content.length&&this.content[this.content.length-1]instanceof Ai)&&this.getLine()}buildText(t,e,i){for(;t>0;){if(this.textOff==this.text.length){let{value:n,lineBreak:o,done:a}=this.cursor.next(this.skip);if(this.skip=0,a)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,t--;continue}else this.text=n,this.textOff=0}let s=Math.min(this.text.length-this.textOff,t,512);this.flushBuffer(e.slice(e.length-i)),this.getLine().append(gr(new Qe(this.text.slice(this.textOff,this.textOff+s)),e),i),this.atCursorPos=!0,this.textOff+=s,t-=s,i=0}}span(t,e,i,s){this.buildText(e-t,i,s),this.pos=e,this.openStart<0&&(this.openStart=s)}point(t,e,i,s,n,o){if(this.disallowBlockEffectsFor[o]&&i instanceof Zi){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(e>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let a=e-t;if(i instanceof Zi)if(i.block)i.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new Ai(i.widget||Xs.block,a,i));else{let l=fs.create(i.widget||Xs.inline,a,a?0:i.startSide),h=this.atCursorPos&&!l.isEditable&&n<=s.length&&(t<e||i.startSide>0),c=!l.isEditable&&(t<e||n>s.length||i.startSide<=0),f=this.getLine();this.pendingBuffer==2&&!h&&!l.isEditable&&(this.pendingBuffer=0),this.flushBuffer(s),h&&(f.append(gr(new Ys(1),s),n),n=s.length+Math.max(0,n-s.length)),f.append(gr(l,s),n),this.atCursorPos=c,this.pendingBuffer=c?t<e||n>s.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=s.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);a&&(this.textOff+a<=this.text.length?this.textOff+=a:(this.skip+=a-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=e),this.openStart<0&&(this.openStart=n)}static build(t,e,i,s,n){let o=new On(t,e,i,n);return o.openEnd=Mt.spans(s,e,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function gr(r,t){for(let e of t)r=new Ri(e,[r],r.length);return r}class Xs extends Ol{constructor(t){super(),this.tag=t}eq(t){return t.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(t){return t.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}Xs.inline=new Xs("span");Xs.block=new Xs("div");var re=function(r){return r[r.LTR=0]="LTR",r[r.RTL=1]="RTL",r}(re||(re={}));const ws=re.LTR,Pl=re.RTL;function td(r){let t=[];for(let e=0;e<r.length;e++)t.push(1<<+r[e]);return t}const r1=td("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),o1=td("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),Ka=Object.create(null),ii=[];for(let r of["()","[]","{}"]){let t=r.charCodeAt(0),e=r.charCodeAt(1);Ka[t]=e,Ka[e]=-t}function ed(r){return r<=247?r1[r]:1424<=r&&r<=1524?2:1536<=r&&r<=1785?o1[r-1536]:1774<=r&&r<=2220?4:8192<=r&&r<=8204?256:64336<=r&&r<=65023?4:1}const a1=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class qi{get dir(){return this.level%2?Pl:ws}constructor(t,e,i){this.from=t,this.to=e,this.level=i}side(t,e){return this.dir==e==t?this.to:this.from}forward(t,e){return t==(this.dir==e)}static find(t,e,i,s){let n=-1;for(let o=0;o<t.length;o++){let a=t[o];if(a.from<=e&&a.to>=e){if(a.level==i)return o;(n<0||(s!=0?s<0?a.from<e:a.to>e:t[n].level>a.level))&&(n=o)}}if(n<0)throw new RangeError("Index out of range");return n}}function id(r,t){if(r.length!=t.length)return!1;for(let e=0;e<r.length;e++){let i=r[e],s=t[e];if(i.from!=s.from||i.to!=s.to||i.direction!=s.direction||!id(i.inner,s.inner))return!1}return!0}const kt=[];function l1(r,t,e,i,s){for(let n=0;n<=i.length;n++){let o=n?i[n-1].to:t,a=n<i.length?i[n].from:e,l=n?256:s;for(let h=o,c=l,f=l;h<a;h++){let p=ed(r.charCodeAt(h));p==512?p=c:p==8&&f==4&&(p=16),kt[h]=p==4?2:p,p&7&&(f=p),c=p}for(let h=o,c=l,f=l;h<a;h++){let p=kt[h];if(p==128)h<a-1&&c==kt[h+1]&&c&24?p=kt[h]=c:kt[h]=256;else if(p==64){let m=h+1;for(;m<a&&kt[m]==64;)m++;let y=h&&c==8||m<e&&kt[m]==8?f==1?1:8:256;for(let b=h;b<m;b++)kt[b]=y;h=m-1}else p==8&&f==1&&(kt[h]=1);c=p,p&7&&(f=p)}}}function h1(r,t,e,i,s){let n=s==1?2:1;for(let o=0,a=0,l=0;o<=i.length;o++){let h=o?i[o-1].to:t,c=o<i.length?i[o].from:e;for(let f=h,p,m,y;f<c;f++)if(m=Ka[p=r.charCodeAt(f)])if(m<0){for(let b=a-3;b>=0;b-=3)if(ii[b+1]==-m){let S=ii[b+2],T=S&2?s:S&4?S&1?n:s:0;T&&(kt[f]=kt[ii[b]]=T),a=b;break}}else{if(ii.length==189)break;ii[a++]=f,ii[a++]=p,ii[a++]=l}else if((y=kt[f])==2||y==1){let b=y==s;l=b?0:1;for(let S=a-3;S>=0;S-=3){let T=ii[S+2];if(T&2)break;if(b)ii[S+2]|=2;else{if(T&4)break;ii[S+2]|=4}}}}}function c1(r,t,e,i){for(let s=0,n=i;s<=e.length;s++){let o=s?e[s-1].to:r,a=s<e.length?e[s].from:t;for(let l=o;l<a;){let h=kt[l];if(h==256){let c=l+1;for(;;)if(c==a){if(s==e.length)break;c=e[s++].to,a=s<e.length?e[s].from:t}else if(kt[c]==256)c++;else break;let f=n==1,p=(c<t?kt[c]:i)==1,m=f==p?f?1:2:i;for(let y=c,b=s,S=b?e[b-1].to:r;y>l;)y==S&&(y=e[--b].from,S=b?e[b-1].to:r),kt[--y]=m;l=c}else n=h,l++}}}function Ga(r,t,e,i,s,n,o){let a=i%2?2:1;if(i%2==s%2)for(let l=t,h=0;l<e;){let c=!0,f=!1;if(h==n.length||l<n[h].from){let b=kt[l];b!=a&&(c=!1,f=b==16)}let p=!c&&a==1?[]:null,m=c?i:i+1,y=l;t:for(;;)if(h<n.length&&y==n[h].from){if(f)break t;let b=n[h];if(!c)for(let S=b.to,T=h+1;;){if(S==e)break t;if(T<n.length&&n[T].from==S)S=n[T++].to;else{if(kt[S]==a)break t;break}}if(h++,p)p.push(b);else{b.from>l&&o.push(new qi(l,b.from,m));let S=b.direction==ws!=!(m%2);Ya(r,S?i+1:i,s,b.inner,b.from,b.to,o),l=b.to}y=b.to}else{if(y==e||(c?kt[y]!=a:kt[y]==a))break;y++}p?Ga(r,l,y,i+1,s,p,o):l<y&&o.push(new qi(l,y,m)),l=y}else for(let l=e,h=n.length;l>t;){let c=!0,f=!1;if(!h||l>n[h-1].to){let b=kt[l-1];b!=a&&(c=!1,f=b==16)}let p=!c&&a==1?[]:null,m=c?i:i+1,y=l;t:for(;;)if(h&&y==n[h-1].to){if(f)break t;let b=n[--h];if(!c)for(let S=b.from,T=h;;){if(S==t)break t;if(T&&n[T-1].to==S)S=n[--T].from;else{if(kt[S-1]==a)break t;break}}if(p)p.push(b);else{b.to<l&&o.push(new qi(b.to,l,m));let S=b.direction==ws!=!(m%2);Ya(r,S?i+1:i,s,b.inner,b.from,b.to,o),l=b.from}y=b.from}else{if(y==t||(c?kt[y-1]!=a:kt[y-1]==a))break;y--}p?Ga(r,y,l,i+1,s,p,o):y<l&&o.push(new qi(y,l,m)),l=y}}function Ya(r,t,e,i,s,n,o){let a=t%2?2:1;l1(r,s,n,i,a),h1(r,s,n,i,a),c1(s,n,i,a),Ga(r,s,n,t,e,i,o)}function u1(r,t,e){if(!r)return[new qi(0,0,t==Pl?1:0)];if(t==ws&&!e.length&&!a1.test(r))return sd(r.length);if(e.length)for(;r.length>kt.length;)kt[kt.length]=256;let i=[],s=t==ws?0:1;return Ya(r,s,s,e,0,r.length,i),i}function sd(r){return[new qi(0,r,0)]}let nd="";function f1(r,t,e,i,s){var n;let o=i.head-r.from,a=qi.find(t,o,(n=i.bidiLevel)!==null&&n!==void 0?n:-1,i.assoc),l=t[a],h=l.side(s,e);if(o==h){let p=a+=s?1:-1;if(p<0||p>=t.length)return null;l=t[a=p],o=l.side(!s,e),h=l.side(s,e)}let c=ki(r.text,o,l.forward(s,e));(c<l.from||c>l.to)&&(c=h),nd=r.text.slice(Math.min(o,c),Math.max(o,c));let f=a==(s?t.length-1:0)?null:t[a+(s?1:-1)];return f&&c==h&&f.level+(s?0:1)<l.level?G.cursor(f.side(!s,e)+r.from,f.forward(s,e)?1:-1,f.level):G.cursor(c+r.from,l.forward(s,e)?-1:1,l.level)}function d1(r,t,e){for(let i=t;i<e;i++){let s=ed(r.charCodeAt(i));if(s==1)return ws;if(s==2||s==4)return Pl}return ws}const rd=st.define(),od=st.define(),ad=st.define(),ld=st.define(),Xa=st.define(),hd=st.define(),cd=st.define(),Tl=st.define(),Al=st.define(),ud=st.define({combine:r=>r.some(t=>t)}),p1=st.define({combine:r=>r.some(t=>t)}),fd=st.define();class js{constructor(t,e="nearest",i="nearest",s=5,n=5,o=!1){this.range=t,this.y=e,this.x=i,this.yMargin=s,this.xMargin=n,this.isSnapshot=o}map(t){return t.empty?this:new js(this.range.map(t),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(t){return this.range.to<=t.doc.length?this:new js(G.cursor(t.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const mr=Vt.define({map:(r,t)=>r.map(t)}),dd=Vt.define();function ci(r,t,e){let i=r.facet(ld);i.length?i[0](t):window.onerror?window.onerror(String(t),e,void 0,void 0,t):e?console.error(e+":",t):console.error(t)}const Wi=st.define({combine:r=>r.length?r[0]:!0});let g1=0;const gn=st.define();class Qs{constructor(t,e,i,s,n){this.id=t,this.create=e,this.domEventHandlers=i,this.domEventObservers=s,this.extension=n(this)}static define(t,e){const{eventHandlers:i,eventObservers:s,provide:n,decorations:o}=e||{};return new Qs(g1++,t,i,s,a=>{let l=[gn.of(a)];return o&&l.push(Ln.of(h=>{let c=h.plugin(a);return c?o(c):ue.none})),n&&l.push(n(a)),l})}static fromClass(t,e){return Qs.define(i=>new t(i),e)}}class sa{constructor(t){this.spec=t,this.mustUpdate=null,this.value=null}update(t){if(this.value){if(this.mustUpdate){let e=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(e)}catch(i){if(ci(e.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(t)}catch(e){ci(t.state,e,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(t){var e;if(!((e=this.value)===null||e===void 0)&&e.destroy)try{this.value.destroy()}catch(i){ci(t.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const pd=st.define(),Rl=st.define(),Ln=st.define(),gd=st.define(),Ml=st.define(),md=st.define();function eu(r,t){let e=r.state.facet(md);if(!e.length)return e;let i=e.map(n=>n instanceof Function?n(r):n),s=[];return Mt.spans(i,t.from,t.to,{point(){},span(n,o,a,l){let h=n-t.from,c=o-t.from,f=s;for(let p=a.length-1;p>=0;p--,l--){let m=a[p].spec.bidiIsolate,y;if(m==null&&(m=d1(t.text,h,c)),l>0&&f.length&&(y=f[f.length-1]).to==h&&y.direction==m)y.to=c,f=y.inner;else{let b={from:h,to:c,direction:m,inner:[]};f.push(b),f=b.inner}}}}),s}const vd=st.define();function yd(r){let t=0,e=0,i=0,s=0;for(let n of r.state.facet(vd)){let o=n(r);o&&(o.left!=null&&(t=Math.max(t,o.left)),o.right!=null&&(e=Math.max(e,o.right)),o.top!=null&&(i=Math.max(i,o.top)),o.bottom!=null&&(s=Math.max(s,o.bottom)))}return{left:t,right:e,top:i,bottom:s}}const mn=st.define();class $e{constructor(t,e,i,s){this.fromA=t,this.toA=e,this.fromB=i,this.toB=s}join(t){return new $e(Math.min(this.fromA,t.fromA),Math.max(this.toA,t.toA),Math.min(this.fromB,t.fromB),Math.max(this.toB,t.toB))}addToSet(t){let e=t.length,i=this;for(;e>0;e--){let s=t[e-1];if(!(s.fromA>i.toA)){if(s.toA<i.fromA)break;i=i.join(s),t.splice(e-1,1)}}return t.splice(e,0,i),t}static extendWithRanges(t,e){if(e.length==0)return t;let i=[];for(let s=0,n=0,o=0,a=0;;s++){let l=s==t.length?null:t[s],h=o-a,c=l?l.fromB:1e9;for(;n<e.length&&e[n]<c;){let f=e[n],p=e[n+1],m=Math.max(a,f),y=Math.min(c,p);if(m<=y&&new $e(m+h,y+h,m,y).addToSet(i),p>c)break;n+=2}if(!l)return i;new $e(l.fromA,l.toA,l.fromB,l.toB).addToSet(i),o=l.toA,a=l.toB}}}class Yr{constructor(t,e,i){this.view=t,this.state=e,this.transactions=i,this.flags=0,this.startState=t.state,this.changes=Yt.empty(this.startState.doc.length);for(let n of i)this.changes=this.changes.compose(n.changes);let s=[];this.changes.iterChangedRanges((n,o,a,l)=>s.push(new $e(n,o,a,l))),this.changedRanges=s}static create(t,e,i){return new Yr(t,e,i)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(t=>t.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class iu extends Ct{get length(){return this.view.state.doc.length}constructor(t){super(),this.view=t,this.decorations=[],this.dynamicDecorationMap=[!1],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.editContextFormatting=ue.none,this.lastCompositionAfterCursor=!1,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(t.contentDOM),this.children=[new zt],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new $e(0,0,0,t.state.doc.length)],0,null)}update(t){var e;let i=t.changedRanges;this.minWidth>0&&i.length&&(i.every(({fromA:h,toA:c})=>c<this.minWidthFrom||h>this.minWidthTo)?(this.minWidthFrom=t.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=t.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0),this.updateEditContextFormatting(t);let s=-1;this.view.inputState.composing>=0&&!this.view.observer.editContext&&(!((e=this.domChanged)===null||e===void 0)&&e.newSel?s=this.domChanged.newSel.head:!S1(t.changes,this.hasComposition)&&!t.selectionSet&&(s=t.state.selection.main.head));let n=s>-1?v1(this.view,t.changes,s):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:h,to:c}=this.hasComposition;i=new $e(h,c,t.changes.mapPos(h,-1),t.changes.mapPos(c,1)).addToSet(i.slice())}this.hasComposition=n?{from:n.range.fromB,to:n.range.toB}:null,(q.ie||q.chrome)&&!n&&t&&t.state.doc.lines!=t.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,a=this.updateDeco(),l=w1(o,a,t.changes);return i=$e.extendWithRanges(i,l),!(this.flags&7)&&i.length==0?!1:(this.updateInner(i,t.startState.doc.length,n),t.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(t,e,i){this.view.viewState.mustMeasureContent=!0,this.updateChildren(t,e,i);let{observer:s}=this.view;s.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=q.chrome||q.ios?{node:s.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,o),this.flags&=-8,o&&(o.written||s.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(o=>o.flags&=-9);let n=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof Ai&&o.widget instanceof qa&&n.push(o.dom);s.updateGaps(n)}updateChildren(t,e,i){let s=i?i.range.addToSet(t.slice()):t,n=this.childCursor(e);for(let o=s.length-1;;o--){let a=o>=0?s[o]:null;if(!a)break;let{fromA:l,toA:h,fromB:c,toB:f}=a,p,m,y,b;if(i&&i.range.fromB<f&&i.range.toB>c){let N=On.build(this.view.state.doc,c,i.range.fromB,this.decorations,this.dynamicDecorationMap),F=On.build(this.view.state.doc,i.range.toB,f,this.decorations,this.dynamicDecorationMap);m=N.breakAtStart,y=N.openStart,b=F.openEnd;let I=this.compositionView(i);F.breakAtStart?I.breakAfter=1:F.content.length&&I.merge(I.length,I.length,F.content[0],!1,F.openStart,0)&&(I.breakAfter=F.content[0].breakAfter,F.content.shift()),N.content.length&&I.merge(0,0,N.content[N.content.length-1],!0,0,N.openEnd)&&N.content.pop(),p=N.content.concat(I).concat(F.content)}else({content:p,breakAtStart:m,openStart:y,openEnd:b}=On.build(this.view.state.doc,c,f,this.decorations,this.dynamicDecorationMap));let{i:S,off:T}=n.findPos(h,1),{i:L,off:B}=n.findPos(l,-1);qf(this,L,B,S,T,p,m,y,b)}i&&this.fixCompositionDOM(i)}updateEditContextFormatting(t){this.editContextFormatting=this.editContextFormatting.map(t.changes);for(let e of t.transactions)for(let i of e.effects)i.is(dd)&&(this.editContextFormatting=i.value)}compositionView(t){let e=new Qe(t.text.nodeValue);e.flags|=8;for(let{deco:s}of t.marks)e=new Ri(s,[e],e.length);let i=new zt;return i.append(e,0),i}fixCompositionDOM(t){let e=(n,o)=>{o.flags|=8|(o.children.some(l=>l.flags&7)?1:0),this.markedForComposition.add(o);let a=Ct.get(n);a&&a!=o&&(a.dom=null),o.setDOM(n)},i=this.childPos(t.range.fromB,1),s=this.children[i.i];e(t.line,s);for(let n=t.marks.length-1;n>=-1;n--)i=s.childPos(i.off,1),s=s.children[i.i],e(n>=0?t.marks[n].node:t.text,s)}updateSelection(t=!1,e=!1){(t||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let i=this.view.root.activeElement,s=i==this.dom,n=!s&&$r(this.dom,this.view.observer.selectionRange)&&!(i&&this.dom.contains(i));if(!(s||e||n))return;let o=this.forceSelection;this.forceSelection=!1;let a=this.view.state.selection.main,l=this.moveToLine(this.domAtPos(a.anchor)),h=a.empty?l:this.moveToLine(this.domAtPos(a.head));if(q.gecko&&a.empty&&!this.hasComposition&&m1(l)){let f=document.createTextNode("");this.view.observer.ignore(()=>l.node.insertBefore(f,l.node.childNodes[l.offset]||null)),l=h=new he(f,0),o=!0}let c=this.view.observer.selectionRange;(o||!c.focusNode||(!Cn(l.node,l.offset,c.anchorNode,c.anchorOffset)||!Cn(h.node,h.offset,c.focusNode,c.focusOffset))&&!this.suppressWidgetCursorChange(c,a))&&(this.view.observer.ignore(()=>{q.android&&q.chrome&&this.dom.contains(c.focusNode)&&x1(c.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let f=En(this.view.root);if(f)if(a.empty){if(q.gecko){let p=y1(l.node,l.offset);if(p&&p!=3){let m=(p==1?jf:Hf)(l.node,l.offset);m&&(l=new he(m.node,m.offset))}}f.collapse(l.node,l.offset),a.bidiLevel!=null&&f.caretBidiLevel!==void 0&&(f.caretBidiLevel=a.bidiLevel)}else if(f.extend){f.collapse(l.node,l.offset);try{f.extend(h.node,h.offset)}catch{}}else{let p=document.createRange();a.anchor>a.head&&([l,h]=[h,l]),p.setEnd(h.node,h.offset),p.setStart(l.node,l.offset),f.removeAllRanges(),f.addRange(p)}n&&this.view.root.activeElement==this.dom&&(this.dom.blur(),i&&i.focus())}),this.view.observer.setSelectionRange(l,h)),this.impreciseAnchor=l.precise?null:new he(c.anchorNode,c.anchorOffset),this.impreciseHead=h.precise?null:new he(c.focusNode,c.focusOffset)}suppressWidgetCursorChange(t,e){return this.hasComposition&&e.empty&&Cn(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)&&this.posFromDOM(t.focusNode,t.focusOffset)==e.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:t}=this,e=t.state.selection.main,i=En(t.root),{anchorNode:s,anchorOffset:n}=t.observer.selectionRange;if(!i||!e.empty||!e.assoc||!i.modify)return;let o=zt.find(this,e.head);if(!o)return;let a=o.posAtStart;if(e.head==a||e.head==a+o.length)return;let l=this.coordsAt(e.head,-1),h=this.coordsAt(e.head,1);if(!l||!h||l.bottom>h.top)return;let c=this.domAtPos(e.head+e.assoc);i.collapse(c.node,c.offset),i.modify("move",e.assoc<0?"forward":"backward","lineboundary"),t.observer.readSelectionRange();let f=t.observer.selectionRange;t.docView.posFromDOM(f.anchorNode,f.anchorOffset)!=e.from&&i.collapse(s,n)}moveToLine(t){let e=this.dom,i;if(t.node!=e)return t;for(let s=t.offset;!i&&s<e.childNodes.length;s++){let n=Ct.get(e.childNodes[s]);n instanceof zt&&(i=n.domAtPos(0))}for(let s=t.offset-1;!i&&s>=0;s--){let n=Ct.get(e.childNodes[s]);n instanceof zt&&(i=n.domAtPos(n.length))}return i?new he(i.node,i.offset,!0):t}nearest(t){for(let e=t;e;){let i=Ct.get(e);if(i&&i.rootView==this)return i;e=e.parentNode}return null}posFromDOM(t,e){let i=this.nearest(t);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(t,e)+i.posAtStart}domAtPos(t){let{i:e,off:i}=this.childCursor().findPos(t,-1);for(;e<this.children.length-1;){let s=this.children[e];if(i<s.length||s instanceof zt)break;e++,i=0}return this.children[e].domAtPos(i)}coordsAt(t,e){let i=null,s=0;for(let n=this.length,o=this.children.length-1;o>=0;o--){let a=this.children[o],l=n-a.breakAfter,h=l-a.length;if(l<t)break;if(h<=t&&(h<t||a.covers(-1))&&(l>t||a.covers(1))&&(!i||a instanceof zt&&!(i instanceof zt&&e>=0)))i=a,s=h;else if(i&&h==t&&l==t&&a instanceof Ai&&Math.abs(e)<2){if(a.deco.startSide<0)break;o&&(i=null)}n=h}return i?i.coordsAt(t-s,e):null}coordsForChar(t){let{i:e,off:i}=this.childPos(t,1),s=this.children[e];if(!(s instanceof zt))return null;for(;s.children.length;){let{i:a,off:l}=s.childPos(i,1);for(;;a++){if(a==s.children.length)return null;if((s=s.children[a]).length)break}i=l}if(!(s instanceof Qe))return null;let n=ki(s.text,i);if(n==i)return null;let o=bs(s.dom,i,n).getClientRects();for(let a=0;a<o.length;a++){let l=o[a];if(a==o.length-1||l.top<l.bottom&&l.left<l.right)return l}return null}measureVisibleLineHeights(t){let e=[],{from:i,to:s}=t,n=this.view.contentDOM.clientWidth,o=n>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,a=-1,l=this.view.textDirection==re.LTR;for(let h=0,c=0;c<this.children.length;c++){let f=this.children[c],p=h+f.length;if(p>s)break;if(h>=i){let m=f.dom.getBoundingClientRect();if(e.push(m.height),o){let y=f.dom.lastChild,b=y?Dn(y):[];if(b.length){let S=b[b.length-1],T=l?S.right-m.left:m.right-S.left;T>a&&(a=T,this.minWidth=n,this.minWidthFrom=h,this.minWidthTo=p)}}}h=p+f.breakAfter}return e}textDirectionAt(t){let{i:e}=this.childPos(t,1);return getComputedStyle(this.children[e].dom).direction=="rtl"?re.RTL:re.LTR}measureTextSize(){for(let n of this.children)if(n instanceof zt){let o=n.measureTextSize();if(o)return o}let t=document.createElement("div"),e,i,s;return t.className="cm-line",t.style.width="99999px",t.style.position="absolute",t.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(t);let n=Dn(t.firstChild)[0];e=t.getBoundingClientRect().height,i=n?n.width/27:7,s=n?n.height:e,t.remove()}),{lineHeight:e,charWidth:i,textHeight:s}}childCursor(t=this.length){let e=this.children.length;return e&&(t-=this.children[--e].length),new Vf(this.children,t,e)}computeBlockGapDeco(){let t=[],e=this.view.viewState;for(let i=0,s=0;;s++){let n=s==e.viewports.length?null:e.viewports[s],o=n?n.from-1:this.length;if(o>i){let a=(e.lineBlockAt(o).bottom-e.lineBlockAt(i).top)/this.view.scaleY;t.push(ue.replace({widget:new qa(a),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!n)break;i=n.to+1}return ue.set(t)}updateDeco(){let t=1,e=this.view.state.facet(Ln).map(n=>(this.dynamicDecorationMap[t++]=typeof n=="function")?n(this.view):n),i=!1,s=this.view.state.facet(gd).map((n,o)=>{let a=typeof n=="function";return a&&(i=!0),a?n(this.view):n});for(s.length&&(this.dynamicDecorationMap[t++]=i,e.push(Mt.join(s))),this.decorations=[this.editContextFormatting,...e,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco];t<this.decorations.length;)this.dynamicDecorationMap[t++]=!1;return this.decorations}scrollIntoView(t){if(t.isSnapshot){let h=this.view.viewState.lineBlockAt(t.range.head);this.view.scrollDOM.scrollTop=h.top-t.yMargin,this.view.scrollDOM.scrollLeft=t.xMargin;return}for(let h of this.view.state.facet(fd))try{if(h(this.view,t.range,t))return!0}catch(c){ci(this.view.state,c,"scroll handler")}let{range:e}=t,i=this.coordsAt(e.head,e.empty?e.assoc:e.head>e.anchor?-1:1),s;if(!i)return;!e.empty&&(s=this.coordsAt(e.anchor,e.anchor>e.head?-1:1))&&(i={left:Math.min(i.left,s.left),top:Math.min(i.top,s.top),right:Math.max(i.right,s.right),bottom:Math.max(i.bottom,s.bottom)});let n=yd(this.view),o={left:i.left-n.left,top:i.top-n.top,right:i.right+n.right,bottom:i.bottom+n.bottom},{offsetWidth:a,offsetHeight:l}=this.view.scrollDOM;Yy(this.view.scrollDOM,o,e.head<e.anchor?-1:1,t.x,t.y,Math.max(Math.min(t.xMargin,a),-a),Math.max(Math.min(t.yMargin,l),-l),this.view.textDirection==re.LTR)}}function m1(r){return r.node.nodeType==1&&r.node.firstChild&&(r.offset==0||r.node.childNodes[r.offset-1].contentEditable=="false")&&(r.offset==r.node.childNodes.length||r.node.childNodes[r.offset].contentEditable=="false")}function bd(r,t){let e=r.observer.selectionRange;if(!e.focusNode)return null;let i=jf(e.focusNode,e.focusOffset),s=Hf(e.focusNode,e.focusOffset),n=i||s;if(s&&i&&s.node!=i.node){let a=Ct.get(s.node);if(!a||a instanceof Qe&&a.text!=s.node.nodeValue)n=s;else if(r.docView.lastCompositionAfterCursor){let l=Ct.get(i.node);!l||l instanceof Qe&&l.text!=i.node.nodeValue||(n=s)}}if(r.docView.lastCompositionAfterCursor=n!=i,!n)return null;let o=t-n.offset;return{from:o,to:o+n.node.nodeValue.length,node:n.node}}function v1(r,t,e){let i=bd(r,e);if(!i)return null;let{node:s,from:n,to:o}=i,a=s.nodeValue;if(/[\n\r]/.test(a)||r.state.doc.sliceString(i.from,i.to)!=a)return null;let l=t.invertedDesc,h=new $e(l.mapPos(n),l.mapPos(o),n,o),c=[];for(let f=s.parentNode;;f=f.parentNode){let p=Ct.get(f);if(p instanceof Ri)c.push({node:f,deco:p.mark});else{if(p instanceof zt||f.nodeName=="DIV"&&f.parentNode==r.contentDOM)return{range:h,text:s,marks:c,line:f};if(f!=r.contentDOM)c.push({node:f,deco:new Yn({inclusive:!0,attributes:s1(f),tagName:f.tagName.toLowerCase()})});else return null}}}function y1(r,t){return r.nodeType!=1?0:(t&&r.childNodes[t-1].contentEditable=="false"?1:0)|(t<r.childNodes.length&&r.childNodes[t].contentEditable=="false"?2:0)}let b1=class{constructor(){this.changes=[]}compareRange(t,e){Va(t,e,this.changes)}comparePoint(t,e){Va(t,e,this.changes)}};function w1(r,t,e){let i=new b1;return Mt.compare(r,t,e,i),i.changes}function x1(r,t){for(let e=r;e&&e!=t;e=e.assignedSlot||e.parentNode)if(e.nodeType==1&&e.contentEditable=="false")return!0;return!1}function S1(r,t){let e=!1;return t&&r.iterChangedRanges((i,s)=>{i<t.to&&s>t.from&&(e=!0)}),e}function k1(r,t,e=1){let i=r.charCategorizer(t),s=r.doc.lineAt(t),n=t-s.from;if(s.length==0)return G.cursor(t);n==0?e=1:n==s.length&&(e=-1);let o=n,a=n;e<0?o=ki(s.text,n,!1):a=ki(s.text,n);let l=i(s.text.slice(o,a));for(;o>0;){let h=ki(s.text,o,!1);if(i(s.text.slice(h,o))!=l)break;o=h}for(;a<s.length;){let h=ki(s.text,a);if(i(s.text.slice(a,h))!=l)break;a=h}return G.range(o+s.from,a+s.from)}function C1(r,t){return t.left>r?t.left-r:Math.max(0,r-t.right)}function O1(r,t){return t.top>r?t.top-r:Math.max(0,r-t.bottom)}function na(r,t){return r.top<t.bottom-1&&r.bottom>t.top+1}function su(r,t){return t<r.top?{top:t,left:r.left,right:r.right,bottom:r.bottom}:r}function nu(r,t){return t>r.bottom?{top:r.top,left:r.left,right:r.right,bottom:t}:r}function Qa(r,t,e){let i,s,n,o,a=!1,l,h,c,f;for(let y=r.firstChild;y;y=y.nextSibling){let b=Dn(y);for(let S=0;S<b.length;S++){let T=b[S];s&&na(s,T)&&(T=su(nu(T,s.bottom),s.top));let L=C1(t,T),B=O1(e,T);if(L==0&&B==0)return y.nodeType==3?ru(y,t,e):Qa(y,t,e);if(!i||o>B||o==B&&n>L){i=y,s=T,n=L,o=B;let N=B?e<T.top?-1:1:L?t<T.left?-1:1:0;a=!N||(N>0?S<b.length-1:S>0)}L==0?e>T.bottom&&(!c||c.bottom<T.bottom)?(l=y,c=T):e<T.top&&(!f||f.top>T.top)&&(h=y,f=T):c&&na(c,T)?c=nu(c,T.bottom):f&&na(f,T)&&(f=su(f,T.top))}}if(c&&c.bottom>=e?(i=l,s=c):f&&f.top<=e&&(i=h,s=f),!i)return{node:r,offset:0};let p=Math.max(s.left,Math.min(s.right,t));if(i.nodeType==3)return ru(i,p,e);if(a&&i.contentEditable!="false")return Qa(i,p,e);let m=Array.prototype.indexOf.call(r.childNodes,i)+(t>=(s.left+s.right)/2?1:0);return{node:r,offset:m}}function ru(r,t,e){let i=r.nodeValue.length,s=-1,n=1e9,o=0;for(let a=0;a<i;a++){let l=bs(r,a,a+1).getClientRects();for(let h=0;h<l.length;h++){let c=l[h];if(c.top==c.bottom)continue;o||(o=t-c.left);let f=(c.top>e?c.top-e:e-c.bottom)-1;if(c.left-1<=t&&c.right+1>=t&&f<n){let p=t>=(c.left+c.right)/2,m=p;if((q.chrome||q.gecko)&&bs(r,a).getBoundingClientRect().left==c.right&&(m=!p),f<=0)return{node:r,offset:a+(m?1:0)};s=a+(m?1:0),n=f}}}return{node:r,offset:s>-1?s:o>0?r.nodeValue.length:0}}function wd(r,t,e,i=-1){var s,n;let o=r.contentDOM.getBoundingClientRect(),a=o.top+r.viewState.paddingTop,l,{docHeight:h}=r.viewState,{x:c,y:f}=t,p=f-a;if(p<0)return 0;if(p>h)return r.state.doc.length;for(let N=r.viewState.heightOracle.textHeight/2,F=!1;l=r.elementAtHeight(p),l.type!=fi.Text;)for(;p=i>0?l.bottom+N:l.top-N,!(p>=0&&p<=h);){if(F)return e?null:0;F=!0,i=-i}f=a+p;let m=l.from;if(m<r.viewport.from)return r.viewport.from==0?0:e?null:ou(r,o,l,c,f);if(m>r.viewport.to)return r.viewport.to==r.state.doc.length?r.state.doc.length:e?null:ou(r,o,l,c,f);let y=r.dom.ownerDocument,b=r.root.elementFromPoint?r.root:y,S=b.elementFromPoint(c,f);S&&!r.contentDOM.contains(S)&&(S=null),S||(c=Math.max(o.left+1,Math.min(o.right-1,c)),S=b.elementFromPoint(c,f),S&&!r.contentDOM.contains(S)&&(S=null));let T,L=-1;if(S&&((s=r.docView.nearest(S))===null||s===void 0?void 0:s.isEditable)!=!1){if(y.caretPositionFromPoint){let N=y.caretPositionFromPoint(c,f);N&&({offsetNode:T,offset:L}=N)}else if(y.caretRangeFromPoint){let N=y.caretRangeFromPoint(c,f);N&&({startContainer:T,startOffset:L}=N,(!r.contentDOM.contains(T)||q.safari&&P1(T,L,c)||q.chrome&&T1(T,L,c))&&(T=void 0))}T&&(L=Math.min(di(T),L))}if(!T||!r.docView.dom.contains(T)){let N=zt.find(r.docView,m);if(!N)return p>l.top+l.height/2?l.to:l.from;({node:T,offset:L}=Qa(N.dom,c,f))}let B=r.docView.nearest(T);if(!B)return null;if(B.isWidget&&((n=B.dom)===null||n===void 0?void 0:n.nodeType)==1){let N=B.dom.getBoundingClientRect();return t.y<N.top||t.y<=N.bottom&&t.x<=(N.left+N.right)/2?B.posAtStart:B.posAtEnd}else return B.localPosFromDOM(T,L)+B.posAtStart}function ou(r,t,e,i,s){let n=Math.round((i-t.left)*r.defaultCharacterWidth);if(r.lineWrapping&&e.height>r.defaultLineHeight*1.5){let a=r.viewState.heightOracle.textHeight,l=Math.floor((s-e.top-(r.defaultLineHeight-a)*.5)/a);n+=l*r.viewState.heightOracle.lineLength}let o=r.state.sliceDoc(e.from,e.to);return e.from+qy(o,n,r.state.tabSize)}function P1(r,t,e){let i;if(r.nodeType!=3||t!=(i=r.nodeValue.length))return!1;for(let s=r.nextSibling;s;s=s.nextSibling)if(s.nodeType!=1||s.nodeName!="BR")return!1;return bs(r,i-1,i).getBoundingClientRect().left>e}function T1(r,t,e){if(t!=0)return!1;for(let s=r;;){let n=s.parentNode;if(!n||n.nodeType!=1||n.firstChild!=s)return!1;if(n.classList.contains("cm-line"))break;s=n}let i=r.nodeType==1?r.getBoundingClientRect():bs(r,0,Math.max(r.nodeValue.length,1)).getBoundingClientRect();return e-i.left>5}function A1(r,t){let e=r.lineBlockAt(t);if(Array.isArray(e.type)){for(let i of e.type)if(i.to>t||i.to==t&&(i.to==e.to||i.type==fi.Text))return i}return e}function R1(r,t,e,i){let s=A1(r,t.head),n=!i||s.type!=fi.Text||!(r.lineWrapping||s.widgetLineBreaks)?null:r.coordsAtPos(t.assoc<0&&t.head>s.from?t.head-1:t.head);if(n){let o=r.dom.getBoundingClientRect(),a=r.textDirectionAt(s.from),l=r.posAtCoords({x:e==(a==re.LTR)?o.right-1:o.left+1,y:(n.top+n.bottom)/2});if(l!=null)return G.cursor(l,e?-1:1)}return G.cursor(e?s.to:s.from,e?-1:1)}function au(r,t,e,i){let s=r.state.doc.lineAt(t.head),n=r.bidiSpans(s),o=r.textDirectionAt(s.from);for(let a=t,l=null;;){let h=f1(s,n,o,a,e),c=nd;if(!h){if(s.number==(e?r.state.doc.lines:1))return a;c=`
`,s=r.state.doc.line(s.number+(e?1:-1)),n=r.bidiSpans(s),h=r.visualLineSide(s,!e)}if(l){if(!l(c))return a}else{if(!i)return h;l=i(c)}a=h}}function M1(r,t,e){let i=r.state.charCategorizer(t),s=i(e);return n=>{let o=i(n);return s==Ci.Space&&(s=o),s==o}}function I1(r,t,e,i){let s=t.head,n=e?1:-1;if(s==(e?r.state.doc.length:0))return G.cursor(s,t.assoc);let o=t.goalColumn,a,l=r.contentDOM.getBoundingClientRect(),h=r.coordsAtPos(s,t.assoc||-1),c=r.documentTop;if(h)o==null&&(o=h.left-l.left),a=n<0?h.top:h.bottom;else{let m=r.viewState.lineBlockAt(s);o==null&&(o=Math.min(l.right-l.left,r.defaultCharacterWidth*(s-m.from))),a=(n<0?m.top:m.bottom)+c}let f=l.left+o,p=i??r.viewState.heightOracle.textHeight>>1;for(let m=0;;m+=10){let y=a+(p+m)*n,b=wd(r,{x:f,y},!1,n);if(y<l.top||y>l.bottom||(n<0?b<s:b>s)){let S=r.docView.coordsForChar(b),T=!S||y<S.top?-1:1;return G.cursor(b,T,void 0,o)}}}function Fr(r,t,e){for(;;){let i=0;for(let s of r)s.between(t-1,t+1,(n,o,a)=>{if(t>n&&t<o){let l=i||e||(t-n<o-t?-1:1);t=l<0?n:o,i=l}});if(!i)return t}}function ra(r,t,e){let i=Fr(r.state.facet(Ml).map(s=>s(r)),e.from,t.head>e.from?-1:1);return i==e.from?e:G.cursor(i,i<e.from?1:-1)}const vn="";class E1{constructor(t,e){this.points=t,this.text="",this.lineSeparator=e.facet(St.lineSeparator)}append(t){this.text+=t}lineBreak(){this.text+=vn}readRange(t,e){if(!t)return this;let i=t.parentNode;for(let s=t;;){this.findPointBefore(i,s);let n=this.text.length;this.readNode(s);let o=s.nextSibling;if(o==e)break;let a=Ct.get(s),l=Ct.get(o);(a&&l?a.breakAfter:(a?a.breakAfter:Kr(s))||Kr(o)&&(s.nodeName!="BR"||s.cmIgnore)&&this.text.length>n)&&this.lineBreak(),s=o}return this.findPointBefore(i,e),this}readTextNode(t){let e=t.nodeValue;for(let i of this.points)i.node==t&&(i.pos=this.text.length+Math.min(i.offset,e.length));for(let i=0,s=this.lineSeparator?null:/\r\n?|\n/g;;){let n=-1,o=1,a;if(this.lineSeparator?(n=e.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(a=s.exec(e))&&(n=a.index,o=a[0].length),this.append(e.slice(i,n<0?e.length:n)),n<0)break;if(this.lineBreak(),o>1)for(let l of this.points)l.node==t&&l.pos>this.text.length&&(l.pos-=o-1);i=n+o}}readNode(t){if(t.cmIgnore)return;let e=Ct.get(t),i=e&&e.overrideDOMText;if(i!=null){this.findPointInside(t,i.length);for(let s=i.iter();!s.next().done;)s.lineBreak?this.lineBreak():this.append(s.value)}else t.nodeType==3?this.readTextNode(t):t.nodeName=="BR"?t.nextSibling&&this.lineBreak():t.nodeType==1&&this.readRange(t.firstChild,null)}findPointBefore(t,e){for(let i of this.points)i.node==t&&t.childNodes[i.offset]==e&&(i.pos=this.text.length)}findPointInside(t,e){for(let i of this.points)(t.nodeType==3?i.node==t:t.contains(i.node))&&(i.pos=this.text.length+(D1(t,i.node,i.offset)?e:0))}}function D1(r,t,e){for(;;){if(!t||e<di(t))return!1;if(t==r)return!0;e=ys(t)+1,t=t.parentNode}}class lu{constructor(t,e){this.node=t,this.offset=e,this.pos=-1}}class L1{constructor(t,e,i,s){this.typeOver=s,this.bounds=null,this.text="",this.domChanged=e>-1;let{impreciseHead:n,impreciseAnchor:o}=t.docView;if(t.state.readOnly&&e>-1)this.newSel=null;else if(e>-1&&(this.bounds=t.docView.domBoundsAround(e,i,0))){let a=n||o?[]:_1(t),l=new E1(a,t.state);l.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=l.text,this.newSel=$1(a,this.bounds.from)}else{let a=t.observer.selectionRange,l=n&&n.node==a.focusNode&&n.offset==a.focusOffset||!Fa(t.contentDOM,a.focusNode)?t.state.selection.main.head:t.docView.posFromDOM(a.focusNode,a.focusOffset),h=o&&o.node==a.anchorNode&&o.offset==a.anchorOffset||!Fa(t.contentDOM,a.anchorNode)?t.state.selection.main.anchor:t.docView.posFromDOM(a.anchorNode,a.anchorOffset),c=t.viewport;if((q.ios||q.chrome)&&t.state.selection.main.empty&&l!=h&&(c.from>0||c.to<t.state.doc.length)){let f=Math.min(l,h),p=Math.max(l,h),m=c.from-f,y=c.to-p;(m==0||m==1||f==0)&&(y==0||y==-1||p==t.state.doc.length)&&(l=0,h=t.state.doc.length)}this.newSel=G.single(h,l)}}}function xd(r,t){let e,{newSel:i}=t,s=r.state.selection.main,n=r.inputState.lastKeyTime>Date.now()-100?r.inputState.lastKeyCode:-1;if(t.bounds){let{from:o,to:a}=t.bounds,l=s.from,h=null;(n===8||q.android&&t.text.length<a-o)&&(l=s.to,h="end");let c=B1(r.state.doc.sliceString(o,a,vn),t.text,l-o,h);c&&(q.chrome&&n==13&&c.toB==c.from+2&&t.text.slice(c.from,c.toB)==vn+vn&&c.toB--,e={from:o+c.from,to:o+c.toA,insert:mt.of(t.text.slice(c.from,c.toB).split(vn))})}else i&&(!r.hasFocus&&r.state.facet(Wi)||i.main.eq(s))&&(i=null);if(!e&&!i)return!1;if(!e&&t.typeOver&&!s.empty&&i&&i.main.empty?e={from:s.from,to:s.to,insert:r.state.doc.slice(s.from,s.to)}:e&&e.from>=s.from&&e.to<=s.to&&(e.from!=s.from||e.to!=s.to)&&s.to-s.from-(e.to-e.from)<=4?e={from:s.from,to:s.to,insert:r.state.doc.slice(s.from,e.from).append(e.insert).append(r.state.doc.slice(e.to,s.to))}:(q.mac||q.android)&&e&&e.from==e.to&&e.from==s.head-1&&/^\. ?$/.test(e.insert.toString())&&r.contentDOM.getAttribute("autocorrect")=="off"?(i&&e.insert.length==2&&(i=G.single(i.main.anchor-1,i.main.head-1)),e={from:s.from,to:s.to,insert:mt.of([" "])}):q.chrome&&e&&e.from==e.to&&e.from==s.head&&e.insert.toString()==`
 `&&r.lineWrapping&&(i&&(i=G.single(i.main.anchor-1,i.main.head-1)),e={from:s.from,to:s.to,insert:mt.of([" "])}),e)return Il(r,e,i,n);if(i&&!i.main.eq(s)){let o=!1,a="select";return r.inputState.lastSelectionTime>Date.now()-50&&(r.inputState.lastSelectionOrigin=="select"&&(o=!0),a=r.inputState.lastSelectionOrigin),r.dispatch({selection:i,scrollIntoView:o,userEvent:a}),!0}else return!1}function Il(r,t,e,i=-1){if(q.ios&&r.inputState.flushIOSKey(t))return!0;let s=r.state.selection.main;if(q.android&&(t.to==s.to&&(t.from==s.from||t.from==s.from-1&&r.state.sliceDoc(t.from,s.from)==" ")&&t.insert.length==1&&t.insert.lines==2&&Ws(r.contentDOM,"Enter",13)||(t.from==s.from-1&&t.to==s.to&&t.insert.length==0||i==8&&t.insert.length<t.to-t.from&&t.to>s.head)&&Ws(r.contentDOM,"Backspace",8)||t.from==s.from&&t.to==s.to+1&&t.insert.length==0&&Ws(r.contentDOM,"Delete",46)))return!0;let n=t.insert.toString();r.inputState.composing>=0&&r.inputState.composing++;let o,a=()=>o||(o=N1(r,t,e));return r.state.facet(hd).some(l=>l(r,t.from,t.to,n,a))||r.dispatch(a()),!0}function N1(r,t,e){let i,s=r.state,n=s.selection.main;if(t.from>=n.from&&t.to<=n.to&&t.to-t.from>=(n.to-n.from)/3&&(!e||e.main.empty&&e.main.from==t.from+t.insert.length)&&r.inputState.composing<0){let a=n.from<t.from?s.sliceDoc(n.from,t.from):"",l=n.to>t.to?s.sliceDoc(t.to,n.to):"";i=s.replaceSelection(r.state.toText(a+t.insert.sliceString(0,void 0,r.state.lineBreak)+l))}else{let a=s.changes(t),l=e&&e.main.to<=a.newLength?e.main:void 0;if(s.selection.ranges.length>1&&r.inputState.composing>=0&&t.to<=n.to&&t.to>=n.to-10){let h=r.state.sliceDoc(t.from,t.to),c,f=e&&bd(r,e.main.head);if(f){let y=t.insert.length-(t.to-t.from);c={from:f.from,to:f.to-y}}else c=r.state.doc.lineAt(n.head);let p=n.to-t.to,m=n.to-n.from;i=s.changeByRange(y=>{if(y.from==n.from&&y.to==n.to)return{changes:a,range:l||y.map(a)};let b=y.to-p,S=b-h.length;if(y.to-y.from!=m||r.state.sliceDoc(S,b)!=h||y.to>=c.from&&y.from<=c.to)return{range:y};let T=s.changes({from:S,to:b,insert:t.insert}),L=y.to-n.to;return{changes:T,range:l?G.range(Math.max(0,l.anchor+L),Math.max(0,l.head+L)):y.map(T)}})}else i={changes:a,selection:l&&s.selection.replaceRange(l)}}let o="input.type";return(r.composing||r.inputState.compositionPendingChange&&r.inputState.compositionEndedAt>Date.now()-50)&&(r.inputState.compositionPendingChange=!1,o+=".compose",r.inputState.compositionFirstChange&&(o+=".start",r.inputState.compositionFirstChange=!1)),s.update(i,{userEvent:o,scrollIntoView:!0})}function B1(r,t,e,i){let s=Math.min(r.length,t.length),n=0;for(;n<s&&r.charCodeAt(n)==t.charCodeAt(n);)n++;if(n==s&&r.length==t.length)return null;let o=r.length,a=t.length;for(;o>0&&a>0&&r.charCodeAt(o-1)==t.charCodeAt(a-1);)o--,a--;if(i=="end"){let l=Math.max(0,n-Math.min(o,a));e-=o+l-n}if(o<n&&r.length<t.length){let l=e<=n&&e>=o?n-e:0;n-=l,a=n+(a-o),o=n}else if(a<n){let l=e<=n&&e>=a?n-e:0;n-=l,o=n+(o-a),a=n}return{from:n,toA:o,toB:a}}function _1(r){let t=[];if(r.root.activeElement!=r.contentDOM)return t;let{anchorNode:e,anchorOffset:i,focusNode:s,focusOffset:n}=r.observer.selectionRange;return e&&(t.push(new lu(e,i)),(s!=e||n!=i)&&t.push(new lu(s,n))),t}function $1(r,t){if(r.length==0)return null;let e=r[0].pos,i=r.length==2?r[1].pos:e;return e>-1&&i>-1?G.single(e+t,i+t):null}class F1{setSelectionOrigin(t){this.lastSelectionOrigin=t,this.lastSelectionTime=Date.now()}constructor(t){this.view=t,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.tabFocusMode=-1,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=t.hasFocus,q.safari&&t.contentDOM.addEventListener("input",()=>null),q.gecko&&ib(t.contentDOM.ownerDocument)}handleEvent(t){!G1(this.view,t)||this.ignoreDuringComposition(t)||t.type=="keydown"&&this.keydown(t)||this.runHandlers(t.type,t)}runHandlers(t,e){let i=this.handlers[t];if(i){for(let s of i.observers)s(this.view,e);for(let s of i.handlers){if(e.defaultPrevented)break;if(s(this.view,e)){e.preventDefault();break}}}}ensureHandlers(t){let e=z1(t),i=this.handlers,s=this.view.contentDOM;for(let n in e)if(n!="scroll"){let o=!e[n].handlers.length,a=i[n];a&&o!=!a.handlers.length&&(s.removeEventListener(n,this.handleEvent),a=null),a||s.addEventListener(n,this.handleEvent,{passive:o})}for(let n in i)n!="scroll"&&!e[n]&&s.removeEventListener(n,this.handleEvent);this.handlers=e}keydown(t){if(this.lastKeyCode=t.keyCode,this.lastKeyTime=Date.now(),t.keyCode==9&&this.tabFocusMode>-1&&(!this.tabFocusMode||Date.now()<=this.tabFocusMode))return!0;if(this.tabFocusMode>0&&t.keyCode!=27&&W1.indexOf(t.keyCode)<0&&(this.tabFocusMode=-1),q.android&&q.chrome&&!t.synthetic&&(t.keyCode==13||t.keyCode==8))return this.view.observer.delayAndroidKey(t.key,t.keyCode),!0;let e;return q.ios&&!t.synthetic&&!t.altKey&&!t.metaKey&&((e=Sd.find(i=>i.keyCode==t.keyCode))&&!t.ctrlKey||U1.indexOf(t.key)>-1&&t.ctrlKey&&!t.shiftKey)?(this.pendingIOSKey=e||t,setTimeout(()=>this.flushIOSKey(),250),!0):(t.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(t){let e=this.pendingIOSKey;return!e||e.key=="Enter"&&t&&t.from<t.to&&/^\S+$/.test(t.insert.toString())?!1:(this.pendingIOSKey=void 0,Ws(this.view.contentDOM,e.key,e.keyCode,e instanceof KeyboardEvent?e:void 0))}ignoreDuringComposition(t){return/^key/.test(t.type)?this.composing>0?!0:q.safari&&!q.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(t){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=t}update(t){this.view.observer.update(t),this.mouseSelection&&this.mouseSelection.update(t),this.draggedContent&&t.docChanged&&(this.draggedContent=this.draggedContent.map(t.changes)),t.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function hu(r,t){return(e,i)=>{try{return t.call(r,i,e)}catch(s){ci(e.state,s)}}}function z1(r){let t=Object.create(null);function e(i){return t[i]||(t[i]={observers:[],handlers:[]})}for(let i of r){let s=i.spec;if(s&&s.domEventHandlers)for(let n in s.domEventHandlers){let o=s.domEventHandlers[n];o&&e(n).handlers.push(hu(i.value,o))}if(s&&s.domEventObservers)for(let n in s.domEventObservers){let o=s.domEventObservers[n];o&&e(n).observers.push(hu(i.value,o))}}for(let i in Ze)e(i).handlers.push(Ze[i]);for(let i in Fe)e(i).observers.push(Fe[i]);return t}const Sd=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],U1="dthko",W1=[16,17,18,20,91,92,224,225],vr=6;function yr(r){return Math.max(0,r)*.7+8}function j1(r,t){return Math.max(Math.abs(r.clientX-t.clientX),Math.abs(r.clientY-t.clientY))}class H1{constructor(t,e,i,s){this.view=t,this.startEvent=e,this.style=i,this.mustSelect=s,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=e,this.scrollParents=Xy(t.contentDOM),this.atoms=t.state.facet(Ml).map(o=>o(t));let n=t.contentDOM.ownerDocument;n.addEventListener("mousemove",this.move=this.move.bind(this)),n.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=e.shiftKey,this.multiple=t.state.facet(St.allowMultipleSelections)&&V1(t,e),this.dragging=K1(t,e)&&Od(e)==1?null:!1}start(t){this.dragging===!1&&this.select(t)}move(t){if(t.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&j1(this.startEvent,t)<10)return;this.select(this.lastEvent=t);let e=0,i=0,s=0,n=0,o=this.view.win.innerWidth,a=this.view.win.innerHeight;this.scrollParents.x&&({left:s,right:o}=this.scrollParents.x.getBoundingClientRect()),this.scrollParents.y&&({top:n,bottom:a}=this.scrollParents.y.getBoundingClientRect());let l=yd(this.view);t.clientX-l.left<=s+vr?e=-yr(s-t.clientX):t.clientX+l.right>=o-vr&&(e=yr(t.clientX-o)),t.clientY-l.top<=n+vr?i=-yr(n-t.clientY):t.clientY+l.bottom>=a-vr&&(i=yr(t.clientY-a)),this.setScrollSpeed(e,i)}up(t){this.dragging==null&&this.select(this.lastEvent),this.dragging||t.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let t=this.view.contentDOM.ownerDocument;t.removeEventListener("mousemove",this.move),t.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(t,e){this.scrollSpeed={x:t,y:e},t||e?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){let{x:t,y:e}=this.scrollSpeed;t&&this.scrollParents.x&&(this.scrollParents.x.scrollLeft+=t,t=0),e&&this.scrollParents.y&&(this.scrollParents.y.scrollTop+=e,e=0),(t||e)&&this.view.win.scrollBy(t,e),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(t){let e=null;for(let i=0;i<t.ranges.length;i++){let s=t.ranges[i],n=null;if(s.empty){let o=Fr(this.atoms,s.from,0);o!=s.from&&(n=G.cursor(o,-1))}else{let o=Fr(this.atoms,s.from,-1),a=Fr(this.atoms,s.to,1);(o!=s.from||a!=s.to)&&(n=G.range(s.from==s.anchor?o:a,s.from==s.head?o:a))}n&&(e||(e=t.ranges.slice()),e[i]=n)}return e?G.create(e,t.mainIndex):t}select(t){let{view:e}=this,i=this.skipAtoms(this.style.get(t,this.extend,this.multiple));(this.mustSelect||!i.eq(e.state.selection,this.dragging===!1))&&this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(t){t.transactions.some(e=>e.isUserEvent("input.type"))?this.destroy():this.style.update(t)&&setTimeout(()=>this.select(this.lastEvent),20)}}function V1(r,t){let e=r.state.facet(rd);return e.length?e[0](t):q.mac?t.metaKey:t.ctrlKey}function q1(r,t){let e=r.state.facet(od);return e.length?e[0](t):q.mac?!t.altKey:!t.ctrlKey}function K1(r,t){let{main:e}=r.state.selection;if(e.empty)return!1;let i=En(r.root);if(!i||i.rangeCount==0)return!0;let s=i.getRangeAt(0).getClientRects();for(let n=0;n<s.length;n++){let o=s[n];if(o.left<=t.clientX&&o.right>=t.clientX&&o.top<=t.clientY&&o.bottom>=t.clientY)return!0}return!1}function G1(r,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let e=t.target,i;e!=r.contentDOM;e=e.parentNode)if(!e||e.nodeType==11||(i=Ct.get(e))&&i.ignoreEvent(t))return!1;return!0}const Ze=Object.create(null),Fe=Object.create(null),kd=q.ie&&q.ie_version<15||q.ios&&q.webkit_version<604;function Y1(r){let t=r.dom.parentNode;if(!t)return;let e=t.appendChild(document.createElement("textarea"));e.style.cssText="position: fixed; left: -10000px; top: 10px",e.focus(),setTimeout(()=>{r.focus(),e.remove(),Cd(r,e.value)},50)}function mo(r,t,e){for(let i of r.facet(t))e=i(e,r);return e}function Cd(r,t){t=mo(r.state,Tl,t);let{state:e}=r,i,s=1,n=e.toText(t),o=n.lines==e.selection.ranges.length;if(Za!=null&&e.selection.ranges.every(l=>l.empty)&&Za==n.toString()){let l=-1;i=e.changeByRange(h=>{let c=e.doc.lineAt(h.from);if(c.from==l)return{range:h};l=c.from;let f=e.toText((o?n.line(s++).text:t)+e.lineBreak);return{changes:{from:c.from,insert:f},range:G.cursor(h.from+f.length)}})}else o?i=e.changeByRange(l=>{let h=n.line(s++);return{changes:{from:l.from,to:l.to,insert:h.text},range:G.cursor(l.from+h.length)}}):i=e.replaceSelection(n);r.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}Fe.scroll=r=>{r.inputState.lastScrollTop=r.scrollDOM.scrollTop,r.inputState.lastScrollLeft=r.scrollDOM.scrollLeft};Ze.keydown=(r,t)=>(r.inputState.setSelectionOrigin("select"),t.keyCode==27&&r.inputState.tabFocusMode!=0&&(r.inputState.tabFocusMode=Date.now()+2e3),!1);Fe.touchstart=(r,t)=>{r.inputState.lastTouchTime=Date.now(),r.inputState.setSelectionOrigin("select.pointer")};Fe.touchmove=r=>{r.inputState.setSelectionOrigin("select.pointer")};Ze.mousedown=(r,t)=>{if(r.observer.flush(),r.inputState.lastTouchTime>Date.now()-2e3)return!1;let e=null;for(let i of r.state.facet(ad))if(e=i(r,t),e)break;if(!e&&t.button==0&&(e=Z1(r,t)),e){let i=!r.hasFocus;r.inputState.startMouseSelection(new H1(r,t,e,i)),i&&r.observer.ignore(()=>{zf(r.contentDOM);let n=r.root.activeElement;n&&!n.contains(r.contentDOM)&&n.blur()});let s=r.inputState.mouseSelection;if(s)return s.start(t),s.dragging===!1}return!1};function cu(r,t,e,i){if(i==1)return G.cursor(t,e);if(i==2)return k1(r.state,t,e);{let s=zt.find(r.docView,t),n=r.state.doc.lineAt(s?s.posAtEnd:t),o=s?s.posAtStart:n.from,a=s?s.posAtEnd:n.to;return a<r.state.doc.length&&a==n.to&&a++,G.range(o,a)}}let uu=(r,t,e)=>t>=e.top&&t<=e.bottom&&r>=e.left&&r<=e.right;function X1(r,t,e,i){let s=zt.find(r.docView,t);if(!s)return 1;let n=t-s.posAtStart;if(n==0)return 1;if(n==s.length)return-1;let o=s.coordsAt(n,-1);if(o&&uu(e,i,o))return-1;let a=s.coordsAt(n,1);return a&&uu(e,i,a)?1:o&&o.bottom>=i?-1:1}function fu(r,t){let e=r.posAtCoords({x:t.clientX,y:t.clientY},!1);return{pos:e,bias:X1(r,e,t.clientX,t.clientY)}}const Q1=q.ie&&q.ie_version<=11;let du=null,pu=0,gu=0;function Od(r){if(!Q1)return r.detail;let t=du,e=gu;return du=r,gu=Date.now(),pu=!t||e>Date.now()-400&&Math.abs(t.clientX-r.clientX)<2&&Math.abs(t.clientY-r.clientY)<2?(pu+1)%3:1}function Z1(r,t){let e=fu(r,t),i=Od(t),s=r.state.selection;return{update(n){n.docChanged&&(e.pos=n.changes.mapPos(e.pos),s=s.map(n.changes))},get(n,o,a){let l=fu(r,n),h,c=cu(r,l.pos,l.bias,i);if(e.pos!=l.pos&&!o){let f=cu(r,e.pos,e.bias,i),p=Math.min(f.from,c.from),m=Math.max(f.to,c.to);c=p<c.from?G.range(p,m):G.range(m,p)}return o?s.replaceRange(s.main.extend(c.from,c.to)):a&&i==1&&s.ranges.length>1&&(h=J1(s,l.pos))?h:a?s.addRange(c):G.create([c])}}}function J1(r,t){for(let e=0;e<r.ranges.length;e++){let{from:i,to:s}=r.ranges[e];if(i<=t&&s>=t)return G.create(r.ranges.slice(0,e).concat(r.ranges.slice(e+1)),r.mainIndex==e?0:r.mainIndex-(r.mainIndex>e?1:0))}return null}Ze.dragstart=(r,t)=>{let{selection:{main:e}}=r.state;if(t.target.draggable){let s=r.docView.nearest(t.target);if(s&&s.isWidget){let n=s.posAtStart,o=n+s.length;(n>=e.to||o<=e.from)&&(e=G.range(n,o))}}let{inputState:i}=r;return i.mouseSelection&&(i.mouseSelection.dragging=!0),i.draggedContent=e,t.dataTransfer&&(t.dataTransfer.setData("Text",mo(r.state,Al,r.state.sliceDoc(e.from,e.to))),t.dataTransfer.effectAllowed="copyMove"),!1};Ze.dragend=r=>(r.inputState.draggedContent=null,!1);function mu(r,t,e,i){if(e=mo(r.state,Tl,e),!e)return;let s=r.posAtCoords({x:t.clientX,y:t.clientY},!1),{draggedContent:n}=r.inputState,o=i&&n&&q1(r,t)?{from:n.from,to:n.to}:null,a={from:s,insert:e},l=r.state.changes(o?[o,a]:a);r.focus(),r.dispatch({changes:l,selection:{anchor:l.mapPos(s,-1),head:l.mapPos(s,1)},userEvent:o?"move.drop":"input.drop"}),r.inputState.draggedContent=null}Ze.drop=(r,t)=>{if(!t.dataTransfer)return!1;if(r.state.readOnly)return!0;let e=t.dataTransfer.files;if(e&&e.length){let i=Array(e.length),s=0,n=()=>{++s==e.length&&mu(r,t,i.filter(o=>o!=null).join(r.state.lineBreak),!1)};for(let o=0;o<e.length;o++){let a=new FileReader;a.onerror=n,a.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(a.result)||(i[o]=a.result),n()},a.readAsText(e[o])}return!0}else{let i=t.dataTransfer.getData("Text");if(i)return mu(r,t,i,!0),!0}return!1};Ze.paste=(r,t)=>{if(r.state.readOnly)return!0;r.observer.flush();let e=kd?null:t.clipboardData;return e?(Cd(r,e.getData("text/plain")||e.getData("text/uri-list")),!0):(Y1(r),!1)};function tb(r,t){let e=r.dom.parentNode;if(!e)return;let i=e.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=t,i.focus(),i.selectionEnd=t.length,i.selectionStart=0,setTimeout(()=>{i.remove(),r.focus()},50)}function eb(r){let t=[],e=[],i=!1;for(let s of r.selection.ranges)s.empty||(t.push(r.sliceDoc(s.from,s.to)),e.push(s));if(!t.length){let s=-1;for(let{from:n}of r.selection.ranges){let o=r.doc.lineAt(n);o.number>s&&(t.push(o.text),e.push({from:o.from,to:Math.min(r.doc.length,o.to+1)})),s=o.number}i=!0}return{text:mo(r,Al,t.join(r.lineBreak)),ranges:e,linewise:i}}let Za=null;Ze.copy=Ze.cut=(r,t)=>{let{text:e,ranges:i,linewise:s}=eb(r.state);if(!e&&!s)return!1;Za=s?e:null,t.type=="cut"&&!r.state.readOnly&&r.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"});let n=kd?null:t.clipboardData;return n?(n.clearData(),n.setData("text/plain",e),!0):(tb(r,e),!1)};const Pd=rn.define();function Td(r,t){let e=[];for(let i of r.facet(cd)){let s=i(r,t);s&&e.push(s)}return e?r.update({effects:e,annotations:Pd.of(!0)}):null}function Ad(r){setTimeout(()=>{let t=r.hasFocus;if(t!=r.inputState.notifiedFocused){let e=Td(r.state,t);e?r.dispatch(e):r.update([])}},10)}Fe.focus=r=>{r.inputState.lastFocusTime=Date.now(),!r.scrollDOM.scrollTop&&(r.inputState.lastScrollTop||r.inputState.lastScrollLeft)&&(r.scrollDOM.scrollTop=r.inputState.lastScrollTop,r.scrollDOM.scrollLeft=r.inputState.lastScrollLeft),Ad(r)};Fe.blur=r=>{r.observer.clearSelectionRange(),Ad(r)};Fe.compositionstart=Fe.compositionupdate=r=>{r.observer.editContext||(r.inputState.compositionFirstChange==null&&(r.inputState.compositionFirstChange=!0),r.inputState.composing<0&&(r.inputState.composing=0))};Fe.compositionend=r=>{r.observer.editContext||(r.inputState.composing=-1,r.inputState.compositionEndedAt=Date.now(),r.inputState.compositionPendingKey=!0,r.inputState.compositionPendingChange=r.observer.pendingRecords().length>0,r.inputState.compositionFirstChange=null,q.chrome&&q.android?r.observer.flushSoon():r.inputState.compositionPendingChange?Promise.resolve().then(()=>r.observer.flush()):setTimeout(()=>{r.inputState.composing<0&&r.docView.hasComposition&&r.update([])},50))};Fe.contextmenu=r=>{r.inputState.lastContextMenu=Date.now()};Ze.beforeinput=(r,t)=>{var e,i;if(t.inputType=="insertReplacementText"&&r.observer.editContext){let n=(e=t.dataTransfer)===null||e===void 0?void 0:e.getData("text/plain"),o=t.getTargetRanges();if(n&&o.length){let a=o[0],l=r.posAtDOM(a.startContainer,a.startOffset),h=r.posAtDOM(a.endContainer,a.endOffset);return Il(r,{from:l,to:h,insert:r.state.toText(n)},null),!0}}let s;if(q.chrome&&q.android&&(s=Sd.find(n=>n.inputType==t.inputType))&&(r.observer.delayAndroidKey(s.key,s.keyCode),s.key=="Backspace"||s.key=="Delete")){let n=((i=window.visualViewport)===null||i===void 0?void 0:i.height)||0;setTimeout(()=>{var o;(((o=window.visualViewport)===null||o===void 0?void 0:o.height)||0)>n+10&&r.hasFocus&&(r.contentDOM.blur(),r.focus())},100)}return q.ios&&t.inputType=="deleteContentForward"&&r.observer.flushSoon(),q.safari&&t.inputType=="insertText"&&r.inputState.composing>=0&&setTimeout(()=>Fe.compositionend(r,t),20),!1};const vu=new Set;function ib(r){vu.has(r)||(vu.add(r),r.addEventListener("copy",()=>{}),r.addEventListener("cut",()=>{}))}const yu=["pre-wrap","normal","pre-line","break-spaces"];let Zs=!1;function bu(){Zs=!1}class sb{constructor(t){this.lineWrapping=t,this.doc=mt.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30}heightForGap(t,e){let i=this.doc.lineAt(e).number-this.doc.lineAt(t).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((e-t-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(t){return this.lineWrapping?(1+Math.max(0,Math.ceil((t-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(t){return this.doc=t,this}mustRefreshForWrapping(t){return yu.indexOf(t)>-1!=this.lineWrapping}mustRefreshForHeights(t){let e=!1;for(let i=0;i<t.length;i++){let s=t[i];s<0?i++:this.heightSamples[Math.floor(s*10)]||(e=!0,this.heightSamples[Math.floor(s*10)]=!0)}return e}refresh(t,e,i,s,n,o){let a=yu.indexOf(t)>-1,l=Math.round(e)!=Math.round(this.lineHeight)||this.lineWrapping!=a;if(this.lineWrapping=a,this.lineHeight=e,this.charWidth=i,this.textHeight=s,this.lineLength=n,l){this.heightSamples={};for(let h=0;h<o.length;h++){let c=o[h];c<0?h++:this.heightSamples[Math.floor(c*10)]=!0}}return l}}class nb{constructor(t,e){this.from=t,this.heights=e,this.index=0}get more(){return this.index<this.heights.length}}class ai{constructor(t,e,i,s,n){this.from=t,this.length=e,this.top=i,this.height=s,this._content=n}get type(){return typeof this._content=="number"?fi.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Zi?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(t){let e=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(t._content)?t._content:[t]);return new ai(this.from,this.length+t.length,this.top,this.height+t.height,e)}}var Rt=function(r){return r[r.ByPos=0]="ByPos",r[r.ByHeight=1]="ByHeight",r[r.ByPosNoHeight=2]="ByPosNoHeight",r}(Rt||(Rt={}));const zr=.001;class pe{constructor(t,e,i=2){this.length=t,this.height=e,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(t){this.flags=(t?2:0)|this.flags&-3}setHeight(t){this.height!=t&&(Math.abs(this.height-t)>zr&&(Zs=!0),this.height=t)}replace(t,e,i){return pe.of(i)}decomposeLeft(t,e){e.push(this)}decomposeRight(t,e){e.push(this)}applyChanges(t,e,i,s){let n=this,o=i.doc;for(let a=s.length-1;a>=0;a--){let{fromA:l,toA:h,fromB:c,toB:f}=s[a],p=n.lineAt(l,Rt.ByPosNoHeight,i.setDoc(e),0,0),m=p.to>=h?p:n.lineAt(h,Rt.ByPosNoHeight,i,0,0);for(f+=m.to-h,h=m.to;a>0&&p.from<=s[a-1].toA;)l=s[a-1].fromA,c=s[a-1].fromB,a--,l<p.from&&(p=n.lineAt(l,Rt.ByPosNoHeight,i,0,0));c+=p.from-l,l=p.from;let y=El.build(i.setDoc(o),t,c,f);n=Xr(n,n.replace(l,h,y))}return n.updateHeight(i,0)}static empty(){return new Ce(0,0)}static of(t){if(t.length==1)return t[0];let e=0,i=t.length,s=0,n=0;for(;;)if(e==i)if(s>n*2){let a=t[e-1];a.break?t.splice(--e,1,a.left,null,a.right):t.splice(--e,1,a.left,a.right),i+=1+a.break,s-=a.size}else if(n>s*2){let a=t[i];a.break?t.splice(i,1,a.left,null,a.right):t.splice(i,1,a.left,a.right),i+=2+a.break,n-=a.size}else break;else if(s<n){let a=t[e++];a&&(s+=a.size)}else{let a=t[--i];a&&(n+=a.size)}let o=0;return t[e-1]==null?(o=1,e--):t[e]==null&&(o=1,i++),new rb(pe.of(t.slice(0,e)),o,pe.of(t.slice(i)))}}function Xr(r,t){return r==t?r:(r.constructor!=t.constructor&&(Zs=!0),t)}pe.prototype.size=1;class Rd extends pe{constructor(t,e,i){super(t,e),this.deco=i}blockAt(t,e,i,s){return new ai(s,this.length,i,this.height,this.deco||0)}lineAt(t,e,i,s,n){return this.blockAt(0,i,s,n)}forEachLine(t,e,i,s,n,o){t<=n+this.length&&e>=n&&o(this.blockAt(0,i,s,n))}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more&&this.setHeight(s.heights[s.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class Ce extends Rd{constructor(t,e){super(t,e,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(t,e,i,s){return new ai(s,this.length,i,this.height,this.breaks)}replace(t,e,i){let s=i[0];return i.length==1&&(s instanceof Ce||s instanceof ie&&s.flags&4)&&Math.abs(this.length-s.length)<10?(s instanceof ie?s=new Ce(s.length,this.height):s.height=this.height,this.outdated||(s.outdated=!1),s):pe.of(i)}updateHeight(t,e=0,i=!1,s){return s&&s.from<=e&&s.more?this.setHeight(s.heights[s.index++]):(i||this.outdated)&&this.setHeight(Math.max(this.widgetHeight,t.heightForLine(this.length-this.collapsed))+this.breaks*t.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class ie extends pe{constructor(t){super(t,0)}heightMetrics(t,e){let i=t.doc.lineAt(e).number,s=t.doc.lineAt(e+this.length).number,n=s-i+1,o,a=0;if(t.lineWrapping){let l=Math.min(this.height,t.lineHeight*n);o=l/n,this.length>n+1&&(a=(this.height-l)/(this.length-n-1))}else o=this.height/n;return{firstLine:i,lastLine:s,perLine:o,perChar:a}}blockAt(t,e,i,s){let{firstLine:n,lastLine:o,perLine:a,perChar:l}=this.heightMetrics(e,s);if(e.lineWrapping){let h=s+(t<e.lineHeight?0:Math.round(Math.max(0,Math.min(1,(t-i)/this.height))*this.length)),c=e.doc.lineAt(h),f=a+c.length*l,p=Math.max(i,t-f/2);return new ai(c.from,c.length,p,f,0)}else{let h=Math.max(0,Math.min(o-n,Math.floor((t-i)/a))),{from:c,length:f}=e.doc.line(n+h);return new ai(c,f,i+a*h,a,0)}}lineAt(t,e,i,s,n){if(e==Rt.ByHeight)return this.blockAt(t,i,s,n);if(e==Rt.ByPosNoHeight){let{from:m,to:y}=i.doc.lineAt(t);return new ai(m,y-m,0,0,0)}let{firstLine:o,perLine:a,perChar:l}=this.heightMetrics(i,n),h=i.doc.lineAt(t),c=a+h.length*l,f=h.number-o,p=s+a*f+l*(h.from-n-f);return new ai(h.from,h.length,Math.max(s,Math.min(p,s+this.height-c)),c,0)}forEachLine(t,e,i,s,n,o){t=Math.max(t,n),e=Math.min(e,n+this.length);let{firstLine:a,perLine:l,perChar:h}=this.heightMetrics(i,n);for(let c=t,f=s;c<=e;){let p=i.doc.lineAt(c);if(c==t){let y=p.number-a;f+=l*y+h*(t-n-y)}let m=l+h*p.length;o(new ai(p.from,p.length,f,m,0)),f+=m,c=p.to+1}}replace(t,e,i){let s=this.length-e;if(s>0){let n=i[i.length-1];n instanceof ie?i[i.length-1]=new ie(n.length+s):i.push(null,new ie(s-1))}if(t>0){let n=i[0];n instanceof ie?i[0]=new ie(t+n.length):i.unshift(new ie(t-1),null)}return pe.of(i)}decomposeLeft(t,e){e.push(new ie(t-1),null)}decomposeRight(t,e){e.push(null,new ie(this.length-t-1))}updateHeight(t,e=0,i=!1,s){let n=e+this.length;if(s&&s.from<=e+this.length&&s.more){let o=[],a=Math.max(e,s.from),l=-1;for(s.from>e&&o.push(new ie(s.from-e-1).updateHeight(t,e));a<=n&&s.more;){let c=t.doc.lineAt(a).length;o.length&&o.push(null);let f=s.heights[s.index++];l==-1?l=f:Math.abs(f-l)>=zr&&(l=-2);let p=new Ce(c,f);p.outdated=!1,o.push(p),a+=c+1}a<=n&&o.push(null,new ie(n-a).updateHeight(t,a));let h=pe.of(o);return(l<0||Math.abs(h.height-this.height)>=zr||Math.abs(l-this.heightMetrics(t,e).perLine)>=zr)&&(Zs=!0),Xr(this,h)}else(i||this.outdated)&&(this.setHeight(t.heightForGap(e,e+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class rb extends pe{constructor(t,e,i){super(t.length+e+i.length,t.height+i.height,e|(t.outdated||i.outdated?2:0)),this.left=t,this.right=i,this.size=t.size+i.size}get break(){return this.flags&1}blockAt(t,e,i,s){let n=i+this.left.height;return t<n?this.left.blockAt(t,e,i,s):this.right.blockAt(t,e,n,s+this.left.length+this.break)}lineAt(t,e,i,s,n){let o=s+this.left.height,a=n+this.left.length+this.break,l=e==Rt.ByHeight?t<o:t<a,h=l?this.left.lineAt(t,e,i,s,n):this.right.lineAt(t,e,i,o,a);if(this.break||(l?h.to<a:h.from>a))return h;let c=e==Rt.ByPosNoHeight?Rt.ByPosNoHeight:Rt.ByPos;return l?h.join(this.right.lineAt(a,c,i,o,a)):this.left.lineAt(a,c,i,s,n).join(h)}forEachLine(t,e,i,s,n,o){let a=s+this.left.height,l=n+this.left.length+this.break;if(this.break)t<l&&this.left.forEachLine(t,e,i,s,n,o),e>=l&&this.right.forEachLine(t,e,i,a,l,o);else{let h=this.lineAt(l,Rt.ByPos,i,s,n);t<h.from&&this.left.forEachLine(t,h.from-1,i,s,n,o),h.to>=t&&h.from<=e&&o(h),e>h.to&&this.right.forEachLine(h.to+1,e,i,a,l,o)}}replace(t,e,i){let s=this.left.length+this.break;if(e<s)return this.balanced(this.left.replace(t,e,i),this.right);if(t>this.left.length)return this.balanced(this.left,this.right.replace(t-s,e-s,i));let n=[];t>0&&this.decomposeLeft(t,n);let o=n.length;for(let a of i)n.push(a);if(t>0&&wu(n,o-1),e<this.length){let a=n.length;this.decomposeRight(e,n),wu(n,a)}return pe.of(n)}decomposeLeft(t,e){let i=this.left.length;if(t<=i)return this.left.decomposeLeft(t,e);e.push(this.left),this.break&&(i++,t>=i&&e.push(null)),t>i&&this.right.decomposeLeft(t-i,e)}decomposeRight(t,e){let i=this.left.length,s=i+this.break;if(t>=s)return this.right.decomposeRight(t-s,e);t<i&&this.left.decomposeRight(t,e),this.break&&t<s&&e.push(null),e.push(this.right)}balanced(t,e){return t.size>2*e.size||e.size>2*t.size?pe.of(this.break?[t,null,e]:[t,e]):(this.left=Xr(this.left,t),this.right=Xr(this.right,e),this.setHeight(t.height+e.height),this.outdated=t.outdated||e.outdated,this.size=t.size+e.size,this.length=t.length+this.break+e.length,this)}updateHeight(t,e=0,i=!1,s){let{left:n,right:o}=this,a=e+n.length+this.break,l=null;return s&&s.from<=e+n.length&&s.more?l=n=n.updateHeight(t,e,i,s):n.updateHeight(t,e,i),s&&s.from<=a+o.length&&s.more?l=o=o.updateHeight(t,a,i,s):o.updateHeight(t,a,i),l?this.balanced(n,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function wu(r,t){let e,i;r[t]==null&&(e=r[t-1])instanceof ie&&(i=r[t+1])instanceof ie&&r.splice(t-1,3,new ie(e.length+1+i.length))}const ob=5;class El{constructor(t,e){this.pos=t,this.oracle=e,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=t}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(t,e){if(this.lineStart>-1){let i=Math.min(e,this.lineEnd),s=this.nodes[this.nodes.length-1];s instanceof Ce?s.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new Ce(i-this.pos,-1)),this.writtenTo=i,e>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=e}point(t,e,i){if(t<e||i.heightRelevant){let s=i.widget?i.widget.estimatedHeight:0,n=i.widget?i.widget.lineBreaks:0;s<0&&(s=this.oracle.lineHeight);let o=e-t;i.block?this.addBlock(new Rd(o,s,i)):(o||n||s>=ob)&&this.addLineDeco(s,n,o)}else e>t&&this.span(t,e);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:t,to:e}=this.oracle.doc.lineAt(this.pos);this.lineStart=t,this.lineEnd=e,this.writtenTo<t&&((this.writtenTo<t-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,t-1)),this.nodes.push(null)),this.pos>t&&this.nodes.push(new Ce(this.pos-t,-1)),this.writtenTo=this.pos}blankContent(t,e){let i=new ie(e-t);return this.oracle.doc.lineAt(t).to==e&&(i.flags|=4),i}ensureLine(){this.enterLine();let t=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(t instanceof Ce)return t;let e=new Ce(0,-1);return this.nodes.push(e),e}addBlock(t){this.enterLine();let e=t.deco;e&&e.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(t),this.writtenTo=this.pos=this.pos+t.length,e&&e.endSide>0&&(this.covering=t)}addLineDeco(t,e,i){let s=this.ensureLine();s.length+=i,s.collapsed+=i,s.widgetHeight=Math.max(s.widgetHeight,t),s.breaks+=e,this.writtenTo=this.pos=this.pos+i}finish(t){let e=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(e instanceof Ce)&&!this.isCovered?this.nodes.push(new Ce(0,-1)):(this.writtenTo<this.pos||e==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=t;for(let s of this.nodes)s instanceof Ce&&s.updateHeight(this.oracle,i),i+=s?s.length:1;return this.nodes}static build(t,e,i,s){let n=new El(i,t);return Mt.spans(e,i,s,n,0),n.finish(i)}}function ab(r,t,e){let i=new lb;return Mt.compare(r,t,e,i,0),i.changes}class lb{constructor(){this.changes=[]}compareRange(){}comparePoint(t,e,i,s){(t<e||i&&i.heightRelevant||s&&s.heightRelevant)&&Va(t,e,this.changes,5)}}function hb(r,t){let e=r.getBoundingClientRect(),i=r.ownerDocument,s=i.defaultView||window,n=Math.max(0,e.left),o=Math.min(s.innerWidth,e.right),a=Math.max(0,e.top),l=Math.min(s.innerHeight,e.bottom);for(let h=r.parentNode;h&&h!=i.body;)if(h.nodeType==1){let c=h,f=window.getComputedStyle(c);if((c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth)&&f.overflow!="visible"){let p=c.getBoundingClientRect();n=Math.max(n,p.left),o=Math.min(o,p.right),a=Math.max(a,p.top),l=Math.min(h==r.parentNode?s.innerHeight:l,p.bottom)}h=f.position=="absolute"||f.position=="fixed"?c.offsetParent:c.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:n-e.left,right:Math.max(n,o)-e.left,top:a-(e.top+t),bottom:Math.max(a,l)-(e.top+t)}}function cb(r,t){let e=r.getBoundingClientRect();return{left:0,right:e.right-e.left,top:t,bottom:e.bottom-(e.top+t)}}class oa{constructor(t,e,i,s){this.from=t,this.to=e,this.size=i,this.displaySize=s}static same(t,e){if(t.length!=e.length)return!1;for(let i=0;i<t.length;i++){let s=t[i],n=e[i];if(s.from!=n.from||s.to!=n.to||s.size!=n.size)return!1}return!0}draw(t,e){return ue.replace({widget:new ub(this.displaySize*(e?t.scaleY:t.scaleX),e)}).range(this.from,this.to)}}class ub extends Ol{constructor(t,e){super(),this.size=t,this.vertical=e}eq(t){return t.size==this.size&&t.vertical==this.vertical}toDOM(){let t=document.createElement("div");return this.vertical?t.style.height=this.size+"px":(t.style.width=this.size+"px",t.style.height="2px",t.style.display="inline-block"),t}get estimatedHeight(){return this.vertical?this.size:-1}}class xu{constructor(t){this.state=t,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!1,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=Su,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=re.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let e=t.facet(Rl).some(i=>typeof i!="function"&&i.class=="cm-lineWrapping");this.heightOracle=new sb(e),this.stateDeco=t.facet(Ln).filter(i=>typeof i!="function"),this.heightMap=pe.empty().applyChanges(this.stateDeco,mt.empty,this.heightOracle.setDoc(t.doc),[new $e(0,0,0,t.doc.length)]);for(let i=0;i<2&&(this.viewport=this.getViewport(0,null),!!this.updateForViewport());i++);this.updateViewportLines(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=ue.set(this.lineGaps.map(i=>i.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let t=[this.viewport],{main:e}=this.state.selection;for(let i=0;i<=1;i++){let s=i?e.head:e.anchor;if(!t.some(({from:n,to:o})=>s>=n&&s<=o)){let{from:n,to:o}=this.lineBlockAt(s);t.push(new br(n,o))}}return this.viewports=t.sort((i,s)=>i.from-s.from),this.updateScaler()}updateScaler(){let t=this.scaler;return this.scaler=this.heightMap.height<=7e6?Su:new Dl(this.heightOracle,this.heightMap,this.viewports),t.eq(this.scaler)?0:2}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,t=>{this.viewportLines.push(yn(t,this.scaler))})}update(t,e=null){this.state=t.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Ln).filter(c=>typeof c!="function");let s=t.changedRanges,n=$e.extendWithRanges(s,ab(i,this.stateDeco,t?t.changes:Yt.empty(this.state.doc.length))),o=this.heightMap.height,a=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);bu(),this.heightMap=this.heightMap.applyChanges(this.stateDeco,t.startState.doc,this.heightOracle.setDoc(this.state.doc),n),(this.heightMap.height!=o||Zs)&&(t.flags|=2),a?(this.scrollAnchorPos=t.changes.mapPos(a.from,-1),this.scrollAnchorHeight=a.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let l=n.length?this.mapViewport(this.viewport,t.changes):this.viewport;(e&&(e.range.head<l.from||e.range.head>l.to)||!this.viewportIsAppropriate(l))&&(l=this.getViewport(0,e));let h=l.from!=this.viewport.from||l.to!=this.viewport.to;this.viewport=l,t.flags|=this.updateForViewport(),(h||!t.changes.empty||t.flags&2)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,t.changes))),t.flags|=this.computeVisibleRanges(),e&&(this.scrollTarget=e),!this.mustEnforceCursorAssoc&&t.selectionSet&&t.view.lineWrapping&&t.state.selection.main.empty&&t.state.selection.main.assoc&&!t.state.facet(p1)&&(this.mustEnforceCursorAssoc=!0)}measure(t){let e=t.contentDOM,i=window.getComputedStyle(e),s=this.heightOracle,n=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?re.RTL:re.LTR;let o=this.heightOracle.mustRefreshForWrapping(n),a=e.getBoundingClientRect(),l=o||this.mustMeasureContent||this.contentDOMHeight!=a.height;this.contentDOMHeight=a.height,this.mustMeasureContent=!1;let h=0,c=0;if(a.width&&a.height){let{scaleX:N,scaleY:F}=Ff(e,a);(N>.005&&Math.abs(this.scaleX-N)>.005||F>.005&&Math.abs(this.scaleY-F)>.005)&&(this.scaleX=N,this.scaleY=F,h|=8,o=l=!0)}let f=(parseInt(i.paddingTop)||0)*this.scaleY,p=(parseInt(i.paddingBottom)||0)*this.scaleY;(this.paddingTop!=f||this.paddingBottom!=p)&&(this.paddingTop=f,this.paddingBottom=p,h|=10),this.editorWidth!=t.scrollDOM.clientWidth&&(s.lineWrapping&&(l=!0),this.editorWidth=t.scrollDOM.clientWidth,h|=8);let m=t.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=m&&(this.scrollAnchorHeight=-1,this.scrollTop=m),this.scrolledToBottom=Wf(t.scrollDOM);let y=(this.printing?cb:hb)(e,this.paddingTop),b=y.top-this.pixelViewport.top,S=y.bottom-this.pixelViewport.bottom;this.pixelViewport=y;let T=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(T!=this.inView&&(this.inView=T,T&&(l=!0)),!this.inView&&!this.scrollTarget)return 0;let L=a.width;if((this.contentDOMWidth!=L||this.editorHeight!=t.scrollDOM.clientHeight)&&(this.contentDOMWidth=a.width,this.editorHeight=t.scrollDOM.clientHeight,h|=8),l){let N=t.docView.measureVisibleLineHeights(this.viewport);if(s.mustRefreshForHeights(N)&&(o=!0),o||s.lineWrapping&&Math.abs(L-this.contentDOMWidth)>s.charWidth){let{lineHeight:F,charWidth:I,textHeight:U}=t.docView.measureTextSize();o=F>0&&s.refresh(n,F,I,U,L/I,N),o&&(t.docView.minWidth=0,h|=8)}b>0&&S>0?c=Math.max(b,S):b<0&&S<0&&(c=Math.min(b,S)),bu();for(let F of this.viewports){let I=F.from==this.viewport.from?N:t.docView.measureVisibleLineHeights(F);this.heightMap=(o?pe.empty().applyChanges(this.stateDeco,mt.empty,this.heightOracle,[new $e(0,0,0,t.state.doc.length)]):this.heightMap).updateHeight(s,0,o,new nb(F.from,I))}Zs&&(h|=2)}let B=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return B&&(h&2&&(h|=this.updateScaler()),this.viewport=this.getViewport(c,this.scrollTarget),h|=this.updateForViewport()),(h&2||B)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,t)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,t.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(t,e){let i=.5-Math.max(-.5,Math.min(.5,t/1e3/2)),s=this.heightMap,n=this.heightOracle,{visibleTop:o,visibleBottom:a}=this,l=new br(s.lineAt(o-i*1e3,Rt.ByHeight,n,0,0).from,s.lineAt(a+(1-i)*1e3,Rt.ByHeight,n,0,0).to);if(e){let{head:h}=e.range;if(h<l.from||h>l.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),f=s.lineAt(h,Rt.ByPos,n,0,0),p;e.y=="center"?p=(f.top+f.bottom)/2-c/2:e.y=="start"||e.y=="nearest"&&h<l.from?p=f.top:p=f.bottom-c,l=new br(s.lineAt(p-1e3/2,Rt.ByHeight,n,0,0).from,s.lineAt(p+c+1e3/2,Rt.ByHeight,n,0,0).to)}}return l}mapViewport(t,e){let i=e.mapPos(t.from,-1),s=e.mapPos(t.to,1);return new br(this.heightMap.lineAt(i,Rt.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(s,Rt.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:t,to:e},i=0){if(!this.inView)return!0;let{top:s}=this.heightMap.lineAt(t,Rt.ByPos,this.heightOracle,0,0),{bottom:n}=this.heightMap.lineAt(e,Rt.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:a}=this;return(t==0||s<=o-Math.max(10,Math.min(-i,250)))&&(e==this.state.doc.length||n>=a+Math.max(10,Math.min(i,250)))&&s>o-2*1e3&&n<a+2*1e3}mapLineGaps(t,e){if(!t.length||e.empty)return t;let i=[];for(let s of t)e.touchesRange(s.from,s.to)||i.push(new oa(e.mapPos(s.from),e.mapPos(s.to),s.size,s.displaySize));return i}ensureLineGaps(t,e){let i=this.heightOracle.lineWrapping,s=i?1e4:2e3,n=s>>1,o=s<<1;if(this.defaultTextDirection!=re.LTR&&!i)return[];let a=[],l=(c,f,p,m)=>{if(f-c<n)return;let y=this.state.selection.main,b=[y.from];y.empty||b.push(y.to);for(let T of b)if(T>c&&T<f){l(c,T-10,p,m),l(T+10,f,p,m);return}let S=db(t,T=>T.from>=p.from&&T.to<=p.to&&Math.abs(T.from-c)<n&&Math.abs(T.to-f)<n&&!b.some(L=>T.from<L&&T.to>L));if(!S){if(f<p.to&&e&&i&&e.visibleRanges.some(B=>B.from<=f&&B.to>=f)){let B=e.moveToLineBoundary(G.cursor(f),!1,!0).head;B>c&&(f=B)}let T=this.gapSize(p,c,f,m),L=i||T<2e6?T:2e6;S=new oa(c,f,T,L)}a.push(S)},h=c=>{if(c.length<o||c.type!=fi.Text)return;let f=fb(c.from,c.to,this.stateDeco);if(f.total<o)return;let p=this.scrollTarget?this.scrollTarget.range.head:null,m,y;if(i){let b=s/this.heightOracle.lineLength*this.heightOracle.lineHeight,S,T;if(p!=null){let L=xr(f,p),B=((this.visibleBottom-this.visibleTop)/2+b)/c.height;S=L-B,T=L+B}else S=(this.visibleTop-c.top-b)/c.height,T=(this.visibleBottom-c.top+b)/c.height;m=wr(f,S),y=wr(f,T)}else{let b=f.total*this.heightOracle.charWidth,S=s*this.heightOracle.charWidth,T=0;if(b>2e6)for(let I of t)I.from>=c.from&&I.from<c.to&&I.size!=I.displaySize&&I.from*this.heightOracle.charWidth+T<this.pixelViewport.left&&(T=I.size-I.displaySize);let L=this.pixelViewport.left+T,B=this.pixelViewport.right+T,N,F;if(p!=null){let I=xr(f,p),U=((B-L)/2+S)/b;N=I-U,F=I+U}else N=(L-S)/b,F=(B+S)/b;m=wr(f,N),y=wr(f,F)}m>c.from&&l(c.from,m,c,f),y<c.to&&l(y,c.to,c,f)};for(let c of this.viewportLines)Array.isArray(c.type)?c.type.forEach(h):h(c);return a}gapSize(t,e,i,s){let n=xr(s,i)-xr(s,e);return this.heightOracle.lineWrapping?t.height*n:s.total*this.heightOracle.charWidth*n}updateLineGaps(t){oa.same(t,this.lineGaps)||(this.lineGaps=t,this.lineGapDeco=ue.set(t.map(e=>e.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(){let t=this.stateDeco;this.lineGaps.length&&(t=t.concat(this.lineGapDeco));let e=[];Mt.spans(t,this.viewport.from,this.viewport.to,{span(s,n){e.push({from:s,to:n})},point(){}},20);let i=e.length!=this.visibleRanges.length||this.visibleRanges.some((s,n)=>s.from!=e[n].from||s.to!=e[n].to);return this.visibleRanges=e,i?4:0}lineBlockAt(t){return t>=this.viewport.from&&t<=this.viewport.to&&this.viewportLines.find(e=>e.from<=t&&e.to>=t)||yn(this.heightMap.lineAt(t,Rt.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(t){return t>=this.viewportLines[0].top&&t<=this.viewportLines[this.viewportLines.length-1].bottom&&this.viewportLines.find(e=>e.top<=t&&e.bottom>=t)||yn(this.heightMap.lineAt(this.scaler.fromDOM(t),Rt.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(t){let e=this.lineBlockAtHeight(t+8);return e.from>=this.viewport.from||this.viewportLines[0].top-t>200?e:this.viewportLines[0]}elementAtHeight(t){return yn(this.heightMap.blockAt(this.scaler.fromDOM(t),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class br{constructor(t,e){this.from=t,this.to=e}}function fb(r,t,e){let i=[],s=r,n=0;return Mt.spans(e,r,t,{span(){},point(o,a){o>s&&(i.push({from:s,to:o}),n+=o-s),s=a}},20),s<t&&(i.push({from:s,to:t}),n+=t-s),{total:n,ranges:i}}function wr({total:r,ranges:t},e){if(e<=0)return t[0].from;if(e>=1)return t[t.length-1].to;let i=Math.floor(r*e);for(let s=0;;s++){let{from:n,to:o}=t[s],a=o-n;if(i<=a)return n+i;i-=a}}function xr(r,t){let e=0;for(let{from:i,to:s}of r.ranges){if(t<=s){e+=t-i;break}e+=s-i}return e/r.total}function db(r,t){for(let e of r)if(t(e))return e}const Su={toDOM(r){return r},fromDOM(r){return r},scale:1,eq(r){return r==this}};class Dl{constructor(t,e,i){let s=0,n=0,o=0;this.viewports=i.map(({from:a,to:l})=>{let h=e.lineAt(a,Rt.ByPos,t,0,0).top,c=e.lineAt(l,Rt.ByPos,t,0,0).bottom;return s+=c-h,{from:a,to:l,top:h,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-s)/(e.height-s);for(let a of this.viewports)a.domTop=o+(a.top-n)*this.scale,o=a.domBottom=a.domTop+(a.bottom-a.top),n=a.bottom}toDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.top)return s+(t-i)*this.scale;if(t<=n.bottom)return n.domTop+(t-n.top);i=n.bottom,s=n.domBottom}}fromDOM(t){for(let e=0,i=0,s=0;;e++){let n=e<this.viewports.length?this.viewports[e]:null;if(!n||t<n.domTop)return i+(t-s)/this.scale;if(t<=n.domBottom)return n.top+(t-n.domTop);i=n.bottom,s=n.domBottom}}eq(t){return t instanceof Dl?this.scale==t.scale&&this.viewports.length==t.viewports.length&&this.viewports.every((e,i)=>e.from==t.viewports[i].from&&e.to==t.viewports[i].to):!1}}function yn(r,t){if(t.scale==1)return r;let e=t.toDOM(r.top),i=t.toDOM(r.bottom);return new ai(r.from,r.length,e,i-e,Array.isArray(r._content)?r._content.map(s=>yn(s,t)):r._content)}const Sr=st.define({combine:r=>r.join(" ")}),Ja=st.define({combine:r=>r.indexOf(!0)>-1}),tl=Qi.newName(),Md=Qi.newName(),Id=Qi.newName(),Ed={"&light":"."+Md,"&dark":"."+Id};function el(r,t,e){return new Qi(t,{finish(i){return/&/.test(i)?i.replace(/&\w*/,s=>{if(s=="&")return r;if(!e||!e[s])throw new RangeError(`Unsupported selector: ${s}`);return e[s]}):r+" "+i}})}const pb=el("."+tl,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0,overflowAnchor:"none"},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0,zIndex:300},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace":{backgroundImage:"radial-gradient(circle at 50% 55%, #aaa 20%, transparent 5%)",backgroundPosition:"center"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Ed),gb={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},aa=q.ie&&q.ie_version<=11;class mb{constructor(t){this.view=t,this.active=!1,this.editContext=null,this.selectionRange=new Qy,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.printQuery=null,this.parentCheck=-1,this.dom=t.contentDOM,this.observer=new MutationObserver(e=>{for(let i of e)this.queue.push(i);(q.ie&&q.ie_version<=11||q.ios&&t.composing)&&e.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),window.EditContext&&t.constructor.EDIT_CONTEXT!==!1&&!(q.chrome&&q.chrome_version<126)&&(this.editContext=new yb(t),t.state.facet(Wi)&&(t.contentDOM.editContext=this.editContext.editContext)),aa&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),window.matchMedia&&(this.printQuery=window.matchMedia("print")),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var e;((e=this.view.docView)===null||e===void 0?void 0:e.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(t.scrollDOM)),this.addWindowListeners(this.win=t.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(e=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),e.length>0&&e[e.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(e=>{e.length>0&&e[e.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(t){this.view.inputState.runHandlers("scroll",t),this.intersecting&&this.view.measure()}onScroll(t){this.intersecting&&this.flush(!1),this.editContext&&this.view.requestMeasure(this.editContext.measureReq),this.onScrollChanged(t)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(t){(t.type=="change"||!t.type)&&!t.matches||(this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500))}updateGaps(t){if(this.gapIntersection&&(t.length!=this.gaps.length||this.gaps.some((e,i)=>e!=t[i]))){this.gapIntersection.disconnect();for(let e of t)this.gapIntersection.observe(e);this.gaps=t}}onSelectionChange(t){let e=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,s=this.selectionRange;if(i.state.facet(Wi)?i.root.activeElement!=this.dom:!$r(this.dom,s))return;let n=s.anchorNode&&i.docView.nearest(s.anchorNode);if(n&&n.ignoreEvent(t)){e||(this.selectionChanged=!1);return}(q.ie&&q.ie_version<=11||q.android&&q.chrome)&&!i.state.selection.main.empty&&s.focusNode&&Cn(s.focusNode,s.focusOffset,s.anchorNode,s.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:t}=this,e=En(t.root);if(!e)return!1;let i=q.safari&&t.root.nodeType==11&&t.root.activeElement==this.dom&&vb(this.view,e)||e;if(!i||this.selectionRange.eq(i))return!1;let s=$r(this.dom,i);return s&&!this.selectionChanged&&t.inputState.lastFocusTime>Date.now()-200&&t.inputState.lastTouchTime<Date.now()-300&&Jy(this.dom,i)?(this.view.inputState.lastFocusTime=0,t.docView.updateSelection(),!1):(this.selectionRange.setRange(i),s&&(this.selectionChanged=!0),!0)}setSelectionRange(t,e){this.selectionRange.set(t.node,t.offset,e.node,e.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let t=0,e=null;for(let i=this.dom;i;)if(i.nodeType==1)!e&&t<this.scrollTargets.length&&this.scrollTargets[t]==i?t++:e||(e=this.scrollTargets.slice(0,t)),e&&e.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(t<this.scrollTargets.length&&!e&&(e=this.scrollTargets.slice(0,t)),e){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=e)i.addEventListener("scroll",this.onScroll)}}ignore(t){if(!this.active)return t();try{return this.stop(),t()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,gb),aa&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),aa&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(t,e){var i;if(!this.delayedAndroidKey){let s=()=>{let n=this.delayedAndroidKey;n&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=n.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&n.force&&Ws(this.dom,n.key,n.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(s)}(!this.delayedAndroidKey||t=="Enter")&&(this.delayedAndroidKey={key:t,keyCode:e,force:this.lastChange<Date.now()-50||!!(!((i=this.delayedAndroidKey)===null||i===void 0)&&i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}processRecords(){let t=this.pendingRecords();t.length&&(this.queue=[]);let e=-1,i=-1,s=!1;for(let n of t){let o=this.readMutation(n);o&&(o.typeOver&&(s=!0),e==-1?{from:e,to:i}=o:(e=Math.min(o.from,e),i=Math.max(o.to,i)))}return{from:e,to:i,typeOver:s}}readChange(){let{from:t,to:e,typeOver:i}=this.processRecords(),s=this.selectionChanged&&$r(this.dom,this.selectionRange);if(t<0&&!s)return null;t>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let n=new L1(this.view,t,e,i);return this.view.docView.domChanged={newSel:n.newSel?n.newSel.main:null},n}flush(t=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;t&&this.readSelectionRange();let e=this.readChange();if(!e)return this.view.requestMeasure(),!1;let i=this.view.state,s=xd(this.view,e);return this.view.state==i&&(e.domChanged||e.newSel&&!e.newSel.main.eq(this.view.state.selection.main))&&this.view.update([]),s}readMutation(t){let e=this.view.docView.nearest(t.target);if(!e||e.ignoreMutation(t))return null;if(e.markDirty(t.type=="attributes"),t.type=="attributes"&&(e.flags|=4),t.type=="childList"){let i=ku(e,t.previousSibling||t.target.previousSibling,-1),s=ku(e,t.nextSibling||t.target.nextSibling,1);return{from:i?e.posAfter(i):e.posAtStart,to:s?e.posBefore(s):e.posAtEnd,typeOver:!1}}else return t.type=="characterData"?{from:e.posAtStart,to:e.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}:null}setWindow(t){t!=this.win&&(this.removeWindowListeners(this.win),this.win=t,this.addWindowListeners(this.win))}addWindowListeners(t){t.addEventListener("resize",this.onResize),this.printQuery?this.printQuery.addEventListener?this.printQuery.addEventListener("change",this.onPrint):this.printQuery.addListener(this.onPrint):t.addEventListener("beforeprint",this.onPrint),t.addEventListener("scroll",this.onScroll),t.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(t){t.removeEventListener("scroll",this.onScroll),t.removeEventListener("resize",this.onResize),this.printQuery?this.printQuery.removeEventListener?this.printQuery.removeEventListener("change",this.onPrint):this.printQuery.removeListener(this.onPrint):t.removeEventListener("beforeprint",this.onPrint),t.document.removeEventListener("selectionchange",this.onSelectionChange)}update(t){this.editContext&&(this.editContext.update(t),t.startState.facet(Wi)!=t.state.facet(Wi)&&(t.view.contentDOM.editContext=t.state.facet(Wi)?this.editContext.editContext:null))}destroy(){var t,e,i;this.stop(),(t=this.intersection)===null||t===void 0||t.disconnect(),(e=this.gapIntersection)===null||e===void 0||e.disconnect(),(i=this.resizeScroll)===null||i===void 0||i.disconnect();for(let s of this.scrollTargets)s.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey),this.editContext&&(this.view.contentDOM.editContext=null,this.editContext.destroy())}}function ku(r,t,e){for(;t;){let i=Ct.get(t);if(i&&i.parent==r)return i;let s=t.parentNode;t=s!=r.dom?s:e>0?t.nextSibling:t.previousSibling}return null}function Cu(r,t){let e=t.startContainer,i=t.startOffset,s=t.endContainer,n=t.endOffset,o=r.docView.domAtPos(r.state.selection.main.anchor);return Cn(o.node,o.offset,s,n)&&([e,i,s,n]=[s,n,e,i]),{anchorNode:e,anchorOffset:i,focusNode:s,focusOffset:n}}function vb(r,t){if(t.getComposedRanges){let s=t.getComposedRanges(r.root)[0];if(s)return Cu(r,s)}let e=null;function i(s){s.preventDefault(),s.stopImmediatePropagation(),e=s.getTargetRanges()[0]}return r.contentDOM.addEventListener("beforeinput",i,!0),r.dom.ownerDocument.execCommand("indent"),r.contentDOM.removeEventListener("beforeinput",i,!0),e?Cu(r,e):null}class yb{constructor(t){this.from=0,this.to=0,this.pendingContextChange=null,this.handlers=Object.create(null),this.resetRange(t.state);let e=this.editContext=new window.EditContext({text:t.state.doc.sliceString(this.from,this.to),selectionStart:this.toContextPos(Math.max(this.from,Math.min(this.to,t.state.selection.main.anchor))),selectionEnd:this.toContextPos(t.state.selection.main.head)});this.handlers.textupdate=i=>{let{anchor:s}=t.state.selection.main,n={from:this.toEditorPos(i.updateRangeStart),to:this.toEditorPos(i.updateRangeEnd),insert:mt.of(i.text.split(`
`))};n.from==this.from&&s<this.from?n.from=s:n.to==this.to&&s>this.to&&(n.to=s),!(n.from==n.to&&!n.insert.length)&&(this.pendingContextChange=n,t.state.readOnly||Il(t,n,G.single(this.toEditorPos(i.selectionStart),this.toEditorPos(i.selectionEnd))),this.pendingContextChange&&(this.revertPending(t.state),this.setSelection(t.state)))},this.handlers.characterboundsupdate=i=>{let s=[],n=null;for(let o=this.toEditorPos(i.rangeStart),a=this.toEditorPos(i.rangeEnd);o<a;o++){let l=t.coordsForChar(o);n=l&&new DOMRect(l.left,l.top,l.right-l.left,l.bottom-l.top)||n||new DOMRect,s.push(n)}e.updateCharacterBounds(i.rangeStart,s)},this.handlers.textformatupdate=i=>{let s=[];for(let n of i.getTextFormats()){let o=n.underlineStyle,a=n.underlineThickness;if(o!="None"&&a!="None"){let l=`text-decoration: underline ${o=="Dashed"?"dashed ":o=="Squiggle"?"wavy ":""}${a=="Thin"?1:2}px`;s.push(ue.mark({attributes:{style:l}}).range(this.toEditorPos(n.rangeStart),this.toEditorPos(n.rangeEnd)))}}t.dispatch({effects:dd.of(ue.set(s))})},this.handlers.compositionstart=()=>{t.inputState.composing<0&&(t.inputState.composing=0,t.inputState.compositionFirstChange=!0)},this.handlers.compositionend=()=>{t.inputState.composing=-1,t.inputState.compositionFirstChange=null};for(let i in this.handlers)e.addEventListener(i,this.handlers[i]);this.measureReq={read:i=>{this.editContext.updateControlBounds(i.contentDOM.getBoundingClientRect());let s=En(i.root);s&&s.rangeCount&&this.editContext.updateSelectionBounds(s.getRangeAt(0).getBoundingClientRect())}}}applyEdits(t){let e=0,i=!1,s=this.pendingContextChange;return t.changes.iterChanges((n,o,a,l,h)=>{if(i)return;let c=h.length-(o-n);if(s&&o>=s.to)if(s.from==n&&s.to==o&&s.insert.eq(h)){s=this.pendingContextChange=null,e+=c,this.to+=c;return}else s=null,this.revertPending(t.state);if(n+=e,o+=e,o<=this.from)this.from+=c,this.to+=c;else if(n<this.to){if(n<this.from||o>this.to||this.to-this.from+h.length>3e4){i=!0;return}this.editContext.updateText(this.toContextPos(n),this.toContextPos(o),h.toString()),this.to+=c}e+=c}),s&&!i&&this.revertPending(t.state),!i}update(t){let e=this.pendingContextChange;!this.applyEdits(t)||!this.rangeIsValid(t.state)?(this.pendingContextChange=null,this.resetRange(t.state),this.editContext.updateText(0,this.editContext.text.length,t.state.doc.sliceString(this.from,this.to)),this.setSelection(t.state)):(t.docChanged||t.selectionSet||e)&&this.setSelection(t.state),(t.geometryChanged||t.docChanged||t.selectionSet)&&t.view.requestMeasure(this.measureReq)}resetRange(t){let{head:e}=t.selection.main;this.from=Math.max(0,e-1e4),this.to=Math.min(t.doc.length,e+1e4)}revertPending(t){let e=this.pendingContextChange;this.pendingContextChange=null,this.editContext.updateText(this.toContextPos(e.from),this.toContextPos(e.from+e.insert.length),t.doc.sliceString(e.from,e.to))}setSelection(t){let{main:e}=t.selection,i=this.toContextPos(Math.max(this.from,Math.min(this.to,e.anchor))),s=this.toContextPos(e.head);(this.editContext.selectionStart!=i||this.editContext.selectionEnd!=s)&&this.editContext.updateSelection(i,s)}rangeIsValid(t){let{head:e}=t.selection.main;return!(this.from>0&&e-this.from<500||this.to<t.doc.length&&this.to-e<500||this.to-this.from>1e4*3)}toEditorPos(t){return t+this.from}toContextPos(t){return t-this.from}destroy(){for(let t in this.handlers)this.editContext.removeEventListener(t,this.handlers[t])}}class wt{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(t={}){var e;this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),t.parent&&t.parent.appendChild(this.dom);let{dispatch:i}=t;this.dispatchTransactions=t.dispatchTransactions||i&&(s=>s.forEach(n=>i(n,this)))||(s=>this.update(s)),this.dispatch=this.dispatch.bind(this),this._root=t.root||Zy(t.parent)||document,this.viewState=new xu(t.state||St.create(t)),t.scrollTo&&t.scrollTo.is(mr)&&(this.viewState.scrollTarget=t.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(gn).map(s=>new sa(s));for(let s of this.plugins)s.update(this);this.observer=new mb(this),this.inputState=new F1(this),this.inputState.ensureHandlers(this.plugins),this.docView=new iu(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure(),!((e=document.fonts)===null||e===void 0)&&e.ready&&document.fonts.ready.then(()=>this.requestMeasure())}dispatch(...t){let e=t.length==1&&t[0]instanceof ce?t:t.length==1&&Array.isArray(t[0])?t[0]:[this.state.update(...t)];this.dispatchTransactions(e,this)}update(t){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let e=!1,i=!1,s,n=this.state;for(let p of t){if(p.startState!=n)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");n=p.state}if(this.destroyed){this.viewState.state=n;return}let o=this.hasFocus,a=0,l=null;t.some(p=>p.annotation(Pd))?(this.inputState.notifiedFocused=o,a=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,l=Td(n,o),l||(a=1));let h=this.observer.delayedAndroidKey,c=null;if(h?(this.observer.clearDelayedAndroidKey(),c=this.observer.readChange(),(c&&!this.state.doc.eq(n.doc)||!this.state.selection.eq(n.selection))&&(c=null)):this.observer.clear(),n.facet(St.phrases)!=this.state.facet(St.phrases))return this.setState(n);s=Yr.create(this,n,t),s.flags|=a;let f=this.viewState.scrollTarget;try{this.updateState=2;for(let p of t){if(f&&(f=f.map(p.changes)),p.scrollIntoView){let{main:m}=p.state.selection;f=new js(m.empty?m:G.cursor(m.head,m.head>m.anchor?-1:1))}for(let m of p.effects)m.is(mr)&&(f=m.value.clip(this.state))}this.viewState.update(s,f),this.bidiCache=Qr.update(this.bidiCache,s.changes),s.empty||(this.updatePlugins(s),this.inputState.update(s)),e=this.docView.update(s),this.state.facet(mn)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(t),this.docView.updateSelection(e,t.some(p=>p.isUserEvent("select.pointer")))}finally{this.updateState=0}if(s.startState.facet(Sr)!=s.state.facet(Sr)&&(this.viewState.mustMeasureContent=!0),(e||i||f||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),e&&this.docViewUpdate(),!s.empty)for(let p of this.state.facet(Xa))try{p(s)}catch(m){ci(this.state,m,"update listener")}(l||c)&&Promise.resolve().then(()=>{l&&this.state==l.startState&&this.dispatch(l),c&&!xd(this,c)&&h.force&&Ws(this.contentDOM,h.key,h.keyCode)})}setState(t){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=t;return}this.updateState=2;let e=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new xu(t),this.plugins=t.facet(gn).map(i=>new sa(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView.destroy(),this.docView=new iu(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}e&&this.focus(),this.requestMeasure()}updatePlugins(t){let e=t.startState.facet(gn),i=t.state.facet(gn);if(e!=i){let s=[];for(let n of i){let o=e.indexOf(n);if(o<0)s.push(new sa(n));else{let a=this.plugins[o];a.mustUpdate=t,s.push(a)}}for(let n of this.plugins)n.mustUpdate!=t&&n.destroy(this);this.plugins=s,this.pluginMap.clear()}else for(let s of this.plugins)s.mustUpdate=t;for(let s=0;s<this.plugins.length;s++)this.plugins[s].update(this);e!=i&&this.inputState.ensureHandlers(this.plugins)}docViewUpdate(){for(let t of this.plugins){let e=t.value;if(e&&e.docViewUpdate)try{e.docViewUpdate(this)}catch(i){ci(this.state,i,"doc view update listener")}}}measure(t=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,t&&this.observer.forceFlush();let e=null,i=this.scrollDOM,s=i.scrollTop*this.scaleY,{scrollAnchorPos:n,scrollAnchorHeight:o}=this.viewState;Math.abs(s-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let a=0;;a++){if(o<0)if(Wf(i))n=-1,o=this.viewState.heightMap.height;else{let m=this.viewState.scrollAnchorAt(s);n=m.from,o=m.top}this.updateState=1;let l=this.viewState.measure(this);if(!l&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(a>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let h=[];l&4||([this.measureRequests,h]=[h,this.measureRequests]);let c=h.map(m=>{try{return m.read(this)}catch(y){return ci(this.state,y),Ou}}),f=Yr.create(this,this.state,[]),p=!1;f.flags|=l,e?e.flags|=l:e=f,this.updateState=2,f.empty||(this.updatePlugins(f),this.inputState.update(f),this.updateAttrs(),p=this.docView.update(f),p&&this.docViewUpdate());for(let m=0;m<h.length;m++)if(c[m]!=Ou)try{let y=h[m];y.write&&y.write(c[m],this)}catch(y){ci(this.state,y)}if(p&&this.docView.updateSelection(!0),!f.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let y=(n<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(n).top)-o;if(y>1||y<-1){s=s+y,i.scrollTop=s/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(e&&!e.empty)for(let a of this.state.facet(Xa))a(e)}get themeClasses(){return tl+" "+(this.state.facet(Ja)?Id:Md)+" "+this.state.facet(Sr)}updateAttrs(){let t=Pu(this,pd,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),e={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Wi)?"true":"false",class:"cm-content",style:`${q.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(e["aria-readonly"]="true"),Pu(this,Rl,e);let i=this.observer.ignore(()=>{let s=Ha(this.contentDOM,this.contentAttrs,e),n=Ha(this.dom,this.editorAttrs,t);return s||n});return this.editorAttrs=t,this.contentAttrs=e,i}showAnnouncements(t){let e=!0;for(let i of t)for(let s of i.effects)if(s.is(wt.announce)){e&&(this.announceDOM.textContent=""),e=!1;let n=this.announceDOM.appendChild(document.createElement("div"));n.textContent=s.value}}mountStyles(){this.styleModules=this.state.facet(mn);let t=this.state.facet(wt.cspNonce);Qi.mount(this.root,this.styleModules.concat(pb).reverse(),t?{nonce:t}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(t){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),t){if(this.measureRequests.indexOf(t)>-1)return;if(t.key!=null){for(let e=0;e<this.measureRequests.length;e++)if(this.measureRequests[e].key===t.key){this.measureRequests[e]=t;return}}this.measureRequests.push(t)}}plugin(t){let e=this.pluginMap.get(t);return(e===void 0||e&&e.spec!=t)&&this.pluginMap.set(t,e=this.plugins.find(i=>i.spec==t)||null),e&&e.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(t){return this.readMeasured(),this.viewState.elementAtHeight(t)}lineBlockAtHeight(t){return this.readMeasured(),this.viewState.lineBlockAtHeight(t)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(t){return this.viewState.lineBlockAt(t)}get contentHeight(){return this.viewState.contentHeight}moveByChar(t,e,i){return ra(this,t,au(this,t,e,i))}moveByGroup(t,e){return ra(this,t,au(this,t,e,i=>M1(this,t.head,i)))}visualLineSide(t,e){let i=this.bidiSpans(t),s=this.textDirectionAt(t.from),n=i[e?i.length-1:0];return G.cursor(n.side(e,s)+t.from,n.forward(!e,s)?1:-1)}moveToLineBoundary(t,e,i=!0){return R1(this,t,e,i)}moveVertically(t,e,i){return ra(this,t,I1(this,t,e,i))}domAtPos(t){return this.docView.domAtPos(t)}posAtDOM(t,e=0){return this.docView.posFromDOM(t,e)}posAtCoords(t,e=!0){return this.readMeasured(),wd(this,t,e)}coordsAtPos(t,e=1){this.readMeasured();let i=this.docView.coordsAt(t,e);if(!i||i.left==i.right)return i;let s=this.state.doc.lineAt(t),n=this.bidiSpans(s),o=n[qi.find(n,t-s.from,-1,e)];return po(i,o.dir==re.LTR==e>0)}coordsForChar(t){return this.readMeasured(),this.docView.coordsForChar(t)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(t){return!this.state.facet(ud)||t<this.viewport.from||t>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(t))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(t){if(t.length>bb)return sd(t.length);let e=this.textDirectionAt(t.from),i;for(let n of this.bidiCache)if(n.from==t.from&&n.dir==e&&(n.fresh||id(n.isolates,i=eu(this,t))))return n.order;i||(i=eu(this,t));let s=u1(t.text,e,i);return this.bidiCache.push(new Qr(t.from,t.to,e,i,!0,s)),s}get hasFocus(){var t;return(this.dom.ownerDocument.hasFocus()||q.safari&&((t=this.inputState)===null||t===void 0?void 0:t.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{zf(this.contentDOM),this.docView.updateSelection()})}setRoot(t){this._root!=t&&(this._root=t,this.observer.setWindow((t.nodeType==9?t:t.ownerDocument).defaultView||window),this.mountStyles())}destroy(){this.root.activeElement==this.contentDOM&&this.contentDOM.blur();for(let t of this.plugins)t.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(t,e={}){return mr.of(new js(typeof t=="number"?G.cursor(t):t,e.y,e.x,e.yMargin,e.xMargin))}scrollSnapshot(){let{scrollTop:t,scrollLeft:e}=this.scrollDOM,i=this.viewState.scrollAnchorAt(t);return mr.of(new js(G.cursor(i.from),"start","start",i.top-t,e,!0))}setTabFocusMode(t){t==null?this.inputState.tabFocusMode=this.inputState.tabFocusMode<0?0:-1:typeof t=="boolean"?this.inputState.tabFocusMode=t?0:-1:this.inputState.tabFocusMode!=0&&(this.inputState.tabFocusMode=Date.now()+t)}static domEventHandlers(t){return Qs.define(()=>({}),{eventHandlers:t})}static domEventObservers(t){return Qs.define(()=>({}),{eventObservers:t})}static theme(t,e){let i=Qi.newName(),s=[Sr.of(i),mn.of(el(`.${i}`,t))];return e&&e.dark&&s.push(Ja.of(!0)),s}static baseTheme(t){return Ly.lowest(mn.of(el("."+tl,t,Ed)))}static findFromDOM(t){var e;let i=t.querySelector(".cm-content"),s=i&&Ct.get(i)||Ct.get(t);return((e=s?.rootView)===null||e===void 0?void 0:e.view)||null}}wt.styleModule=mn;wt.inputHandler=hd;wt.clipboardInputFilter=Tl;wt.clipboardOutputFilter=Al;wt.scrollHandler=fd;wt.focusChangeEffect=cd;wt.perLineTextDirection=ud;wt.exceptionSink=ld;wt.updateListener=Xa;wt.editable=Wi;wt.mouseSelectionStyle=ad;wt.dragMovesSelection=od;wt.clickAddsSelectionRange=rd;wt.decorations=Ln;wt.outerDecorations=gd;wt.atomicRanges=Ml;wt.bidiIsolatedRanges=md;wt.scrollMargins=vd;wt.darkTheme=Ja;wt.cspNonce=st.define({combine:r=>r.length?r[0]:""});wt.contentAttributes=Rl;wt.editorAttributes=pd;wt.lineWrapping=wt.contentAttributes.of({class:"cm-lineWrapping"});wt.announce=Vt.define();const bb=4096,Ou={};class Qr{constructor(t,e,i,s,n,o){this.from=t,this.to=e,this.dir=i,this.isolates=s,this.fresh=n,this.order=o}static update(t,e){if(e.empty&&!t.some(n=>n.fresh))return t;let i=[],s=t.length?t[t.length-1].dir:re.LTR;for(let n=Math.max(0,t.length-10);n<t.length;n++){let o=t[n];o.dir==s&&!e.touchesRange(o.from,o.to)&&i.push(new Qr(e.mapPos(o.from,1),e.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return i}}function Pu(r,t,e){for(let i=r.state.facet(t),s=i.length-1;s>=0;s--){let n=i[s],o=typeof n=="function"?n(r):n;o&&ja(o,e)}return e}const wb=!q.ios,Tu={".cm-line":{"& ::selection, &::selection":{backgroundColor:"transparent !important"}},".cm-content":{"& :focus":{caretColor:"initial !important","&::selection, & ::selection":{backgroundColor:"Highlight !important"}}}};wb&&(Tu[".cm-line"].caretColor=Tu[".cm-content"].caretColor="transparent !important");class Js extends Ks{compare(t){return this==t||this.constructor==t.constructor&&this.eq(t)}eq(t){return!1}destroy(t){}}Js.prototype.elementClass="";Js.prototype.toDOM=void 0;Js.prototype.mapMode=Oe.TrackBefore;Js.prototype.startSide=Js.prototype.endSide=-1;Js.prototype.point=!0;let xb=0;class Ee{constructor(t,e,i,s){this.name=t,this.set=e,this.base=i,this.modified=s,this.id=xb++}toString(){let{name:t}=this;for(let e of this.modified)e.name&&(t=`${e.name}(${t})`);return t}static define(t,e){let i=typeof t=="string"?t:"?";if(t instanceof Ee&&(e=t),e?.base)throw new Error("Can not derive from a modified tag");let s=new Ee(i,[],null,[]);if(s.set.push(s),e)for(let n of e.set)s.set.push(n);return s}static defineModifier(t){let e=new Zr(t);return i=>i.modified.indexOf(e)>-1?i:Zr.get(i.base||i,i.modified.concat(e).sort((s,n)=>s.id-n.id))}}let Sb=0;class Zr{constructor(t){this.name=t,this.instances=[],this.id=Sb++}static get(t,e){if(!e.length)return t;let i=e[0].instances.find(a=>a.base==t&&kb(e,a.modified));if(i)return i;let s=[],n=new Ee(t.name,s,t,e);for(let a of e)a.instances.push(n);let o=Cb(e);for(let a of t.set)if(!a.modified.length)for(let l of o)s.push(Zr.get(a,l));return n}}function kb(r,t){return r.length==t.length&&r.every((e,i)=>e==t[i])}function Cb(r){let t=[[]];for(let e=0;e<r.length;e++)for(let i=0,s=t.length;i<s;i++)t.push(t[i].concat(r[e]));return t.sort((e,i)=>i.length-e.length)}function Dd(r){let t=Object.create(null);for(let e in r){let i=r[e];Array.isArray(i)||(i=[i]);for(let s of e.split(" "))if(s){let n=[],o=2,a=s;for(let f=0;;){if(a=="..."&&f>0&&f+3==s.length){o=1;break}let p=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(a);if(!p)throw new RangeError("Invalid path: "+s);if(n.push(p[0]=="*"?"":p[0][0]=='"'?JSON.parse(p[0]):p[0]),f+=p[0].length,f==s.length)break;let m=s[f++];if(f==s.length&&m=="!"){o=0;break}if(m!="/")throw new RangeError("Invalid path: "+s);a=s.slice(f)}let l=n.length-1,h=n[l];if(!h)throw new RangeError("Invalid path: "+s);let c=new Jr(i,o,l>0?n.slice(0,l):null);t[h]=c.sort(t[h])}}return Ld.add(t)}const Ld=new bt;class Jr{constructor(t,e,i,s){this.tags=t,this.mode=e,this.context=i,this.next=s}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(t){return!t||t.depth<this.depth?(this.next=t,this):(t.next=this.sort(t.next),t)}get depth(){return this.context?this.context.length:0}}Jr.empty=new Jr([],2,null);function Nd(r,t){let e=Object.create(null);for(let n of r)if(!Array.isArray(n.tag))e[n.tag.id]=n.class;else for(let o of n.tag)e[o.id]=n.class;let{scope:i,all:s=null}=t||{};return{style:n=>{let o=s;for(let a of n)for(let l of a.set){let h=e[l.id];if(h){o=o?o+" "+h:h;break}}return o},scope:i}}function Ob(r,t){let e=null;for(let i of r){let s=i.style(t);s&&(e=e?e+" "+s:s)}return e}function Pb(r,t,e,i=0,s=r.length){let n=new Tb(i,Array.isArray(t)?t:[t],e);n.highlightRange(r.cursor(),i,s,"",n.highlighters),n.flush(s)}class Tb{constructor(t,e,i){this.at=t,this.highlighters=e,this.span=i,this.class=""}startSpan(t,e){e!=this.class&&(this.flush(t),t>this.at&&(this.at=t),this.class=e)}flush(t){t>this.at&&this.class&&this.span(this.at,t,this.class)}highlightRange(t,e,i,s,n){let{type:o,from:a,to:l}=t;if(a>=i||l<=e)return;o.isTop&&(n=this.highlighters.filter(m=>!m.scope||m.scope(o)));let h=s,c=Ab(t)||Jr.empty,f=Ob(n,c.tags);if(f&&(h&&(h+=" "),h+=f,c.mode==1&&(s+=(s?" ":"")+f)),this.startSpan(Math.max(e,a),h),c.opaque)return;let p=t.tree&&t.tree.prop(bt.mounted);if(p&&p.overlay){let m=t.node.enter(p.overlay[0].from+a,1),y=this.highlighters.filter(S=>!S.scope||S.scope(p.tree.type)),b=t.firstChild();for(let S=0,T=a;;S++){let L=S<p.overlay.length?p.overlay[S]:null,B=L?L.from+a:l,N=Math.max(e,T),F=Math.min(i,B);if(N<F&&b)for(;t.from<F&&(this.highlightRange(t,N,F,s,n),this.startSpan(Math.min(F,t.to),h),!(t.to>=B||!t.nextSibling())););if(!L||B>i)break;T=L.to+a,T>e&&(this.highlightRange(m.cursor(),Math.max(e,L.from+a),Math.min(i,T),"",y),this.startSpan(Math.min(i,T),h))}b&&t.parent()}else if(t.firstChild()){p&&(s="");do if(!(t.to<=e)){if(t.from>=i)break;this.highlightRange(t,e,i,s,n),this.startSpan(Math.min(i,t.to),h)}while(t.nextSibling());t.parent()}}}function Ab(r){let t=r.type.prop(Ld);for(;t&&t.context&&!r.matchContext(t.context);)t=t.next;return t||null}const $=Ee.define,kr=$(),$i=$(),Au=$($i),Ru=$($i),Fi=$(),Cr=$(Fi),la=$(Fi),ri=$(),ls=$(ri),si=$(),ni=$(),il=$(),fn=$(il),Or=$(),A={comment:kr,lineComment:$(kr),blockComment:$(kr),docComment:$(kr),name:$i,variableName:$($i),typeName:Au,tagName:$(Au),propertyName:Ru,attributeName:$(Ru),className:$($i),labelName:$($i),namespace:$($i),macroName:$($i),literal:Fi,string:Cr,docString:$(Cr),character:$(Cr),attributeValue:$(Cr),number:la,integer:$(la),float:$(la),bool:$(Fi),regexp:$(Fi),escape:$(Fi),color:$(Fi),url:$(Fi),keyword:si,self:$(si),null:$(si),atom:$(si),unit:$(si),modifier:$(si),operatorKeyword:$(si),controlKeyword:$(si),definitionKeyword:$(si),moduleKeyword:$(si),operator:ni,derefOperator:$(ni),arithmeticOperator:$(ni),logicOperator:$(ni),bitwiseOperator:$(ni),compareOperator:$(ni),updateOperator:$(ni),definitionOperator:$(ni),typeOperator:$(ni),controlOperator:$(ni),punctuation:il,separator:$(il),bracket:fn,angleBracket:$(fn),squareBracket:$(fn),paren:$(fn),brace:$(fn),content:ri,heading:ls,heading1:$(ls),heading2:$(ls),heading3:$(ls),heading4:$(ls),heading5:$(ls),heading6:$(ls),contentSeparator:$(ri),list:$(ri),quote:$(ri),emphasis:$(ri),strong:$(ri),link:$(ri),monospace:$(ri),strikethrough:$(ri),inserted:$(),deleted:$(),changed:$(),invalid:$(),meta:Or,documentMeta:$(Or),annotation:$(Or),processingInstruction:$(Or),definition:Ee.defineModifier("definition"),constant:Ee.defineModifier("constant"),function:Ee.defineModifier("function"),standard:Ee.defineModifier("standard"),local:Ee.defineModifier("local"),special:Ee.defineModifier("special")};for(let r in A){let t=A[r];t instanceof Ee&&(t.name=r)}Nd([{tag:A.link,class:"tok-link"},{tag:A.heading,class:"tok-heading"},{tag:A.emphasis,class:"tok-emphasis"},{tag:A.strong,class:"tok-strong"},{tag:A.keyword,class:"tok-keyword"},{tag:A.atom,class:"tok-atom"},{tag:A.bool,class:"tok-bool"},{tag:A.url,class:"tok-url"},{tag:A.labelName,class:"tok-labelName"},{tag:A.inserted,class:"tok-inserted"},{tag:A.deleted,class:"tok-deleted"},{tag:A.literal,class:"tok-literal"},{tag:A.string,class:"tok-string"},{tag:A.number,class:"tok-number"},{tag:[A.regexp,A.escape,A.special(A.string)],class:"tok-string2"},{tag:A.variableName,class:"tok-variableName"},{tag:A.local(A.variableName),class:"tok-variableName tok-local"},{tag:A.definition(A.variableName),class:"tok-variableName tok-definition"},{tag:A.special(A.variableName),class:"tok-variableName2"},{tag:A.definition(A.propertyName),class:"tok-propertyName tok-definition"},{tag:A.typeName,class:"tok-typeName"},{tag:A.namespace,class:"tok-namespace"},{tag:A.className,class:"tok-className"},{tag:A.macroName,class:"tok-macroName"},{tag:A.propertyName,class:"tok-propertyName"},{tag:A.operator,class:"tok-operator"},{tag:A.comment,class:"tok-comment"},{tag:A.meta,class:"tok-meta"},{tag:A.invalid,class:"tok-invalid"},{tag:A.punctuation,class:"tok-punctuation"}]);var ha;const bn=new bt,Rb=new bt;class ui{constructor(t,e,i=[],s=""){this.data=t,this.name=s,St.prototype.hasOwnProperty("tree")||Object.defineProperty(St.prototype,"tree",{get(){return sl(this)}}),this.parser=e,this.extension=[en.of(this),St.languageData.of((n,o,a)=>{let l=Mu(n,o,a),h=l.type.prop(bn);if(!h)return[];let c=n.facet(h),f=l.type.prop(Rb);if(f){let p=l.resolve(o-l.from,a);for(let m of f)if(m.test(p,n)){let y=n.facet(m.facet);return m.type=="replace"?y:y.concat(c)}}return c})].concat(i)}isActiveAt(t,e,i=-1){return Mu(t,e,i).type.prop(bn)==this.data}findRegions(t){let e=t.facet(en);if(e?.data==this.data)return[{from:0,to:t.doc.length}];if(!e||!e.allowsNesting)return[];let i=[],s=(n,o)=>{if(n.prop(bn)==this.data){i.push({from:o,to:o+n.length});return}let a=n.prop(bt.mounted);if(a){if(a.tree.prop(bn)==this.data){if(a.overlay)for(let l of a.overlay)i.push({from:l.from+o,to:l.to+o});else i.push({from:o,to:o+n.length});return}else if(a.overlay){let l=i.length;if(s(a.tree,a.overlay[0].from+o),i.length>l)return}}for(let l=0;l<n.children.length;l++){let h=n.children[l];h instanceof Wt&&s(h,n.positions[l]+o)}};return s(sl(t),0),i}get allowsNesting(){return!0}}ui.setState=Vt.define();function Mu(r,t,e){let i=r.facet(en),s=sl(r).topNode;if(!i||i.allowsNesting)for(let n=s;n;n=n.enter(t,e,Xt.ExcludeBuffers))n.type.isTop&&(s=n);return s}function sl(r){let t=r.field(ui.state,!1);return t?t.tree:Wt.empty}class Mb{constructor(t){this.doc=t,this.cursorPos=0,this.string="",this.cursor=t.iter()}get length(){return this.doc.length}syncTo(t){return this.string=this.cursor.next(t-this.cursorPos).value,this.cursorPos=t+this.string.length,this.cursorPos-this.string.length}chunk(t){return this.syncTo(t),this.string}get lineChunks(){return!0}read(t,e){let i=this.cursorPos-this.string.length;return t<i||e>=this.cursorPos?this.doc.sliceString(t,e):this.string.slice(t-i,e-i)}}let dn=null;class to{constructor(t,e,i=[],s,n,o,a,l){this.parser=t,this.state=e,this.fragments=i,this.tree=s,this.treeLen=n,this.viewport=o,this.skipped=a,this.scheduleOn=l,this.parse=null,this.tempSkipped=[]}static create(t,e,i){return new to(t,e,[],Wt.empty,0,i,[],null)}startParse(){return this.parser.startParse(new Mb(this.state.doc),this.fragments)}work(t,e){return e!=null&&e>=this.state.doc.length&&(e=void 0),this.tree!=Wt.empty&&this.isDone(e??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if(typeof t=="number"){let s=Date.now()+t;t=()=>Date.now()>s}for(this.parse||(this.parse=this.startParse()),e!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&e<this.state.doc.length&&this.parse.stopAt(e);;){let s=this.parse.advance();if(s)if(this.fragments=this.withoutTempSkipped(ms.addTree(s,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=s,this.parse=null,this.treeLen<(e??this.state.doc.length))this.parse=this.startParse();else return!0;if(t())return!1}})}takeTree(){let t,e;this.parse&&(t=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&this.parse.stopAt(t),this.withContext(()=>{for(;!(e=this.parse.advance()););}),this.treeLen=t,this.tree=e,this.fragments=this.withoutTempSkipped(ms.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(t){let e=dn;dn=this;try{return t()}finally{dn=e}}withoutTempSkipped(t){for(let e;e=this.tempSkipped.pop();)t=Iu(t,e.from,e.to);return t}changes(t,e){let{fragments:i,tree:s,treeLen:n,viewport:o,skipped:a}=this;if(this.takeTree(),!t.empty){let l=[];if(t.iterChangedRanges((h,c,f,p)=>l.push({fromA:h,toA:c,fromB:f,toB:p})),i=ms.applyChanges(i,l),s=Wt.empty,n=0,o={from:t.mapPos(o.from,-1),to:t.mapPos(o.to,1)},this.skipped.length){a=[];for(let h of this.skipped){let c=t.mapPos(h.from,1),f=t.mapPos(h.to,-1);c<f&&a.push({from:c,to:f})}}}return new to(this.parser,e,i,s,n,o,a,this.scheduleOn)}updateViewport(t){if(this.viewport.from==t.from&&this.viewport.to==t.to)return!1;this.viewport=t;let e=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:s,to:n}=this.skipped[i];s<t.to&&n>t.from&&(this.fragments=Iu(this.fragments,s,n),this.skipped.splice(i--,1))}return this.skipped.length>=e?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(t,e){this.skipped.push({from:t,to:e})}static getSkippingParser(t){return new class extends xf{createParse(e,i,s){let n=s[0].from,o=s[s.length-1].to;return{parsedPos:n,advance(){let l=dn;if(l){for(let h of s)l.tempSkipped.push(h);t&&(l.scheduleOn=l.scheduleOn?Promise.all([l.scheduleOn,t]):t)}return this.parsedPos=o,new Wt(xe.none,[],[],o-n)},stoppedAt:null,stopAt(){}}}}}isDone(t){t=Math.min(t,this.state.doc.length);let e=this.fragments;return this.treeLen>=t&&e.length&&e[0].from==0&&e[0].to>=t}static get(){return dn}}function Iu(r,t,e){return ms.applyChanges(r,[{fromA:t,toA:e,fromB:t,toB:e}])}class tn{constructor(t){this.context=t,this.tree=t.tree}apply(t){if(!t.docChanged&&this.tree==this.context.tree)return this;let e=this.context.changes(t.changes,t.state),i=this.context.treeLen==t.startState.doc.length?void 0:Math.max(t.changes.mapPos(this.context.treeLen),e.viewport.to);return e.work(20,i)||e.takeTree(),new tn(e)}static init(t){let e=Math.min(3e3,t.doc.length),i=to.create(t.facet(en).parser,t,{from:0,to:e});return i.work(20,e)||i.takeTree(),new tn(i)}}ui.state=Cs.define({create:tn.init,update(r,t){for(let e of t.effects)if(e.is(ui.setState))return e.value;return t.startState.facet(en)!=t.state.facet(en)?tn.init(t.state):r.apply(t)}});let Bd=r=>{let t=setTimeout(()=>r(),500);return()=>clearTimeout(t)};typeof requestIdleCallback<"u"&&(Bd=r=>{let t=-1,e=setTimeout(()=>{t=requestIdleCallback(r,{timeout:500-100})},100);return()=>t<0?clearTimeout(e):cancelIdleCallback(t)});const ca=typeof navigator<"u"&&(!((ha=navigator.scheduling)===null||ha===void 0)&&ha.isInputPending)?()=>navigator.scheduling.isInputPending():null,Ib=Qs.fromClass(class{constructor(t){this.view=t,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(t){let e=this.view.state.field(ui.state).context;(e.updateViewport(t.view.viewport)||this.view.viewport.to>e.treeLen)&&this.scheduleWork(),(t.docChanged||t.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(e)}scheduleWork(){if(this.working)return;let{state:t}=this.view,e=t.field(ui.state);(e.tree!=e.context.tree||!e.context.isDone(t.doc.length))&&(this.working=Bd(this.work))}work(t){this.working=null;let e=Date.now();if(this.chunkEnd<e&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=e+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:s}}=this.view,n=i.field(ui.state);if(n.tree==n.context.tree&&n.context.isDone(s+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,t&&!ca?Math.max(25,t.timeRemaining()-5):1e9),a=n.context.treeLen<s&&i.doc.length>s+1e3,l=n.context.work(()=>ca&&ca()||Date.now()>o,s+(a?0:1e5));this.chunkBudget-=Date.now()-e,(l||this.chunkBudget<=0)&&(n.context.takeTree(),this.view.dispatch({effects:ui.setState.of(new tn(n.context))})),this.chunkBudget>0&&!(l&&!a)&&this.scheduleWork(),this.checkAsyncSchedule(n.context)}checkAsyncSchedule(t){t.scheduleOn&&(this.workScheduled++,t.scheduleOn.then(()=>this.scheduleWork()).catch(e=>ci(this.view.state,e)).then(()=>this.workScheduled--),t.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),en=st.define({combine(r){return r.length?r[0]:null},enables:r=>[ui.state,Ib,wt.contentAttributes.compute([r],t=>{let e=t.facet(r);return e&&e.name?{"data-language":e.name}:{}})]});class Qn{constructor(t,e){this.specs=t;let i;function s(a){let l=Qi.newName();return(i||(i=Object.create(null)))["."+l]=a,l}const n=typeof e.all=="string"?e.all:e.all?s(e.all):void 0,o=e.scope;this.scope=o instanceof ui?a=>a.prop(bn)==o.data:o?a=>a==o:void 0,this.style=Nd(t.map(a=>({tag:a.tag,class:a.class||s(Object.assign({},a,{tag:null}))})),{all:n}).style,this.module=i?new Qi(i):null,this.themeType=e.themeType}static define(t,e){return new Qn(t,e||{})}}A.meta,A.link,A.heading,A.emphasis,A.strong,A.strikethrough,A.keyword,A.atom,A.bool,A.url,A.contentSeparator,A.labelName,A.literal,A.inserted,A.string,A.deleted,A.regexp,A.escape,A.string,A.variableName,A.variableName,A.typeName,A.namespace,A.className,A.variableName,A.macroName,A.propertyName,A.comment,A.invalid;const Eb=Object.create(null),Eu=[xe.none],Du=[],Lu=Object.create(null),Db=Object.create(null);for(let[r,t]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])Db[r]=Lb(Eb,t);function ua(r,t){Du.indexOf(r)>-1||(Du.push(r),console.warn(t))}function Lb(r,t){let e=[];for(let a of t.split(" ")){let l=[];for(let h of a.split(".")){let c=r[h]||A[h];c?typeof c=="function"?l.length?l=l.map(c):ua(h,`Modifier ${h} used at start of tag`):l.length?ua(h,`Tag ${h} used as modifier`):l=Array.isArray(c)?c:[c]:ua(h,`Unknown highlighting tag ${h}`)}for(let h of l)e.push(h)}if(!e.length)return 0;let i=t.replace(/ /g,"_"),s=i+" "+e.map(a=>a.id),n=Lu[s];if(n)return n.id;let o=Lu[s]=xe.define({id:Eu.length,name:i,props:[Dd({[i]:e})]});return Eu.push(o),o.id}re.RTL,re.LTR;const Nb=Qn.define([{tag:A.keyword,color:"#5e81ac"},{tag:[A.name,A.deleted,A.character,A.propertyName,A.macroName],color:"#88c0d0"},{tag:[A.variableName],color:"#8fbcbb"},{tag:[A.function(A.variableName)],color:"#8fbcbb"},{tag:[A.labelName],color:"#81a1c1"},{tag:[A.color,A.constant(A.name),A.standard(A.name)],color:"#5e81ac"},{tag:[A.definition(A.name),A.separator],color:"#a3be8c"},{tag:[A.brace],color:"#8fbcbb"},{tag:[A.annotation],color:"#d30102"},{tag:[A.number,A.changed,A.annotation,A.modifier,A.self,A.namespace],color:"#b48ead"},{tag:[A.typeName,A.className],color:"#ECEFF4"},{tag:[A.operator,A.operatorKeyword],color:"#a3be8c"},{tag:[A.tagName],color:"#b48ead"},{tag:[A.squareBracket],color:"#ECEFF4"},{tag:[A.angleBracket],color:"#ECEFF4"},{tag:[A.attributeName],color:"#eceff4"},{tag:[A.regexp],color:"#5e81ac"},{tag:[A.quote],color:"#b48ead"},{tag:[A.string],color:"#a3be8c"},{tag:A.link,color:"#a3be8c",textDecoration:"underline",textUnderlinePosition:"under"},{tag:[A.url,A.escape,A.special(A.string)],color:"#8fbcbb"},{tag:[A.meta],color:"#88c0d0"},{tag:[A.monospace],color:"#d8dee9",fontStyle:"italic"},{tag:[A.comment],color:"#4c566a",fontStyle:"italic"},{tag:A.strong,fontWeight:"bold",color:"#5e81ac"},{tag:A.emphasis,fontStyle:"italic",color:"#5e81ac"},{tag:A.strikethrough,textDecoration:"line-through"},{tag:A.heading,fontWeight:"bold",color:"#5e81ac"},{tag:A.special(A.heading1),fontWeight:"bold",color:"#5e81ac"},{tag:A.heading1,fontWeight:"bold",color:"#5e81ac"},{tag:[A.heading2,A.heading3,A.heading4],fontWeight:"bold",color:"#5e81ac"},{tag:[A.heading5,A.heading6],color:"#5e81ac"},{tag:[A.atom,A.bool,A.special(A.variableName)],color:"#d08770"},{tag:[A.processingInstruction,A.inserted],color:"#8fbcbb"},{tag:[A.contentSeparator],color:"#ebcb8b"},{tag:A.invalid,color:"#434c5e",borderBottom:"1px dotted #d30102"}]);class vo{constructor(t,e=Nb){this.parser=t,this.style=e,this.classLookup=new Map;for(const i of this.style.module?.getRules().split(`
`)??[]){const s=i.match(vo.classRegex);if(!s)continue;const n=s[1],o=s[2].trim();this.classLookup.set(n,o)}}initialize(){return!0}prepare(t){const e=new Map,i=this.parser.parse(t);return Pb(i,this.style,(s,n,o)=>{const a=this.classLookup.get(o);if(!a)return;const l=i.cursorAt(s,1);do{const h=this.getNodeId(l.node);e.set(h,a)}while(l.next()&&l.to<=n)}),{tree:i,code:t,colorLookup:e}}highlight(t,e){if(!e)return{color:null,skipAhead:0};const i=e.tree.resolveInner(t,1),s=this.getNodeId(i),n=e.colorLookup.get(s);if(n)return{color:n,skipAhead:i.to-t};let o=0;return i.firstChild||(o=i.to-t),{color:null,skipAhead:o}}tokenize(t){const i=this.parser.parse(t).cursor(),s=[];let n=0;do i.node.firstChild||(i.from>n&&s.push(t.slice(n,i.from)),i.from<i.to&&s.push(t.slice(i.from,i.to)),n=i.to);while(i.next());return s}getNodeId(t){return`${t.from}:${t.to}`}}vo.classRegex=/\.(\S+).*color:([^;]+)/;function Bb(r){return!!r.prototype?.isClass}const _b=Symbol.for("@motion-canvas/2d/fragment");function rt(r,t,e){const{ref:i,children:s,...n}=t,o=Array.isArray(s)?s.flat():s;if(r===_b)return o;if(Bb(r)){const a=new r({...n,children:o,key:e});return i?.(a),a}else return r({...n,ref:i,children:o,key:e})}class $b extends yv{constructor(t){super(t),this.view=null,this.registeredNodes=new Map,this.nodeCounters=new Map,this.assetHash=Date.now().toString(),this.recreateView()}getView(){return this.view}next(){return this.getView()?.playbackState(this.playback.state).globalTime(this.playback.time),super.next()}draw(t){t.save(),this.renderLifecycle.dispatch([li.BeforeRender,t]),t.save(),this.renderLifecycle.dispatch([li.BeginRender,t]),this.getView().playbackState(this.playback.state).globalTime(this.playback.time),this.getView().render(t),this.renderLifecycle.dispatch([li.FinishRender,t]),t.restore(),this.renderLifecycle.dispatch([li.AfterRender,t]),t.restore()}reset(t){for(const e of this.registeredNodes.keys())try{this.registeredNodes.get(e).dispose()}catch(i){this.logger.error(i)}return this.registeredNodes.clear(),this.registeredNodes=new Map,this.nodeCounters.clear(),this.recreateView(),super.reset(t)}inspectPosition(t,e){return this.execute(()=>this.getView().hit(new k(t,e))?.key??null)}validateInspection(t){return this.getNode(t)?.key??null}inspectAttributes(t){const e=this.getNode(t);if(!e)return null;const i={stack:e.creationStack,key:e.key};for(const{key:s,meta:n,signal:o}of e)n.inspectable&&(i[s]=o());return i}drawOverlay(t,e,i){const s=this.getNode(t);s&&this.execute(()=>{const n=this.getView().findAll(gl(ti)),o=[];for(const a of n){const l=a.scene();l&&(l===s||l.findFirst(h=>h===s))&&o.push(a)}if(o.length>0)for(const a of o){const l=a.parentToWorld(),h=a.localToParent().inverse(),c=s.localToWorld();s.drawOverlay(i,e.multiply(l).multiply(h).multiply(c))}else s.drawOverlay(i,e.multiply(s.localToWorld()))})}transformMousePosition(t,e){return new k(t,e).transformAsPoint(this.getView().localToParent().inverse())}registerNode(t,e){const i=t.constructor?.name??"unknown",s=(this.nodeCounters.get(i)??0)+1;this.nodeCounters.set(i,s),e&&this.registeredNodes.has(e)&&(qt().error({message:`Duplicated node key: "${e}".`,inspect:e,stack:new Error().stack}),e=void 0),e??(e=`${this.name}/${i}[${s}]`),this.registeredNodes.set(e,t);const n=this.registeredNodes;return[e,()=>n.delete(e)]}getNode(t){return typeof t!="string"?null:this.registeredNodes.get(t)??null}*getDetachedNodes(){for(const t of this.registeredNodes.values())!t.parent()&&t!==this.view&&(yield t)}recreateView(){this.execute(()=>{const t=this.getSize();this.view=new Yi({position:t.scale(this.resolutionScale/2),scale:this.resolutionScale,assetHash:this.assetHash,size:t})})}}function on(r){return{klass:$b,config:r,stack:new Error().stack,meta:bv(),plugins:["@motion-canvas/2d/editor"]}}class eo{constructor(t,e,i,s,n,o,a,l,h,c=0,f){this.p=t,this.stack=e,this.state=i,this.reducePos=s,this.pos=n,this.score=o,this.buffer=a,this.bufferBase=l,this.curContext=h,this.lookAhead=c,this.parent=f}toString(){return`[${this.stack.filter((t,e)=>e%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(t,e,i=0){let s=t.parser.context;return new eo(t,[],e,i,i,0,[],0,s?new Nu(s,s.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(t,e){this.stack.push(this.state,e,this.bufferBase+this.buffer.length),this.state=t}reduce(t){var e;let i=t>>19,s=t&65535,{parser:n}=this.p,o=this.reducePos<this.pos-25;o&&this.setLookAhead(this.pos);let a=n.dynamicPrecedence(s);if(a&&(this.score+=a),i==0){this.pushState(n.getGoto(this.state,s,!0),this.reducePos),s<n.minRepeatTerm&&this.storeNode(s,this.reducePos,this.reducePos,o?8:4,!0),this.reduceContext(s,this.reducePos);return}let l=this.stack.length-(i-1)*3-(t&262144?6:0),h=l?this.stack[l-2]:this.p.ranges[0].from,c=this.reducePos-h;c>=2e3&&!(!((e=this.p.parser.nodeSet.types[s])===null||e===void 0)&&e.isAnonymous)&&(h==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=c):this.p.lastBigReductionSize<c&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=h,this.p.lastBigReductionSize=c));let f=l?this.stack[l-1]:0,p=this.bufferBase+this.buffer.length-f;if(s<n.minRepeatTerm||t&131072){let m=n.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(s,h,m,p+4,!0)}if(t&262144)this.state=this.stack[l];else{let m=this.stack[l-3];this.state=n.getGoto(m,s,!0)}for(;this.stack.length>l;)this.stack.pop();this.reduceContext(s,h)}storeNode(t,e,i,s=4,n=!1){if(t==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let o=this,a=this.buffer.length;if(a==0&&o.parent&&(a=o.bufferBase-o.parent.bufferBase,o=o.parent),a>0&&o.buffer[a-4]==0&&o.buffer[a-1]>-1){if(e==i)return;if(o.buffer[a-2]>=e){o.buffer[a-2]=i;return}}}if(!n||this.pos==i)this.buffer.push(t,e,i,s);else{let o=this.buffer.length;if(o>0&&this.buffer[o-4]!=0){let a=!1;for(let l=o;l>0&&this.buffer[l-2]>i;l-=4)if(this.buffer[l-1]>=0){a=!0;break}if(a)for(;o>0&&this.buffer[o-2]>i;)this.buffer[o]=this.buffer[o-4],this.buffer[o+1]=this.buffer[o-3],this.buffer[o+2]=this.buffer[o-2],this.buffer[o+3]=this.buffer[o-1],o-=4,s>4&&(s-=4)}this.buffer[o]=t,this.buffer[o+1]=e,this.buffer[o+2]=i,this.buffer[o+3]=s}}shift(t,e,i,s){if(t&131072)this.pushState(t&65535,this.pos);else if(t&262144)this.pos=s,this.shiftContext(e,i),e<=this.p.parser.maxNode&&this.buffer.push(e,i,s,4);else{let n=t,{parser:o}=this.p;(s>this.pos||e<=o.maxNode)&&(this.pos=s,o.stateFlag(n,1)||(this.reducePos=s)),this.pushState(n,i),this.shiftContext(e,i),e<=o.maxNode&&this.buffer.push(e,i,s,4)}}apply(t,e,i,s){t&65536?this.reduce(t):this.shift(t,e,i,s)}useNode(t,e){let i=this.p.reused.length-1;(i<0||this.p.reused[i]!=t)&&(this.p.reused.push(t),i++);let s=this.pos;this.reducePos=this.pos=s+t.length,this.pushState(e,s),this.buffer.push(i,s,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,t,this,this.p.stream.reset(this.pos-t.length)))}split(){let t=this,e=t.buffer.length;for(;e>0&&t.buffer[e-2]>t.reducePos;)e-=4;let i=t.buffer.slice(e),s=t.bufferBase+e;for(;t&&s==t.bufferBase;)t=t.parent;return new eo(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,i,s,this.curContext,this.lookAhead,t)}recoverByDelete(t,e){let i=t<=this.p.parser.maxNode;i&&this.storeNode(t,this.pos,e,4),this.storeNode(0,this.pos,e,i?8:4),this.pos=this.reducePos=e,this.score-=190}canShift(t){for(let e=new Fb(this);;){let i=this.p.parser.stateSlot(e.state,4)||this.p.parser.hasAction(e.state,t);if(i==0)return!1;if(!(i&65536))return!0;e.reduce(i)}}recoverByInsert(t){if(this.stack.length>=300)return[];let e=this.p.parser.nextStates(this.state);if(e.length>8||this.stack.length>=120){let s=[];for(let n=0,o;n<e.length;n+=2)(o=e[n+1])!=this.state&&this.p.parser.hasAction(o,t)&&s.push(e[n],o);if(this.stack.length<120)for(let n=0;s.length<8&&n<e.length;n+=2){let o=e[n+1];s.some((a,l)=>l&1&&a==o)||s.push(e[n],o)}e=s}let i=[];for(let s=0;s<e.length&&i.length<4;s+=2){let n=e[s+1];if(n==this.state)continue;let o=this.split();o.pushState(n,this.pos),o.storeNode(0,o.pos,o.pos,4,!0),o.shiftContext(e[s],this.pos),o.reducePos=this.pos,o.score-=200,i.push(o)}return i}forceReduce(){let{parser:t}=this.p,e=t.stateSlot(this.state,5);if(!(e&65536))return!1;if(!t.validAction(this.state,e)){let i=e>>19,s=e&65535,n=this.stack.length-i*3;if(n<0||t.getGoto(this.stack[n],s,!1)<0){let o=this.findForcedReduction();if(o==null)return!1;e=o}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(e),!0}findForcedReduction(){let{parser:t}=this.p,e=[],i=(s,n)=>{if(!e.includes(s))return e.push(s),t.allActions(s,o=>{if(!(o&393216))if(o&65536){let a=(o>>19)-n;if(a>1){let l=o&65535,h=this.stack.length-a*3;if(h>=0&&t.getGoto(this.stack[h],l,!1)>=0)return a<<19|65536|l}}else{let a=i(o,n+1);if(a!=null)return a}})};return i(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:t}=this.p;return t.data[t.stateSlot(this.state,1)]==65535&&!t.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(t){if(this.state!=t.state||this.stack.length!=t.stack.length)return!1;for(let e=0;e<this.stack.length;e+=3)if(this.stack[e]!=t.stack[e])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(t){return this.p.parser.dialect.flags[t]}shiftContext(t,e){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,t,this,this.p.stream.reset(e)))}reduceContext(t,e){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,t,this,this.p.stream.reset(e)))}emitContext(){let t=this.buffer.length-1;(t<0||this.buffer[t]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let t=this.buffer.length-1;(t<0||this.buffer[t]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(t){if(t!=this.curContext.context){let e=new Nu(this.curContext.tracker,t);e.hash!=this.curContext.hash&&this.emitContext(),this.curContext=e}}setLookAhead(t){t>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=t)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class Nu{constructor(t,e){this.tracker=t,this.context=e,this.hash=t.strict?t.hash(e):0}}class Fb{constructor(t){this.start=t,this.state=t.state,this.stack=t.stack,this.base=this.stack.length}reduce(t){let e=t&65535,i=t>>19;i==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(i-1)*3;let s=this.start.p.parser.getGoto(this.stack[this.base-3],e,!0);this.state=s}}class io{constructor(t,e,i){this.stack=t,this.pos=e,this.index=i,this.buffer=t.buffer,this.index==0&&this.maybeNext()}static create(t,e=t.bufferBase+t.buffer.length){return new io(t,e,e-t.bufferBase)}maybeNext(){let t=this.stack.parent;t!=null&&(this.index=this.stack.bufferBase-t.bufferBase,this.stack=t,this.buffer=t.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new io(this.stack,this.pos,this.index)}}function Pr(r,t=Uint16Array){if(typeof r!="string")return r;let e=null;for(let i=0,s=0;i<r.length;){let n=0;for(;;){let o=r.charCodeAt(i++),a=!1;if(o==126){n=65535;break}o>=92&&o--,o>=34&&o--;let l=o-32;if(l>=46&&(l-=46,a=!0),n+=l,a)break;n*=46}e?e[s++]=n:e=new t(n)}return e}class Ur{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const Bu=new Ur;class zb{constructor(t,e){this.input=t,this.ranges=e,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=Bu,this.rangeIndex=0,this.pos=this.chunkPos=e[0].from,this.range=e[0],this.end=e[e.length-1].to,this.readNext()}resolveOffset(t,e){let i=this.range,s=this.rangeIndex,n=this.pos+t;for(;n<i.from;){if(!s)return null;let o=this.ranges[--s];n-=i.from-o.to,i=o}for(;e<0?n>i.to:n>=i.to;){if(s==this.ranges.length-1)return null;let o=this.ranges[++s];n+=o.from-i.to,i=o}return n}clipPos(t){if(t>=this.range.from&&t<this.range.to)return t;for(let e of this.ranges)if(e.to>t)return Math.max(t,e.from);return this.end}peek(t){let e=this.chunkOff+t,i,s;if(e>=0&&e<this.chunk.length)i=this.pos+t,s=this.chunk.charCodeAt(e);else{let n=this.resolveOffset(t,1);if(n==null)return-1;if(i=n,i>=this.chunk2Pos&&i<this.chunk2Pos+this.chunk2.length)s=this.chunk2.charCodeAt(i-this.chunk2Pos);else{let o=this.rangeIndex,a=this.range;for(;a.to<=i;)a=this.ranges[++o];this.chunk2=this.input.chunk(this.chunk2Pos=i),i+this.chunk2.length>a.to&&(this.chunk2=this.chunk2.slice(0,a.to-i)),s=this.chunk2.charCodeAt(0)}}return i>=this.token.lookAhead&&(this.token.lookAhead=i+1),s}acceptToken(t,e=0){let i=e?this.resolveOffset(e,-1):this.pos;if(i==null||i<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=t,this.token.end=i}acceptTokenTo(t,e){this.token.value=t,this.token.end=e}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:t,chunkPos:e}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=t,this.chunk2Pos=e,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let t=this.input.chunk(this.pos),e=this.pos+t.length;this.chunk=e>this.range.to?t.slice(0,this.range.to-this.pos):t,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(t=1){for(this.chunkOff+=t;this.pos+t>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();t-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=t,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(t,e){if(e?(this.token=e,e.start=t,e.lookAhead=t+1,e.value=e.extended=-1):this.token=Bu,this.pos!=t){if(this.pos=t,t==this.end)return this.setDone(),this;for(;t<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;t>=this.range.to;)this.range=this.ranges[++this.rangeIndex];t>=this.chunkPos&&t<this.chunkPos+this.chunk.length?this.chunkOff=t-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(t,e){if(t>=this.chunkPos&&e<=this.chunkPos+this.chunk.length)return this.chunk.slice(t-this.chunkPos,e-this.chunkPos);if(t>=this.chunk2Pos&&e<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(t-this.chunk2Pos,e-this.chunk2Pos);if(t>=this.range.from&&e<=this.range.to)return this.input.read(t,e);let i="";for(let s of this.ranges){if(s.from>=e)break;s.to>t&&(i+=this.input.read(Math.max(s.from,t),Math.min(s.to,e)))}return i}}class Hs{constructor(t,e){this.data=t,this.id=e}token(t,e){let{parser:i}=e.p;Ub(this.data,t,e,this.id,i.data,i.tokenPrecTable)}}Hs.prototype.contextual=Hs.prototype.fallback=Hs.prototype.extend=!1;Hs.prototype.fallback=Hs.prototype.extend=!1;function Ub(r,t,e,i,s,n){let o=0,a=1<<i,{dialect:l}=e.p.parser;t:for(;a&r[o];){let h=r[o+1];for(let m=o+3;m<h;m+=2)if((r[m+1]&a)>0){let y=r[m];if(l.allows(y)&&(t.token.value==-1||t.token.value==y||Wb(y,t.token.value,s,n))){t.acceptToken(y);break}}let c=t.next,f=0,p=r[o+2];if(t.next<0&&p>f&&r[h+p*3-3]==65535){o=r[h+p*3-1];continue t}for(;f<p;){let m=f+p>>1,y=h+m+(m<<1),b=r[y],S=r[y+1]||65536;if(c<b)p=m;else if(c>=S)f=m+1;else{o=r[y+2],t.advance();continue t}}break}}function _u(r,t,e){for(let i=t,s;(s=r[i])!=65535;i++)if(s==e)return i-t;return-1}function Wb(r,t,e,i){let s=_u(e,i,t);return s<0||_u(e,i,r)<s}const ke=typeof process<"u"&&process.env&&/\bparse\b/.test({}.LOG);let fa=null;function $u(r,t,e){let i=r.cursor(Xt.IncludeAnonymous);for(i.moveTo(t);;)if(!(e<0?i.childBefore(t):i.childAfter(t)))for(;;){if((e<0?i.to<t:i.from>t)&&!i.type.isError)return e<0?Math.max(0,Math.min(i.to-1,t-25)):Math.min(r.length,Math.max(i.from+1,t+25));if(e<0?i.prevSibling():i.nextSibling())break;if(!i.parent())return e<0?0:r.length}}class jb{constructor(t,e){this.fragments=t,this.nodeSet=e,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let t=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(t){for(this.safeFrom=t.openStart?$u(t.tree,t.from+t.offset,1)-t.offset:t.from,this.safeTo=t.openEnd?$u(t.tree,t.to+t.offset,-1)-t.offset:t.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(t.tree),this.start.push(-t.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(t){if(t<this.nextStart)return null;for(;this.fragment&&this.safeTo<=t;)this.nextFragment();if(!this.fragment)return null;for(;;){let e=this.trees.length-1;if(e<0)return this.nextFragment(),null;let i=this.trees[e],s=this.index[e];if(s==i.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let n=i.children[s],o=this.start[e]+i.positions[s];if(o>t)return this.nextStart=o,null;if(n instanceof Wt){if(o==t){if(o<this.safeFrom)return null;let a=o+n.length;if(a<=this.safeTo){let l=n.prop(bt.lookAhead);if(!l||a+l<this.fragment.to)return n}}this.index[e]++,o+n.length>=Math.max(this.safeFrom,t)&&(this.trees.push(n),this.start.push(o),this.index.push(0))}else this.index[e]++,this.nextStart=o+n.length}}}class Hb{constructor(t,e){this.stream=e,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=t.tokenizers.map(i=>new Ur)}getActions(t){let e=0,i=null,{parser:s}=t.p,{tokenizers:n}=s,o=s.stateSlot(t.state,3),a=t.curContext?t.curContext.hash:0,l=0;for(let h=0;h<n.length;h++){if(!(1<<h&o))continue;let c=n[h],f=this.tokens[h];if(!(i&&!c.fallback)&&((c.contextual||f.start!=t.pos||f.mask!=o||f.context!=a)&&(this.updateCachedToken(f,c,t),f.mask=o,f.context=a),f.lookAhead>f.end+25&&(l=Math.max(f.lookAhead,l)),f.value!=0)){let p=e;if(f.extended>-1&&(e=this.addActions(t,f.extended,f.end,e)),e=this.addActions(t,f.value,f.end,e),!c.extend&&(i=f,e>p))break}}for(;this.actions.length>e;)this.actions.pop();return l&&t.setLookAhead(l),!i&&t.pos==this.stream.end&&(i=new Ur,i.value=t.p.parser.eofTerm,i.start=i.end=t.pos,e=this.addActions(t,i.value,i.end,e)),this.mainToken=i,this.actions}getMainToken(t){if(this.mainToken)return this.mainToken;let e=new Ur,{pos:i,p:s}=t;return e.start=i,e.end=Math.min(i+1,s.stream.end),e.value=i==s.stream.end?s.parser.eofTerm:0,e}updateCachedToken(t,e,i){let s=this.stream.clipPos(i.pos);if(e.token(this.stream.reset(s,t),i),t.value>-1){let{parser:n}=i.p;for(let o=0;o<n.specialized.length;o++)if(n.specialized[o]==t.value){let a=n.specializers[o](this.stream.read(t.start,t.end),i);if(a>=0&&i.p.parser.dialect.allows(a>>1)){a&1?t.extended=a>>1:t.value=a>>1;break}}}else t.value=0,t.end=this.stream.clipPos(s+1)}putAction(t,e,i,s){for(let n=0;n<s;n+=3)if(this.actions[n]==t)return s;return this.actions[s++]=t,this.actions[s++]=e,this.actions[s++]=i,s}addActions(t,e,i,s){let{state:n}=t,{parser:o}=t.p,{data:a}=o;for(let l=0;l<2;l++)for(let h=o.stateSlot(n,l?2:1);;h+=3){if(a[h]==65535)if(a[h+1]==1)h=Si(a,h+2);else{s==0&&a[h+1]==2&&(s=this.putAction(Si(a,h+2),e,i,s));break}a[h]==e&&(s=this.putAction(Si(a,h+1),e,i,s))}return s}}class Vb{constructor(t,e,i,s){this.parser=t,this.input=e,this.ranges=s,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new zb(e,s),this.tokens=new Hb(t,this.stream),this.topTerm=t.top[1];let{from:n}=s[0];this.stacks=[eo.start(this,t.top[0],n)],this.fragments=i.length&&this.stream.end-n>t.bufferLength*4?new jb(i,t.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let t=this.stacks,e=this.minStackPos,i=this.stacks=[],s,n;if(this.bigReductionCount>300&&t.length==1){let[o]=t;for(;o.forceReduce()&&o.stack.length&&o.stack[o.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let o=0;o<t.length;o++){let a=t[o];for(;;){if(this.tokens.mainToken=null,a.pos>e)i.push(a);else{if(this.advanceStack(a,i,t))continue;{s||(s=[],n=[]),s.push(a);let l=this.tokens.getMainToken(a);n.push(l.value,l.end)}}break}}if(!i.length){let o=s&&Kb(s);if(o)return ke&&console.log("Finish with "+this.stackID(o)),this.stackToTree(o);if(this.parser.strict)throw ke&&s&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+e);this.recovering||(this.recovering=5)}if(this.recovering&&s){let o=this.stoppedAt!=null&&s[0].pos>this.stoppedAt?s[0]:this.runRecovery(s,n,i);if(o)return ke&&console.log("Force-finish "+this.stackID(o)),this.stackToTree(o.forceAll())}if(this.recovering){let o=this.recovering==1?1:this.recovering*3;if(i.length>o)for(i.sort((a,l)=>l.score-a.score);i.length>o;)i.pop();i.some(a=>a.reducePos>e)&&this.recovering--}else if(i.length>1){t:for(let o=0;o<i.length-1;o++){let a=i[o];for(let l=o+1;l<i.length;l++){let h=i[l];if(a.sameState(h)||a.buffer.length>500&&h.buffer.length>500)if((a.score-h.score||a.buffer.length-h.buffer.length)>0)i.splice(l--,1);else{i.splice(o--,1);continue t}}}i.length>12&&i.splice(12,i.length-12)}this.minStackPos=i[0].pos;for(let o=1;o<i.length;o++)i[o].pos<this.minStackPos&&(this.minStackPos=i[o].pos);return null}stopAt(t){if(this.stoppedAt!=null&&this.stoppedAt<t)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=t}advanceStack(t,e,i){let s=t.pos,{parser:n}=this,o=ke?this.stackID(t)+" -> ":"";if(this.stoppedAt!=null&&s>this.stoppedAt)return t.forceReduce()?t:null;if(this.fragments){let h=t.curContext&&t.curContext.tracker.strict,c=h?t.curContext.hash:0;for(let f=this.fragments.nodeAt(s);f;){let p=this.parser.nodeSet.types[f.type.id]==f.type?n.getGoto(t.state,f.type.id):-1;if(p>-1&&f.length&&(!h||(f.prop(bt.contextHash)||0)==c))return t.useNode(f,p),ke&&console.log(o+this.stackID(t)+` (via reuse of ${n.getName(f.type.id)})`),!0;if(!(f instanceof Wt)||f.children.length==0||f.positions[0]>0)break;let m=f.children[0];if(m instanceof Wt&&f.positions[0]==0)f=m;else break}}let a=n.stateSlot(t.state,4);if(a>0)return t.reduce(a),ke&&console.log(o+this.stackID(t)+` (via always-reduce ${n.getName(a&65535)})`),!0;if(t.stack.length>=8400)for(;t.stack.length>6e3&&t.forceReduce(););let l=this.tokens.getActions(t);for(let h=0;h<l.length;){let c=l[h++],f=l[h++],p=l[h++],m=h==l.length||!i,y=m?t:t.split(),b=this.tokens.mainToken;if(y.apply(c,f,b?b.start:y.pos,p),ke&&console.log(o+this.stackID(y)+` (via ${c&65536?`reduce of ${n.getName(c&65535)}`:"shift"} for ${n.getName(f)} @ ${s}${y==t?"":", split"})`),m)return!0;y.pos>s?e.push(y):i.push(y)}return!1}advanceFully(t,e){let i=t.pos;for(;;){if(!this.advanceStack(t,null,null))return!1;if(t.pos>i)return Fu(t,e),!0}}runRecovery(t,e,i){let s=null,n=!1;for(let o=0;o<t.length;o++){let a=t[o],l=e[o<<1],h=e[(o<<1)+1],c=ke?this.stackID(a)+" -> ":"";if(a.deadEnd&&(n||(n=!0,a.restart(),ke&&console.log(c+this.stackID(a)+" (restarted)"),this.advanceFully(a,i))))continue;let f=a.split(),p=c;for(let m=0;f.forceReduce()&&m<10&&(ke&&console.log(p+this.stackID(f)+" (via force-reduce)"),!this.advanceFully(f,i));m++)ke&&(p=this.stackID(f)+" -> ");for(let m of a.recoverByInsert(l))ke&&console.log(c+this.stackID(m)+" (via recover-insert)"),this.advanceFully(m,i);this.stream.end>a.pos?(h==a.pos&&(h++,l=0),a.recoverByDelete(l,h),ke&&console.log(c+this.stackID(a)+` (via recover-delete ${this.parser.getName(l)})`),Fu(a,i)):(!s||s.score<a.score)&&(s=a)}return s}stackToTree(t){return t.close(),Wt.build({buffer:io.create(t),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:t.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(t){let e=(fa||(fa=new WeakMap)).get(t);return e||fa.set(t,e=String.fromCodePoint(this.nextStackID++)),e+t}}function Fu(r,t){for(let e=0;e<t.length;e++){let i=t[e];if(i.pos==r.pos&&i.sameState(r)){t[e].score<r.score&&(t[e]=r);return}}t.push(r)}class qb{constructor(t,e,i){this.source=t,this.flags=e,this.disabled=i}allows(t){return!this.disabled||this.disabled[t]==0}}class so extends xf{constructor(t){if(super(),this.wrappers=[],t.version!=14)throw new RangeError(`Parser version (${t.version}) doesn't match runtime version (14)`);let e=t.nodeNames.split(" ");this.minRepeatTerm=e.length;for(let a=0;a<t.repeatNodeCount;a++)e.push("");let i=Object.keys(t.topRules).map(a=>t.topRules[a][1]),s=[];for(let a=0;a<e.length;a++)s.push([]);function n(a,l,h){s[a].push([l,l.deserialize(String(h))])}if(t.nodeProps)for(let a of t.nodeProps){let l=a[0];typeof l=="string"&&(l=bt[l]);for(let h=1;h<a.length;){let c=a[h++];if(c>=0)n(c,l,a[h++]);else{let f=a[h+-c];for(let p=-c;p>0;p--)n(a[h++],l,f);h++}}}this.nodeSet=new vl(e.map((a,l)=>xe.define({name:l>=this.minRepeatTerm?void 0:a,id:l,props:s[l],top:i.indexOf(l)>-1,error:l==0,skipped:t.skippedNodes&&t.skippedNodes.indexOf(l)>-1}))),t.propSources&&(this.nodeSet=this.nodeSet.extend(...t.propSources)),this.strict=!1,this.bufferLength=vf;let o=Pr(t.tokenData);this.context=t.context,this.specializerSpecs=t.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let a=0;a<this.specializerSpecs.length;a++)this.specialized[a]=this.specializerSpecs[a].term;this.specializers=this.specializerSpecs.map(zu),this.states=Pr(t.states,Uint32Array),this.data=Pr(t.stateData),this.goto=Pr(t.goto),this.maxTerm=t.maxTerm,this.tokenizers=t.tokenizers.map(a=>typeof a=="number"?new Hs(o,a):a),this.topRules=t.topRules,this.dialects=t.dialects||{},this.dynamicPrecedences=t.dynamicPrecedences||null,this.tokenPrecTable=t.tokenPrec,this.termNames=t.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(t,e,i){let s=new Vb(this,t,e,i);for(let n of this.wrappers)s=n(s,t,e,i);return s}getGoto(t,e,i=!1){let s=this.goto;if(e>=s[0])return-1;for(let n=s[e+1];;){let o=s[n++],a=o&1,l=s[n++];if(a&&i)return l;for(let h=n+(o>>1);n<h;n++)if(s[n]==t)return l;if(a)return-1}}hasAction(t,e){let i=this.data;for(let s=0;s<2;s++)for(let n=this.stateSlot(t,s?2:1),o;;n+=3){if((o=i[n])==65535)if(i[n+1]==1)o=i[n=Si(i,n+2)];else{if(i[n+1]==2)return Si(i,n+2);break}if(o==e||o==0)return Si(i,n+1)}return 0}stateSlot(t,e){return this.states[t*6+e]}stateFlag(t,e){return(this.stateSlot(t,0)&e)>0}validAction(t,e){return!!this.allActions(t,i=>i==e?!0:null)}allActions(t,e){let i=this.stateSlot(t,4),s=i?e(i):void 0;for(let n=this.stateSlot(t,1);s==null;n+=3){if(this.data[n]==65535)if(this.data[n+1]==1)n=Si(this.data,n+2);else break;s=e(Si(this.data,n+1))}return s}nextStates(t){let e=[];for(let i=this.stateSlot(t,1);;i+=3){if(this.data[i]==65535)if(this.data[i+1]==1)i=Si(this.data,i+2);else break;if(!(this.data[i+2]&1)){let s=this.data[i+1];e.some((n,o)=>o&1&&n==s)||e.push(this.data[i],s)}}return e}configure(t){let e=Object.assign(Object.create(so.prototype),this);if(t.props&&(e.nodeSet=this.nodeSet.extend(...t.props)),t.top){let i=this.topRules[t.top];if(!i)throw new RangeError(`Invalid top rule name ${t.top}`);e.top=i}return t.tokenizers&&(e.tokenizers=this.tokenizers.map(i=>{let s=t.tokenizers.find(n=>n.from==i);return s?s.to:i})),t.specializers&&(e.specializers=this.specializers.slice(),e.specializerSpecs=this.specializerSpecs.map((i,s)=>{let n=t.specializers.find(a=>a.from==i.external);if(!n)return i;let o=Object.assign(Object.assign({},i),{external:n.to});return e.specializers[s]=zu(o),o})),t.contextTracker&&(e.context=t.contextTracker),t.dialect&&(e.dialect=this.parseDialect(t.dialect)),t.strict!=null&&(e.strict=t.strict),t.wrap&&(e.wrappers=e.wrappers.concat(t.wrap)),t.bufferLength!=null&&(e.bufferLength=t.bufferLength),e}hasWrappers(){return this.wrappers.length>0}getName(t){return this.termNames?this.termNames[t]:String(t<=this.maxNode&&this.nodeSet.types[t].name||t)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(t){let e=this.dynamicPrecedences;return e==null?0:e[t]||0}parseDialect(t){let e=Object.keys(this.dialects),i=e.map(()=>!1);if(t)for(let n of t.split(" ")){let o=e.indexOf(n);o>=0&&(i[o]=!0)}let s=null;for(let n=0;n<e.length;n++)if(!i[n])for(let o=this.dialects[e[n]],a;(a=this.data[o++])!=65535;)(s||(s=new Uint8Array(this.maxTerm+1)))[a]=1;return new qb(t,i,s)}static deserialize(t){return new so(t)}}function Si(r,t){return r[t]|r[t+1]<<16}function Kb(r){let t=null;for(let e of r){let i=e.p.stoppedAt;(e.pos==e.p.stream.end||i!=null&&e.pos>i)&&e.p.parser.stateFlag(e.state,2)&&(!t||t.score<e.score)&&(t=e)}return t}function zu(r){if(r.external){let t=r.extend?1:0;return(e,i)=>r.external(e,i)<<1|t}return r.get}const Gb=Dd({Keyword:A.keyword,NamespaceName:A.namespace,ClassName:A.className,ExtendsName:A.className,String:A.string,Number:A.number,Punctuation:A.operator,Comment:A.comment}),Yb={__proto__:null,namespace:8,class:14,extends:18,bool:28,byte:30,sbyte:32,short:34,ushort:36,int:38,uint:40,long:42,ulong:44,double:46,float:48,decimal:50,string:52,char:54,void:56,object:58,typeof:60,sizeof:62,null:64,true:66,false:68,if:70,else:72,while:74,for:76,foreach:78,do:80,switch:82,case:84,default:86,try:88,catch:90,finally:92,lock:94,goto:96,break:98,continue:100,return:102,throw:104,public:106,private:108,internal:110,protected:112,static:114,readonly:116,sealed:118,const:120,fixed:122,stackalloc:124,volatile:126,new:128,override:130,abstract:132,virtual:134,event:136,extern:138,ref:140,out:142,in:144,is:146,as:148,params:150,arglist:152,makeref:154,reftype:156,refvalue:158,this:160,base:162,using:164,struct:166,interface:168,enum:170,delegate:172,checked:174,unchecked:176,unsafe:178,operator:180,explicit:182,implicit:184,yield:186,partial:188,alias:190,global:192,assembly:194,module:196,type:198,field:200,method:202,param:204,property:206,typevar:208,get:210,set:212,add:214,remove:216,where:218,from:220,group:222,join:224,into:226,let:228,by:230,select:232,orderby:234,on:236,equals:238,ascending:240,descending:242,nameof:244,async:246,await:248,when:250,or:252,and:254,not:256,var:258,dynamic:260},Xb=so.deserialize({version:14,states:"$zQ]QPOOP,VOPOOO,_QPO'#CgO,fQPO'#ChOOQO'#Fe'#FeOOQO'#Fk'#FkOOQO'#Fx'#FxOOQO'#FW'#FWOOQO'#F_'#F_OOQO'#FX'#FXQ]QPOOO,mQPO'#C_O,rQPO'#CbOOQO'#Ci'#CiPOOO'#C]'#C]POOO)CAP)CAPOOQO,59R,59RO,wQPO,59ROOQO,59S,59SO-OQPO,59SOOQO-E9V-E9VOOQO'#Ca'#CaOOQO,58y,58yOOQO'#Cd'#CdO-VQPO,58|OOQO1G.m1G.mOOQO1G.n1G.nO8]QPO1G.hOOQO'#Cf'#CfOOQO7+$S7+$S",stateData:"8h~O$OOS$PPQ$QPQ~OSZOV[O^]O_]O`]Oa]Ob]Oc]Od]Oe]Of]Og]Oh]Oi]Oj]Ok]Ol]Om]On]Oo]Op]Oq]Or]Os]Ot]Ou]Ov]Ow]Ox]Oy]Oz]O{]O|]O}]O!O]O!P]O!Q]O!R]O!S]O!T]O!U]O!V]O!W]O!X]O!Y]O!Z]O![]O!]]O!^]O!_]O!`]O!a]O!b]O!c]O!d]O!e]O!f]O!g]O!h]O!i]O!j]O!k]O!l]O!m]O!n]O!o]O!p]O!q]O!r]O!s]O!t]O!u]O!v]O!w]O!x]O!y]O!z]O!{]O!|]O!}]O#O]O#P]O#Q]O#R]O#S]O#T]O#U]O#V]O#W]O#X]O#Y]O#Z]O#[]O#]]O#^]O#_]O#`]O#a]O#b]O#c]O#d]O#e]O#f]O#g]O#h]O#i]O#j]O#k]O#l]O#m]O#n]O#o]O#p]O#q]O#r]O#s]O#t]O#u]O#v]O#wSO#xSO#ySO$UQO$WRO$YVO$ZVO$[VO$]VO$^VO$`TO$aTO$bTO$cTO$dTO$eTO$fTO$gTO$hTO$iTO$jTO$kTO$mUO$nUO$oUO$pUO$qUO$rUO$sUO$tUO$uUO$vUO$wUO$xUO$yUO$zUO${UO$|UO$}UO%OUO%PUO%QUO%RUO%SUO%TUO%UUO%VUO~O$P^O$Q^O~O$T`O~P]O$VbO~P]O$SeO~O$SgO~O$TiO~P]O$VjO~P]OXkOSUaVUa^Ua_Ua`UaaUabUacUadUaeUafUagUahUaiUajUakUalUamUanUaoUapUaqUarUasUatUauUavUawUaxUayUazUa{Ua|Ua}Ua!OUa!PUa!QUa!RUa!SUa!TUa!UUa!VUa!WUa!XUa!YUa!ZUa![Ua!]Ua!^Ua!_Ua!`Ua!aUa!bUa!cUa!dUa!eUa!fUa!gUa!hUa!iUa!jUa!kUa!lUa!mUa!nUa!oUa!pUa!qUa!rUa!sUa!tUa!uUa!vUa!wUa!xUa!yUa!zUa!{Ua!|Ua!}Ua#OUa#PUa#QUa#RUa#SUa#TUa#UUa#VUa#WUa#XUa#YUa#ZUa#[Ua#]Ua#^Ua#_Ua#`Ua#aUa#bUa#cUa#dUa#eUa#fUa#gUa#hUa#iUa#jUa#kUa#lUa#mUa#nUa#oUa#pUa#qUa#rUa#sUa#tUa#uUa#vUa#wUa#xUa#yUa#|Ua$UUa$WUa$YUa$ZUa$[Ua$]Ua$^Ua$`Ua$aUa$bUa$cUa$dUa$eUa$fUa$gUa$hUa$iUa$jUa$kUa$mUa$nUa$oUa$pUa$qUa$rUa$sUa$tUa$uUa$vUa$wUa$xUa$yUa$zUa${Ua$|Ua$}Ua%OUa%PUa%QUa%RUa%SUa%TUa%UUa%VUa$TUa$VUa~O$SlO~O$Q$P$S$O$p~",goto:"%r$mP$nP$qP$y$qP$|P%P$q$q$qPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP$q%SPPPPP%bPPPPP$qPPPPP%jPPPPPPPPPPPP%jR_P]WOQRYacRfZRh[RmkQYOQaQQcRVdYac]XOQRYac]VOQRYac",nodeNames:" Comment Root Namespace Keyword NamespaceName Class Keyword ClassName Keyword ExtendsName Block Group Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword Keyword String Number Char Punctuation",maxTerm:191,propSources:[Gb],skippedNodes:[0,1],repeatNodeCount:1,tokenData:"5Z~R!RX^$[pq$[qr%Prs%ftu&ouv'dvw'qwx(Wxy)dyz)iz{)n{|){}!O*b!O!P*w!P!Q+w!Q!R-z!R![.c![!]/t!^!_/y!_!`0h!`!a0}!a!b1l!c!}&o!}#O2Z#P#Q2`#Q#R2e#R#S&o#T#o&o#o#p2r#p#q2w#q#r3^#r#s3c#y#z$[$f$g$[$g#BY&o#BY#BZ3h#BZ$IS&o$IS$I_3h$I_$I|&o$I|$JO3h$JO$JT&o$JT$JU3h$JU$KV&o$KV$KW3h$KW&FU&o&FU&FV3h&FV;'S&o;'S;=`'^<%lO&o~$aY$O~X^$[pq$[#y#z$[$f$g$[#BY#BZ$[$IS$I_$[$I|$JO$[$JT$JU$[$KV$KW$[&FU&FV$[~%UQ$m~!O!P%[!_!`%a~%aO$]~~%fO$w~~%kW#w~OY%fZr%frs&Ts#O%f#O#P&Y#P;'S%f;'S;=`&i<%lO%f~&YO#w~~&]SOY%fZ;'S%f;'S;=`&i<%lO%f~&lP;=`<%l%f~&tW$S~tu&o!Q![&o!c!}&o#R#S&o#T#o&o$g;'S&o;'S;=`'^<%lO&o~'aP;=`<%l&o~'iP$s~!_!`'l~'qO$e~~'vQ${~vw'|!_!`(R~(RO%P~~(WO$g~~(ZVOY(pZw(px#O(p#O#P(}#P;'S(p;'S;=`)^<%lO(p~(uP#y~wx(x~(}O#y~~)QSOY(pZ;'S(p;'S;=`)^<%lO(p~)aP;=`<%l(p~)iO$W~~)nO$V~~)sP$o~!_!`)v~){O$a~~*QQ$q~{|*W!_!`*]~*]O%U~~*bO$c~~*gQ$r~}!O*m!_!`*r~*rO%V~~*wO$d~~*zP!Q![*}~+SR#x~!Q![*}!g!h+]#X#Y+]~+`R{|+i}!O+i!Q![+o~+lP!Q![+o~+tP#x~!Q![+o~+|R$p~z{,V!P!Q-^!_!`-u~,YTOz,Vz{,i{;'S,V;'S;=`-W<%lO,V~,lVOz,Vz{,i{!P,V!P!Q-R!Q;'S,V;'S;=`-W<%lO,V~-WO$Q~~-ZP;=`<%l,V~-cS$P~OY-^Z;'S-^;'S;=`-o<%lO-^~-rP;=`<%l-^~-zO$b~~.PU#x~!O!P*}!Q![.c!g!h+]#U#V.t#X#Y+]#l#m/Y~.hS#x~!O!P*}!Q![.c!g!h+]#X#Y+]~.wQ!Q!R.}!R!S.}~/SQ#x~!Q!R.}!R!S.}~/]R!Q![/f!c!i/f#T#Z/f~/kR#x~!Q![/f!c!i/f#T#Z/f~/yO%T~~0OQ$t~!^!_0U!_!`0c~0ZP%O~!_!`0^~0cO$j~~0hO$y~~0mQ$`~!_!`0s!`!a0x~0xO$v~~0}O$^~~1SQ$u~!_!`1Y!`!a1_~1_O$x~~1dP$}~!_!`1g~1lO$i~~1qQ%S~!O!P1w!a!b1|~1|O$[~~2RP%R~!_!`2U~2ZO$k~~2`O$Y~~2eO$Z~~2jP$z~!_!`2m~2rO$f~~2wO$U~~2|Q$|~!_!`3S#p#q3X~3XO$h~~3^O%Q~~3cO$T~~3hO$n~~3oh$S~$O~X^$[pq$[tu&o!Q![&o!c!}&o#R#S&o#T#o&o#y#z$[$f$g$[$g#BY&o#BY#BZ3h#BZ$IS&o$IS$I_3h$I_$I|&o$I|$JO3h$JO$JT&o$JT$JU3h$JU$KV&o$KV$KW3h$KW&FU&o&FU&FV3h&FV;'S&o;'S;=`'^<%lO&o",tokenizers:[0],topRules:{Root:[0,2]},specialized:[{term:142,get:r=>Yb[r]||-1}],tokenPrec:1076});let Ll;Ll??=new pi("Introduction",!1);Ll.loadData({version:0,timeEvents:[],seed:3595415307});const Qb=Ll,Zb=`#version 300 es
precision highp float;

in vec2 screenUV;
in vec2 sourceUV;
in vec2 destinationUV;

out vec4 outColor;

uniform float time;
uniform float deltaTime;
uniform float framerate;
uniform int frame;
uniform vec2 resolution;
uniform sampler2D sourceTexture;
uniform sampler2D destinationTexture;
uniform mat4 sourceMatrix;
uniform mat4 destinationMatrix;


/*
  Feel free to do anything you want with this code.
  This shader uses "runes" code by FabriceNeyret2 (https://www.shadertoy.com/view/4ltyDM)
  which is based on "runes" by otaviogood (https://shadertoy.com/view/MsXSRn).
  These random runes look good as matrix symbols and have acceptable performance.
*/

const int ITERATIONS = 40;   //use less value if you need more performance
const float SPEED = 1.;

const float STRIP_CHARS_MIN =  7.;
const float STRIP_CHARS_MAX = 40.;
const float STRIP_CHAR_HEIGHT = 0.15;
const float STRIP_CHAR_WIDTH = 0.10;
const float ZCELL_SIZE = 1. * (STRIP_CHAR_HEIGHT * STRIP_CHARS_MAX);  //the multiplier can't be less than 1.
const float XYCELL_SIZE = 12. * STRIP_CHAR_WIDTH;  //the multiplier can't be less than 1.

const int BLOCK_SIZE = 10;  //in cells
const int BLOCK_GAP = 2;    //in cells

const float WALK_SPEED = 1. * XYCELL_SIZE;
const float BLOCKS_BEFORE_TURN = 3.;


const float PI = 3.14159265359;


//        ----  random  ----

float hash(float v) {
    return fract(sin(v)*43758.5453123);
}

float hash(vec2 v) {
    return hash(dot(v, vec2(5.3983, 5.4427)));
}

vec2 hash2(vec2 v)
{
    v = vec2(v * mat2(127.1, 311.7,  269.5, 183.3));
	return fract(sin(v)*43758.5453123);
}

vec4 hash4(vec2 v)
{
    vec4 p = vec4(v * mat4x2( 127.1, 311.7,
                              269.5, 183.3,
                              113.5, 271.9,
                              246.1, 124.6 ));
    return fract(sin(p)*43758.5453123);
}

vec4 hash4(vec3 v)
{
    vec4 p = vec4(v * mat4x3( 127.1, 311.7, 74.7,
                              269.5, 183.3, 246.1,
                              113.5, 271.9, 124.6,
                              271.9, 269.5, 311.7 ) );
    return fract(sin(p)*43758.5453123);
}


//        ----  symbols  ----
//  Slightly modified version of "runes" by FabriceNeyret2 -  https://www.shadertoy.com/view/4ltyDM
//  Which is based on "runes" by otaviogood -  https://shadertoy.com/view/MsXSRn

float rune_line(vec2 p, vec2 a, vec2 b) {   // from https://www.shadertoy.com/view/4dcfW8
    p -= a, b -= a;
	float h = clamp(dot(p, b) / dot(b, b), 0., 1.);   // proj coord on line
	return length(p - b * h);                         // dist to segment
}

float rune(vec2 U, vec2 seed, float highlight)
{
	float d = 1e5;
	for (int i = 0; i < 4; i++)	// number of strokes
	{
        vec4 pos = hash4(seed);
		seed += 1.;

		// each rune touches the edge of its box on all 4 sides
		if (i == 0) pos.y = .0;
		if (i == 1) pos.x = .999;
		if (i == 2) pos.x = .0;
		if (i == 3) pos.y = .999;
		// snap the random line endpoints to a grid 2x3
		vec4 snaps = vec4(2, 3, 2, 3);
		pos = ( floor(pos * snaps) + .5) / snaps;

		if (pos.xy != pos.zw)  //filter out single points (when start and end are the same)
		    d = min(d, rune_line(U, pos.xy, pos.zw + .001) ); // closest line
	}
	return smoothstep(0.1, 0., d) + highlight*smoothstep(0.4, 0., d);
}

float random_char(vec2 outer, vec2 inner, float highlight) {
    vec2 seed = vec2(dot(outer, vec2(269.5, 183.3)), dot(outer, vec2(113.5, 271.9)));
    return rune(inner, seed, highlight);
}


//        ----  digital rain  ----

// xy - horizontal, z - vertical
vec3 rain(vec3 ro3, vec3 rd3, float time) {
    vec4 result = vec4(0.);

    // normalized 2d projection
    vec2 ro2 = vec2(ro3);
    vec2 rd2 = normalize(vec2(rd3));

    // we use formulas \`ro3 + rd3 * t3\` and \`ro2 + rd2 * t2\`, \`t3_to_t2\` is a multiplier to convert t3 to t2
    bool prefer_dx = abs(rd2.x) > abs(rd2.y);
    float t3_to_t2 = prefer_dx ? rd3.x / rd2.x : rd3.y / rd2.y;

    // at first, horizontal space (xy) is divided into cells (which are columns in 3D)
    // then each xy-cell is divided into vertical cells (along z) - each of these cells contains one raindrop

    ivec3 cell_side = ivec3(step(0., rd3));      //for positive rd.x use cell side with higher x (1) as the next side, for negative - with lower x (0), the same for y and z
    ivec3 cell_shift = ivec3(sign(rd3));         //shift to move to the next cell

    //  move through xy-cells in the ray direction
    float t2 = 0.;  // the ray formula is: ro2 + rd2 * t2, where t2 is positive as the ray has a direction.
    ivec2 next_cell = ivec2(floor(ro2/XYCELL_SIZE));  //first cell index where ray origin is located
    for (int i=0; i<ITERATIONS; i++) {
        ivec2 cell = next_cell;  //save cell value before changing
        float t2s = t2;          //and t

        //  find the intersection with the nearest side of the current xy-cell (since we know the direction, we only need to check one vertical side and one horizontal side)
        vec2 side = vec2(next_cell + cell_side.xy) * XYCELL_SIZE;  //side.x is x coord of the y-axis side, side.y - y of the x-axis side
        vec2 t2_side = (side - ro2) / rd2;  // t2_side.x and t2_side.y are two candidates for the next value of t2, we need the nearest
        if (t2_side.x < t2_side.y) {
            t2 = t2_side.x;
            next_cell.x += cell_shift.x;  //cross through the y-axis side
        } else {
            t2 = t2_side.y;
            next_cell.y += cell_shift.y;  //cross through the x-axis side
        }
        //now t2 is the value of the end point in the current cell (and the same point is the start value in the next cell)

        //  gap cells
        vec2 cell_in_block = fract(vec2(cell) / float(BLOCK_SIZE));
        float gap = float(BLOCK_GAP) / float(BLOCK_SIZE);
        if (cell_in_block.x < gap || cell_in_block.y < gap || (cell_in_block.x < (gap+0.1) && cell_in_block.y < (gap+0.1))) {
            continue;
        }

        //  return to 3d - we have start and end points of the ray segment inside the column (t3s and t3e)
        float t3s = t2s / t3_to_t2;

        //  move through z-cells of the current column in the ray direction (don't need much to check, two nearest cells are enough)
        float pos_z = ro3.z + rd3.z * t3s;
        float xycell_hash = hash(vec2(cell));
        float z_shift = xycell_hash*11. - time * (0.5 + xycell_hash * 1.0 + xycell_hash * xycell_hash * 1.0 + pow(xycell_hash, 16.) * 3.0);  //a different z shift for each xy column
        float char_z_shift = floor(z_shift / STRIP_CHAR_HEIGHT);
        z_shift = char_z_shift * STRIP_CHAR_HEIGHT;
        int zcell = int(floor((pos_z - z_shift)/ZCELL_SIZE));  //z-cell index
        for (int j=0; j<2; j++) {  //2 iterations is enough if camera doesn't look much up or down
            //  calcaulate coordinates of the target (raindrop)
            vec4 cell_hash = hash4(vec3(ivec3(cell, zcell)));
            vec4 cell_hash2 = fract(cell_hash * vec4(127.1, 311.7, 271.9, 124.6));

            float chars_count = cell_hash.w * (STRIP_CHARS_MAX - STRIP_CHARS_MIN) + STRIP_CHARS_MIN;
            float target_length = chars_count * STRIP_CHAR_HEIGHT;
            float target_rad = STRIP_CHAR_WIDTH / 2.;
            float target_z = (float(zcell)*ZCELL_SIZE + z_shift) + cell_hash.z * (ZCELL_SIZE - target_length);
            vec2 target = vec2(cell) * XYCELL_SIZE + target_rad + cell_hash.xy * (XYCELL_SIZE - target_rad*2.);

            //  We have a line segment (t0,t). Now calculate the distance between line segment and cell target (it's easier in 2d)
            vec2 s = target - ro2;
            float tmin = dot(s, rd2);  //tmin - point with minimal distance to target
            if (tmin >= t2s && tmin <= t2) {
                float u = s.x * rd2.y - s.y * rd2.x;  //horizontal coord in the matrix strip
                if (abs(u) < target_rad) {
                    u = (u/target_rad + 1.) / 2.;
                    float z = ro3.z + rd3.z * tmin/t3_to_t2;
                    float v = (z - target_z) / target_length;  //vertical coord in the matrix strip
                    if (v >= 0.0 && v < 1.0) {
                        float c = floor(v * chars_count);  //symbol index relative to the start of the strip, with addition of char_z_shift it becomes an index relative to the whole cell
                        float q = fract(v * chars_count);
                        vec2 char_hash = hash2(vec2(c+char_z_shift, cell_hash2.x));
                        if (char_hash.x >= 0.1 || c == 0.) {  //10% of missed symbols
                            float time_factor = floor(c == 0. ? time*5.0 :  //first symbol is changed fast
                                    time*(1.0*cell_hash2.z +   //strips are changed sometime with different speed
                                            cell_hash2.w*cell_hash2.w*4.*pow(char_hash.y, 4.)));  //some symbols in some strips are changed relatively often
                            float a = random_char(vec2(char_hash.x, time_factor), vec2(u,q), max(1., 3. - c/2.)*0.2);  //alpha
                            a *= clamp((chars_count - 0.5 - c) / 2., 0., 1.);  //tail fade
                            if (a > 0.) {
                                float attenuation = 1. + pow(0.06*tmin/t3_to_t2, 2.);
                                vec3 col = (c == 0. ? vec3(0.67, 1.0, 0.82) : vec3(0.25, 0.80, 0.40)) / attenuation;
                                float a1 = result.a;
                                result.a = a1 + (1. - a1) * a;
                                result.xyz = (result.xyz * a1 + col * (1. - a1) * a) / result.a;
                                if (result.a > 0.98)  return result.xyz;
                            }
                        }
                    }
                }
            }
            // not found in this cell - go to next vertical cell
            zcell += cell_shift.z;
        }
        // go to next horizontal cell
    }

    return result.xyz * result.a;
}


//        ----  main, camera  ----

vec2 rotate(vec2 v, float a) {
    float s = sin(a);
	float c = cos(a);
    mat2 m = mat2(c, -s, s, c);
    return m * v;
}

vec3 rotateX(vec3 v, float a) {
    float s = sin(a);
    float c = cos(a);
    return mat3(1.,0.,0.,0.,c,-s,0.,s,c) * v;
}

vec3 rotateY(vec3 v, float a) {
    float s = sin(a);
    float c = cos(a);
    return mat3(c,0.,-s,0.,1.,0.,s,0.,c) * v;
}

vec3 rotateZ(vec3 v, float a) {
    float s = sin(a);
    float c = cos(a);
    return mat3(c,-s,0.,s,c,0.,0.,0.,1.) * v;
}

float smoothstep1(float x) {
    return smoothstep(0., 1., x);
}

vec4 matrix() {
    if (STRIP_CHAR_WIDTH > XYCELL_SIZE || STRIP_CHAR_HEIGHT * STRIP_CHARS_MAX > ZCELL_SIZE) {
        // error
        return vec4(1., 0., 0., 1.);
    }

	vec2 uv = (gl_FragCoord.xy * 2. - resolution.xy) / resolution.y;

    float _time = time * SPEED;

    const float turn_rad = 0.25 / BLOCKS_BEFORE_TURN;   //0 .. 0.5
    const float turn_abs_time = (PI/2.*turn_rad) * 1.5;  //multiplier different than 1 means a slow down on turns
    const float turn_time = turn_abs_time / (1. - 2.*turn_rad + turn_abs_time);  //0..1, but should be <= 0.5

    float level1_size = float(BLOCK_SIZE) * BLOCKS_BEFORE_TURN * XYCELL_SIZE;
    float level2_size = 4. * level1_size;
    float gap_size = float(BLOCK_GAP) * XYCELL_SIZE;

    vec3 ro = vec3(gap_size/2., gap_size/2., 0.);
    vec3 rd = vec3(uv.x, 2.0, uv.y);

    float tq = fract(_time / (level2_size*4.) * WALK_SPEED);  //the whole cycle time counter
    float t8 = fract(tq*4.);  //time counter while walking on one of the four big sides
    float t1 = fract(t8*8.);  //time counter while walking on one of the eight sides of the big side

    vec2 prev;
    vec2 dir;
    if (tq < 0.25) {
        prev = vec2(0.,0.);
        dir = vec2(0.,1.);
    } else if (tq < 0.5) {
        prev = vec2(0.,1.);
        dir = vec2(1.,0.);
    } else if (tq < 0.75) {
        prev = vec2(1.,1.);
        dir = vec2(0.,-1.);
    } else {
        prev = vec2(1.,0.);
        dir = vec2(-1.,0.);
    }
    float angle = floor(tq * 4.);  //0..4 wich means 0..2*PI

    prev *= 4.;

    const float first_turn_look_angle = 0.4;
    const float second_turn_drift_angle = 0.5;
    const float fifth_turn_drift_angle = 0.25;

    vec2 turn;
    float turn_sign = 0.;
    vec2 dirL = rotate(dir, -PI/2.);
    vec2 dirR = -dirL;
    float up_down = 0.;
    float rotate_on_turns = 1.;
    float roll_on_turns = 1.;
    float add_angel = 0.;
    if (t8 < 0.125) {
        turn = dirL;
        //dir = dir;
        turn_sign = -1.;
        angle -= first_turn_look_angle * (max(0., t1 - (1. - turn_time*2.)) / turn_time - max(0., t1 - (1. - turn_time)) / turn_time * 2.5);
        roll_on_turns = 0.;
    } else if (t8 < 0.250) {
        prev += dir;
        turn = dir;
        dir = dirL;
        angle -= 1.;
        turn_sign = 1.;
        add_angel += first_turn_look_angle*0.5 + (-first_turn_look_angle*0.5+1.0+second_turn_drift_angle)*t1;
        rotate_on_turns = 0.;
        roll_on_turns = 0.;
    } else if (t8 < 0.375) {
        prev += dir + dirL;
        turn = dirR;
        //dir = dir;
        turn_sign = 1.;
        add_angel += second_turn_drift_angle*sqrt(1.-t1);
        //roll_on_turns = 0.;
    } else if (t8 < 0.5) {
        prev += dir + dir + dirL;
        turn = dirR;
        dir = dirR;
        angle += 1.;
        turn_sign = 0.;
        up_down = sin(t1*PI) * 0.37;
    } else if (t8 < 0.625) {
        prev += dir + dir;
        turn = dir;
        dir = dirR;
        angle += 1.;
        turn_sign = -1.;
        up_down = sin(-min(1., t1/(1.-turn_time))*PI) * 0.37;
    } else if (t8 < 0.750) {
        prev += dir + dir + dirR;
        turn = dirL;
        //dir = dir;
        turn_sign = -1.;
        add_angel -= (fifth_turn_drift_angle + 1.) * smoothstep1(t1);
        rotate_on_turns = 0.;
        roll_on_turns = 0.;
    } else if (t8 < 0.875) {
        prev += dir + dir + dir + dirR;
        turn = dir;
        dir = dirL;
        angle -= 1.;
        turn_sign = 1.;
        add_angel -= fifth_turn_drift_angle - smoothstep1(t1) * (fifth_turn_drift_angle * 2. + 1.);
        rotate_on_turns = 0.;
        roll_on_turns = 0.;
    } else {
        prev += dir + dir + dir;
        turn = dirR;
        //dir = dir;
        turn_sign = 1.;
        angle += fifth_turn_drift_angle * (1.5*min(1., (1.-t1)/turn_time) - 0.5*smoothstep1(1. - min(1.,t1/(1.-turn_time))));
    }

    angle += add_angel;

    rd = rotateX(rd, up_down);

    vec2 p;
    if (turn_sign == 0.) {
        //  move forward
        p = prev + dir * (turn_rad + 1. * t1);
    }
    else if (t1 > (1. - turn_time)) {
        //  turn
        float tr = (t1 - (1. - turn_time)) / turn_time;
        vec2 c = prev + dir * (1. - turn_rad) + turn * turn_rad;
        p = c + turn_rad * rotate(dir, (tr - 1.) * turn_sign * PI/2.);
        angle += tr * turn_sign * rotate_on_turns;
        rd = rotateY(rd, sin(tr*turn_sign*PI) * 0.2 * roll_on_turns);  //roll
    }  else  {
        //  move forward
        t1 /= (1. - turn_time);
        p = prev + dir * (turn_rad + (1. - turn_rad*2.) * t1);
    }

    rd = rotateZ(rd, angle * PI/2.);

    ro.xy += level1_size * p;

    ro += rd * 0.2;
    rd = normalize(rd);

    vec3 col = rain(ro, rd, _time);

    return vec4(col, 1.);
}
// #version 300 es
// precision highp float;


/*
Copyright 2023 Maxim Samoliuk

Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the Software), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED AS IS, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

// precision highp float;
// varying vec2 v_texcoord;
// uniform sampler2D tex;

// WARNING: DISABLE DAMAGE TRACKING, TO ADD SCANLINES, FLICKER AND
// ANALOG NOISE OR ELSE - COMMENT OUT TIME VARIABLE AND EVERY OTHER
// THING THAT USES TIME
// uniform highp float time;

// ATTENTION!! IF YOU ENABLE FLICKER - MAKE SURE TO SET PROPER DISPLAY FRAMERATE
// AND RESOLUTION VARIABLES FOR YOUR DISPLAY IF FRAMERATE IS WRONG - SHADER
// MIGHT CHANGE BRIGHTNESS RANDOMLY !! - SEE FLICKER SECTION OF THIS CODE

// const float framerate = 30.0;
//const float framerate = 60.0;
// const vec2 resolution = vec2(1128.0, 752.0);
//const vec2 display_resolution = vec2(2256.0, 1504.0);

vec2 curve(vec2 uv) {
  uv = (uv - 0.5) * 2.0;
  uv *= 1.1;
  uv.x *= 1.0 + pow((abs(uv.y) / 8.0), 2.0);
  uv.y *= 1.0 + pow((abs(uv.x) / 8.0), 2.0);
  uv = (uv / 2.0) + 0.5;
  uv = uv * 0.92 + 0.04;
  return uv;
}

float rand(vec2 uv, float t) {
  return fract(sin(dot(uv, vec2(1225.6548, 321.8942))) * 4251.4865 + t);
}

vec4 glow(vec4 background) {
  vec2 uv = sourceUV;
  // comment out to disable barrel distortion.
  // if cursor is misaligned - enable software cursor rendering
  // by setting envvar: run "export WLR_NO_HARDWARE_CURSORS=1"
  // before launching Hyprland
  vec4 pixColor = texture(sourceTexture, uv);

  vec3 col = pixColor.rgb;

  // Chromatic aberration from CRT ray misalignment
  float analog_noise = fract(sin(time) * 43758.5453123 * uv.y) * 0.0006;
  col.r =
      texture(sourceTexture, vec2(analog_noise + uv.x + 0.0008, uv.y + 0.0)).x + 0.05;
  col.g = texture(sourceTexture, vec2(analog_noise + uv.x + 0.0008, uv.y + 0.0005)).y +
          0.05;
  col.b =
      texture(sourceTexture, vec2(analog_noise + uv.x - 0.0008, uv.y + 0.0)).z + 0.05;

  ///////////////////////////////////////////////////////////////////////////////////////////////

  // Contrast
  col = mix(col, col * smoothstep(0.0, 1.0, col), 1.);
  col = mix(col, col * smoothstep(0.0, 1.0, col), 0.5);
  /////////////

  // Grain
  float scale = 2.8;
  float amount = 0.15;
  vec2 offset = (rand(uv, time) - 0.9) * 1.8 * uv * scale;
  vec3 noise = texture(sourceTexture, uv + offset).rgb;
  col.rgb = mix(col.rgb, noise, amount);
  ////////////////////////////////
  col *= 12.8;
  /////

  ///////////////////////////////////////////////////////////////////////////////////////////////

  // BLOOM
  const float blur_directions =
      24.0;                       // default is 12.0 but 24.0+ will look bestest
  const float blur_quality = 9.0; // default is 3.0  but 4.0+  will look bestest
  const float blur_size = 18.0;   // radius in pixels
  const float blur_brightness = 9.5; // radius in pixels

  vec2 blur_radius = blur_size / (resolution.xy * 0.5);

  // Blur calculations may be expensive: blur_directions * blur_quality amount
  // of iterations 12 * 3 = 36 iterations per pixel by default
  vec3 bloomColor = vec3(0.0);
  for (float d = 0.0; d < 6.283185307180;
       d += 6.283185307180 / blur_directions) {
    for (float i = 1.0 / blur_quality; i <= 1.0; i += 1.0 / blur_quality) {
      vec3 toAdd =
          texture(sourceTexture, uv + vec2(cos(d), sin(d)) * blur_radius * i).rgb;
      toAdd *= blur_brightness * vec3(1.5, 0.85, 0.40);
      bloomColor += toAdd;
    }
  }

  bloomColor /= blur_quality * blur_directions;

  col.rgb += bloomColor;
  ////////////////////////////////////////////////////////////////////////////////////////

  ///////////////////////////////////////////////////////////////////////////////////////////////

  // SCANLINES
  float scanvar = 0.1;
  float scanlines =
      clamp(scanvar + scanvar * sin(framerate * 1.95 * mod(-time, 8.0) +
                                    uv.y * resolution.y),
            0.0, 1.0);

  float s = pow(scanlines, 1.7);
  col = col * vec3(0.1, 0.4, 0.2) * vec3(0.4 + 0.7 * s);
  ///////////////////////////////////////////////////////////////////////////////////////////////

  // FLICKER
  // WARNING: this is framerate dependent, and due to floating point precision,
  // it might misbehave over time just like real CRT!!
  float flickerAmount = 0.01; // attempt to recreate CRT flicker(yes, I'm
  // serious). If behaves badly - make it smaller, or comment out
  col *= 1.0 +
         flickerAmount * sin(framerate * 2.0 * time); // comment out to
  // disable
  ///////////////////////////////////////////////////////////////////////////////////////////////

  // blacken the display edges
  if (uv.x < 0.0 || uv.x > 1.0)
    col *= 0.0;
  if (uv.y < 0.0 || uv.y > 1.0)
    col *= 0.0;

  // PHOSPHOR COATING LINES
  float phosphor = 0.10;
  float rPhosphor = clamp(
      phosphor + phosphor * sin((uv.x) * resolution.x * 1.333333333),
      0.0, 1.0);
  float gPhosphor =
      clamp(phosphor + phosphor * sin((uv.x + 0.333333333) *
                                      resolution.x * 1.333333333),
            0.0, 1.0);
  float bPhosphor =
      clamp(phosphor + phosphor * sin((uv.x + 0.666666666) *
                                      resolution.x * 1.333333333),
            0.0, 1.0);

  col.r -= rPhosphor;
  col.g -= gPhosphor;
  col.b -= bPhosphor;

  // after adding blur + normal color, brightness was doubled
  col *= 0.5;
  ///////////////////////////////////////////////////////////////////////////////////////////////
  // VIGNETTE FROM CURVATURE
  const float vignetteStrenght = 200.;
  const float vignetteExtend = 0.5;

  vec2 uv_ = uv * (1.0 - uv.yx);
  // multiply with sth for intensity
  float vignette = uv_.x * uv_.y * vignetteStrenght;
  // change pow for modifying the extend of the  vignette
  vignette = clamp(pow(vignette, vignetteExtend), 0., 1.0);

  col *= vec3(vignette);
  ///////////////////////////////////////////////////////////////////////////////////////////////

  // CRUDE COLOR GAMUT REDUCTION
  // pixColor.rgb = col; // replace below lines with this to preserve colors
  // decrease color quality
  // by blending in other colors
  // across the spectrum
  pixColor.r = mix(col.r, mix(col.g, col.b, 0.9), 0.05);
  pixColor.g = mix(col.g, mix(col.r, col.b, 0.3), 0.05);
  pixColor.b = mix(col.b, mix(col.g, col.r, 0.8), 0.05);

  pixColor.rb *= vec2(1.04, 0.8); // crt phosphor  tinting

  return pixColor * 0.9 + background * 0.1;

  // gl_FragColor = vec4(col, 1.);
}
// #version 300 es
// precision highp float;


vec2 VogelDiskSample(int sampleIndex, int sampleCount, float phi)
{
    float sampleIndexf = float(sampleIndex);
    float sampleCountf = float(sampleCount);
    
    float goldenAngle = 2.39996;

    float r = sqrt((sampleIndexf + 0.5) / sampleCountf);
    float theta = sampleIndexf * goldenAngle + phi;

    return vec2(cos(theta), sin(theta)) * r;
}

vec4 godRays() {
    // Normalized pixel coordinates (from 0 to 1)
    vec2 uv = gl_FragCoord.xy/resolution;
    
    // config variables:
    int radialSmpCount = 48;
    int softnessSmpCount = 10;
    float range = -0.5;
    float blurRadius = 0.1;
    float attenuationSoftness = 0.3;
 
 
    float rangePerSample = range / float(radialSmpCount);
 
    
    vec2 radialOrigin = vec2(0.5, 0.8); 
    radialOrigin += vec2(sin(time * 2.0), cos(time)) * vec2(0.1, 0.05) + vec2(0.1);
    
    vec4 buffer = vec4(0);
    for(int softnessSmpIdx = 0; softnessSmpIdx < softnessSmpCount; softnessSmpIdx++)
    {
        vec2 softnessOffset = VogelDiskSample(softnessSmpIdx, softnessSmpCount, 0.0) * blurRadius;
        vec2 uvOffset = softnessOffset + radialOrigin;
        vec2 uvCentered = uv - uvOffset;
        for(int radialIdx = 0; radialIdx < radialSmpCount; radialIdx++)
        {
            float stepSize = float(radialIdx) * rangePerSample;
            vec2 uv = uvCentered * (1.0 + stepSize) + uvOffset ;
            buffer += max(vec4(0.0), texture(sourceTexture, uv) - vec4(0.9)); 
        }
    }
    
  
    vec4 radialBlurTarget = buffer / float(softnessSmpCount * radialSmpCount);
    // compute attenuation
    {
        vec2 vecToOrigin = radialOrigin - uv;
        
        float invSqrFalloff = 1.0 / (dot(vecToOrigin, vecToOrigin) + attenuationSoftness);
        radialBlurTarget *= invSqrFalloff;
    }
    radialBlurTarget *=  exp2(0.9);

    vec4 background = texture(sourceTexture, sourceUV) * 0.95;
    vec4 finalColor = radialBlurTarget + background;
    
    // frankenstein reinhard tonemapping
    finalColor = (finalColor / (2.0 + finalColor)) * 2.0;
    
    // Output to screen 
    return finalColor;
}

void main() {
    outColor = glow(matrix()) + godRays();
}

//# sourceURL=src/shaders/mix.glsl`,Nn=on(function*(r){r.fill("#121212");const t=ae(),e=wv();r.add(rt(W,{ref:t,gap:30,alignItems:"center",layout:!0,children:[rt(Ut,{fill:"white",fontFamily:"JetBrainsMono Nerd Font",fontSize:400,fontWeight:900,children:"C#"}),rt(W,{direction:"column",layout:!0,children:[rt(Ut,{fill:"white",fontFamily:"JetBrainsMono Nerd Font",fontSize:150,fontWeight:900,children:"Enkapsulacja"}),rt(W,{gap:40,justifyContent:"space-between",layout:!0,children:[rt(Ut,{fill:"#ee6055",fontFamily:"JetBrainsMono Nerd Font",fontSize:130,fontWeight:700,children:"Piotr"}),rt(Ut,{fill:"#aaf683",fontFamily:"JetBrainsMono Nerd Font",fontSize:130,fontWeight:700,children:"Lesiak"})]})]})]})),r.shaders(Zb),yield*Gu(3,()=>Ku(1.75,t().scale(e.nextFloat(1.07,1.13),e.nextFloat(1.2,1.7),Ov).wait(1).back(.8,Cv))),yield*de("Introduction")});Nn.name="Introduction";Qb.attach(Nn.meta);Nn.onReplaced??=new Te(Nn.config);let Nl;Nl??=new pi("Public",!1);Nl.loadData({version:0,timeEvents:[],seed:843778258});const Jb=Nl;var tw=Object.defineProperty,ew=Object.getOwnPropertyDescriptor,_d=(r,t,e,i)=>{for(var s=i>1?void 0:i?ew(t,e):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(s=(i?o(t,e,s):o(s))||s);return i&&s&&tw(t,e,s),s};class Zn extends W{constructor(t){super({...t,layout:!0}),this.texts=[];const e=["Dostpny w klasie","Dostpny w innych klasach","Dostpny z zewntrz"];this.add(rt(be,{layout:!0,direction:"column",gap:50,padding:50,radius:25,fill:"#0c0c0c",children:[rt(W,{layout:!0,justifyContent:"center",children:rt(Ut,{fill:"white",fontSize:65,fontFamily:"JetBrainsMono Nerd Font",fontWeight:700,children:["Modyfikator ",this.modifier()]})}),e.map((i,s)=>rt(be,{layout:!0,direction:"column",gap:100,padding:50,radius:25,fill:"#151515",children:rt(Ut,{ref:Z0(this.texts,s),fill:"#a1a1a1",fontSize:50,fontFamily:"JetBrainsMono Nerd Font",fontWeight:700,children:i})}))]}))}*turnOn(){yield*Xu(.6,...this.texts.map((t,e)=>t.fill(this.accessibility()[e]?"#7ee787":"#ff7b72",.6,sf)))}}_d([_()],Zn.prototype,"modifier",2);_d([_()],Zn.prototype,"accessibility",2);const Bn=on(function*(r){r.fill("#121212");const t=ae(),e=ae();r.add(rt(Y,{children:[rt(oe,{ref:t,code:`class Vector2 {

    public double X = 21;

}`,fontFamily:"JetBrainsMono Nerd Font",fontWeight:600}),rt(Zn,{ref:e,modifier:"public",accessibility:[!0,!0,!0],position:[430,0],opacity:0})]})),yield*cl(Qt.Bottom,1.5),yield*It(1.5),yield*qu(t().code.insert([4,0],`    public double Y = 37;

`,.5),t().code.insert([6,0],`    public double Sum() {
        return X + Y;
    }

`,.6)),yield*de("Public | Code"),yield*It(1.5),yield*t().position.x(-520,.8,Me),yield*e().opacity(1,.8,Me),yield*It(1.5),yield*t().selection(t().findAllRanges("public"),.6),yield*It(.6),yield*e().turnOn(),yield*It(1.5),yield*t().selection(Be,.6),yield*de("Public | Summary")});Bn.name="Public";Jb.attach(Bn.meta);Bn.onReplaced??=new Te(Bn.config);let Bl;Bl??=new pi("Protected",!1);Bl.loadData({version:0,timeEvents:[],seed:1690859526});const iw=Bl,_n=on(function*(r){r.fill("#121212");const t=ae(),e=ae();r.add(rt(Y,{children:[rt(oe,{ref:t,code:`class Base {

    protected string chatGPTKey = "...";

}`,fontFamily:"JetBrainsMono Nerd Font",fontWeight:600}),rt(Zn,{ref:e,modifier:"protected",accessibility:[!0,!0,!1],position:[430,0],opacity:0})]})),yield*qv(t().cacheBBox(),1.5),yield*It(1.5),yield*t().code.insert([4,1],`

class Derived extends Base {

    public string Expose() {
        return chatGPTKey;
    }

}`,.9),yield*de("Protected | Code"),yield*It(1.5),yield*Lt(t().fontSize(33,.8,Me),t().position.x(-500,.8,Me)),yield*e().opacity(1,.8,Me),yield*It(1.5),yield*t().selection(t().findAllRanges("protected"),.6),yield*It(.6),yield*e().turnOn(),yield*It(1.5),yield*t().selection(Be,.6),yield*de("Protected | Summary")});_n.name="Protected";iw.attach(_n.meta);_n.onReplaced??=new Te(_n.config);let _l;_l??=new pi("Private",!1);_l.loadData({version:0,timeEvents:[],seed:2540990997});const sw=_l,$n=on(function*(r){r.fill("#121212");const t=ae(),e=ae(),i=ae();r.add(rt(Y,{ref:t,children:[rt(oe,{ref:e,code:`class KeepPrivate {

    private string phone = "667 584 036";

    private string email = "hotdelfinek69@yahoo.pl";

    private string address = "52.21566045341923, 21.017910271221744";

}`,fontSize:40,fontFamily:"JetBrainsMono Nerd Font",fontWeight:600}),rt(Zn,{ref:i,modifier:"private",accessibility:[!0,!1,!1],position:[430,0],opacity:0})]})),yield*Kv(t().cacheBBox(),1.5),yield*de("Private | Code"),yield*It(2.5),yield*Lt(e().fontSize(25,.8,Me),e().position([-500,-50],.8,Me)),yield*e().rotation(-55,.8,Me),yield*i().opacity(1,.8,Me),yield*It(1.5),yield*e().selection(e().findAllRanges("private"),.6),yield*It(.6),yield*i().turnOn(),yield*It(1.5),yield*e().selection(Be,.6),yield*Lt(t().rotation(55,.8,Me),t().position([200,400],.8,Me),e().fontSize(40,.8,Me)),yield*de("Private | Summary")});$n.name="Private";sw.attach($n.meta);$n.onReplaced??=new Te($n.config);let $l;$l??=new pi("Properties",!1);$l.loadData({version:0,timeEvents:[],seed:2530902876});const nw=$l,Fn=on(function*(r){r.fill("#121212");const t=ae(),e=ae(),i=ae(),s=ae(),n=ae(),o=ae(),a=ae(),l=ae();r.add(rt(Y,{children:[rt(Ut,{ref:t,position:[320,140],fill:"white",opacity:0,fontFamily:"JetBrainsMono Nerd Font",fontWeight:600,children:"get"}),rt(Ne,{ref:i,points:[[-515,207],[515,207]],stroke:"#4c4c4c",lineWidth:16,end:0}),rt(Ne,{ref:n,points:[[-515,207],[515,207]],stroke:"lightseagreen",lineWidth:16,end:0}),rt(Ut,{ref:e,position:[-320,390],fill:"white",opacity:0,fontFamily:"JetBrainsMono Nerd Font",fontWeight:600,children:"set"}),rt(Ne,{ref:s,points:[[-515,340],[515,340]],stroke:"#4c4c4c",lineWidth:16,end:0}),rt(Ne,{ref:o,points:[[-515,340],[515,340]],stroke:"tomato",lineWidth:16,end:0}),rt(oe,{ref:a,code:`class Storage {
    public string Property { get; set; } = "https://tiny.pl/9w4rc";
}

class Backend extends Storage {}

class User {
    Backend backend = new();
}`,position:[0,-200],opacity:0,fontSize:40,fontFamily:"JetBrainsMono Nerd Font",fontWeight:600}),rt(W,{ref:l,layout:!0,position:[0,275],width:"100%",justifyContent:"space-around",opacity:0,children:[rt(be,{layout:!0,direction:"column",alignItems:"center",justifyContent:"space-between",padding:30,radius:25,size:250,fill:"#eecd8b",children:[rt(Ut,{fontFamily:"JetBrainsMono Nerd Font",fontWeight:900,children:"Storage"}),rt(be,{layout:!0,alignItems:"center",justifyContent:"center",radius:25,marginBottom:20,width:220,height:80,fill:"#eaad61",children:rt(Ut,{fontSize:35,fontFamily:"JetBrainsMono Nerd Font",fontWeight:700,children:"Property"})})]}),rt(be,{layout:!0,justifyContent:"center",alignItems:"center",radius:25,size:250,fill:"#ea6161",children:rt(Ut,{fontSize:50,fontFamily:"JetBrainsMono Nerd Font",fontWeight:900,children:"Backend"})}),rt(be,{layout:!0,justifyContent:"center",alignItems:"center",radius:25,size:250,fill:"#cce0ac",children:rt(Ut,{fontSize:60,fontFamily:"JetBrainsMono Nerd Font",fontWeight:900,children:"User"})})]})]})),yield*cl(Qt.Right,1.5),yield*a().opacity(1,1,yt),yield*l().opacity(1,1,yt),yield*Lt(i().end(1,1,yt),s().end(1,1,yt)),yield*It(1.5),yield*Lt(t().opacity(1,1.5,yt),e().opacity(1,1.5,yt)),yield*de("Properties | Start"),yield*Lt(t().opacity(0,1,yt),e().opacity(0,1,yt)),yield*a().selection(as(1,0,40),.6,yt),yield*Lt(n().end(1,2,yt),o().end(1,2,yt)),yield*de("Properties | All Public"),yield*a().selection(Be,.6,yt),yield*Lt(a().code.insert([1,34],"protected ",.6),a().fontSize(35,.6)),yield*It(1.5),yield*a().selection(as(1,0,50),.6,yt),yield*o().end(.5,2,yt),yield*de("Properties | Public Protected"),yield*a().selection(Be,.6,yt),yield*Lt(a().code.replace(as(1,4,6),"private",.6),a().code.replace(as(1,34,10),"public ",.6)),yield*a().fontSize(38,.6),yield*It(1.5),yield*a().selection(as(1,0,48),.6,yt),yield*Lt(n().end(0,2,yt),o().end(1,2,yt)),yield*de("Properties | Private Public"),yield*a().selection(Be,.6,yt),yield*Lt(n().opacity(0,1,yt),i().opacity(0,1,yt),o().opacity(0,1,yt),s().opacity(0,1,yt),l().opacity(0,1,yt)),yield*Lt(a().position([-50,140],1.5,yt),a().scale(1.3,1.5,yt)),yield*It(.75),yield*Lt(a().code.replace(as(1,4,7),"public",1.2),a().code.replace(as(1,29),`

        private get { return otherProperty }

        set {
            if (value == "") {
                throw new Exception("Can not be empty!");
            }

            otherProperty = value;
        }

    } // no initializer
`,1.2)),yield*It(1.5),yield*a().selection(Rr(3),.6,yt),yield*de("Properties | Custom Getter"),yield*a().selection(Rr(5,11),.6,yt),yield*de("Properties | Custom Setter"),yield*a().selection(Rr(13),.6,yt),yield*de("Properties | No Initializer")});Fn.name="Properties";nw.attach(Fn.meta);Fn.onReplaced??=new Te(Fn.config);let Fl;Fl??=new pi("Ending",!1);Fl.loadData({version:0,timeEvents:[],seed:3550456209});const rw=Fl,zn=on(function*(r){r.fill("#121212"),yield*cl(Qt.Top,1.5),yield*It(2.5),yield*r.fill("white",2.5),yield*de("Ending")});zn.name="Ending";rw.attach(zn.meta);zn.onReplaced??=new Te(zn.config);const ow=Qn.define([{tag:[A.keyword,A.operator],color:"#ff7b72"},{tag:[A.namespace,A.className],color:"#ffa657"},{tag:A.string,color:"#a5d6ff"},{tag:A.number,color:"#79c0ff"},{tag:A.comment,color:"#9198a1"}]);oe.defaultHighlighter=new vo(Xb,ow);const aw={scenes:[Nn,Bn,_n,$n,Fn,zn],experimentalFeatures:!0};let zl;zl??=new pi("\0virtual:settings",!1);zl.loadData({version:1,appearance:{color:"rgb(51,166,255)",font:!1,coordinates:!0},defaults:{background:null,size:{x:1920,y:1080}}});const lw=zl,Sw=await Vv("project",{core:"3.17.0",two:"3.17.1",ui:"3.17.0",vitePlugin:"3.17.0"},[],aw,Gv,lw);export{Sw as default};
